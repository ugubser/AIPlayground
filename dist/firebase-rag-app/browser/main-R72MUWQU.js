var xU=Object.create;var Lh=Object.defineProperty,RU=Object.defineProperties,PU=Object.getOwnPropertyDescriptor,MU=Object.getOwnPropertyDescriptors,NU=Object.getOwnPropertyNames,kh=Object.getOwnPropertySymbols,ax=Object.getPrototypeOf,P_=Object.prototype.hasOwnProperty,cx=Object.prototype.propertyIsEnumerable,OU=Reflect.get;var za=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n);var ox=(n,e,t)=>e in n?Lh(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_=(n,e)=>{for(var t in e||={})P_.call(e,t)&&ox(n,t,e[t]);if(kh)for(var t of kh(e))cx.call(e,t)&&ox(n,t,e[t]);return n},P=(n,e)=>RU(n,MU(e));var nn=(n,e)=>{var t={};for(var r in n)P_.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&kh)for(var r of kh(n))e.indexOf(r)<0&&cx.call(n,r)&&(t[r]=n[r]);return t};var ie=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),lx=(n,e)=>{for(var t in e)Lh(n,t,{get:e[t],enumerable:!0})},kU=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of NU(e))!P_.call(n,i)&&i!==t&&Lh(n,i,{get:()=>e[i],enumerable:!(r=PU(e,i))||r.enumerable});return n};var Or=(n,e,t)=>(t=n!=null?xU(ax(n)):{},kU(e||!n||!n.__esModule?Lh(t,"default",{value:n,enumerable:!0}):t,n));var Kt=(n,e,t)=>OU(ax(n),t,e);var g=(n,e,t)=>new Promise((r,i)=>{var s=c=>{try{a(t.next(c))}catch(l){i(l)}},o=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(n,e)).next())}),$=function(n,e){this[0]=n,this[1]=e},we=(n,e,t)=>{var r=(o,a,c,l)=>{try{var u=t[o](a),d=(a=u.value)instanceof $,f=u.done;Promise.resolve(d?a[0]:a).then(p=>d?r(o==="return"?o:"next",a[1]?{done:p.done,value:p.value}:p,c,l):c({value:p,done:f})).catch(p=>r("throw",p,c,l))}catch(p){l(p)}},i=o=>s[o]=a=>new Promise((c,l)=>r(o,a,c,l)),s={};return t=t.apply(n,e),s[za("asyncIterator")]=()=>s,i("next"),i("throw"),i("return"),s},rn=n=>{var e=n[za("asyncIterator")],t=!1,r,i={};return e==null?(e=n[za("iterator")](),r=s=>i[s]=o=>e[s](o)):(e=e.call(n),r=s=>i[s]=o=>{if(t){if(t=!1,s==="throw")throw o;return o}return t=!0,{done:!1,value:new $(new Promise(a=>{var c=e[s](o);if(!(c instanceof Object))throw TypeError("Object expected");a(c)}),1)}}),i[za("iterator")]=()=>i,r("next"),"throw"in e?r("throw"):i.throw=s=>{throw s},"return"in e&&r("return"),i},Me=(n,e,t)=>(e=n[za("asyncIterator")])?e.call(n):(n=n[za("iterator")](),e={},t=(r,i)=>(i=n[r])&&(e[r]=s=>new Promise((o,a,c)=>(s=i.call(n,s),c=s.done,Promise.resolve(s.value).then(l=>o({value:l,done:c}),a)))),t("next"),t("return"),e);var uV=ie((Hye,lV)=>{"use strict";function Ar(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}lV.exports=Ar;Ar.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Ar.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Ar.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};Ar.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Ar.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};Ar.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};Ar.prototype.start=Ar.prototype.try;Ar.prototype.errors=function(){return this._errors};Ar.prototype.attempts=function(){return this._attempts};Ar.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,o=(n[s]||0)+1;n[s]=o,o>=t&&(e=i,t=o)}return e}});var dV=ie(Ca=>{"use strict";var VZ=uV();Ca.operation=function(n){var e=Ca.timeouts(n);return new VZ(e,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})};Ca.timeouts=function(n){if(n instanceof Array)return[].concat(n);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in n)e[t]=n[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<e.retries;i++)r.push(this.createTimeout(i,e));return n&&n.forever&&!r.length&&r.push(this.createTimeout(i,e)),r.sort(function(s,o){return s-o}),r};Ca.createTimeout=function(n,e){var t=e.randomize?Math.random()+1:1,r=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,n));return r=Math.min(r,e.maxTimeout),r};Ca.wrap=function(n,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var r in n)typeof n[r]=="function"&&t.push(r)}for(var i=0;i<t.length;i++){var s=t[i],o=n[s];n[s]=function(c){var l=Ca.operation(e),u=Array.prototype.slice.call(arguments,1),d=u.pop();u.push(function(f){l.retry(f)||(f&&(arguments[0]=l.mainError()),d.apply(this,arguments))}),l.attempt(function(){c.apply(n,u)})}.bind(n,o),n[s].options=e}}});var fV=ie((zye,hV)=>{"use strict";hV.exports=dV()});var oy=ie((mV,sy)=>{"use strict";var jZ=fV(),$Z=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],iy=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},UZ=(n,e,t)=>{let r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},BZ=n=>$Z.includes(n),pV=(n,e)=>new Promise((t,r)=>{e=_({onFailedAttempt:()=>{},retries:10},e);let i=jZ.operation(e);i.attempt(s=>g(mV,null,function*(){try{t(yield n(s))}catch(o){if(!(o instanceof Error)){r(new TypeError(`Non-error was thrown: "${o}". You should only throw errors.`));return}if(o instanceof iy)i.stop(),r(o.originalError);else if(o instanceof TypeError&&!BZ(o.message))i.stop(),r(o);else{UZ(o,s,e);try{yield e.onFailedAttempt(o)}catch(a){r(a);return}i.retry(o)||r(i.mainError())}}}))});sy.exports=pV;sy.exports.default=pV;sy.exports.AbortError=iy});var vV=ie((s_e,LC)=>{"use strict";var WZ=Object.prototype.hasOwnProperty,Ln="~";function Qd(){}Object.create&&(Qd.prototype=Object.create(null),new Qd().__proto__||(Ln=!1));function KZ(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function _V(n,e,t,r,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new KZ(t,r||n,i),o=Ln?Ln+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],s]:n._events[o].push(s):(n._events[o]=s,n._eventsCount++),n}function uy(n,e){--n._eventsCount===0?n._events=new Qd:delete n._events[e]}function Cn(){this._events=new Qd,this._eventsCount=0}Cn.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)WZ.call(t,r)&&e.push(Ln?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Cn.prototype.listeners=function(e){var t=Ln?Ln+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o};Cn.prototype.listenerCount=function(e){var t=Ln?Ln+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Cn.prototype.emit=function(e,t,r,i,s,o){var a=Ln?Ln+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,d;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,s),!0;case 6:return c.fn.call(c.context,t,r,i,s,o),!0}for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c.fn.apply(c.context,u)}else{var f=c.length,p;for(d=0;d<f;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),l){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,r);break;case 4:c[d].fn.call(c[d].context,t,r,i);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];c[d].fn.apply(c[d].context,u)}}return!0};Cn.prototype.on=function(e,t,r){return _V(this,e,t,r,!1)};Cn.prototype.once=function(e,t,r){return _V(this,e,t,r,!0)};Cn.prototype.removeListener=function(e,t,r,i){var s=Ln?Ln+e:e;if(!this._events[s])return this;if(!t)return uy(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!r||o.context===r)&&uy(this,s);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==t||i&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[s]=c.length===1?c[0]:c:uy(this,s)}return this};Cn.prototype.removeAllListeners=function(e){var t;return e?(t=Ln?Ln+e:e,this._events[t]&&uy(this,t)):(this._events=new Qd,this._eventsCount=0),this};Cn.prototype.off=Cn.prototype.removeListener;Cn.prototype.addListener=Cn.prototype.on;Cn.prefixed=Ln;Cn.EventEmitter=Cn;typeof LC<"u"&&(LC.exports=Cn)});var bV=ie((o_e,wV)=>{"use strict";wV.exports=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))});var IV=ie((a_e,hy)=>{"use strict";var YZ=bV(),dy=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},EV=(n,e,t)=>new Promise((r,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}let s=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(c){i(c)}return}let o=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,a=t instanceof Error?t:new dy(o);typeof n.cancel=="function"&&n.cancel(),i(a)},e);YZ(n.then(r,i),()=>{clearTimeout(s)})});hy.exports=EV;hy.exports.default=EV;hy.exports.TimeoutError=dy});var AV=ie(FC=>{"use strict";Object.defineProperty(FC,"__esModule",{value:!0});function QZ(n,e,t){let r=0,i=n.length;for(;i>0;){let s=i/2|0,o=r+s;t(n[o],e)<=0?(r=++o,i-=s+1):i=s}return r}FC.default=QZ});var TV=ie(jC=>{"use strict";Object.defineProperty(jC,"__esModule",{value:!0});var XZ=AV(),VC=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let i=XZ.default(this._queue,r,(s,o)=>o.priority-s.priority);this._queue.splice(i,0,r)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};jC.default=VC});var py=ie(UC=>{"use strict";Object.defineProperty(UC,"__esModule",{value:!0});var ZZ=vV(),CV=IV(),JZ=TV(),fy=()=>{},eJ=new CV.TimeoutError,$C=class extends ZZ{constructor(e){var t,r,i,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=fy,this._resolveIdle=fy,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:JZ.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=fy,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=fy,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}add(r){return g(this,arguments,function*(e,t={}){return new Promise((i,s)=>{let o=()=>g(this,null,function*(){this._pendingCount++,this._intervalCount++;try{let a=this._timeout===void 0&&t.timeout===void 0?e():CV.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(eJ)});i(yield a)}catch(a){s(a)}this._next()});this._queue.enqueue(o,t),this._tryToStartAnother(),this.emit("add")})})}addAll(e,t){return g(this,null,function*(){return Promise.all(e.map(r=>g(this,null,function*(){return this.add(r,t)})))})}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}onEmpty(){return g(this,null,function*(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})})}onIdle(){return g(this,null,function*(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};UC.default=$C});var Zd=ie((w_e,xV)=>{"use strict";var sJ="2.0.0",oJ=Number.MAX_SAFE_INTEGER||9007199254740991,aJ=16,cJ=250,lJ=["major","premajor","minor","preminor","patch","prepatch","prerelease"];xV.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:aJ,MAX_SAFE_BUILD_LENGTH:cJ,MAX_SAFE_INTEGER:oJ,RELEASE_TYPES:lJ,SEMVER_SPEC_VERSION:sJ,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Jd=ie((b_e,RV)=>{"use strict";var uJ=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};RV.exports=uJ});var El=ie((Vi,PV)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:qC,MAX_SAFE_BUILD_LENGTH:dJ,MAX_LENGTH:hJ}=Zd(),fJ=Jd();Vi=PV.exports={};var pJ=Vi.re=[],mJ=Vi.safeRe=[],Y=Vi.src=[],gJ=Vi.safeSrc=[],Q=Vi.t={},yJ=0,zC="[a-zA-Z0-9-]",_J=[["\\s",1],["\\d",hJ],[zC,dJ]],vJ=n=>{for(let[e,t]of _J)n=n.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return n},Ie=(n,e,t)=>{let r=vJ(e),i=yJ++;fJ(n,i,e),Q[n]=i,Y[i]=e,gJ[i]=r,pJ[i]=new RegExp(e,t?"g":void 0),mJ[i]=new RegExp(r,t?"g":void 0)};Ie("NUMERICIDENTIFIER","0|[1-9]\\d*");Ie("NUMERICIDENTIFIERLOOSE","\\d+");Ie("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${zC}*`);Ie("MAINVERSION",`(${Y[Q.NUMERICIDENTIFIER]})\\.(${Y[Q.NUMERICIDENTIFIER]})\\.(${Y[Q.NUMERICIDENTIFIER]})`);Ie("MAINVERSIONLOOSE",`(${Y[Q.NUMERICIDENTIFIERLOOSE]})\\.(${Y[Q.NUMERICIDENTIFIERLOOSE]})\\.(${Y[Q.NUMERICIDENTIFIERLOOSE]})`);Ie("PRERELEASEIDENTIFIER",`(?:${Y[Q.NONNUMERICIDENTIFIER]}|${Y[Q.NUMERICIDENTIFIER]})`);Ie("PRERELEASEIDENTIFIERLOOSE",`(?:${Y[Q.NONNUMERICIDENTIFIER]}|${Y[Q.NUMERICIDENTIFIERLOOSE]})`);Ie("PRERELEASE",`(?:-(${Y[Q.PRERELEASEIDENTIFIER]}(?:\\.${Y[Q.PRERELEASEIDENTIFIER]})*))`);Ie("PRERELEASELOOSE",`(?:-?(${Y[Q.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${Y[Q.PRERELEASEIDENTIFIERLOOSE]})*))`);Ie("BUILDIDENTIFIER",`${zC}+`);Ie("BUILD",`(?:\\+(${Y[Q.BUILDIDENTIFIER]}(?:\\.${Y[Q.BUILDIDENTIFIER]})*))`);Ie("FULLPLAIN",`v?${Y[Q.MAINVERSION]}${Y[Q.PRERELEASE]}?${Y[Q.BUILD]}?`);Ie("FULL",`^${Y[Q.FULLPLAIN]}$`);Ie("LOOSEPLAIN",`[v=\\s]*${Y[Q.MAINVERSIONLOOSE]}${Y[Q.PRERELEASELOOSE]}?${Y[Q.BUILD]}?`);Ie("LOOSE",`^${Y[Q.LOOSEPLAIN]}$`);Ie("GTLT","((?:<|>)?=?)");Ie("XRANGEIDENTIFIERLOOSE",`${Y[Q.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);Ie("XRANGEIDENTIFIER",`${Y[Q.NUMERICIDENTIFIER]}|x|X|\\*`);Ie("XRANGEPLAIN",`[v=\\s]*(${Y[Q.XRANGEIDENTIFIER]})(?:\\.(${Y[Q.XRANGEIDENTIFIER]})(?:\\.(${Y[Q.XRANGEIDENTIFIER]})(?:${Y[Q.PRERELEASE]})?${Y[Q.BUILD]}?)?)?`);Ie("XRANGEPLAINLOOSE",`[v=\\s]*(${Y[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${Y[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${Y[Q.XRANGEIDENTIFIERLOOSE]})(?:${Y[Q.PRERELEASELOOSE]})?${Y[Q.BUILD]}?)?)?`);Ie("XRANGE",`^${Y[Q.GTLT]}\\s*${Y[Q.XRANGEPLAIN]}$`);Ie("XRANGELOOSE",`^${Y[Q.GTLT]}\\s*${Y[Q.XRANGEPLAINLOOSE]}$`);Ie("COERCEPLAIN",`(^|[^\\d])(\\d{1,${qC}})(?:\\.(\\d{1,${qC}}))?(?:\\.(\\d{1,${qC}}))?`);Ie("COERCE",`${Y[Q.COERCEPLAIN]}(?:$|[^\\d])`);Ie("COERCEFULL",Y[Q.COERCEPLAIN]+`(?:${Y[Q.PRERELEASE]})?(?:${Y[Q.BUILD]})?(?:$|[^\\d])`);Ie("COERCERTL",Y[Q.COERCE],!0);Ie("COERCERTLFULL",Y[Q.COERCEFULL],!0);Ie("LONETILDE","(?:~>?)");Ie("TILDETRIM",`(\\s*)${Y[Q.LONETILDE]}\\s+`,!0);Vi.tildeTrimReplace="$1~";Ie("TILDE",`^${Y[Q.LONETILDE]}${Y[Q.XRANGEPLAIN]}$`);Ie("TILDELOOSE",`^${Y[Q.LONETILDE]}${Y[Q.XRANGEPLAINLOOSE]}$`);Ie("LONECARET","(?:\\^)");Ie("CARETTRIM",`(\\s*)${Y[Q.LONECARET]}\\s+`,!0);Vi.caretTrimReplace="$1^";Ie("CARET",`^${Y[Q.LONECARET]}${Y[Q.XRANGEPLAIN]}$`);Ie("CARETLOOSE",`^${Y[Q.LONECARET]}${Y[Q.XRANGEPLAINLOOSE]}$`);Ie("COMPARATORLOOSE",`^${Y[Q.GTLT]}\\s*(${Y[Q.LOOSEPLAIN]})$|^$`);Ie("COMPARATOR",`^${Y[Q.GTLT]}\\s*(${Y[Q.FULLPLAIN]})$|^$`);Ie("COMPARATORTRIM",`(\\s*)${Y[Q.GTLT]}\\s*(${Y[Q.LOOSEPLAIN]}|${Y[Q.XRANGEPLAIN]})`,!0);Vi.comparatorTrimReplace="$1$2$3";Ie("HYPHENRANGE",`^\\s*(${Y[Q.XRANGEPLAIN]})\\s+-\\s+(${Y[Q.XRANGEPLAIN]})\\s*$`);Ie("HYPHENRANGELOOSE",`^\\s*(${Y[Q.XRANGEPLAINLOOSE]})\\s+-\\s+(${Y[Q.XRANGEPLAINLOOSE]})\\s*$`);Ie("STAR","(<|>)?=?\\s*\\*");Ie("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");Ie("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var yy=ie((E_e,MV)=>{"use strict";var wJ=Object.freeze({loose:!0}),bJ=Object.freeze({}),EJ=n=>n?typeof n!="object"?wJ:n:bJ;MV.exports=EJ});var GC=ie((I_e,kV)=>{"use strict";var NV=/^[0-9]+$/,OV=(n,e)=>{let t=NV.test(n),r=NV.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},IJ=(n,e)=>OV(e,n);kV.exports={compareIdentifiers:OV,rcompareIdentifiers:IJ}});var Sn=ie((A_e,FV)=>{"use strict";var _y=Jd(),{MAX_LENGTH:LV,MAX_SAFE_INTEGER:vy}=Zd(),{safeRe:wy,t:by}=El(),AJ=yy(),{compareIdentifiers:Il}=GC(),WC=class n{constructor(e,t){if(t=AJ(t),e instanceof n){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>LV)throw new TypeError(`version is longer than ${LV} characters`);_y("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?wy[by.LOOSE]:wy[by.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>vy||this.major<0)throw new TypeError("Invalid major version");if(this.minor>vy||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>vy||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<vy)return s}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(_y("SemVer.compare",this.version,this.options,e),!(e instanceof n)){if(typeof e=="string"&&e===this.version)return 0;e=new n(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof n||(e=new n(e,this.options)),Il(this.major,e.major)||Il(this.minor,e.minor)||Il(this.patch,e.patch)}comparePre(e){if(e instanceof n||(e=new n(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],i=e.prerelease[t];if(_y("prerelease compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Il(r,i)}while(++t)}compareBuild(e){e instanceof n||(e=new n(e,this.options));let t=0;do{let r=this.build[t],i=e.build[t];if(_y("build compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Il(r,i)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let i=`-${t}`.match(this.options.loose?wy[by.PRERELEASELOOSE]:wy[by.PRERELEASE]);if(!i||i[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];r===!1&&(s=[t]),Il(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};FV.exports=WC});var Da=ie((T_e,jV)=>{"use strict";var VV=Sn(),TJ=(n,e,t=!1)=>{if(n instanceof VV)return n;try{return new VV(n,e)}catch(r){if(!t)return null;throw r}};jV.exports=TJ});var UV=ie((C_e,$V)=>{"use strict";var CJ=Da(),SJ=(n,e)=>{let t=CJ(n,e);return t?t.version:null};$V.exports=SJ});var HV=ie((S_e,BV)=>{"use strict";var DJ=Da(),xJ=(n,e)=>{let t=DJ(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null};BV.exports=xJ});var GV=ie((D_e,zV)=>{"use strict";var qV=Sn(),RJ=(n,e,t,r,i)=>{typeof t=="string"&&(i=r,r=t,t=void 0);try{return new qV(n instanceof qV?n.version:n,t).inc(e,r,i).version}catch{return null}};zV.exports=RJ});var YV=ie((x_e,KV)=>{"use strict";var WV=Da(),PJ=(n,e)=>{let t=WV(n,null,!0),r=WV(e,null,!0),i=t.compare(r);if(i===0)return null;let s=i>0,o=s?t:r,a=s?r:t,c=!!o.prerelease.length;if(!!a.prerelease.length&&!c){if(!a.patch&&!a.minor)return"major";if(a.compareMain(o)===0)return a.minor&&!a.patch?"minor":"patch"}let u=c?"pre":"";return t.major!==r.major?u+"major":t.minor!==r.minor?u+"minor":t.patch!==r.patch?u+"patch":"prerelease"};KV.exports=PJ});var XV=ie((R_e,QV)=>{"use strict";var MJ=Sn(),NJ=(n,e)=>new MJ(n,e).major;QV.exports=NJ});var JV=ie((P_e,ZV)=>{"use strict";var OJ=Sn(),kJ=(n,e)=>new OJ(n,e).minor;ZV.exports=kJ});var tj=ie((M_e,ej)=>{"use strict";var LJ=Sn(),FJ=(n,e)=>new LJ(n,e).patch;ej.exports=FJ});var rj=ie((N_e,nj)=>{"use strict";var VJ=Da(),jJ=(n,e)=>{let t=VJ(n,e);return t&&t.prerelease.length?t.prerelease:null};nj.exports=jJ});var Tr=ie((O_e,sj)=>{"use strict";var ij=Sn(),$J=(n,e,t)=>new ij(n,t).compare(new ij(e,t));sj.exports=$J});var aj=ie((k_e,oj)=>{"use strict";var UJ=Tr(),BJ=(n,e,t)=>UJ(e,n,t);oj.exports=BJ});var lj=ie((L_e,cj)=>{"use strict";var HJ=Tr(),qJ=(n,e)=>HJ(n,e,!0);cj.exports=qJ});var Ey=ie((F_e,dj)=>{"use strict";var uj=Sn(),zJ=(n,e,t)=>{let r=new uj(n,t),i=new uj(e,t);return r.compare(i)||r.compareBuild(i)};dj.exports=zJ});var fj=ie((V_e,hj)=>{"use strict";var GJ=Ey(),WJ=(n,e)=>n.sort((t,r)=>GJ(t,r,e));hj.exports=WJ});var mj=ie((j_e,pj)=>{"use strict";var KJ=Ey(),YJ=(n,e)=>n.sort((t,r)=>KJ(r,t,e));pj.exports=YJ});var eh=ie(($_e,gj)=>{"use strict";var QJ=Tr(),XJ=(n,e,t)=>QJ(n,e,t)>0;gj.exports=XJ});var Iy=ie((U_e,yj)=>{"use strict";var ZJ=Tr(),JJ=(n,e,t)=>ZJ(n,e,t)<0;yj.exports=JJ});var KC=ie((B_e,_j)=>{"use strict";var eee=Tr(),tee=(n,e,t)=>eee(n,e,t)===0;_j.exports=tee});var YC=ie((H_e,vj)=>{"use strict";var nee=Tr(),ree=(n,e,t)=>nee(n,e,t)!==0;vj.exports=ree});var Ay=ie((q_e,wj)=>{"use strict";var iee=Tr(),see=(n,e,t)=>iee(n,e,t)>=0;wj.exports=see});var Ty=ie((z_e,bj)=>{"use strict";var oee=Tr(),aee=(n,e,t)=>oee(n,e,t)<=0;bj.exports=aee});var QC=ie((G_e,Ej)=>{"use strict";var cee=KC(),lee=YC(),uee=eh(),dee=Ay(),hee=Iy(),fee=Ty(),pee=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return cee(n,t,r);case"!=":return lee(n,t,r);case">":return uee(n,t,r);case">=":return dee(n,t,r);case"<":return hee(n,t,r);case"<=":return fee(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};Ej.exports=pee});var Aj=ie((W_e,Ij)=>{"use strict";var mee=Sn(),gee=Da(),{safeRe:Cy,t:Sy}=El(),yee=(n,e)=>{if(n instanceof mee)return n;if(typeof n=="number"&&(n=String(n)),typeof n!="string")return null;e=e||{};let t=null;if(!e.rtl)t=n.match(e.includePrerelease?Cy[Sy.COERCEFULL]:Cy[Sy.COERCE]);else{let c=e.includePrerelease?Cy[Sy.COERCERTLFULL]:Cy[Sy.COERCERTL],l;for(;(l=c.exec(n))&&(!t||t.index+t[0].length!==n.length);)(!t||l.index+l[0].length!==t.index+t[0].length)&&(t=l),c.lastIndex=l.index+l[1].length+l[2].length;c.lastIndex=-1}if(t===null)return null;let r=t[2],i=t[3]||"0",s=t[4]||"0",o=e.includePrerelease&&t[5]?`-${t[5]}`:"",a=e.includePrerelease&&t[6]?`+${t[6]}`:"";return gee(`${r}.${i}.${s}${o}${a}`,e)};Ij.exports=yee});var Cj=ie((K_e,Tj)=>{"use strict";var XC=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};Tj.exports=XC});var Cr=ie((Y_e,Rj)=>{"use strict";var _ee=/\s+/g,ZC=class n{constructor(e,t){if(t=wee(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof JC)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(_ee," "),this.set=this.raw.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(i=>!Dj(i[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&See(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let r=0;r<t.length;r++)r>0&&(this.formatted+=" "),this.formatted+=t[r].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let r=((this.options.includePrerelease&&Tee)|(this.options.loose&&Cee))+":"+e,i=Sj.get(r);if(i)return i;let s=this.options.loose,o=s?Zn[Fn.HYPHENRANGELOOSE]:Zn[Fn.HYPHENRANGE];e=e.replace(o,Fee(this.options.includePrerelease)),yt("hyphen replace",e),e=e.replace(Zn[Fn.COMPARATORTRIM],Eee),yt("comparator trim",e),e=e.replace(Zn[Fn.TILDETRIM],Iee),yt("tilde trim",e),e=e.replace(Zn[Fn.CARETTRIM],Aee),yt("caret trim",e);let a=e.split(" ").map(d=>Dee(d,this.options)).join(" ").split(/\s+/).map(d=>Lee(d,this.options));s&&(a=a.filter(d=>(yt("loose invalid filter",d,this.options),!!d.match(Zn[Fn.COMPARATORLOOSE])))),yt("range list",a);let c=new Map,l=a.map(d=>new JC(d,this.options));for(let d of l){if(Dj(d))return[d];c.set(d.value,d)}c.size>1&&c.has("")&&c.delete("");let u=[...c.values()];return Sj.set(r,u),u}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some(r=>xj(r,t)&&e.set.some(i=>xj(i,t)&&r.every(s=>i.every(o=>s.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new bee(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(Vee(this.set[t],e,this.options))return!0;return!1}};Rj.exports=ZC;var vee=Cj(),Sj=new vee,wee=yy(),JC=th(),yt=Jd(),bee=Sn(),{safeRe:Zn,t:Fn,comparatorTrimReplace:Eee,tildeTrimReplace:Iee,caretTrimReplace:Aee}=El(),{FLAG_INCLUDE_PRERELEASE:Tee,FLAG_LOOSE:Cee}=Zd(),Dj=n=>n.value==="<0.0.0-0",See=n=>n.value==="",xj=(n,e)=>{let t=!0,r=n.slice(),i=r.pop();for(;t&&r.length;)t=r.every(s=>i.intersects(s,e)),i=r.pop();return t},Dee=(n,e)=>(yt("comp",n,e),n=Pee(n,e),yt("caret",n),n=xee(n,e),yt("tildes",n),n=Nee(n,e),yt("xrange",n),n=kee(n,e),yt("stars",n),n),Vn=n=>!n||n.toLowerCase()==="x"||n==="*",xee=(n,e)=>n.trim().split(/\s+/).map(t=>Ree(t,e)).join(" "),Ree=(n,e)=>{let t=e.loose?Zn[Fn.TILDELOOSE]:Zn[Fn.TILDE];return n.replace(t,(r,i,s,o,a)=>{yt("tilde",n,r,i,s,o,a);let c;return Vn(i)?c="":Vn(s)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:Vn(o)?c=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:a?(yt("replaceTilde pr",a),c=`>=${i}.${s}.${o}-${a} <${i}.${+s+1}.0-0`):c=`>=${i}.${s}.${o} <${i}.${+s+1}.0-0`,yt("tilde return",c),c})},Pee=(n,e)=>n.trim().split(/\s+/).map(t=>Mee(t,e)).join(" "),Mee=(n,e)=>{yt("caret",n,e);let t=e.loose?Zn[Fn.CARETLOOSE]:Zn[Fn.CARET],r=e.includePrerelease?"-0":"";return n.replace(t,(i,s,o,a,c)=>{yt("caret",n,i,s,o,a,c);let l;return Vn(s)?l="":Vn(o)?l=`>=${s}.0.0${r} <${+s+1}.0.0-0`:Vn(a)?s==="0"?l=`>=${s}.${o}.0${r} <${s}.${+o+1}.0-0`:l=`>=${s}.${o}.0${r} <${+s+1}.0.0-0`:c?(yt("replaceCaret pr",c),s==="0"?o==="0"?l=`>=${s}.${o}.${a}-${c} <${s}.${o}.${+a+1}-0`:l=`>=${s}.${o}.${a}-${c} <${s}.${+o+1}.0-0`:l=`>=${s}.${o}.${a}-${c} <${+s+1}.0.0-0`):(yt("no pr"),s==="0"?o==="0"?l=`>=${s}.${o}.${a}${r} <${s}.${o}.${+a+1}-0`:l=`>=${s}.${o}.${a}${r} <${s}.${+o+1}.0-0`:l=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),yt("caret return",l),l})},Nee=(n,e)=>(yt("replaceXRanges",n,e),n.split(/\s+/).map(t=>Oee(t,e)).join(" ")),Oee=(n,e)=>{n=n.trim();let t=e.loose?Zn[Fn.XRANGELOOSE]:Zn[Fn.XRANGE];return n.replace(t,(r,i,s,o,a,c)=>{yt("xRange",n,r,i,s,o,a,c);let l=Vn(s),u=l||Vn(o),d=u||Vn(a),f=d;return i==="="&&f&&(i=""),c=e.includePrerelease?"-0":"",l?i===">"||i==="<"?r="<0.0.0-0":r="*":i&&f?(u&&(o=0),a=0,i===">"?(i=">=",u?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):i==="<="&&(i="<",u?s=+s+1:o=+o+1),i==="<"&&(c="-0"),r=`${i+s}.${o}.${a}${c}`):u?r=`>=${s}.0.0${c} <${+s+1}.0.0-0`:d&&(r=`>=${s}.${o}.0${c} <${s}.${+o+1}.0-0`),yt("xRange return",r),r})},kee=(n,e)=>(yt("replaceStars",n,e),n.trim().replace(Zn[Fn.STAR],"")),Lee=(n,e)=>(yt("replaceGTE0",n,e),n.trim().replace(Zn[e.includePrerelease?Fn.GTE0PRE:Fn.GTE0],"")),Fee=n=>(e,t,r,i,s,o,a,c,l,u,d,f)=>(Vn(r)?t="":Vn(i)?t=`>=${r}.0.0${n?"-0":""}`:Vn(s)?t=`>=${r}.${i}.0${n?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${n?"-0":""}`,Vn(l)?c="":Vn(u)?c=`<${+l+1}.0.0-0`:Vn(d)?c=`<${l}.${+u+1}.0-0`:f?c=`<=${l}.${u}.${d}-${f}`:n?c=`<${l}.${u}.${+d+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),Vee=(n,e,t)=>{for(let r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let r=0;r<n.length;r++)if(yt(n[r].semver),n[r].semver!==JC.ANY&&n[r].semver.prerelease.length>0){let i=n[r].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var th=ie((Q_e,Lj)=>{"use strict";var nh=Symbol("SemVer ANY"),nS=class n{static get ANY(){return nh}constructor(e,t){if(t=Pj(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),tS("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===nh?this.value="":this.value=this.operator+this.semver.version,tS("comp",this)}parse(e){let t=this.options.loose?Mj[Nj.COMPARATORLOOSE]:Mj[Nj.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new Oj(r[2],this.options.loose):this.semver=nh}toString(){return this.value}test(e){if(tS("Comparator.test",e,this.options.loose),this.semver===nh||e===nh)return!0;if(typeof e=="string")try{e=new Oj(e,this.options)}catch{return!1}return eS(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new kj(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new kj(this.value,t).test(e.semver):(t=Pj(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||eS(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||eS(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Lj.exports=nS;var Pj=yy(),{safeRe:Mj,t:Nj}=El(),eS=QC(),tS=Jd(),Oj=Sn(),kj=Cr()});var rh=ie((X_e,Fj)=>{"use strict";var jee=Cr(),$ee=(n,e,t)=>{try{e=new jee(e,t)}catch{return!1}return e.test(n)};Fj.exports=$ee});var jj=ie((Z_e,Vj)=>{"use strict";var Uee=Cr(),Bee=(n,e)=>new Uee(n,e).set.map(t=>t.map(r=>r.value).join(" ").trim().split(" "));Vj.exports=Bee});var Uj=ie((J_e,$j)=>{"use strict";var Hee=Sn(),qee=Cr(),zee=(n,e,t)=>{let r=null,i=null,s=null;try{s=new qee(e,t)}catch{return null}return n.forEach(o=>{s.test(o)&&(!r||i.compare(o)===-1)&&(r=o,i=new Hee(r,t))}),r};$j.exports=zee});var Hj=ie((eve,Bj)=>{"use strict";var Gee=Sn(),Wee=Cr(),Kee=(n,e,t)=>{let r=null,i=null,s=null;try{s=new Wee(e,t)}catch{return null}return n.forEach(o=>{s.test(o)&&(!r||i.compare(o)===1)&&(r=o,i=new Gee(r,t))}),r};Bj.exports=Kee});var Gj=ie((tve,zj)=>{"use strict";var rS=Sn(),Yee=Cr(),qj=eh(),Qee=(n,e)=>{n=new Yee(n,e);let t=new rS("0.0.0");if(n.test(t)||(t=new rS("0.0.0-0"),n.test(t)))return t;t=null;for(let r=0;r<n.set.length;++r){let i=n.set[r],s=null;i.forEach(o=>{let a=new rS(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!s||qj(a,s))&&(s=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),s&&(!t||qj(t,s))&&(t=s)}return t&&n.test(t)?t:null};zj.exports=Qee});var Kj=ie((nve,Wj)=>{"use strict";var Xee=Cr(),Zee=(n,e)=>{try{return new Xee(n,e).range||"*"}catch{return null}};Wj.exports=Zee});var Dy=ie((rve,Zj)=>{"use strict";var Jee=Sn(),Xj=th(),{ANY:ete}=Xj,tte=Cr(),nte=rh(),Yj=eh(),Qj=Iy(),rte=Ty(),ite=Ay(),ste=(n,e,t,r)=>{n=new Jee(n,r),e=new tte(e,r);let i,s,o,a,c;switch(t){case">":i=Yj,s=rte,o=Qj,a=">",c=">=";break;case"<":i=Qj,s=ite,o=Yj,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(nte(n,e,r))return!1;for(let l=0;l<e.set.length;++l){let u=e.set[l],d=null,f=null;if(u.forEach(p=>{p.semver===ete&&(p=new Xj(">=0.0.0")),d=d||p,f=f||p,i(p.semver,d.semver,r)?d=p:o(p.semver,f.semver,r)&&(f=p)}),d.operator===a||d.operator===c||(!f.operator||f.operator===a)&&s(n,f.semver))return!1;if(f.operator===c&&o(n,f.semver))return!1}return!0};Zj.exports=ste});var e2=ie((ive,Jj)=>{"use strict";var ote=Dy(),ate=(n,e,t)=>ote(n,e,">",t);Jj.exports=ate});var n2=ie((sve,t2)=>{"use strict";var cte=Dy(),lte=(n,e,t)=>cte(n,e,"<",t);t2.exports=lte});var s2=ie((ove,i2)=>{"use strict";var r2=Cr(),ute=(n,e,t)=>(n=new r2(n,t),e=new r2(e,t),n.intersects(e,t));i2.exports=ute});var a2=ie((ave,o2)=>{"use strict";var dte=rh(),hte=Tr();o2.exports=(n,e,t)=>{let r=[],i=null,s=null,o=n.sort((u,d)=>hte(u,d,t));for(let u of o)dte(u,e,t)?(s=u,i||(i=u)):(s&&r.push([i,s]),s=null,i=null);i&&r.push([i,null]);let a=[];for(let[u,d]of r)u===d?a.push(u):!d&&u===o[0]?a.push("*"):d?u===o[0]?a.push(`<=${d}`):a.push(`${u} - ${d}`):a.push(`>=${u}`);let c=a.join(" || "),l=typeof e.raw=="string"?e.raw:String(e);return c.length<l.length?c:e}});var f2=ie((cve,h2)=>{"use strict";var c2=Cr(),sS=th(),{ANY:iS}=sS,ih=rh(),oS=Tr(),fte=(n,e,t={})=>{if(n===e)return!0;n=new c2(n,t),e=new c2(e,t);let r=!1;e:for(let i of n.set){for(let s of e.set){let o=mte(i,s,t);if(r=r||o!==null,o)continue e}if(r)return!1}return!0},pte=[new sS(">=0.0.0-0")],l2=[new sS(">=0.0.0")],mte=(n,e,t)=>{if(n===e)return!0;if(n.length===1&&n[0].semver===iS){if(e.length===1&&e[0].semver===iS)return!0;t.includePrerelease?n=pte:n=l2}if(e.length===1&&e[0].semver===iS){if(t.includePrerelease)return!0;e=l2}let r=new Set,i,s;for(let p of n)p.operator===">"||p.operator===">="?i=u2(i,p,t):p.operator==="<"||p.operator==="<="?s=d2(s,p,t):r.add(p.semver);if(r.size>1)return null;let o;if(i&&s){if(o=oS(i.semver,s.semver,t),o>0)return null;if(o===0&&(i.operator!==">="||s.operator!=="<="))return null}for(let p of r){if(i&&!ih(p,String(i),t)||s&&!ih(p,String(s),t))return null;for(let y of e)if(!ih(p,String(y),t))return!1;return!0}let a,c,l,u,d=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1,f=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1;d&&d.prerelease.length===1&&s.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let p of e){if(u=u||p.operator===">"||p.operator===">=",l=l||p.operator==="<"||p.operator==="<=",i){if(f&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===f.major&&p.semver.minor===f.minor&&p.semver.patch===f.patch&&(f=!1),p.operator===">"||p.operator===">="){if(a=u2(i,p,t),a===p&&a!==i)return!1}else if(i.operator===">="&&!ih(i.semver,String(p),t))return!1}if(s){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator==="<"||p.operator==="<="){if(c=d2(s,p,t),c===p&&c!==s)return!1}else if(s.operator==="<="&&!ih(s.semver,String(p),t))return!1}if(!p.operator&&(s||i)&&o!==0)return!1}return!(i&&l&&!s&&o!==0||s&&u&&!i&&o!==0||f||d)},u2=(n,e,t)=>{if(!n)return e;let r=oS(n.semver,e.semver,t);return r>0?n:r<0||e.operator===">"&&n.operator===">="?e:n},d2=(n,e,t)=>{if(!n)return e;let r=oS(n.semver,e.semver,t);return r<0?n:r>0||e.operator==="<"&&n.operator==="<="?e:n};h2.exports=fte});var y2=ie((lve,g2)=>{"use strict";var aS=El(),p2=Zd(),gte=Sn(),m2=GC(),yte=Da(),_te=UV(),vte=HV(),wte=GV(),bte=YV(),Ete=XV(),Ite=JV(),Ate=tj(),Tte=rj(),Cte=Tr(),Ste=aj(),Dte=lj(),xte=Ey(),Rte=fj(),Pte=mj(),Mte=eh(),Nte=Iy(),Ote=KC(),kte=YC(),Lte=Ay(),Fte=Ty(),Vte=QC(),jte=Aj(),$te=th(),Ute=Cr(),Bte=rh(),Hte=jj(),qte=Uj(),zte=Hj(),Gte=Gj(),Wte=Kj(),Kte=Dy(),Yte=e2(),Qte=n2(),Xte=s2(),Zte=a2(),Jte=f2();g2.exports={parse:yte,valid:_te,clean:vte,inc:wte,diff:bte,major:Ete,minor:Ite,patch:Ate,prerelease:Tte,compare:Cte,rcompare:Ste,compareLoose:Dte,compareBuild:xte,sort:Rte,rsort:Pte,gt:Mte,lt:Nte,eq:Ote,neq:kte,gte:Lte,lte:Fte,cmp:Vte,coerce:jte,Comparator:$te,Range:Ute,satisfies:Bte,toComparators:Hte,maxSatisfying:qte,minSatisfying:zte,minVersion:Gte,validRange:Wte,outside:Kte,gtr:Yte,ltr:Qte,intersects:Xte,simplifyRange:Zte,subset:Jte,SemVer:gte,re:aS.re,src:aS.src,tokens:aS.t,SEMVER_SPEC_VERSION:p2.SEMVER_SPEC_VERSION,RELEASE_TYPES:p2.RELEASE_TYPES,compareIdentifiers:m2.compareIdentifiers,rcompareIdentifiers:m2.rcompareIdentifiers}});var M2=ie((awe,P2)=>{"use strict";P2.exports=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var j2=ie((cwe,bS)=>{"use strict";var Cne=/[\p{Lu}]/u,Sne=/[\p{Ll}]/u,N2=/^[\p{Lu}](?![\p{Lu}])/gu,L2=/([\p{Alpha}\p{N}_]|$)/u,F2=/[_.\- ]+/,Dne=new RegExp("^"+F2.source),O2=new RegExp(F2.source+L2.source,"gu"),k2=new RegExp("\\d+"+L2.source,"gu"),xne=(n,e,t)=>{let r=!1,i=!1,s=!1;for(let o=0;o<n.length;o++){let a=n[o];r&&Cne.test(a)?(n=n.slice(0,o)+"-"+n.slice(o),r=!1,s=i,i=!0,o++):i&&s&&Sne.test(a)?(n=n.slice(0,o-1)+"-"+n.slice(o-1),s=i,i=!1,r=!0):(r=e(a)===a&&t(a)!==a,s=i,i=t(a)===a&&e(a)!==a)}return n},Rne=(n,e)=>(N2.lastIndex=0,n.replace(N2,t=>e(t))),Pne=(n,e)=>(O2.lastIndex=0,k2.lastIndex=0,n.replace(O2,(t,r)=>e(r)).replace(k2,t=>e(t))),V2=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e=_({pascalCase:!1,preserveConsecutiveUppercase:!1},e),Array.isArray(n)?n=n.map(s=>s.trim()).filter(s=>s.length).join("-"):n=n.trim(),n.length===0)return"";let t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),r=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=xne(n,t,r)),n=n.replace(Dne,""),e.preserveConsecutiveUppercase?n=Rne(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),Pne(n,r))};bS.exports=V2;bS.exports.default=V2});var Y2=ie((Awe,K2)=>{"use strict";var G2=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,W2=(n=0)=>(e,t,r)=>`\x1B[${38+n};2;${e};${t};${r}m`;function Une(){let n=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,r]of Object.entries(e)){for(let[i,s]of Object.entries(r))e[i]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},r[i]=e[i],n.set(s[0],s[1]);Object.defineProperty(e,t,{value:r,enumerable:!1})}return Object.defineProperty(e,"codes",{value:n,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=G2(),e.color.ansi16m=W2(),e.bgColor.ansi256=G2(10),e.bgColor.ansi16m=W2(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,r,i)=>t===r&&r===i?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(i/255*5),enumerable:!1},hexToRgb:{value:t=>{let r=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!r)return[0,0,0];let{colorString:i}=r.groups;i.length===3&&(i=i.split("").map(o=>o+o).join(""));let s=Number.parseInt(i,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(K2,"exports",{enumerable:!0,get:Une})});var z$=ie(i_=>{"use strict";i_.byteLength=lre;i_.toByteArray=dre;i_.fromByteArray=pre;var Hi=[],Pr=[],cre=typeof Uint8Array<"u"?Uint8Array:Array,nD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(ja=0,H$=nD.length;ja<H$;++ja)Hi[ja]=nD[ja],Pr[nD.charCodeAt(ja)]=ja;var ja,H$;Pr[45]=62;Pr[95]=63;function q$(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function lre(n){var e=q$(n),t=e[0],r=e[1];return(t+r)*3/4-r}function ure(n,e,t){return(e+t)*3/4-t}function dre(n){var e,t=q$(n),r=t[0],i=t[1],s=new cre(ure(n,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=Pr[n.charCodeAt(c)]<<18|Pr[n.charCodeAt(c+1)]<<12|Pr[n.charCodeAt(c+2)]<<6|Pr[n.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Pr[n.charCodeAt(c)]<<2|Pr[n.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=Pr[n.charCodeAt(c)]<<10|Pr[n.charCodeAt(c+1)]<<4|Pr[n.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function hre(n){return Hi[n>>18&63]+Hi[n>>12&63]+Hi[n>>6&63]+Hi[n&63]}function fre(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(hre(r));return i.join("")}function pre(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,a=t-r;o<a;o+=s)i.push(fre(n,o,o+s>a?a:o+s));return r===1?(e=n[t-1],i.push(Hi[e>>2]+Hi[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Hi[e>>10]+Hi[e>>4&63]+Hi[e<<2&63]+"=")),i.join("")}});var ux=null;var M_=1,N_=Symbol("SIGNAL");function Ze(n){let e=ux;return ux=n,e}var dx={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function LU(n){if(!(L_(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===M_)){if(!n.producerMustRecompute(n)&&!O_(n)){n.dirty=!1,n.lastCleanEpoch=M_;return}n.producerRecomputeValue(n),n.dirty=!1,n.lastCleanEpoch=M_}}function hx(n){return n&&(n.nextProducerIndex=0),Ze(n)}function fx(n,e){if(Ze(e),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(L_(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)k_(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function O_(n){Fh(n);for(let e=0;e<n.producerNode.length;e++){let t=n.producerNode[e],r=n.producerLastReadVersion[e];if(r!==t.version||(LU(t),r!==t.version))return!0}return!1}function px(n){if(Fh(n),L_(n))for(let e=0;e<n.producerNode.length;e++)k_(n.producerNode[e],n.producerIndexOfThis[e]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function k_(n,e){if(FU(n),Fh(n),n.liveConsumerNode.length===1)for(let r=0;r<n.producerNode.length;r++)k_(n.producerNode[r],n.producerIndexOfThis[r]);let t=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[t],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[t],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){let r=n.liveConsumerIndexOfThis[e],i=n.liveConsumerNode[e];Fh(i),i.producerIndexOfThis[r]=e}}function L_(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function Fh(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function FU(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function VU(){throw new Error}var jU=VU;function mx(n){jU=n}function Ee(n){return typeof n=="function"}function Ga(n){let t=n(r=>{Error.call(r),r.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Vh=Ga(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((r,i)=>`${i+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function Co(n,e){if(n){let t=n.indexOf(e);0<=t&&n.splice(t,1)}}var xt=class n{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let s of t)s.remove(this);else t.remove(this);let{initialTeardown:r}=this;if(Ee(r))try{r()}catch(s){e=s instanceof Vh?s.errors:[s]}let{_finalizers:i}=this;if(i){this._finalizers=null;for(let s of i)try{gx(s)}catch(o){e=e??[],o instanceof Vh?e=[...e,...o.errors]:e.push(o)}}if(e)throw new Vh(e)}}add(e){var t;if(e&&e!==this)if(this.closed)gx(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Co(t,e)}remove(e){let{_finalizers:t}=this;t&&Co(t,e),e instanceof n&&e._removeParent(this)}};xt.EMPTY=(()=>{let n=new xt;return n.closed=!0,n})();var F_=xt.EMPTY;function jh(n){return n instanceof xt||n&&"closed"in n&&Ee(n.remove)&&Ee(n.add)&&Ee(n.unsubscribe)}function gx(n){Ee(n)?n():n.unsubscribe()}var kr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Wa={setTimeout(n,e,...t){let{delegate:r}=Wa;return r?.setTimeout?r.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){let{delegate:e}=Wa;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function $h(n){Wa.setTimeout(()=>{let{onUnhandledError:e}=kr;if(e)e(n);else throw n})}function ql(){}var yx=V_("C",void 0,void 0);function _x(n){return V_("E",void 0,n)}function vx(n){return V_("N",n,void 0)}function V_(n,e,t){return{kind:n,value:e,error:t}}var So=null;function Ka(n){if(kr.useDeprecatedSynchronousErrorHandling){let e=!So;if(e&&(So={errorThrown:!1,error:null}),n(),e){let{errorThrown:t,error:r}=So;if(So=null,t)throw r}}else n()}function wx(n){kr.useDeprecatedSynchronousErrorHandling&&So&&(So.errorThrown=!0,So.error=n)}var Do=class extends xt{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,jh(e)&&e.add(this)):this.destination=BU}static create(e,t,r){return new Ya(e,t,r)}next(e){this.isStopped?$_(vx(e),this):this._next(e)}error(e){this.isStopped?$_(_x(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?$_(yx,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},$U=Function.prototype.bind;function j_(n,e){return $U.call(n,e)}var U_=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(r){Uh(r)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(r){Uh(r)}else Uh(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Uh(t)}}},Ya=class extends Do{constructor(e,t,r){super();let i;if(Ee(e)||!e)i={next:e??void 0,error:t??void 0,complete:r??void 0};else{let s;this&&kr.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&j_(e.next,s),error:e.error&&j_(e.error,s),complete:e.complete&&j_(e.complete,s)}):i=e}this.destination=new U_(i)}};function Uh(n){kr.useDeprecatedSynchronousErrorHandling?wx(n):$h(n)}function UU(n){throw n}function $_(n,e){let{onStoppedNotification:t}=kr;t&&Wa.setTimeout(()=>t(n,e))}var BU={closed:!0,next:ql,error:UU,complete:ql};var Qa=typeof Symbol=="function"&&Symbol.observable||"@@observable";function tr(n){return n}function B_(...n){return H_(n)}function H_(n){return n.length===0?tr:n.length===1?n[0]:function(t){return n.reduce((r,i)=>i(r),t)}}var Ye=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){let r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,i){let s=qU(t)?t:new Ya(t,r,i);return Ka(()=>{let{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return r=bx(r),new r((i,s)=>{let o=new Ya({next:a=>{try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)}[Qa](){return this}pipe(...t){return H_(t)(this)}toPromise(t){return t=bx(t),new t((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return n.create=e=>new n(e),n})();function bx(n){var e;return(e=n??kr.Promise)!==null&&e!==void 0?e:Promise}function HU(n){return n&&Ee(n.next)&&Ee(n.error)&&Ee(n.complete)}function qU(n){return n&&n instanceof Do||HU(n)&&jh(n)}function q_(n){return Ee(n?.lift)}function Qe(n){return e=>{if(q_(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Be(n,e,t,r,i){return new z_(n,e,t,r,i)}var z_=class extends Do{constructor(e,t,r,i,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=i?function(a){try{i(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function Xa(){return Qe((n,e)=>{let t=null;n._refCount++;let r=Be(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){t=null;return}let i=n._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var Za=class extends Ye{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,q_(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new xt;let t=this.getSubject();e.add(this.source.subscribe(Be(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=xt.EMPTY)}return e}refCount(){return Xa()(this)}};var Ex=Ga(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Pn=(()=>{class n extends Ye{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let r=new Bh(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new Ex}next(t){Ka(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(t)}})}error(t){Ka(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){Ka(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:r,isStopped:i,observers:s}=this;return r||i?F_:(this.currentObservers=null,s.push(t),new xt(()=>{this.currentObservers=null,Co(s,t)}))}_checkFinalizedStatuses(t){let{hasError:r,thrownError:i,isStopped:s}=this;r?t.error(i):s&&t.complete()}asObservable(){let t=new Ye;return t.source=this,t}}return n.create=(e,t)=>new Bh(e,t),n})(),Bh=class extends Pn{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.next)===null||r===void 0||r.call(t,e)}error(e){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.error)===null||r===void 0||r.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,r;return(r=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&r!==void 0?r:F_}};var Bt=class extends Pn{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:r}=this;if(e)throw t;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}};var G_={now(){return(G_.delegate||Date).now()},delegate:void 0};var Hh=class extends xt{constructor(e,t){super()}schedule(e,t=0){return this}};var zl={setInterval(n,e,...t){let{delegate:r}=zl;return r?.setInterval?r.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){let{delegate:e}=zl;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};var Ja=class extends Hh{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var r;if(this.closed)return this;this.state=e;let i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,t)),this.pending=!0,this.delay=t,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,r=0){return zl.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(r!=null&&this.delay===r&&this.pending===!1)return t;t!=null&&zl.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let r=this._execute(e,t);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r=!1,i;try{this.work(e)}catch(s){r=!0,i=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){let{id:e,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Co(r,this),e!=null&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}};var ec=class n{constructor(e,t=n.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,r){return new this.schedulerActionCtor(this,e).schedule(r,t)}};ec.now=G_.now;var tc=class extends ec{constructor(e,t=ec.now){super(e,t),this.actions=[],this._active=!1}flush(e){let{actions:t}=this;if(this._active){t.push(e);return}let r;this._active=!0;do if(r=e.execute(e.state,e.delay))break;while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}};var W_=new tc(Ja);var qh=class extends Ja{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return r!=null&&r>0||r==null&&this.delay>0?super.requestAsyncId(e,t,r):(e.flush(this),0)}};var zh=class extends tc{};var K_=new zh(qh);var nr=new Ye(n=>n.complete());function Ix(n){return n&&Ee(n.schedule)}function Ax(n){return n[n.length-1]}function Gh(n){return Ee(Ax(n))?n.pop():void 0}function Rs(n){return Ix(Ax(n))?n.pop():void 0}function Y_(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Cx(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function Tx(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xo(n){return this instanceof xo?(this.v=n,this):new xo(n)}function Sx(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(p){return function(y){return Promise.resolve(y).then(p,d)}}function a(p,y){r[p]&&(i[p]=function(w){return new Promise(function(b,E){s.push([p,w,b,E])>1||c(p,w)})},y&&(i[p]=y(i[p])))}function c(p,y){try{l(r[p](y))}catch(w){f(s[0][3],w)}}function l(p){p.value instanceof xo?Promise.resolve(p.value.v).then(u,d):f(s[0][2],p)}function u(p){c("next",p)}function d(p){c("throw",p)}function f(p,y){p(y),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Dx(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Tx=="function"?Tx(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var Wh=n=>n&&typeof n.length=="number"&&typeof n!="function";function Kh(n){return Ee(n?.then)}function Yh(n){return Ee(n[Qa])}function Qh(n){return Symbol.asyncIterator&&Ee(n?.[Symbol.asyncIterator])}function Xh(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function zU(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Zh=zU();function Jh(n){return Ee(n?.[Zh])}function ef(n){return Sx(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:r,done:i}=yield xo(t.read());if(i)return yield xo(void 0);yield yield xo(r)}}finally{t.releaseLock()}})}function tf(n){return Ee(n?.getReader)}function Ot(n){if(n instanceof Ye)return n;if(n!=null){if(Yh(n))return GU(n);if(Wh(n))return WU(n);if(Kh(n))return KU(n);if(Qh(n))return xx(n);if(Jh(n))return YU(n);if(tf(n))return QU(n)}throw Xh(n)}function GU(n){return new Ye(e=>{let t=n[Qa]();if(Ee(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function WU(n){return new Ye(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function KU(n){return new Ye(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,$h)})}function YU(n){return new Ye(e=>{for(let t of n)if(e.next(t),e.closed)return;e.complete()})}function xx(n){return new Ye(e=>{XU(n,e).catch(t=>e.error(t))})}function QU(n){return xx(ef(n))}function XU(n,e){var t,r,i,s;return Cx(this,void 0,void 0,function*(){try{for(t=Dx(n);r=yield t.next(),!r.done;){let o=r.value;if(e.next(o),e.closed)return}}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}e.complete()})}function qn(n,e,t,r=0,i=!1){let s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function Ps(n,e=0){return Qe((t,r)=>{t.subscribe(Be(r,i=>qn(r,n,()=>r.next(i),e),()=>qn(r,n,()=>r.complete(),e),i=>qn(r,n,()=>r.error(i),e)))})}function Ms(n,e=0){return Qe((t,r)=>{r.add(n.schedule(()=>t.subscribe(r),e))})}function Rx(n,e){return Ot(n).pipe(Ms(e),Ps(e))}function Px(n,e){return Ot(n).pipe(Ms(e),Ps(e))}function Mx(n,e){return new Ye(t=>{let r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function Nx(n,e){return new Ye(t=>{let r;return qn(t,e,()=>{r=n[Zh](),qn(t,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){t.error(o);return}s?t.complete():t.next(i)},0,!0)}),()=>Ee(r?.return)&&r.return()})}function nf(n,e){if(!n)throw new Error("Iterable cannot be null");return new Ye(t=>{qn(t,e,()=>{let r=n[Symbol.asyncIterator]();qn(t,e,()=>{r.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function Ox(n,e){return nf(ef(n),e)}function kx(n,e){if(n!=null){if(Yh(n))return Rx(n,e);if(Wh(n))return Mx(n,e);if(Kh(n))return Px(n,e);if(Qh(n))return nf(n,e);if(Jh(n))return Nx(n,e);if(tf(n))return Ox(n,e)}throw Xh(n)}function Rt(n,e){return e?kx(n,e):Ot(n)}function Ae(...n){let e=Rs(n);return Rt(n,e)}function nc(n,e){let t=Ee(n)?n:()=>n,r=i=>i.error(t());return new Ye(e?i=>e.schedule(r,0,i):r)}function Q_(n){return!!n&&(n instanceof Ye||Ee(n.lift)&&Ee(n.subscribe))}var Gi=Ga(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function He(n,e){return Qe((t,r)=>{let i=0;t.subscribe(Be(r,s=>{r.next(n.call(e,s,i++))}))})}var{isArray:ZU}=Array;function JU(n,e){return ZU(e)?n(...e):n(e)}function rf(n){return He(e=>JU(n,e))}var{isArray:eB}=Array,{getPrototypeOf:tB,prototype:nB,keys:rB}=Object;function sf(n){if(n.length===1){let e=n[0];if(eB(e))return{args:e,keys:null};if(iB(e)){let t=rB(e);return{args:t.map(r=>e[r]),keys:t}}}return{args:n,keys:null}}function iB(n){return n&&typeof n=="object"&&tB(n)===nB}function of(n,e){return n.reduce((t,r,i)=>(t[r]=e[i],t),{})}function af(...n){let e=Rs(n),t=Gh(n),{args:r,keys:i}=sf(n);if(r.length===0)return Rt([],e);let s=new Ye(sB(r,e,i?o=>of(i,o):tr));return t?s.pipe(rf(t)):s}function sB(n,e,t=tr){return r=>{Lx(e,()=>{let{length:i}=n,s=new Array(i),o=i,a=i;for(let c=0;c<i;c++)Lx(e,()=>{let l=Rt(n[c],e),u=!1;l.subscribe(Be(r,d=>{s[c]=d,u||(u=!0,a--),a||r.next(t(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}function Lx(n,e,t){n?qn(t,n,e):e()}function Fx(n,e,t,r,i,s,o,a){let c=[],l=0,u=0,d=!1,f=()=>{d&&!c.length&&!l&&e.complete()},p=w=>l<r?y(w):c.push(w),y=w=>{s&&e.next(w),l++;let b=!1;Ot(t(w,u++)).subscribe(Be(e,E=>{i?.(E),s?p(E):e.next(E)},()=>{b=!0},void 0,()=>{if(b)try{for(l--;c.length&&l<r;){let E=c.shift();o?qn(e,o,()=>y(E)):y(E)}f()}catch(E){e.error(E)}}))};return n.subscribe(Be(e,p,()=>{d=!0,f()})),()=>{a?.()}}function Ht(n,e,t=1/0){return Ee(e)?Ht((r,i)=>He((s,o)=>e(r,s,i,o))(Ot(n(r,i))),t):(typeof e=="number"&&(t=e),Qe((r,i)=>Fx(r,i,n,t)))}function X_(n=1/0){return Ht(tr,n)}function Vx(){return X_(1)}function rc(...n){return Vx()(Rt(n,Rs(n)))}function cf(n){return new Ye(e=>{Ot(n()).subscribe(e)})}function Z_(...n){let e=Gh(n),{args:t,keys:r}=sf(n),i=new Ye(s=>{let{length:o}=t;if(!o){s.complete();return}let a=new Array(o),c=o,l=o;for(let u=0;u<o;u++){let d=!1;Ot(t[u]).subscribe(Be(s,f=>{d||(d=!0,l--),a[u]=f},()=>c--,void 0,()=>{(!c||!d)&&(l||s.next(r?of(r,a):a),s.complete())}))}});return e?i.pipe(rf(e)):i}function Lr(n,e){return Qe((t,r)=>{let i=0;t.subscribe(Be(r,s=>n.call(e,s,i++)&&r.next(s)))})}function Ns(n){return Qe((e,t)=>{let r=null,i=!1,s;r=e.subscribe(Be(t,void 0,void 0,o=>{s=Ot(n(o,Ns(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function jx(n,e,t,r,i){return(s,o)=>{let a=t,c=e,l=0;s.subscribe(Be(o,u=>{let d=l++;c=a?n(c,u,d):(a=!0,u),r&&o.next(c)},i&&(()=>{a&&o.next(c),o.complete()})))}}function ic(n,e){return Ee(e)?Ht(n,e,1):Ht(n,1)}function Os(n){return Qe((e,t)=>{let r=!1;e.subscribe(Be(t,i=>{r=!0,t.next(i)},()=>{r||t.next(n),t.complete()}))})}function Wi(n){return n<=0?()=>nr:Qe((e,t)=>{let r=0;e.subscribe(Be(t,i=>{++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function J_(n){return He(()=>n)}function lf(n=oB){return Qe((e,t)=>{let r=!1;e.subscribe(Be(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(n())))})}function oB(){return new Gi}function Gl(n){return Qe((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function ai(n,e){let t=arguments.length>=2;return r=>r.pipe(n?Lr((i,s)=>n(i,s,r)):tr,Wi(1),t?Os(e):lf(()=>new Gi))}function sc(n){return n<=0?()=>nr:Qe((e,t)=>{let r=[];e.subscribe(Be(t,i=>{r.push(i),n<r.length&&r.shift()},()=>{for(let i of r)t.next(i);t.complete()},void 0,()=>{r=null}))})}function ev(n,e){let t=arguments.length>=2;return r=>r.pipe(n?Lr((i,s)=>n(i,s,r)):tr,sc(1),t?Os(e):lf(()=>new Gi))}function tv(n,e){return Qe(jx(n,e,arguments.length>=2,!0))}function nv(...n){let e=Rs(n);return Qe((t,r)=>{(e?rc(n,t,e):rc(n,t)).subscribe(r)})}function Fr(n,e){return Qe((t,r)=>{let i=null,s=0,o=!1,a=()=>o&&!i&&r.complete();t.subscribe(Be(r,c=>{i?.unsubscribe();let l=0,u=s++;Ot(n(c,u)).subscribe(i=Be(r,d=>r.next(e?e(c,d,u,l++):d),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function rv(n){return Qe((e,t)=>{Ot(n).subscribe(Be(t,()=>t.complete(),ql)),!t.closed&&e.subscribe(t)})}function qt(n,e,t){let r=Ee(n)||e||t?{next:n,error:e,complete:t}:n;return r?Qe((i,s)=>{var o;(o=r.subscribe)===null||o===void 0||o.call(r);let a=!0;i.subscribe(Be(s,c=>{var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},()=>{var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},c=>{var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},()=>{var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):tr}var aB="https://g.co/ng/security#xss",he=class extends Error{constructor(e,t){super(cw(e,t)),this.code=e}};function cw(n,e){return`${`NG0${Math.abs(n)}`}${e?": "+e:""}`}function ou(n){return{toString:n}.toString()}var uf="__parameters__";function cB(n){return function(...t){if(n){let r=n(...t);for(let i in r)this[i]=r[i]}}}function wR(n,e,t){return ou(()=>{let r=cB(e);function i(...s){if(this instanceof i)return r.apply(this,s),this;let o=new i(...s);return a.annotation=o,a;function a(c,l,u){let d=c.hasOwnProperty(uf)?c[uf]:Object.defineProperty(c,uf,{value:[]})[uf];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),c}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=n,i.annotationCls=i,i})}var Wl=globalThis;function ht(n){for(let e in n)if(n[e]===ht)return e;throw Error("Could not find renamed property on target object.")}function lB(n,e){for(let t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function On(n){if(typeof n=="string")return n;if(Array.isArray(n))return"["+n.map(On).join(", ")+"]";if(n==null)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;let e=n.toString();if(e==null)return""+e;let t=e.indexOf(`
`);return t===-1?e:e.substring(0,t)}function vv(n,e){return n==null||n===""?e===null?"":e:e==null||e===""?n:n+" "+e}var uB=ht({__forward_ref__:ht});function Uo(n){return n.__forward_ref__=Uo,n.toString=function(){return On(this())},n}function Mn(n){return bR(n)?n():n}function bR(n){return typeof n=="function"&&n.hasOwnProperty(uB)&&n.__forward_ref__===Uo}function ce(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Bo(n){return{providers:n.providers||[],imports:n.imports||[]}}function Vf(n){return $x(n,IR)||$x(n,AR)}function ER(n){return Vf(n)!==null}function $x(n,e){return n.hasOwnProperty(e)?n[e]:null}function dB(n){let e=n&&(n[IR]||n[AR]);return e||null}function Ux(n){return n&&(n.hasOwnProperty(Bx)||n.hasOwnProperty(hB))?n[Bx]:null}var IR=ht({\u0275prov:ht}),Bx=ht({\u0275inj:ht}),AR=ht({ngInjectableDef:ht}),hB=ht({ngInjectorDef:ht}),de=class{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=ce({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function TR(n){return n&&!!n.\u0275providers}var fB=ht({\u0275cmp:ht}),pB=ht({\u0275dir:ht}),mB=ht({\u0275pipe:ht}),gB=ht({\u0275mod:ht}),_f=ht({\u0275fac:ht}),Kl=ht({__NG_ELEMENT_ID__:ht}),Hx=ht({__NG_ENV_ID__:ht});function CR(n){return typeof n=="string"?n:n==null?"":String(n)}function yB(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():CR(n)}function _B(n,e){let t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new he(-200,n)}function lw(n,e){throw new he(-201,!1)}var Ne=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(Ne||{}),wv;function SR(){return wv}function zn(n){let e=wv;return wv=n,e}function DR(n,e,t){let r=Vf(n);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(t&Ne.Optional)return null;if(e!==void 0)return e;lw(n,"Injector")}var vB={},Yl=vB,bv="__NG_DI_FLAG__",vf="ngTempTokenPath",wB="ngTokenPath",bB=/\n/gm,EB="\u0275",qx="__source",lc;function IB(){return lc}function ks(n){let e=lc;return lc=n,e}function AB(n,e=Ne.Default){if(lc===void 0)throw new he(-203,!1);return lc===null?DR(n,void 0,e):lc.get(n,e&Ne.Optional?null:void 0,e)}function pe(n,e=Ne.Default){return(SR()||AB)(Mn(n),e)}function ne(n,e=Ne.Default){return pe(n,jf(e))}function jf(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Ev(n){let e=[];for(let t=0;t<n.length;t++){let r=Mn(n[t]);if(Array.isArray(r)){if(r.length===0)throw new he(900,!1);let i,s=Ne.Default;for(let o=0;o<r.length;o++){let a=r[o],c=TB(a);typeof c=="number"?c===-1?i=a.token:s|=c:i=a}e.push(pe(i,s))}else e.push(pe(r))}return e}function xR(n,e){return n[bv]=e,n.prototype[bv]=e,n}function TB(n){return n[bv]}function CB(n,e,t,r){let i=n[vf];throw e[qx]&&i.unshift(e[qx]),n.message=SB(`
`+n.message,i,t,r),n[wB]=i,n[vf]=null,n}function SB(n,e,t,r=null){n=n&&n.charAt(0)===`
`&&n.charAt(1)==EB?n.slice(2):n;let i=On(e);if(Array.isArray(e))i=e.map(On).join(" -> ");else if(typeof e=="object"){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+(typeof a=="string"?JSON.stringify(a):On(a)))}i=`{${s.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${n.replace(bB,`
  `)}`}var gt=xR(wR("Optional"),8);var RR=xR(wR("SkipSelf"),4);function Mo(n,e){let t=n.hasOwnProperty(_f);return t?n[_f]:null}function uw(n,e){n.forEach(t=>Array.isArray(t)?uw(t,e):e(t))}function PR(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function wf(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function DB(n,e,t,r){let i=n.length;if(i==e)n.push(t,r);else if(i===1)n.push(r,n[0]),n[0]=t;else{for(i--,n.push(n[i-1],n[i]);i>e;){let s=i-2;n[i]=n[s],i--}n[e]=t,n[e+1]=r}}function dw(n,e,t){let r=au(n,e);return r>=0?n[r|1]=t:(r=~r,DB(n,r,e,t)),r}function iv(n,e){let t=au(n,e);if(t>=0)return n[t|1]}function au(n,e){return xB(n,e,1)}function xB(n,e,t){let r=0,i=n.length>>t;for(;i!==r;){let s=r+(i-r>>1),o=n[s<<t];if(e===o)return s<<t;o>e?i=s:r=s+1}return~(i<<t)}var dc={},Gn=[],hc=new de(""),MR=new de("",-1),NR=new de(""),bf=class{get(e,t=Yl){if(t===Yl){let r=new Error(`NullInjectorError: No provider for ${On(e)}!`);throw r.name="NullInjectorError",r}return t}},OR=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(OR||{}),ui=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(ui||{}),mr=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(mr||{});function RB(n,e,t){let r=n.length;for(;;){let i=n.indexOf(e,t);if(i===-1)return i;if(i===0||n.charCodeAt(i-1)<=32){let s=e.length;if(i+s===r||n.charCodeAt(i+s)<=32)return i}t=i+1}}function Iv(n,e,t){let r=0;for(;r<t.length;){let i=t[r];if(typeof i=="number"){if(i!==0)break;r++;let s=t[r++],o=t[r++],a=t[r++];n.setAttribute(e,o,a,s)}else{let s=i,o=t[++r];MB(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),r++}}return r}function PB(n){return n===3||n===4||n===6}function MB(n){return n.charCodeAt(0)===64}function Ql(n,e){if(!(e===null||e.length===0))if(n===null||n.length===0)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){let i=e[r];typeof i=="number"?t=i:t===0||(t===-1||t===2?zx(n,t,i,null,e[++r]):zx(n,t,i,null,null))}}return n}function zx(n,e,t,r,i){let s=0,o=n.length;if(e===-1)o=-1;else for(;s<n.length;){let a=n[s++];if(typeof a=="number"){if(a===e){o=-1;break}else if(a>e){o=s-1;break}}}for(;s<n.length;){let a=n[s];if(typeof a=="number")break;if(a===t){if(r===null){i!==null&&(n[s+1]=i);return}else if(r===n[s+1]){n[s+2]=i;return}}s++,r!==null&&s++,i!==null&&s++}o!==-1&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),r!==null&&n.splice(s++,0,r),i!==null&&n.splice(s++,0,i)}var kR="ng-template";function NB(n,e,t,r){let i=0;if(r){for(;i<e.length&&typeof e[i]=="string";i+=2)if(e[i]==="class"&&RB(e[i+1].toLowerCase(),t,0)!==-1)return!0}else if(hw(n))return!1;if(i=e.indexOf(1,i),i>-1){let s;for(;++i<e.length&&typeof(s=e[i])=="string";)if(s.toLowerCase()===t)return!0}return!1}function hw(n){return n.type===4&&n.value!==kR}function OB(n,e,t){let r=n.type===4&&!t?kR:n.value;return e===r}function kB(n,e,t){let r=4,i=n.attrs,s=i!==null?VB(i):0,o=!1;for(let a=0;a<e.length;a++){let c=e[a];if(typeof c=="number"){if(!o&&!Vr(r)&&!Vr(c))return!1;if(o&&Vr(c))continue;o=!1,r=c|r&1;continue}if(!o)if(r&4){if(r=2|r&1,c!==""&&!OB(n,c,t)||c===""&&e.length===1){if(Vr(r))return!1;o=!0}}else if(r&8){if(i===null||!NB(n,i,c,t)){if(Vr(r))return!1;o=!0}}else{let l=e[++a],u=LB(c,i,hw(n),t);if(u===-1){if(Vr(r))return!1;o=!0;continue}if(l!==""){let d;if(u>s?d="":d=i[u+1].toLowerCase(),r&2&&l!==d){if(Vr(r))return!1;o=!0}}}}return Vr(r)||o}function Vr(n){return(n&1)===0}function LB(n,e,t,r){if(e===null)return-1;let i=0;if(r||!t){let s=!1;for(;i<e.length;){let o=e[i];if(o===n)return i;if(o===3||o===6)s=!0;else if(o===1||o===2){let a=e[++i];for(;typeof a=="string";)a=e[++i];continue}else{if(o===4)break;if(o===0){i+=4;continue}}i+=s?1:2}return-1}else return jB(e,n)}function FB(n,e,t=!1){for(let r=0;r<e.length;r++)if(kB(n,e[r],t))return!0;return!1}function VB(n){for(let e=0;e<n.length;e++){let t=n[e];if(PB(t))return e}return n.length}function jB(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){let r=n[t];if(typeof r=="number")return-1;if(r===e)return t;t++}return-1}function Gx(n,e){return n?":not("+e.trim()+")":e}function $B(n){let e=n[0],t=1,r=2,i="",s=!1;for(;t<n.length;){let o=n[t];if(typeof o=="string")if(r&2){let a=n[++t];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else r&8?i+="."+o:r&4&&(i+=" "+o);else i!==""&&!Vr(o)&&(e+=Gx(s,i),i=""),r=o,s=s||!Vr(r);t++}return i!==""&&(e+=Gx(s,i)),e}function UB(n){return n.map($B).join(",")}function BB(n){let e=[],t=[],r=1,i=2;for(;r<n.length;){let s=n[r];if(typeof s=="string")i===2?s!==""&&e.push(s,n[++r]):i===8&&t.push(s);else{if(!Vr(i))break;i=s}r++}return{attrs:e,classes:t}}function _c(n){return ou(()=>{let e=UR(n),t=P(_({},e),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===OR.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||ui.Emulated,styles:n.styles||Gn,_:null,schemas:n.schemas||null,tView:null,id:""});BR(t);let r=n.dependencies;return t.directiveDefs=Kx(r,!1),t.pipeDefs=Kx(r,!0),t.id=zB(t),t})}function HB(n){return No(n)||FR(n)}function qB(n){return n!==null}function Ho(n){return ou(()=>({type:n.type,bootstrap:n.bootstrap||Gn,declarations:n.declarations||Gn,imports:n.imports||Gn,exports:n.exports||Gn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Wx(n,e){if(n==null)return dc;let t={};for(let r in n)if(n.hasOwnProperty(r)){let i=n[r],s,o,a=mr.None;Array.isArray(i)?(a=i[0],s=i[1],o=i[2]??s):(s=i,o=i),e?(t[s]=a!==mr.None?[r,a]:r,e[s]=o):t[s]=r}return t}function kn(n){return ou(()=>{let e=UR(n);return BR(e),e})}function LR(n){return{type:n.type,name:n.name,factory:null,pure:n.pure!==!1,standalone:n.standalone===!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function No(n){return n[fB]||null}function FR(n){return n[pB]||null}function VR(n){return n[mB]||null}function jR(n){let e=No(n)||FR(n)||VR(n);return e!==null?e.standalone:!1}function $R(n,e){let t=n[gB]||null;if(!t&&e===!0)throw new Error(`Type ${On(n)} does not have '\u0275mod' property.`);return t}function UR(n){let e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:n.inputs||dc,exportAs:n.exportAs||null,standalone:n.standalone===!0,signals:n.signals===!0,selectors:n.selectors||Gn,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Wx(n.inputs,e),outputs:Wx(n.outputs),debugInfo:null}}function BR(n){n.features?.forEach(e=>e(n))}function Kx(n,e){if(!n)return null;let t=e?VR:HB;return()=>(typeof n=="function"?n():n).map(r=>t(r)).filter(qB)}function zB(n){let e=0,t=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(let i of t)e=Math.imul(31,e)+i.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function Wn(n){return{\u0275providers:n}}function GB(...n){return{\u0275providers:HR(!0,n),\u0275fromNgModule:!0}}function HR(n,...e){let t=[],r=new Set,i,s=o=>{t.push(o)};return uw(e,o=>{let a=o;Av(a,s,[],r)&&(i||=[],i.push(a))}),i!==void 0&&qR(i,s),t}function qR(n,e){for(let t=0;t<n.length;t++){let{ngModule:r,providers:i}=n[t];fw(i,s=>{e(s,r)})}}function Av(n,e,t,r){if(n=Mn(n),!n)return!1;let i=null,s=Ux(n),o=!s&&No(n);if(!s&&!o){let c=n.ngModule;if(s=Ux(c),s)i=c;else return!1}else{if(o&&!o.standalone)return!1;i=n}let a=r.has(i);if(o){if(a)return!1;if(r.add(i),o.dependencies){let c=typeof o.dependencies=="function"?o.dependencies():o.dependencies;for(let l of c)Av(l,e,t,r)}}else if(s){if(s.imports!=null&&!a){r.add(i);let l;try{uw(s.imports,u=>{Av(u,e,t,r)&&(l||=[],l.push(u))})}finally{}l!==void 0&&qR(l,e)}if(!a){let l=Mo(i)||(()=>new i);e({provide:i,useFactory:l,deps:Gn},i),e({provide:NR,useValue:i,multi:!0},i),e({provide:hc,useValue:()=>pe(i),multi:!0},i)}let c=s.providers;if(c!=null&&!a){let l=n;fw(c,u=>{e(u,l)})}}else return!1;return i!==n&&n.providers!==void 0}function fw(n,e){for(let t of n)TR(t)&&(t=t.\u0275providers),Array.isArray(t)?fw(t,e):e(t)}var WB=ht({provide:String,useValue:ht});function zR(n){return n!==null&&typeof n=="object"&&WB in n}function KB(n){return!!(n&&n.useExisting)}function YB(n){return!!(n&&n.useFactory)}function fc(n){return typeof n=="function"}function QB(n){return!!n.useClass}var $f=new de(""),ff={},XB={},sv;function pw(){return sv===void 0&&(sv=new bf),sv}var gr=class{},Xl=class extends gr{get destroyed(){return this._destroyed}constructor(e,t,r,i){super(),this.parent=t,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Cv(e,o=>this.processProvider(o)),this.records.set(MR,oc(void 0,this)),i.has("environment")&&this.records.set(gr,oc(void 0,this));let s=this.records.get($f);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(NR,Gn,Ne.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let e=Ze(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of t)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Ze(e)}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();let t=ks(this),r=zn(void 0),i;try{return e()}finally{ks(t),zn(r)}}get(e,t=Yl,r=Ne.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(Hx))return e[Hx](this);r=jf(r);let i,s=ks(this),o=zn(void 0);try{if(!(r&Ne.SkipSelf)){let c=this.records.get(e);if(c===void 0){let l=nH(e)&&Vf(e);l&&this.injectableDefInScope(l)?c=oc(Tv(e),ff):c=null,this.records.set(e,c)}if(c!=null)return this.hydrate(e,c)}let a=r&Ne.Self?pw():this.parent;return t=r&Ne.Optional&&t===Yl?null:t,a.get(e,t)}catch(a){if(a.name==="NullInjectorError"){if((a[vf]=a[vf]||[]).unshift(On(e)),s)throw a;return CB(a,e,"R3InjectorError",this.source)}else throw a}finally{zn(o),ks(s)}}resolveInjectorInitializers(){let e=Ze(null),t=ks(this),r=zn(void 0),i;try{let s=this.get(hc,Gn,Ne.Self);for(let o of s)o()}finally{ks(t),zn(r),Ze(e)}}toString(){let e=[],t=this.records;for(let r of t.keys())e.push(On(r));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new he(205,!1)}processProvider(e){e=Mn(e);let t=fc(e)?e:Mn(e&&e.provide),r=JB(e);if(!fc(e)&&e.multi===!0){let i=this.records.get(t);i||(i=oc(void 0,ff,!0),i.factory=()=>Ev(i.multi),this.records.set(t,i)),t=e,i.multi.push(e)}this.records.set(t,r)}hydrate(e,t){let r=Ze(null);try{return t.value===ff&&(t.value=XB,t.value=t.factory()),typeof t.value=="object"&&t.value&&tH(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{Ze(r)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=Mn(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function Tv(n){let e=Vf(n),t=e!==null?e.factory:Mo(n);if(t!==null)return t;if(n instanceof de)throw new he(204,!1);if(n instanceof Function)return ZB(n);throw new he(204,!1)}function ZB(n){if(n.length>0)throw new he(204,!1);let t=dB(n);return t!==null?()=>t.factory(n):()=>new n}function JB(n){if(zR(n))return oc(void 0,n.useValue);{let e=GR(n);return oc(e,ff)}}function GR(n,e,t){let r;if(fc(n)){let i=Mn(n);return Mo(i)||Tv(i)}else if(zR(n))r=()=>Mn(n.useValue);else if(YB(n))r=()=>n.useFactory(...Ev(n.deps||[]));else if(KB(n))r=()=>pe(Mn(n.useExisting));else{let i=Mn(n&&(n.useClass||n.provide));if(eH(n))r=()=>new i(...Ev(n.deps));else return Mo(i)||Tv(i)}return r}function oc(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function eH(n){return!!n.deps}function tH(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function nH(n){return typeof n=="function"||typeof n=="object"&&n instanceof de}function Cv(n,e){for(let t of n)Array.isArray(t)?Cv(t,e):t&&TR(t)?Cv(t.\u0275providers,e):e(t)}function qo(n,e){n instanceof Xl&&n.assertNotDestroyed();let t,r=ks(n),i=zn(void 0);try{return e()}finally{ks(r),zn(i)}}function rH(){return SR()!==void 0||IB()!=null}function iH(n){return typeof n=="function"}var Xi=0,qe=1,ge=2,gn=3,$r=4,Hr=5,Ef=6,Zl=7,Ur=8,pc=9,di=10,zt=11,Jl=12,Yx=13,vc=14,hi=15,Uf=16,ac=17,mc=18,Bf=19,WR=20,Ls=21,ov=22,Oo=23,Br=25,KR=1;var ko=7,If=8,Af=9,pr=10,mw=function(n){return n[n.None=0]="None",n[n.HasTransplantedViews=2]="HasTransplantedViews",n}(mw||{});function Ro(n){return Array.isArray(n)&&typeof n[KR]=="object"}function Zi(n){return Array.isArray(n)&&n[KR]===!0}function YR(n){return(n.flags&4)!==0}function Hf(n){return n.componentOffset>-1}function gw(n){return(n.flags&1)===1}function Fs(n){return!!n.template}function sH(n){return(n[ge]&512)!==0}var Sv=class{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}};function QR(n,e,t,r){e!==null?e.applyValueToInputSignal(e,r):n[t]=r}function wc(){return XR}function XR(n){return n.type.prototype.ngOnChanges&&(n.setInput=aH),oH}wc.ngInherit=!0;function oH(){let n=JR(this),e=n?.current;if(e){let t=n.previous;if(t===dc)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function aH(n,e,t,r,i){let s=this.declaredInputs[r],o=JR(n)||cH(n,{previous:dc,current:null}),a=o.current||(o.current={}),c=o.previous,l=c[s];a[s]=new Sv(l&&l.currentValue,t,c===dc),QR(n,e,i,t)}var ZR="__ngSimpleChanges__";function JR(n){return n[ZR]||null}function cH(n,e){return n[ZR]=e}var Qx=null;var ci=function(n,e,t){Qx?.(n,e,t)},lH="svg",uH="math",dH=!1;function hH(){return dH}function fi(n){for(;Array.isArray(n);)n=n[Xi];return n}function eP(n,e){return fi(e[n])}function qr(n,e){return fi(e[n.index])}function tP(n,e){return n.data[e]}function nP(n,e){return n[e]}function js(n,e){let t=e[n];return Ro(t)?t:t[Xi]}function yw(n){return(n[ge]&128)===128}function fH(n){return Zi(n[gn])}function Tf(n,e){return e==null?null:n[e]}function rP(n){n[ac]=0}function pH(n){n[ge]&1024||(n[ge]|=1024,yw(n)&&eu(n))}function mH(n,e){for(;n>0;)e=e[vc],n--;return e}function _w(n){return!!(n[ge]&9216||n[Oo]?.dirty)}function Dv(n){n[di].changeDetectionScheduler?.notify(1),_w(n)?eu(n):n[ge]&64&&(hH()?(n[ge]|=1024,eu(n)):n[di].changeDetectionScheduler?.notify())}function eu(n){n[di].changeDetectionScheduler?.notify();let e=tu(n);for(;e!==null&&!(e[ge]&8192||(e[ge]|=8192,!yw(e)));)e=tu(e)}function iP(n,e){if((n[ge]&256)===256)throw new he(911,!1);n[Ls]===null&&(n[Ls]=[]),n[Ls].push(e)}function gH(n,e){if(n[Ls]===null)return;let t=n[Ls].indexOf(e);t!==-1&&n[Ls].splice(t,1)}function tu(n){let e=n[gn];return Zi(e)?e[gn]:e}var Oe={lFrame:hP(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function yH(){return Oe.lFrame.elementDepthCount}function _H(){Oe.lFrame.elementDepthCount++}function vH(){Oe.lFrame.elementDepthCount--}function sP(){return Oe.bindingsEnabled}function wH(){return Oe.skipHydrationRootTNode!==null}function bH(n){return Oe.skipHydrationRootTNode===n}function EH(){Oe.skipHydrationRootTNode=null}function pt(){return Oe.lFrame.lView}function Kn(){return Oe.lFrame.tView}function Yt(n){return Oe.lFrame.contextLView=n,n[Ur]}function Qt(n){return Oe.lFrame.contextLView=null,n}function rr(){let n=oP();for(;n!==null&&n.type===64;)n=n.parent;return n}function oP(){return Oe.lFrame.currentTNode}function IH(){let n=Oe.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}function cu(n,e){let t=Oe.lFrame;t.currentTNode=n,t.isParent=e}function aP(){return Oe.lFrame.isParent}function AH(){Oe.lFrame.isParent=!1}function TH(){return Oe.lFrame.contextLView}function CH(){let n=Oe.lFrame,e=n.bindingRootIndex;return e===-1&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function SH(n){return Oe.lFrame.bindingIndex=n}function vw(){return Oe.lFrame.bindingIndex++}function cP(n){let e=Oe.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function DH(){return Oe.lFrame.inI18n}function xH(n,e){let t=Oe.lFrame;t.bindingIndex=t.bindingRootIndex=n,xv(e)}function RH(){return Oe.lFrame.currentDirectiveIndex}function xv(n){Oe.lFrame.currentDirectiveIndex=n}function PH(n){let e=Oe.lFrame.currentDirectiveIndex;return e===-1?null:n[e]}function lP(n){Oe.lFrame.currentQueryIndex=n}function MH(n){let e=n[qe];return e.type===2?e.declTNode:e.type===1?n[Hr]:null}function uP(n,e,t){if(t&Ne.SkipSelf){let i=e,s=n;for(;i=i.parent,i===null&&!(t&Ne.Host);)if(i=MH(s),i===null||(s=s[vc],i.type&10))break;if(i===null)return!1;e=i,n=s}let r=Oe.lFrame=dP();return r.currentTNode=e,r.lView=n,!0}function ww(n){let e=dP(),t=n[qe];Oe.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function dP(){let n=Oe.lFrame,e=n===null?null:n.child;return e===null?hP(n):e}function hP(n){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=e),e}function fP(){let n=Oe.lFrame;return Oe.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var pP=fP;function bw(){let n=fP();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function NH(n){return(Oe.lFrame.contextLView=mH(n,Oe.lFrame.contextLView))[Ur]}function zo(){return Oe.lFrame.selectedIndex}function Lo(n){Oe.lFrame.selectedIndex=n}function mP(){let n=Oe.lFrame;return tP(n.tView,n.selectedIndex)}function OH(){return Oe.lFrame.currentNamespace}var gP=!0;function Ew(){return gP}function Iw(n){gP=n}function kH(n,e,t){let{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){let o=XR(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}i&&(t.preOrderHooks??=[]).push(0-n,i),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}function Aw(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){let s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),c&&(n.viewHooks??=[]).push(-t,c),l&&((n.viewHooks??=[]).push(t,l),(n.viewCheckHooks??=[]).push(t,l)),u!=null&&(n.destroyHooks??=[]).push(t,u)}}function pf(n,e,t){yP(n,e,3,t)}function mf(n,e,t,r){(n[ge]&3)===t&&yP(n,e,t,r)}function av(n,e){let t=n[ge];(t&3)===e&&(t&=16383,t+=1,n[ge]=t)}function yP(n,e,t,r){let i=r!==void 0?n[ac]&65535:0,s=r??-1,o=e.length-1,a=0;for(let c=i;c<o;c++)if(typeof e[c+1]=="number"){if(a=e[c],r!=null&&a>=r)break}else e[c]<0&&(n[ac]+=65536),(a<s||s==-1)&&(LH(n,t,e,c),n[ac]=(n[ac]&4294901760)+c+2),c++}function Xx(n,e){ci(4,n,e);let t=Ze(null);try{e.call(n)}finally{Ze(t),ci(5,n,e)}}function LH(n,e,t,r){let i=t[r]<0,s=t[r+1],o=i?-t[r]:t[r],a=n[o];i?n[ge]>>14<n[ac]>>16&&(n[ge]&3)===e&&(n[ge]+=16384,Xx(a,s)):Xx(a,s)}var uc=-1,Fo=class{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}};function FH(n){return n instanceof Fo}function VH(n){return(n.flags&8)!==0}function jH(n){return(n.flags&16)!==0}function _P(n){return n!==uc}function Cf(n){return n&32767}function $H(n){return n>>16}function Sf(n,e){let t=$H(n),r=e;for(;t>0;)r=r[vc],t--;return r}var Rv=!0;function Df(n){let e=Rv;return Rv=n,e}var UH=256,vP=UH-1,wP=5,BH=0,li={};function HH(n,e,t){let r;typeof t=="string"?r=t.charCodeAt(0)||0:t.hasOwnProperty(Kl)&&(r=t[Kl]),r==null&&(r=t[Kl]=BH++);let i=r&vP,s=1<<i;e.data[n+(i>>wP)]|=s}function xf(n,e){let t=bP(n,e);if(t!==-1)return t;let r=e[qe];r.firstCreatePass&&(n.injectorIndex=e.length,cv(r.data,n),cv(e,null),cv(r.blueprint,null));let i=Tw(n,e),s=n.injectorIndex;if(_P(i)){let o=Cf(i),a=Sf(i,e),c=a[qe].data;for(let l=0;l<8;l++)e[s+l]=a[o+l]|c[o+l]}return e[s+8]=i,s}function cv(n,e){n.push(0,0,0,0,0,0,0,0,e)}function bP(n,e){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||e[n.injectorIndex+8]===null?-1:n.injectorIndex}function Tw(n,e){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let t=0,r=null,i=e;for(;i!==null;){if(r=CP(i),r===null)return uc;if(t++,i=i[vc],r.injectorIndex!==-1)return r.injectorIndex|t<<16}return uc}function Pv(n,e,t){HH(n,e,t)}function EP(n,e,t){if(t&Ne.Optional||n!==void 0)return n;lw(e,"NodeInjector")}function IP(n,e,t,r){if(t&Ne.Optional&&r===void 0&&(r=null),!(t&(Ne.Self|Ne.Host))){let i=n[pc],s=zn(void 0);try{return i?i.get(e,r,t&Ne.Optional):DR(e,r,t&Ne.Optional)}finally{zn(s)}}return EP(r,e,t)}function AP(n,e,t,r=Ne.Default,i){if(n!==null){if(e[ge]&2048&&!(r&Ne.Self)){let o=KH(n,e,t,r,li);if(o!==li)return o}let s=TP(n,e,t,r,li);if(s!==li)return s}return IP(e,t,r,i)}function TP(n,e,t,r,i){let s=GH(t);if(typeof s=="function"){if(!uP(e,n,r))return r&Ne.Host?EP(i,t,r):IP(e,t,r,i);try{let o;if(o=s(r),o==null&&!(r&Ne.Optional))lw(t);else return o}finally{pP()}}else if(typeof s=="number"){let o=null,a=bP(n,e),c=uc,l=r&Ne.Host?e[hi][Hr]:null;for((a===-1||r&Ne.SkipSelf)&&(c=a===-1?Tw(n,e):e[a+8],c===uc||!Jx(r,!1)?a=-1:(o=e[qe],a=Cf(c),e=Sf(c,e)));a!==-1;){let u=e[qe];if(Zx(s,a,u.data)){let d=qH(a,e,t,o,r,l);if(d!==li)return d}c=e[a+8],c!==uc&&Jx(r,e[qe].data[a+8]===l)&&Zx(s,a,e)?(o=u,a=Cf(c),e=Sf(c,e)):a=-1}}return i}function qH(n,e,t,r,i,s){let o=e[qe],a=o.data[n+8],c=r==null?Hf(a)&&Rv:r!=o&&(a.type&3)!==0,l=i&Ne.Host&&s===a,u=zH(a,o,t,c,l);return u!==null?gc(e,o,u,a):li}function zH(n,e,t,r,i){let s=n.providerIndexes,o=e.data,a=s&1048575,c=n.directiveStart,l=n.directiveEnd,u=s>>20,d=r?a:a+u,f=i?a+u:l;for(let p=d;p<f;p++){let y=o[p];if(p<c&&t===y||p>=c&&y.type===t)return p}if(i){let p=o[c];if(p&&Fs(p)&&p.type===t)return c}return null}function gc(n,e,t,r){let i=n[t],s=e.data;if(FH(i)){let o=i;o.resolving&&_B(yB(s[t]));let a=Df(o.canSeeViewProviders);o.resolving=!0;let c,l=o.injectImpl?zn(o.injectImpl):null,u=uP(n,r,Ne.Default);try{i=n[t]=o.factory(void 0,s,n,r),e.firstCreatePass&&t>=r.directiveStart&&kH(t,s[t],e)}finally{l!==null&&zn(l),Df(a),o.resolving=!1,pP()}}return i}function GH(n){if(typeof n=="string")return n.charCodeAt(0)||0;let e=n.hasOwnProperty(Kl)?n[Kl]:void 0;return typeof e=="number"?e>=0?e&vP:WH:e}function Zx(n,e,t){let r=1<<n;return!!(t[e+(n>>wP)]&r)}function Jx(n,e){return!(n&Ne.Self)&&!(n&Ne.Host&&e)}var Po=class{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return AP(this._tNode,this._lView,e,jf(r),t)}};function WH(){return new Po(rr(),pt())}function Go(n){return ou(()=>{let e=n.prototype.constructor,t=e[_f]||Mv(e),r=Object.prototype,i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){let s=i[_f]||Mv(i);if(s&&s!==t)return s;i=Object.getPrototypeOf(i)}return s=>new s})}function Mv(n){return bR(n)?()=>{let e=Mv(Mn(n));return e&&e()}:Mo(n)}function KH(n,e,t,r,i){let s=n,o=e;for(;s!==null&&o!==null&&o[ge]&2048&&!(o[ge]&512);){let a=TP(s,o,t,r|Ne.Self,li);if(a!==li)return a;let c=s.parent;if(!c){let l=o[WR];if(l){let u=l.get(t,li,r);if(u!==li)return u}c=CP(o),o=o[vc]}s=c}return i}function CP(n){let e=n[qe],t=e.type;return t===2?e.declTNode:t===1?n[Hr]:null}function eR(n,e=null,t=null,r){let i=SP(n,e,t,r);return i.resolveInjectorInitializers(),i}function SP(n,e=null,t=null,r,i=new Set){let s=[t||Gn,GB(n)];return r=r||(typeof n=="object"?void 0:On(n)),new Xl(s,e||pw(),r||null,i)}var yn=(()=>{class n{static{this.THROW_IF_NOT_FOUND=Yl}static{this.NULL=new bf}static create(t,r){if(Array.isArray(t))return eR({name:""},r,t,"");{let i=t.name??"";return eR({name:i},t.parent,t.providers,i)}}static{this.\u0275prov=ce({token:n,providedIn:"any",factory:()=>pe(MR)})}static{this.__NG_ELEMENT_ID__=-1}}return n})();var YH="ngOriginalError";function lv(n){return n[YH]}var Ki=class{constructor(){this._console=console}handleError(e){let t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&lv(e);for(;t&&lv(t);)t=lv(t);return t||null}},DP=new de("",{providedIn:"root",factory:()=>ne(Ki).handleError.bind(void 0)}),xP=(()=>{class n{static{this.__NG_ELEMENT_ID__=QH}static{this.__NG_ENV_ID__=t=>t}}return n})(),Nv=class extends xP{constructor(e){super(),this._lView=e}onDestroy(e){return iP(this._lView,e),()=>gH(this._lView,e)}};function QH(){return new Nv(pt())}function XH(){return qf(rr(),pt())}function qf(n,e){return new Ji(qr(n,e))}var Ji=(()=>{class n{constructor(t){this.nativeElement=t}static{this.__NG_ELEMENT_ID__=XH}}return n})();var Ov=class extends Pn{constructor(e=!1){super(),this.destroyRef=void 0,this.__isAsync=e,rH()&&(this.destroyRef=ne(xP,{optional:!0})??void 0)}emit(e){let t=Ze(null);try{super.next(e)}finally{Ze(t)}}subscribe(e,t,r){let i=e,s=t||(()=>null),o=r;if(e&&typeof e=="object"){let c=e;i=c.next?.bind(c),s=c.error?.bind(c),o=c.complete?.bind(c)}this.__isAsync&&(s=uv(s),i&&(i=uv(i)),o&&(o=uv(o)));let a=super.subscribe({next:i,error:s,complete:o});return e instanceof xt&&e.add(a),a}};function uv(n){return e=>{setTimeout(n,void 0,e)}}var Nn=Ov;function RP(n){return(n.flags&128)===128}var PP=new Map,ZH=0;function JH(){return ZH++}function eq(n){PP.set(n[Bf],n)}function tq(n){PP.delete(n[Bf])}var tR="__ngContext__";function Vo(n,e){Ro(e)?(n[tR]=e[Bf],eq(e)):n[tR]=e}function MP(n){return OP(n[Jl])}function NP(n){return OP(n[$r])}function OP(n){for(;n!==null&&!Zi(n);)n=n[$r];return n}var kv;function kP(n){kv=n}function nq(){if(kv!==void 0)return kv;if(typeof document<"u")return document;throw new he(210,!1)}var Cw=new de("",{providedIn:"root",factory:()=>rq}),rq="ng",Sw=new de(""),$s=new de("",{providedIn:"platform",factory:()=>"unknown"});var Dw=new de("",{providedIn:"root",factory:()=>nq().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var iq="h",sq="b";var oq=()=>null;function xw(n,e,t=!1){return oq(n,e,t)}var LP=!1,aq=new de("",{providedIn:"root",factory:()=>LP});var Lv=class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${aB})`}};function zf(n){return n instanceof Lv?n.changingThisBreaksApplicationSecurity:n}function FP(n){return n instanceof Function?n():n}var Yi=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Yi||{}),cq;function Rw(n,e){return cq(n,e)}function cc(n,e,t,r,i){if(r!=null){let s,o=!1;Zi(r)?s=r:Ro(r)&&(o=!0,r=r[Xi]);let a=fi(r);n===0&&t!==null?i==null?BP(e,t,a):Rf(e,t,a,i||null,!0):n===1&&t!==null?Rf(e,t,a,i||null,!0):n===2?Tq(e,a,o):n===3&&e.destroyNode(a),s!=null&&Sq(e,n,s,t,i)}}function lq(n,e){return n.createText(e)}function uq(n,e,t){n.setValue(e,t)}function VP(n,e,t){return n.createElement(e,t)}function dq(n,e){jP(n,e),e[Xi]=null,e[Hr]=null}function hq(n,e,t,r,i,s){r[Xi]=i,r[Hr]=e,Gf(n,r,t,1,i,s)}function jP(n,e){e[di].changeDetectionScheduler?.notify(1),Gf(n,e,e[zt],2,null,null)}function fq(n){let e=n[Jl];if(!e)return dv(n[qe],n);for(;e;){let t=null;if(Ro(e))t=e[Jl];else{let r=e[pr];r&&(t=r)}if(!t){for(;e&&!e[$r]&&e!==n;)Ro(e)&&dv(e[qe],e),e=e[gn];e===null&&(e=n),Ro(e)&&dv(e[qe],e),t=e&&e[$r]}e=t}}function pq(n,e,t,r){let i=pr+r,s=t.length;r>0&&(t[i-1][$r]=e),r<s-pr?(e[$r]=t[i],PR(t,pr+r,e)):(t.push(e),e[$r]=null),e[gn]=t;let o=e[Uf];o!==null&&t!==o&&mq(o,e);let a=e[mc];a!==null&&a.insertView(n),Dv(e),e[ge]|=128}function mq(n,e){let t=n[Af],i=e[gn][gn][hi];e[hi]!==i&&(n[ge]|=mw.HasTransplantedViews),t===null?n[Af]=[e]:t.push(e)}function $P(n,e){let t=n[Af],r=t.indexOf(e);t.splice(r,1)}function Fv(n,e){if(n.length<=pr)return;let t=pr+e,r=n[t];if(r){let i=r[Uf];i!==null&&i!==n&&$P(i,r),e>0&&(n[t-1][$r]=r[$r]);let s=wf(n,pr+e);dq(r[qe],r);let o=s[mc];o!==null&&o.detachView(s[qe]),r[gn]=null,r[$r]=null,r[ge]&=-129}return r}function UP(n,e){if(!(e[ge]&256)){let t=e[zt];t.destroyNode&&Gf(n,e,t,3,null,null),fq(e)}}function dv(n,e){if(e[ge]&256)return;let t=Ze(null);try{e[ge]&=-129,e[ge]|=256,e[Oo]&&px(e[Oo]),yq(n,e),gq(n,e),e[qe].type===1&&e[zt].destroy();let r=e[Uf];if(r!==null&&Zi(e[gn])){r!==e[gn]&&$P(r,e);let i=e[mc];i!==null&&i.detachView(n)}tq(e)}finally{Ze(t)}}function gq(n,e){let t=n.cleanup,r=e[Zl];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let o=t[s+3];o>=0?r[o]():r[-o].unsubscribe(),s+=2}else{let o=r[t[s+1]];t[s].call(o)}r!==null&&(e[Zl]=null);let i=e[Ls];if(i!==null){e[Ls]=null;for(let s=0;s<i.length;s++){let o=i[s];o()}}}function yq(n,e){let t;if(n!=null&&(t=n.destroyHooks)!=null)for(let r=0;r<t.length;r+=2){let i=e[t[r]];if(!(i instanceof Fo)){let s=t[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){let a=i[s[o]],c=s[o+1];ci(4,a,c);try{c.call(a)}finally{ci(5,a,c)}}else{ci(4,i,s);try{s.call(i)}finally{ci(5,i,s)}}}}}function _q(n,e,t){return vq(n,e.parent,t)}function vq(n,e,t){let r=e;for(;r!==null&&r.type&40;)e=r,r=e.parent;if(r===null)return t[Xi];{let{componentOffset:i}=r;if(i>-1){let{encapsulation:s}=n.data[r.directiveStart+i];if(s===ui.None||s===ui.Emulated)return null}return qr(r,t)}}function Rf(n,e,t,r,i){n.insertBefore(e,t,r,i)}function BP(n,e,t){n.appendChild(e,t)}function nR(n,e,t,r,i){r!==null?Rf(n,e,t,r,i):BP(n,e,t)}function wq(n,e,t,r){n.removeChild(e,t,r)}function Pw(n,e){return n.parentNode(e)}function bq(n,e){return n.nextSibling(e)}function Eq(n,e,t){return Aq(n,e,t)}function Iq(n,e,t){return n.type&40?qr(n,t):null}var Aq=Iq,rR;function Mw(n,e,t,r){let i=_q(n,r,e),s=e[zt],o=r.parent||e[Hr],a=Eq(o,r,e);if(i!=null)if(Array.isArray(t))for(let c=0;c<t.length;c++)nR(s,i,t[c],a,!1);else nR(s,i,t,a,!1);rR!==void 0&&rR(s,r,e,t,i)}function gf(n,e){if(e!==null){let t=e.type;if(t&3)return qr(e,n);if(t&4)return Vv(-1,n[e.index]);if(t&8){let r=e.child;if(r!==null)return gf(n,r);{let i=n[e.index];return Zi(i)?Vv(-1,i):fi(i)}}else{if(t&32)return Rw(e,n)()||fi(n[e.index]);{let r=HP(n,e);if(r!==null){if(Array.isArray(r))return r[0];let i=tu(n[hi]);return gf(i,r)}else return gf(n,e.next)}}}return null}function HP(n,e){if(e!==null){let r=n[hi][Hr],i=e.projection;return r.projection[i]}return null}function Vv(n,e){let t=pr+n+1;if(t<e.length){let r=e[t],i=r[qe].firstChild;if(i!==null)return gf(r,i)}return e[ko]}function Tq(n,e,t){let r=Pw(n,e);r&&wq(n,r,e,t)}function Nw(n,e,t,r,i,s,o){for(;t!=null;){let a=r[t.index],c=t.type;if(o&&e===0&&(a&&Vo(fi(a),r),t.flags|=2),(t.flags&32)!==32)if(c&8)Nw(n,e,t.child,r,i,s,!1),cc(e,n,i,a,s);else if(c&32){let l=Rw(t,r),u;for(;u=l();)cc(e,n,i,u,s);cc(e,n,i,a,s)}else c&16?Cq(n,e,r,t,i,s):cc(e,n,i,a,s);t=o?t.projectionNext:t.next}}function Gf(n,e,t,r,i,s){Nw(t,r,n.firstChild,e,i,s,!1)}function Cq(n,e,t,r,i,s){let o=t[hi],c=o[Hr].projection[r.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++){let u=c[l];cc(e,n,i,u,s)}else{let l=c,u=o[gn];RP(r)&&(l.flags|=128),Nw(n,e,l,u,i,s,!0)}}function Sq(n,e,t,r,i){let s=t[ko],o=fi(t);s!==o&&cc(e,n,r,s,i);for(let a=pr;a<t.length;a++){let c=t[a];Gf(c[qe],c,n,e,r,s)}}function Dq(n,e,t,r,i){if(e)i?n.addClass(t,r):n.removeClass(t,r);else{let s=r.indexOf("-")===-1?void 0:Yi.DashCase;i==null?n.removeStyle(t,r,s):(typeof i=="string"&&i.endsWith("!important")&&(i=i.slice(0,-10),s|=Yi.Important),n.setStyle(t,r,i,s))}}function xq(n,e,t){n.setAttribute(e,"style",t)}function qP(n,e,t){t===""?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function zP(n,e,t){let{mergedAttrs:r,classes:i,styles:s}=t;r!==null&&Iv(n,e,r),i!==null&&qP(n,e,i),s!==null&&xq(n,e,s)}var es={};function oe(n=1){GP(Kn(),pt(),zo()+n,!1)}function GP(n,e,t,r){if(!r)if((e[ge]&3)===3){let s=n.preOrderCheckHooks;s!==null&&pf(e,s,t)}else{let s=n.preOrderHooks;s!==null&&mf(e,s,0,t)}Lo(t)}function ke(n,e=Ne.Default){let t=pt();if(t===null)return pe(n,e);let r=rr();return AP(r,t,Mn(n),e)}function WP(n,e,t,r,i,s){let o=Ze(null);try{let a=null;i&mr.SignalBased&&(a=e[r][N_]),a!==null&&a.transformFn!==void 0&&(s=a.transformFn(s)),i&mr.HasDecoratorInputTransform&&(s=n.inputTransforms[r].call(e,s)),n.setInput!==null?n.setInput(e,a,s,t,r):QR(e,a,r,s)}finally{Ze(o)}}function Rq(n,e){let t=n.hostBindingOpCodes;if(t!==null)try{for(let r=0;r<t.length;r++){let i=t[r];if(i<0)Lo(~i);else{let s=i,o=t[++r],a=t[++r];xH(o,s);let c=e[s];a(2,c)}}}finally{Lo(-1)}}function Wf(n,e,t,r,i,s,o,a,c,l,u){let d=e.blueprint.slice();return d[Xi]=i,d[ge]=r|4|128|8|64,(l!==null||n&&n[ge]&2048)&&(d[ge]|=2048),rP(d),d[gn]=d[vc]=n,d[Ur]=t,d[di]=o||n&&n[di],d[zt]=a||n&&n[zt],d[pc]=c||n&&n[pc]||null,d[Hr]=s,d[Bf]=JH(),d[Ef]=u,d[WR]=l,d[hi]=e.type==2?n[hi]:d,d}function Kf(n,e,t,r,i){let s=n.data[e];if(s===null)s=Pq(n,e,t,r,i),DH()&&(s.flags|=32);else if(s.type&64){s.type=t,s.value=r,s.attrs=i;let o=IH();s.injectorIndex=o===null?-1:o.injectorIndex}return cu(s,!0),s}function Pq(n,e,t,r,i){let s=oP(),o=aP(),a=o?s:s&&s.parent,c=n.data[e]=Lq(n,a,t,e,r,i);return n.firstChild===null&&(n.firstChild=c),s!==null&&(o?s.child==null&&c.parent!==null&&(s.child=c):s.next===null&&(s.next=c,c.prev=s)),c}function KP(n,e,t,r){if(t===0)return-1;let i=e.length;for(let s=0;s<t;s++)e.push(r),n.blueprint.push(r),n.data.push(null);return i}function YP(n,e,t,r,i){let s=zo(),o=r&2;try{Lo(-1),o&&e.length>Br&&GP(n,e,Br,!1),ci(o?2:0,i),t(r,i)}finally{Lo(s),ci(o?3:1,i)}}function QP(n,e,t){if(YR(e)){let r=Ze(null);try{let i=e.directiveStart,s=e.directiveEnd;for(let o=i;o<s;o++){let a=n.data[o];if(a.contentQueries){let c=t[o];a.contentQueries(1,c,o)}}}finally{Ze(r)}}}function XP(n,e,t){sP()&&(Bq(n,e,t,qr(t,e)),(t.flags&64)===64&&rM(n,e,t))}function ZP(n,e,t=qr){let r=e.localNames;if(r!==null){let i=e.index+1;for(let s=0;s<r.length;s+=2){let o=r[s+1],a=o===-1?t(e,n):n[o];n[i++]=a}}}function JP(n){let e=n.tView;return e===null||e.incompleteFirstPass?n.tView=Ow(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function Ow(n,e,t,r,i,s,o,a,c,l,u){let d=Br+r,f=d+i,p=Mq(d,f),y=typeof l=="function"?l():l;return p[qe]={type:n,blueprint:p,template:t,queries:null,viewQuery:a,declTNode:e,data:p.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof o=="function"?o():o,firstChild:null,schemas:c,consts:y,incompleteFirstPass:!1,ssrId:u}}function Mq(n,e){let t=[];for(let r=0;r<e;r++)t.push(r<n?null:es);return t}function Nq(n,e,t,r){let s=r.get(aq,LP)||t===ui.ShadowDom,o=n.selectRootElement(e,s);return Oq(o),o}function Oq(n){kq(n)}var kq=()=>null;function Lq(n,e,t,r,i,s){let o=e?e.injectorIndex:-1,a=0;return wH()&&(a|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function iR(n,e,t,r,i){for(let s in e){if(!e.hasOwnProperty(s))continue;let o=e[s];if(o===void 0)continue;r??={};let a,c=mr.None;Array.isArray(o)?(a=o[0],c=o[1]):a=o;let l=s;if(i!==null){if(!i.hasOwnProperty(s))continue;l=i[s]}n===0?sR(r,t,l,a,c):sR(r,t,l,a)}return r}function sR(n,e,t,r,i){let s;n.hasOwnProperty(t)?(s=n[t]).push(e,r):s=n[t]=[e,r],i!==void 0&&s.push(i)}function Fq(n,e,t){let r=e.directiveStart,i=e.directiveEnd,s=n.data,o=e.attrs,a=[],c=null,l=null;for(let u=r;u<i;u++){let d=s[u],f=t?t.get(d):null,p=f?f.inputs:null,y=f?f.outputs:null;c=iR(0,d.inputs,u,c,p),l=iR(1,d.outputs,u,l,y);let w=c!==null&&o!==null&&!hw(e)?Xq(c,u,o):null;a.push(w)}c!==null&&(c.hasOwnProperty("class")&&(e.flags|=8),c.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=c,e.outputs=l}function Vq(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function eM(n,e,t,r,i,s,o,a){let c=qr(e,t),l=e.inputs,u;!a&&l!=null&&(u=l[r])?(kw(n,t,u,r,i),Hf(e)&&jq(t,e.index)):e.type&3?(r=Vq(r),i=o!=null?o(i,e.value||"",r):i,s.setProperty(c,r,i)):e.type&12}function jq(n,e){let t=js(e,n);t[ge]&16||(t[ge]|=64)}function tM(n,e,t,r){if(sP()){let i=r===null?null:{"":-1},s=qq(n,t),o,a;s===null?o=a=null:[o,a]=s,o!==null&&nM(n,e,t,o,i,a),i&&zq(t,r,i)}t.mergedAttrs=Ql(t.mergedAttrs,t.attrs)}function nM(n,e,t,r,i,s){for(let l=0;l<r.length;l++)Pv(xf(t,e),n,r[l].type);Wq(t,n.data.length,r.length);for(let l=0;l<r.length;l++){let u=r[l];u.providersResolver&&u.providersResolver(u)}let o=!1,a=!1,c=KP(n,e,r.length,null);for(let l=0;l<r.length;l++){let u=r[l];t.mergedAttrs=Ql(t.mergedAttrs,u.hostAttrs),Kq(n,t,e,c,u),Gq(c,u,i),u.contentQueries!==null&&(t.flags|=4),(u.hostBindings!==null||u.hostAttrs!==null||u.hostVars!==0)&&(t.flags|=64);let d=u.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),o=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),a=!0),c++}Fq(n,t,s)}function $q(n,e,t,r,i){let s=i.hostBindings;if(s){let o=n.hostBindingOpCodes;o===null&&(o=n.hostBindingOpCodes=[]);let a=~e.index;Uq(o)!=a&&o.push(a),o.push(t,r,s)}}function Uq(n){let e=n.length;for(;e>0;){let t=n[--e];if(typeof t=="number"&&t<0)return t}return 0}function Bq(n,e,t,r){let i=t.directiveStart,s=t.directiveEnd;Hf(t)&&Yq(e,t,n.data[i+t.componentOffset]),n.firstCreatePass||xf(t,e),Vo(r,e);let o=t.initialInputs;for(let a=i;a<s;a++){let c=n.data[a],l=gc(e,n,a,t);if(Vo(l,e),o!==null&&Qq(e,a-i,l,c,t,o),Fs(c)){let u=js(t.index,e);u[Ur]=gc(e,n,a,t)}}}function rM(n,e,t){let r=t.directiveStart,i=t.directiveEnd,s=t.index,o=RH();try{Lo(s);for(let a=r;a<i;a++){let c=n.data[a],l=e[a];xv(a),(c.hostBindings!==null||c.hostVars!==0||c.hostAttrs!==null)&&Hq(c,l)}}finally{Lo(-1),xv(o)}}function Hq(n,e){n.hostBindings!==null&&n.hostBindings(1,e)}function qq(n,e){let t=n.directiveRegistry,r=null,i=null;if(t)for(let s=0;s<t.length;s++){let o=t[s];if(FB(e,o.selectors,!1))if(r||(r=[]),Fs(o))if(o.findHostDirectiveDefs!==null){let a=[];i=i||new Map,o.findHostDirectiveDefs(o,a,i),r.unshift(...a,o);let c=a.length;jv(n,e,c)}else r.unshift(o),jv(n,e,0);else i=i||new Map,o.findHostDirectiveDefs?.(o,r,i),r.push(o)}return r===null?null:[r,i]}function jv(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function zq(n,e,t){if(e){let r=n.localNames=[];for(let i=0;i<e.length;i+=2){let s=t[e[i+1]];if(s==null)throw new he(-301,!1);r.push(e[i],s)}}}function Gq(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;Fs(e)&&(t[""]=n)}}function Wq(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function Kq(n,e,t,r,i){n.data[r]=i;let s=i.factory||(i.factory=Mo(i.type,!0)),o=new Fo(s,Fs(i),ke);n.blueprint[r]=o,t[r]=o,$q(n,e,r,KP(n,t,i.hostVars,es),i)}function Yq(n,e,t){let r=qr(e,n),i=JP(t),s=n[di].rendererFactory,o=16;t.signals?o=4096:t.onPush&&(o=64);let a=Yf(n,Wf(n,i,null,o,r,e,null,s.createRenderer(r,t),null,null,null));n[e.index]=a}function Qq(n,e,t,r,i,s){let o=s[e];if(o!==null)for(let a=0;a<o.length;){let c=o[a++],l=o[a++],u=o[a++],d=o[a++];WP(r,t,c,l,u,d)}}function Xq(n,e,t){let r=null,i=0;for(;i<t.length;){let s=t[i];if(s===0){i+=4;continue}else if(s===5){i+=2;continue}if(typeof s=="number")break;if(n.hasOwnProperty(s)){r===null&&(r=[]);let o=n[s];for(let a=0;a<o.length;a+=3)if(o[a]===e){r.push(s,o[a+1],o[a+2],t[i+1]);break}}i+=2}return r}function iM(n,e,t,r){return[n,!0,0,e,null,r,null,t,null,null]}function sM(n,e){let t=n.contentQueries;if(t!==null){let r=Ze(null);try{for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];if(o!==-1){let a=n.data[o];lP(s),a.contentQueries(2,e[o],o)}}}finally{Ze(r)}}}function Yf(n,e){return n[Jl]?n[Yx][$r]=e:n[Jl]=e,n[Yx]=e,e}function $v(n,e,t){lP(0);let r=Ze(null);try{e(n,t)}finally{Ze(r)}}function Zq(n){return n[Zl]||(n[Zl]=[])}function Jq(n){return n.cleanup||(n.cleanup=[])}function oM(n,e){let t=n[pc],r=t?t.get(Ki,null):null;r&&r.handleError(e)}function kw(n,e,t,r,i){for(let s=0;s<t.length;){let o=t[s++],a=t[s++],c=t[s++],l=e[o],u=n.data[o];WP(u,l,r,a,c,i)}}function e4(n,e,t){let r=eP(e,n);uq(n[zt],r,t)}function t4(n,e){let t=js(e,n),r=t[qe];n4(r,t);let i=t[Xi];i!==null&&t[Ef]===null&&(t[Ef]=xw(i,t[pc])),Lw(r,t,t[Ur])}function n4(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}function Lw(n,e,t){ww(e);try{let r=n.viewQuery;r!==null&&$v(1,r,t);let i=n.template;i!==null&&YP(n,e,i,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[mc]?.finishViewCreation(n),n.staticContentQueries&&sM(n,e),n.staticViewQueries&&$v(2,n.viewQuery,t);let s=n.components;s!==null&&r4(e,s)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[ge]&=-5,bw()}}function r4(n,e){for(let t=0;t<e.length;t++)t4(n,e[t])}function i4(n,e,t,r){let i=Ze(null);try{let s=e.tView,a=n[ge]&4096?4096:16,c=Wf(n,s,t,a,null,e,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),l=n[e.index];c[Uf]=l;let u=n[mc];return u!==null&&(c[mc]=u.createEmbeddedView(s)),Lw(s,c,t),c}finally{Ze(i)}}function oR(n,e){return!e||e.firstChild===null||RP(n)}function s4(n,e,t,r=!0){let i=e[qe];if(pq(i,e,n,t),r){let o=Vv(t,n),a=e[zt],c=Pw(a,n[ko]);c!==null&&hq(i,n[Hr],a,e,c,o)}let s=e[Ef];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function Pf(n,e,t,r,i=!1){for(;t!==null;){let s=e[t.index];s!==null&&r.push(fi(s)),Zi(s)&&o4(s,r);let o=t.type;if(o&8)Pf(n,e,t.child,r);else if(o&32){let a=Rw(t,e),c;for(;c=a();)r.push(c)}else if(o&16){let a=HP(e,t);if(Array.isArray(a))r.push(...a);else{let c=tu(e[hi]);Pf(c[qe],c,a,r,!0)}}t=i?t.projectionNext:t.next}return r}function o4(n,e){for(let t=pr;t<n.length;t++){let r=n[t],i=r[qe].firstChild;i!==null&&Pf(r[qe],r,i,e)}n[ko]!==n[Xi]&&e.push(n[ko])}var aM=[];function a4(n){return n[Oo]??c4(n)}function c4(n){let e=aM.pop()??Object.create(u4);return e.lView=n,e}function l4(n){n.lView[Oo]!==n&&(n.lView=null,aM.push(n))}var u4=P(_({},dx),{consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{eu(n.lView)},consumerOnSignalRead(){this.lView[Oo]=this}}),cM=100;function lM(n,e=!0,t=0){let r=n[di],i=r.rendererFactory,s=!1;s||i.begin?.();try{d4(n,t)}catch(o){throw e&&oM(n,o),o}finally{s||(i.end?.(),r.inlineEffectRunner?.flush())}}function d4(n,e){Uv(n,e);let t=0;for(;_w(n);){if(t===cM)throw new he(103,!1);t++,Uv(n,1)}}function h4(n,e,t,r){let i=e[ge];if((i&256)===256)return;let s=!1;!s&&e[di].inlineEffectRunner?.flush(),ww(e);let o=null,a=null;!s&&f4(n)&&(a=a4(e),o=hx(a));try{rP(e),SH(n.bindingStartIndex),t!==null&&YP(n,e,t,2,r);let c=(i&3)===3;if(!s)if(c){let d=n.preOrderCheckHooks;d!==null&&pf(e,d,null)}else{let d=n.preOrderHooks;d!==null&&mf(e,d,0,null),av(e,0)}if(p4(e),uM(e,0),n.contentQueries!==null&&sM(n,e),!s)if(c){let d=n.contentCheckHooks;d!==null&&pf(e,d)}else{let d=n.contentHooks;d!==null&&mf(e,d,1),av(e,1)}Rq(n,e);let l=n.components;l!==null&&hM(e,l,0);let u=n.viewQuery;if(u!==null&&$v(2,u,r),!s)if(c){let d=n.viewCheckHooks;d!==null&&pf(e,d)}else{let d=n.viewHooks;d!==null&&mf(e,d,2),av(e,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),e[ov]){for(let d of e[ov])d();e[ov]=null}s||(e[ge]&=-73)}catch(c){throw eu(e),c}finally{a!==null&&(fx(a,o),l4(a)),bw()}}function f4(n){return n.type!==2}function uM(n,e){for(let t=MP(n);t!==null;t=NP(t))for(let r=pr;r<t.length;r++){let i=t[r];dM(i,e)}}function p4(n){for(let e=MP(n);e!==null;e=NP(e)){if(!(e[ge]&mw.HasTransplantedViews))continue;let t=e[Af];for(let r=0;r<t.length;r++){let i=t[r],s=i[gn];pH(i)}}}function m4(n,e,t){let r=js(e,n);dM(r,t)}function dM(n,e){yw(n)&&Uv(n,e)}function Uv(n,e){let r=n[qe],i=n[ge],s=n[Oo],o=!!(e===0&&i&16);if(o||=!!(i&64&&e===0),o||=!!(i&1024),o||=!!(s?.dirty&&O_(s)),s&&(s.dirty=!1),n[ge]&=-9217,o)h4(r,n,r.template,n[Ur]);else if(i&8192){uM(n,1);let a=r.components;a!==null&&hM(n,a,1)}}function hM(n,e,t){for(let r=0;r<e.length;r++)m4(n,e[r],t)}function Fw(n){for(n[di].changeDetectionScheduler?.notify();n;){n[ge]|=64;let e=tu(n);if(sH(n)&&!e)return n;n=e}return null}var jo=class{get rootNodes(){let e=this._lView,t=e[qe];return Pf(t,e,t.firstChild,[])}constructor(e,t,r=!0){this._lView=e,this._cdRefInjectingView=t,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ur]}set context(e){this._lView[Ur]=e}get destroyed(){return(this._lView[ge]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[gn];if(Zi(e)){let t=e[If],r=t?t.indexOf(this):-1;r>-1&&(Fv(e,r),wf(t,r))}this._attachedToViewContainer=!1}UP(this._lView[qe],this._lView)}onDestroy(e){iP(this._lView,e)}markForCheck(){Fw(this._cdRefInjectingView||this._lView)}detach(){this._lView[ge]&=-129}reattach(){Dv(this._lView),this._lView[ge]|=128}detectChanges(){this._lView[ge]|=1024,lM(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new he(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,jP(this._lView[qe],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new he(902,!1);this._appRef=e,Dv(this._lView)}},Qf=(()=>{class n{static{this.__NG_ELEMENT_ID__=_4}}return n})(),g4=Qf,y4=class extends g4{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t)}createEmbeddedViewImpl(e,t,r){let i=i4(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:t,dehydratedView:r});return new jo(i)}};function _4(){return fM(rr(),pt())}function fM(n,e){return n.type&4?new y4(e,n,qf(n,e)):null}var Cue=new RegExp(`^(\\d+)*(${sq}|${iq})*(.*)`);var v4=()=>null;function aR(n,e){return v4(n,e)}var Bv=class{},Hv=class{},Mf=class{};function w4(n){let e=Error(`No component factory found for ${On(n)}.`);return e[b4]=n,e}var b4="ngComponent";var qv=class{resolveComponentFactory(e){throw w4(e)}},Xf=(()=>{class n{static{this.NULL=new qv}}return n})(),nu=class{},Us=(()=>{class n{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>E4()}}return n})();function E4(){let n=pt(),e=rr(),t=js(e.index,n);return(Ro(t)?t:n)[zt]}var I4=(()=>{class n{static{this.\u0275prov=ce({token:n,providedIn:"root",factory:()=>null})}}return n})(),hv={};var cR=new Set;function pM(n){cR.has(n)||(cR.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}function lR(...n){}function A4(){let n=typeof Wl.requestAnimationFrame=="function",e=Wl[n?"requestAnimationFrame":"setTimeout"],t=Wl[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&t){let r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);let i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}var et=class n{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Nn(!1),this.onMicrotaskEmpty=new Nn(!1),this.onStable=new Nn(!1),this.onError=new Nn(!1),typeof Zone>"u")throw new he(908,!1);Zone.assertZonePatched();let i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&t,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=A4().nativeRequestAnimationFrame,S4(i)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new he(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new he(909,!1)}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,i){let s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,T4,lR,lR);try{return s.runTask(o,t,r)}finally{s.cancelTask(o)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}},T4={};function Vw(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function C4(n){n.isCheckStableRunning||n.lastRequestAnimationFrameId!==-1||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Wl,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,zv(n),n.isCheckStableRunning=!0,Vw(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),zv(n))}function S4(n){let e=()=>{C4(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,i,s,o,a)=>{if(D4(a))return t.invokeTask(i,s,o,a);try{return uR(n),t.invokeTask(i,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&e(),dR(n)}},onInvoke:(t,r,i,s,o,a,c)=>{try{return uR(n),t.invoke(i,s,o,a,c)}finally{n.shouldCoalesceRunChangeDetection&&e(),dR(n)}},onHasTask:(t,r,i,s)=>{t.hasTask(i,s),r===i&&(s.change=="microTask"?(n._hasPendingMicrotasks=s.microTask,zv(n),Vw(n)):s.change=="macroTask"&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,r,i,s)=>(t.handleError(i,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}function zv(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.lastRequestAnimationFrameId!==-1?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function uR(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function dR(n){n._nesting--,Vw(n)}function D4(n){return!Array.isArray(n)||n.length!==1?!1:n[0].data?.__ignore_ng_zone__===!0}var mM=(()=>{class n{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let t=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let r of t)r()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static{this.\u0275prov=ce({token:n,providedIn:"root",factory:()=>new n})}}return n})();function Gv(n,e,t){let r=t?n.styles:null,i=t?n.classes:null,s=0;if(e!==null)for(let o=0;o<e.length;o++){let a=e[o];if(typeof a=="number")s=a;else if(s==1)i=vv(i,a);else if(s==2){let c=a,l=e[++o];r=vv(r,c+": "+l+";")}}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=i:n.classesWithoutHost=i}var Nf=class extends Xf{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=No(e);return new ru(t,this.ngModule)}};function hR(n){let e=[];for(let t in n){if(!n.hasOwnProperty(t))continue;let r=n[t];r!==void 0&&e.push({propName:Array.isArray(r)?r[0]:r,templateName:t})}return e}function x4(n){let e=n.toLowerCase();return e==="svg"?lH:e==="math"?uH:null}var Wv=class{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,r){r=jf(r);let i=this.injector.get(e,hv,r);return i!==hv||t===hv?i:this.parentInjector.get(e,t,r)}},ru=class extends Mf{get inputs(){let e=this.componentDef,t=e.inputTransforms,r=hR(e.inputs);if(t!==null)for(let i of r)t.hasOwnProperty(i.propName)&&(i.transform=t[i.propName]);return r}get outputs(){return hR(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=UB(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,r,i){let s=Ze(null);try{i=i||this.ngModule;let o=i instanceof gr?i:i?.injector;o&&this.componentDef.getStandaloneInjector!==null&&(o=this.componentDef.getStandaloneInjector(o)||o);let a=o?new Wv(e,o):e,c=a.get(nu,null);if(c===null)throw new he(407,!1);let l=a.get(I4,null),u=a.get(mM,null),d=a.get(Bv,null),f={rendererFactory:c,sanitizer:l,inlineEffectRunner:null,afterRenderEventManager:u,changeDetectionScheduler:d},p=c.createRenderer(null,this.componentDef),y=this.componentDef.selectors[0][0]||"div",w=r?Nq(p,r,this.componentDef.encapsulation,a):VP(p,y,x4(y)),b=512;this.componentDef.signals?b|=4096:this.componentDef.onPush||(b|=16);let E=null;w!==null&&(E=xw(w,a,!0));let D=Ow(0,null,null,1,0,null,null,null,null,null,null),x=Wf(null,D,null,b,null,null,f,p,a,null,E);ww(x);let N,L;try{let F=this.componentDef,T,A=null;F.findHostDirectiveDefs?(T=[],A=new Map,F.findHostDirectiveDefs(F,T,A),T.push(F)):T=[F];let C=R4(x,w),R=P4(C,w,F,T,x,f,p);L=tP(D,Br),w&&O4(p,F,w,r),t!==void 0&&k4(L,this.ngContentSelectors,t),N=N4(R,F,T,A,x,[L4]),Lw(D,x,null)}finally{bw()}return new Kv(this.componentType,N,qf(L,x),x,L)}finally{Ze(s)}}},Kv=class extends Hv{constructor(e,t,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new jo(i,void 0,!1),this.componentType=e}setInput(e,t){let r=this._tNode.inputs,i;if(r!==null&&(i=r[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let s=this._rootLView;kw(s[qe],s,i,e,t),this.previousInputValues.set(e,t);let o=js(this._tNode.index,s);Fw(o)}}get injector(){return new Po(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function R4(n,e){let t=n[qe],r=Br;return n[r]=e,Kf(t,r,2,"#host",null)}function P4(n,e,t,r,i,s,o){let a=i[qe];M4(r,n,e,o);let c=null;e!==null&&(c=xw(e,i[pc]));let l=s.rendererFactory.createRenderer(e,t),u=16;t.signals?u=4096:t.onPush&&(u=64);let d=Wf(i,JP(t),null,u,i[n.index],n,s,l,null,null,c);return a.firstCreatePass&&jv(a,n,r.length-1),Yf(i,d),i[n.index]=d}function M4(n,e,t,r){for(let i of n)e.mergedAttrs=Ql(e.mergedAttrs,i.hostAttrs);e.mergedAttrs!==null&&(Gv(e,e.mergedAttrs,!0),t!==null&&zP(r,t,e))}function N4(n,e,t,r,i,s){let o=rr(),a=i[qe],c=qr(o,i);nM(a,i,o,t,null,r);for(let u=0;u<t.length;u++){let d=o.directiveStart+u,f=gc(i,a,d,o);Vo(f,i)}rM(a,i,o),c&&Vo(c,i);let l=gc(i,a,o.directiveStart+o.componentOffset,o);if(n[Ur]=i[Ur]=l,s!==null)for(let u of s)u(l,e);return QP(a,o,i),l}function O4(n,e,t,r){if(r)Iv(n,t,["ng-version","17.3.12"]);else{let{attrs:i,classes:s}=BB(e.selectors[0]);i&&Iv(n,t,i),s&&s.length>0&&qP(n,t,s.join(" "))}}function k4(n,e,t){let r=n.projection=[];for(let i=0;i<e.length;i++){let s=t[i];r.push(s!=null?Array.from(s):null)}}function L4(){let n=rr();Aw(pt()[qe],n)}var bc=(()=>{class n{static{this.__NG_ELEMENT_ID__=F4}}return n})();function F4(){let n=rr();return j4(n,pt())}var V4=bc,gM=class extends V4{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return qf(this._hostTNode,this._hostLView)}get injector(){return new Po(this._hostTNode,this._hostLView)}get parentInjector(){let e=Tw(this._hostTNode,this._hostLView);if(_P(e)){let t=Sf(e,this._hostLView),r=Cf(e),i=t[qe].data[r+8];return new Po(i,t)}else return new Po(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=fR(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-pr}createEmbeddedView(e,t,r){let i,s;typeof r=="number"?i=r:r!=null&&(i=r.index,s=r.injector);let o=aR(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},s,o);return this.insertImpl(a,i,oR(this._hostTNode,o)),a}createComponent(e,t,r,i,s){let o=e&&!iH(e),a;if(o)a=t;else{let y=t||{};a=y.index,r=y.injector,i=y.projectableNodes,s=y.environmentInjector||y.ngModuleRef}let c=o?e:new ru(No(e)),l=r||this.parentInjector;if(!s&&c.ngModule==null){let w=(o?l:this.parentInjector).get(gr,null);w&&(s=w)}let u=No(c.componentType??{}),d=aR(this._lContainer,u?.id??null),f=d?.firstChild??null,p=c.create(l,i,f,s);return this.insertImpl(p.hostView,a,oR(this._hostTNode,d)),p}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,r){let i=e._lView;if(fH(i)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let c=i[gn],l=new gM(c,c[Hr],c[gn]);l.detach(l.indexOf(e))}}let s=this._adjustIndex(t),o=this._lContainer;return s4(o,i,s,r),e.attachToViewContainerRef(),PR(fv(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=fR(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),r=Fv(this._lContainer,t);r&&(wf(fv(this._lContainer),t),UP(r[qe],r))}detach(e){let t=this._adjustIndex(e,-1),r=Fv(this._lContainer,t);return r&&wf(fv(this._lContainer),t)!=null?new jo(r):null}_adjustIndex(e,t=0){return e??this.length+t}};function fR(n){return n[If]}function fv(n){return n[If]||(n[If]=[])}function j4(n,e){let t,r=e[n.index];return Zi(r)?t=r:(t=iM(r,e,null,n),e[n.index]=t,Yf(e,t)),U4(t,e,n,r),new gM(t,n,e)}function $4(n,e){let t=n[zt],r=t.createComment(""),i=qr(e,n),s=Pw(t,i);return Rf(t,s,r,bq(t,i),!1),r}var U4=q4,B4=()=>!1;function H4(n,e,t){return B4(n,e,t)}function q4(n,e,t,r){if(n[ko])return;let i;t.type&8?i=fi(r):i=$4(e,t),n[ko]=i}function z4(n){return typeof n=="function"&&n[N_]!==void 0}function yM(n){return z4(n)&&typeof n.set=="function"}function G4(n){return Object.getPrototypeOf(n.prototype).constructor}function Bs(n){let e=G4(n.type),t=!0,r=[n];for(;e;){let i;if(Fs(n))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new he(903,!1);i=e.\u0275dir}if(i){if(t){r.push(i);let o=n;o.inputs=df(n.inputs),o.inputTransforms=df(n.inputTransforms),o.declaredInputs=df(n.declaredInputs),o.outputs=df(n.outputs);let a=i.hostBindings;a&&X4(n,a);let c=i.viewQuery,l=i.contentQueries;if(c&&Y4(n,c),l&&Q4(n,l),W4(n,i),lB(n.outputs,i.outputs),Fs(i)&&i.data.animation){let u=n.data;u.animation=(u.animation||[]).concat(i.data.animation)}}let s=i.features;if(s)for(let o=0;o<s.length;o++){let a=s[o];a&&a.ngInherit&&a(n),a===Bs&&(t=!1)}}e=Object.getPrototypeOf(e)}K4(r)}function W4(n,e){for(let t in e.inputs){if(!e.inputs.hasOwnProperty(t)||n.inputs.hasOwnProperty(t))continue;let r=e.inputs[t];if(r!==void 0&&(n.inputs[t]=r,n.declaredInputs[t]=e.declaredInputs[t],e.inputTransforms!==null)){let i=Array.isArray(r)?r[0]:r;if(!e.inputTransforms.hasOwnProperty(i))continue;n.inputTransforms??={},n.inputTransforms[i]=e.inputTransforms[i]}}}function K4(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){let i=n[r];i.hostVars=e+=i.hostVars,i.hostAttrs=Ql(i.hostAttrs,t=Ql(t,i.hostAttrs))}}function df(n){return n===dc?{}:n===Gn?[]:n}function Y4(n,e){let t=n.viewQuery;t?n.viewQuery=(r,i)=>{e(r,i),t(r,i)}:n.viewQuery=e}function Q4(n,e){let t=n.contentQueries;t?n.contentQueries=(r,i,s)=>{e(r,i,s),t(r,i,s)}:n.contentQueries=e}function X4(n,e){let t=n.hostBindings;t?n.hostBindings=(r,i)=>{e(r,i),t(r,i)}:n.hostBindings=e}var Vs=class{},iu=class{};var Yv=class extends Vs{constructor(e,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Nf(this);let i=$R(e);this._bootstrapComponents=FP(i.bootstrap),this._r3Injector=SP(e,t,[{provide:Vs,useValue:this},{provide:Xf,useValue:this.componentFactoryResolver},...r],On(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},Qv=class extends iu{constructor(e){super(),this.moduleType=e}create(e){return new Yv(this.moduleType,e,[])}};var Of=class extends Vs{constructor(e){super(),this.componentFactoryResolver=new Nf(this),this.instance=null;let t=new Xl([...e.providers,{provide:Vs,useValue:this},{provide:Xf,useValue:this.componentFactoryResolver}],e.parent||pw(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function jw(n,e,t=null){return new Of({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}var Zf=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Bt(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function _M(n){return J4(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function Z4(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{let t=n[Symbol.iterator](),r;for(;!(r=t.next()).done;)e(r.value)}}function J4(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function ez(n,e,t){return n[e]=t}function Ec(n,e,t){let r=n[e];return Object.is(r,t)?!1:(n[e]=t,!0)}function tz(n){return(n.flags&32)===32}function nz(n,e,t,r,i,s,o,a,c){let l=e.consts,u=Kf(e,n,4,o||null,Tf(l,a));tM(e,t,u,Tf(l,c)),Aw(e,u);let d=u.tView=Ow(2,u,r,i,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,l,null);return e.queries!==null&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}function _t(n,e,t,r,i,s,o,a){let c=pt(),l=Kn(),u=n+Br,d=l.firstCreatePass?nz(u,l,c,e,t,r,i,s,o):l.data[u];cu(d,!1);let f=rz(l,c,d,n);Ew()&&Mw(l,c,f,d),Vo(f,c);let p=iM(f,c,f,d);return c[u]=p,Yf(c,p),H4(p,d,c),gw(d)&&XP(l,c,d),o!=null&&ZP(c,d,a),_t}var rz=iz;function iz(n,e,t,r){return Iw(!0),e[zt].createComment("")}function sz(n,e,t,r){return Ec(n,vw(),t)?e+CR(t)+r:es}function hf(n,e){return n<<17|e<<2}function $o(n){return n>>17&32767}function oz(n){return(n&2)==2}function az(n,e){return n&131071|e<<17}function Xv(n){return n|2}function yc(n){return(n&131068)>>2}function pv(n,e){return n&-131069|e<<2}function cz(n){return(n&1)===1}function Zv(n){return n|1}function lz(n,e,t,r,i,s){let o=s?e.classBindings:e.styleBindings,a=$o(o),c=yc(o);n[r]=t;let l=!1,u;if(Array.isArray(t)){let d=t;u=d[1],(u===null||au(d,u)>0)&&(l=!0)}else u=t;if(i)if(c!==0){let f=$o(n[a+1]);n[r+1]=hf(f,a),f!==0&&(n[f+1]=pv(n[f+1],r)),n[a+1]=az(n[a+1],r)}else n[r+1]=hf(a,0),a!==0&&(n[a+1]=pv(n[a+1],r)),a=r;else n[r+1]=hf(c,0),a===0?a=r:n[c+1]=pv(n[c+1],r),c=r;l&&(n[r+1]=Xv(n[r+1])),pR(n,u,r,!0),pR(n,u,r,!1),uz(e,u,n,r,s),o=hf(a,c),s?e.classBindings=o:e.styleBindings=o}function uz(n,e,t,r,i){let s=i?n.residualClasses:n.residualStyles;s!=null&&typeof e=="string"&&au(s,e)>=0&&(t[r+1]=Zv(t[r+1]))}function pR(n,e,t,r){let i=n[t+1],s=e===null,o=r?$o(i):yc(i),a=!1;for(;o!==0&&(a===!1||s);){let c=n[o],l=n[o+1];dz(c,e)&&(a=!0,n[o+1]=r?Zv(l):Xv(l)),o=r?$o(l):yc(l)}a&&(n[t+1]=r?Xv(i):Zv(i))}function dz(n,e){return n===null||e==null||(Array.isArray(n)?n[1]:n)===e?!0:Array.isArray(n)&&typeof e=="string"?au(n,e)>=0:!1}var jr={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function hz(n){return n.substring(jr.key,jr.keyEnd)}function fz(n){return pz(n),vM(n,wM(n,0,jr.textEnd))}function vM(n,e){let t=jr.textEnd;return t===e?-1:(e=jr.keyEnd=mz(n,jr.key=e,t),wM(n,e,t))}function pz(n){jr.key=0,jr.keyEnd=0,jr.value=0,jr.valueEnd=0,jr.textEnd=n.length}function wM(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function mz(n,e,t){for(;e<t&&n.charCodeAt(e)>32;)e++;return e}function je(n,e,t){let r=pt(),i=vw();if(Ec(r,i,e)){let s=Kn(),o=mP();eM(s,o,r,n,e,r[zt],t,!1)}return je}function Jv(n,e,t,r,i){let s=e.inputs,o=i?"class":"style";kw(n,t,s[o],o,r)}function pi(n,e){return yz(n,e,null,!0),pi}function bM(n){_z(Az,gz,n,!0)}function gz(n,e){for(let t=fz(e);t>=0;t=vM(e,t))dw(n,hz(e),!0)}function yz(n,e,t,r){let i=pt(),s=Kn(),o=cP(2);if(s.firstUpdatePass&&IM(s,n,o,r),e!==es&&Ec(i,o,e)){let a=s.data[zo()];AM(s,a,i,i[zt],n,i[o+1]=Cz(e,t),r,o)}}function _z(n,e,t,r){let i=Kn(),s=cP(2);i.firstUpdatePass&&IM(i,null,s,r);let o=pt();if(t!==es&&Ec(o,s,t)){let a=i.data[zo()];if(TM(a,r)&&!EM(i,s)){let c=r?a.classesWithoutHost:a.stylesWithoutHost;c!==null&&(t=vv(c,t||"")),Jv(i,a,o,t,r)}else Tz(i,a,o,o[zt],o[s+1],o[s+1]=Iz(n,e,t),r,s)}}function EM(n,e){return e>=n.expandoStartIndex}function IM(n,e,t,r){let i=n.data;if(i[t+1]===null){let s=i[zo()],o=EM(n,t);TM(s,r)&&e===null&&!o&&(e=!1),e=vz(i,s,e,r),lz(i,s,e,t,o,r)}}function vz(n,e,t,r){let i=PH(n),s=r?e.residualClasses:e.residualStyles;if(i===null)(r?e.classBindings:e.styleBindings)===0&&(t=mv(null,n,e,t,r),t=su(t,e.attrs,r),s=null);else{let o=e.directiveStylingLast;if(o===-1||n[o]!==i)if(t=mv(i,n,e,t,r),s===null){let c=wz(n,e,r);c!==void 0&&Array.isArray(c)&&(c=mv(null,n,e,c[1],r),c=su(c,e.attrs,r),bz(n,e,r,c))}else s=Ez(n,e,r)}return s!==void 0&&(r?e.residualClasses=s:e.residualStyles=s),t}function wz(n,e,t){let r=t?e.classBindings:e.styleBindings;if(yc(r)!==0)return n[$o(r)]}function bz(n,e,t,r){let i=t?e.classBindings:e.styleBindings;n[$o(i)]=r}function Ez(n,e,t){let r,i=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<i;s++){let o=n[s].hostAttrs;r=su(r,o,t)}return su(r,e.attrs,t)}function mv(n,e,t,r,i){let s=null,o=t.directiveEnd,a=t.directiveStylingLast;for(a===-1?a=t.directiveStart:a++;a<o&&(s=e[a],r=su(r,s.hostAttrs,i),s!==n);)a++;return n!==null&&(t.directiveStylingLast=a),r}function su(n,e,t){let r=t?1:2,i=-1;if(e!==null)for(let s=0;s<e.length;s++){let o=e[s];typeof o=="number"?i=o:i===r&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),dw(n,o,t?!0:e[++s]))}return n===void 0?null:n}function Iz(n,e,t){if(t==null||t==="")return Gn;let r=[],i=zf(t);if(Array.isArray(i))for(let s=0;s<i.length;s++)n(r,i[s],!0);else if(typeof i=="object")for(let s in i)i.hasOwnProperty(s)&&n(r,s,i[s]);else typeof i=="string"&&e(r,i);return r}function Az(n,e,t){let r=String(e);r!==""&&!r.includes(" ")&&dw(n,r,t)}function Tz(n,e,t,r,i,s,o,a){i===es&&(i=Gn);let c=0,l=0,u=0<i.length?i[0]:null,d=0<s.length?s[0]:null;for(;u!==null||d!==null;){let f=c<i.length?i[c+1]:void 0,p=l<s.length?s[l+1]:void 0,y=null,w;u===d?(c+=2,l+=2,f!==p&&(y=d,w=p)):d===null||u!==null&&u<d?(c+=2,y=u):(l+=2,y=d,w=p),y!==null&&AM(n,e,t,r,y,w,o,a),u=c<i.length?i[c]:null,d=l<s.length?s[l]:null}}function AM(n,e,t,r,i,s,o,a){if(!(e.type&3))return;let c=n.data,l=c[a+1],u=cz(l)?mR(c,e,t,i,yc(l),o):void 0;if(!kf(u)){kf(s)||oz(l)&&(s=mR(c,null,t,i,a,o));let d=eP(zo(),t);Dq(r,o,d,i,s)}}function mR(n,e,t,r,i,s){let o=e===null,a;for(;i>0;){let c=n[i],l=Array.isArray(c),u=l?c[1]:c,d=u===null,f=t[i+1];f===es&&(f=d?Gn:void 0);let p=d?iv(f,r):u===r?f:void 0;if(l&&!kf(p)&&(p=iv(c,r)),kf(p)&&(a=p,o))return a;let y=n[i+1];i=o?$o(y):yc(y)}if(e!==null){let c=s?e.residualClasses:e.residualStyles;c!=null&&(a=iv(c,r))}return a}function kf(n){return n!==void 0}function Cz(n,e){return n==null||n===""||(typeof e=="string"?n=n+e:typeof n=="object"&&(n=On(zf(n)))),n}function TM(n,e){return(n.flags&(e?8:16))!==0}function Sz(n,e,t,r,i,s){let o=e.consts,a=Tf(o,i),c=Kf(e,n,2,r,a);return tM(e,t,c,Tf(o,s)),c.attrs!==null&&Gv(c,c.attrs,!1),c.mergedAttrs!==null&&Gv(c,c.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,c),c}function Z(n,e,t,r){let i=pt(),s=Kn(),o=Br+n,a=i[zt],c=s.firstCreatePass?Sz(o,s,i,e,t,r):s.data[o],l=Dz(s,i,c,a,e,n);i[o]=l;let u=gw(c);return cu(c,!0),zP(a,l,c),!tz(c)&&Ew()&&Mw(s,i,l,c),yH()===0&&Vo(l,i),_H(),u&&(XP(s,i,c),QP(s,c,i)),r!==null&&ZP(i,c),Z}function W(){let n=rr();aP()?AH():(n=n.parent,cu(n,!1));let e=n;bH(e)&&EH(),vH();let t=Kn();return t.firstCreatePass&&(Aw(t,n),YR(n)&&t.queries.elementEnd(n)),e.classesWithoutHost!=null&&VH(e)&&Jv(t,e,pt(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&jH(e)&&Jv(t,e,pt(),e.stylesWithoutHost,!1),W}function Hs(n,e,t,r){return Z(n,e,t,r),W(),Hs}var Dz=(n,e,t,r,i,s)=>(Iw(!0),VP(r,i,OH()));function ir(){return pt()}var Lf="en-US";var xz=Lf;function Rz(n){typeof n=="string"&&(xz=n.toLowerCase().replace(/_/g,"-"))}function Tt(n,e,t,r){let i=pt(),s=Kn(),o=rr();return CM(s,i,i[zt],o,n,e,r),Tt}function Pz(n,e,t,r){let i=n.cleanup;if(i!=null)for(let s=0;s<i.length-1;s+=2){let o=i[s];if(o===t&&i[s+1]===r){let a=e[Zl],c=i[s+2];return a.length>c?a[c]:null}typeof o=="string"&&(s+=2)}return null}function CM(n,e,t,r,i,s,o){let a=gw(r),l=n.firstCreatePass&&Jq(n),u=e[Ur],d=Zq(e),f=!0;if(r.type&3||o){let w=qr(r,e),b=o?o(w):w,E=d.length,D=o?N=>o(fi(N[r.index])):r.index,x=null;if(!o&&a&&(x=Pz(n,e,i,r.index)),x!==null){let N=x.__ngLastListenerFn__||x;N.__ngNextListenerFn__=s,x.__ngLastListenerFn__=s,f=!1}else{s=yR(r,e,u,s,!1);let N=t.listen(b,i,s);d.push(s,N),l&&l.push(i,D,E,E+1)}}else s=yR(r,e,u,s,!1);let p=r.outputs,y;if(f&&p!==null&&(y=p[i])){let w=y.length;if(w)for(let b=0;b<w;b+=2){let E=y[b],D=y[b+1],L=e[E][D].subscribe(s),F=d.length;d.push(s,L),l&&l.push(i,r.index,F,-(F+1))}}}function gR(n,e,t,r){let i=Ze(null);try{return ci(6,e,t),t(r)!==!1}catch(s){return oM(n,s),!1}finally{ci(7,e,t),Ze(i)}}function yR(n,e,t,r,i){return function s(o){if(o===Function)return r;let a=n.componentOffset>-1?js(n.index,e):e;Fw(a);let c=gR(e,t,r,o),l=s.__ngNextListenerFn__;for(;l;)c=gR(e,t,l,o)&&c,l=l.__ngNextListenerFn__;return i&&c===!1&&o.preventDefault(),c}}function nt(n=1){return NH(n)}function Mz(n,e,t,r){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=r}function lu(n){let e=TH();return nP(e,Br+n)}function _e(n,e=""){let t=pt(),r=Kn(),i=n+Br,s=r.firstCreatePass?Kf(r,i,1,e,null):r.data[i],o=Nz(r,t,s,e,n);t[i]=o,Ew()&&Mw(r,t,o,s),cu(s,!1)}var Nz=(n,e,t,r,i)=>(Iw(!0),lq(e[zt],r));function mi(n){return yr("",n,""),mi}function yr(n,e,t){let r=pt(),i=sz(r,n,e,t);return i!==es&&e4(r,zo(),i),yr}function Jf(n,e,t){yM(e)&&(e=e());let r=pt(),i=vw();if(Ec(r,i,e)){let s=Kn(),o=mP();eM(s,o,r,n,e,r[zt],t,!1)}return Jf}function $w(n,e){let t=yM(n);return t&&n.set(e),t}function ep(n,e){let t=pt(),r=Kn(),i=rr();return CM(r,t,t[zt],i,n,e),ep}function Oz(n,e,t){let r=Kn();if(r.firstCreatePass){let i=Fs(n);ew(t,r.data,r.blueprint,i,!0),ew(e,r.data,r.blueprint,i,!1)}}function ew(n,e,t,r,i){if(n=Mn(n),Array.isArray(n))for(let s=0;s<n.length;s++)ew(n[s],e,t,r,i);else{let s=Kn(),o=pt(),a=rr(),c=fc(n)?n:Mn(n.provide),l=GR(n),u=a.providerIndexes&1048575,d=a.directiveStart,f=a.providerIndexes>>20;if(fc(n)||!n.multi){let p=new Fo(l,i,ke),y=yv(c,e,i?u:u+f,d);y===-1?(Pv(xf(a,o),s,c),gv(s,n,e.length),e.push(c),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),t.push(p),o.push(p)):(t[y]=p,o[y]=p)}else{let p=yv(c,e,u+f,d),y=yv(c,e,u,u+f),w=p>=0&&t[p],b=y>=0&&t[y];if(i&&!b||!i&&!w){Pv(xf(a,o),s,c);let E=Fz(i?Lz:kz,t.length,i,r,l);!i&&b&&(t[y].providerFactory=E),gv(s,n,e.length,0),e.push(c),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),t.push(E),o.push(E)}else{let E=SM(t[i?y:p],l,!i&&r);gv(s,n,p>-1?p:y,E)}!i&&r&&b&&t[y].componentProviders++}}}function gv(n,e,t,r){let i=fc(e),s=QB(e);if(i||s){let c=(s?Mn(e.useClass):e).prototype.ngOnDestroy;if(c){let l=n.destroyHooks||(n.destroyHooks=[]);if(!i&&e.multi){let u=l.indexOf(t);u===-1?l.push(t,[r,c]):l[u+1].push(r,c)}else l.push(t,c)}}}function SM(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function yv(n,e,t,r){for(let i=t;i<r;i++)if(e[i]===n)return i;return-1}function kz(n,e,t,r){return tw(this.multi,[])}function Lz(n,e,t,r){let i=this.multi,s;if(this.providerFactory){let o=this.providerFactory.componentProviders,a=gc(t,t[qe],this.providerFactory.index,r);s=a.slice(0,o),tw(i,s);for(let c=o;c<a.length;c++)s.push(a[c])}else s=[],tw(i,s);return s}function tw(n,e){for(let t=0;t<n.length;t++){let r=n[t];e.push(r())}return e}function Fz(n,e,t,r,i){let s=new Fo(n,t,ke);return s.multi=[],s.index=e,s.componentProviders=0,SM(s,i,r&&!t),s}function uu(n,e=[]){return t=>{t.providersResolver=(r,i)=>Oz(r,i?i(n):n,e)}}var Vz=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let r=HR(!1,t.type),i=r.length>0?jw([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,i)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=ce({token:n,providedIn:"environment",factory:()=>new n(pe(gr))})}}return n})();function Ic(n){pM("NgStandalone"),n.getStandaloneInjector=e=>e.get(Vz).getOrCreateStandaloneInjector(n)}function jz(n,e){let t=n[e];return t===es?void 0:t}function $z(n,e,t,r,i,s){let o=e+t;return Ec(n,o,i)?ez(n,o+1,s?r.call(s,i):r(i)):jz(n,o+1)}function Uw(n,e){let t=Kn(),r,i=n+Br;t.firstCreatePass?(r=Uz(e,t.pipeRegistry),t.data[i]=r,r.onDestroy&&(t.destroyHooks??=[]).push(i,r.onDestroy)):r=t.data[i];let s=r.factory||(r.factory=Mo(r.type,!0)),o,a=zn(ke);try{let c=Df(!1),l=s();return Df(c),Mz(t,pt(),i,l),l}finally{zn(a)}}function Uz(n,e){if(e)for(let t=e.length-1;t>=0;t--){let r=e[t];if(n===r.name)return r}}function Bw(n,e,t){let r=n+Br,i=pt(),s=nP(i,r);return Bz(i,r)?$z(i,CH(),e,s.transform,t,s):s.transform(t)}function Bz(n,e){return n[qe].data[e].pure}function Hw(n,e){return fM(n,e)}var Qi=class{constructor(e){this.full=e;let t=e.split(".");this.major=t[0],this.minor=t[1],this.patch=t.slice(2).join(".")}},DM=new Qi("17.3.12"),tp=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"platform"})}}return n})();var xM=new de("");function qs(n){return!!n&&typeof n.then=="function"}function qw(n){return!!n&&typeof n.subscribe=="function"}var RM=new de(""),PM=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r}),this.appInits=ne(RM,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let t=[];for(let i of this.appInits){let s=i();if(qs(s))t.push(s);else if(qw(s)){let o=new Promise((a,c)=>{s.subscribe({complete:a,error:c})});t.push(o)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(i=>{this.reject(i)}),t.length===0&&r(),this.initialized=!0}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),zw=new de("");function Hz(){mx(()=>{throw new he(600,!1)})}function qz(n){return n.isBoundToModule}function zz(n,e,t){try{let r=t();return qs(r)?r.catch(i=>{throw e.runOutsideAngular(()=>n.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}var du=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=ne(DP),this.afterRenderEffectManager=ne(mM),this.externalTestViews=new Set,this.beforeRender=new Pn,this.afterTick=new Pn,this.componentTypes=[],this.components=[],this.isStable=ne(Zf).hasPendingTasks.pipe(He(t=>!t)),this._injector=ne(gr)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,r){let i=t instanceof Mf;if(!this._injector.get(PM).done){let f=!i&&jR(t),p=!1;throw new he(405,p)}let o;i?o=t:o=this._injector.get(Xf).resolveComponentFactory(t),this.componentTypes.push(o.componentType);let a=qz(o)?void 0:this._injector.get(Vs),c=r||o.selector,l=o.create(yn.NULL,[],c,a),u=l.location.nativeElement,d=l.injector.get(xM,null);return d?.registerApplication(u),l.onDestroy(()=>{this.detachView(l.hostView),_v(this.components,l),d?.unregisterApplication(u)}),this._loadComponent(l),l}tick(){this._tick(!0)}_tick(t){if(this._runningTick)throw new he(101,!1);let r=Ze(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(t)}catch(i){this.internalErrorHandler(i)}finally{this.afterTick.next(),this._runningTick=!1,Ze(r)}}detectChangesInAttachedViews(t){let r=0,i=this.afterRenderEffectManager;for(;;){if(r===cM)throw new he(103,!1);if(t){let s=r===0;this.beforeRender.next(s);for(let{_lView:o,notifyErrorHandler:a}of this._views)Gz(o,s,a)}if(r++,i.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:s})=>nw(s))&&(i.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:s})=>nw(s))))break}}attachView(t){let r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){let r=t;_v(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);let r=this._injector.get(zw,[]);[...this._bootstrapListeners,...r].forEach(i=>i(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>_v(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new he(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function _v(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Gz(n,e,t){!e&&!nw(n)||Wz(n,t,e)}function nw(n){return _w(n)}function Wz(n,e,t){let r;t?(r=0,n[ge]|=1024):n[ge]&64?r=0:r=1,lM(n,e,r)}var rw=class{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},Gw=(()=>{class n{compileModuleSync(t){return new Qv(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let r=this.compileModuleSync(t),i=$R(t),s=FP(i.declarations).reduce((o,a)=>{let c=No(a);return c&&o.push(new ru(c)),o},[]);return new rw(r,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Kz=(()=>{class n{constructor(){this.zone=ne(et),this.applicationRef=ne(du)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Yz(n){return[{provide:et,useFactory:n},{provide:hc,multi:!0,useFactory:()=>{let e=ne(Kz,{optional:!0});return()=>e.initialize()}},{provide:hc,multi:!0,useFactory:()=>{let e=ne(Jz);return()=>{e.initialize()}}},{provide:DP,useFactory:Qz}]}function Qz(){let n=ne(et),e=ne(Ki);return t=>n.runOutsideAngular(()=>e.handleError(t))}function Xz(n){let e=Yz(()=>new et(Zz(n)));return Wn([[],e])}function Zz(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var Jz=(()=>{class n{constructor(){this.subscription=new xt,this.initialized=!1,this.zone=ne(et),this.pendingTasks=ne(Zf)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{et.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{et.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function eG(){return typeof $localize<"u"&&$localize.locale||Lf}var Ww=new de("",{providedIn:"root",factory:()=>ne(Ww,Ne.Optional|Ne.SkipSelf)||eG()});var MM=new de("");var yf=null;function tG(n=[],e){return yn.create({name:e,providers:[{provide:$f,useValue:"platform"},{provide:MM,useValue:new Set([()=>yf=null])},...n]})}function nG(n=[]){if(yf)return yf;let e=tG(n);return yf=e,Hz(),rG(e),e}function rG(n){n.get(Sw,null)?.forEach(t=>t())}var zs=(()=>{class n{static{this.__NG_ELEMENT_ID__=iG}}return n})();function iG(n){return sG(rr(),pt(),(n&16)===16)}function sG(n,e,t){if(Hf(n)&&!t){let r=js(n.index,e);return new jo(r,r)}else if(n.type&47){let r=e[hi];return new jo(r,e)}return null}var iw=class{constructor(){}supports(e){return _M(e)}create(e){return new sw(e)}},oG=(n,e)=>e,sw=class{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||oG}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,i=0,s=null;for(;t||r;){let o=!r||t&&t.currentIndex<_R(r,i,s)?t:r,a=_R(o,i,s),c=o.currentIndex;if(o===r)i--,r=r._nextRemoved;else if(t=t._next,o.previousIndex==null)i++;else{s||(s=[]);let l=a-i,u=c-i;if(l!=u){for(let f=0;f<l;f++){let p=f<s.length?s[f]:s[f]=0,y=p+f;u<=y&&y<l&&(s[f]=p+1)}let d=o.previousIndex;s[d]=u-l}}a!==c&&e(o,a,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!_M(e))throw new he(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,r=!1,i,s,o;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),t===null||!Object.is(t.trackById,o)?(t=this._mismatch(t,s,o,a),r=!0):(r&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)),t=t._next}else i=0,Z4(e,a=>{o=this._trackByFn(i,a),t===null||!Object.is(t.trackById,o)?(t=this._mismatch(t,a,o,i),r=!0):(r&&(t=this._verifyReinsertion(t,a,o,i)),Object.is(t.item,a)||this._addIdentityChange(t,a)),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,i){let s;return e===null?s=this._itTail:(s=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,i)):(e=this._linkedRecords===null?null:this._linkedRecords.get(r,i),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,i)):e=this._addAfter(new ow(t,r),s,i)),e}_verifyReinsertion(e,t,r,i){let s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return s!==null?e=this._reinsertAfter(s,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let i=e._prevRemoved,s=e._nextRemoved;return i===null?this._removalsHead=s:i._nextRemoved=s,s===null?this._removalsTail=i:s._prevRemoved=i,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){let i=t===null?this._itHead:t._next;return e._next=i,e._prev=t,i===null?this._itTail=e:i._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new Ff),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,r=e._next;return t===null?this._itHead=r:t._next=r,r===null?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new Ff),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},ow=class{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},aw=class{constructor(){this._head=null,this._tail=null}add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;r!==null;r=r._nextDup)if((t===null||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){let t=e._prevDup,r=e._nextDup;return t===null?this._head=r:t._nextDup=r,r===null?this._tail=t:r._prevDup=t,this._head===null}},Ff=class{constructor(){this.map=new Map}put(e){let t=e.trackById,r=this.map.get(t);r||(r=new aw,this.map.set(t,r)),r.add(e)}get(e,t){let r=e,i=this.map.get(r);return i?i.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function _R(n,e,t){let r=n.previousIndex;if(r===null)return r;let i=0;return t&&r<t.length&&(i=t[r]),r+e+i}function vR(){return new Kw([new iw])}var Kw=(()=>{class n{static{this.\u0275prov=ce({token:n,providedIn:"root",factory:vR})}constructor(t){this.factories=t}static create(t,r){if(r!=null){let i=r.factories.slice();t=t.concat(i)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||vR()),deps:[[n,new RR,new gt]]}}find(t){let r=this.factories.find(i=>i.supports(t));if(r!=null)return r;throw new he(901,!1)}}return n})();function NM(n){try{let{rootComponent:e,appProviders:t,platformProviders:r}=n,i=nG(r),s=[Xz(),...t||[]],a=new Of({providers:s,parent:i,debugName:"",runEnvironmentInitializers:!1}).injector,c=a.get(et);return c.run(()=>{a.resolveInjectorInitializers();let l=a.get(Ki,null),u;c.runOutsideAngular(()=>{u=c.onError.subscribe({next:p=>{l.handleError(p)}})});let d=()=>a.destroy(),f=i.get(MM);return f.add(d),a.onDestroy(()=>{u.unsubscribe(),f.delete(d)}),zz(l,c,()=>{let p=a.get(PM);return p.runInitializers(),p.donePromise.then(()=>{let y=a.get(Ww,Lf);Rz(y||Lf);let w=a.get(du);return e!==void 0&&w.bootstrap(e),w})})})}catch(e){return Promise.reject(e)}}function np(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function Yw(n){let e=Ze(null);try{return n()}finally{Ze(e)}}var VM=null;function ts(){return VM}function jM(n){VM??=n}var rp=class{};var _r=new de(""),$M=(()=>{class n{historyGo(t){throw new Error("")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>ne(lG),providedIn:"platform"})}}return n})();var lG=(()=>{class n extends $M{constructor(){super(),this._doc=ne(_r),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ts().getBaseHref(this._doc)}onPopState(t){let r=ts().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){let r=ts().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,i){this._history.pushState(t,r,i)}replaceState(t,r,i){this._history.replaceState(t,r,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>new n,providedIn:"platform"})}}return n})();function UM(n,e){if(n.length==0)return e;if(e.length==0)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,t==2?n+e.substring(1):t==1?n+e:n+"/"+e}function OM(n){let e=n.match(/#|\?|$/),t=e&&e.index||n.length,r=t-(n[t-1]==="/"?1:0);return n.slice(0,r)+n.slice(t)}function Wo(n){return n&&n[0]!=="?"?"?"+n:n}var sp=(()=>{class n{historyGo(t){throw new Error("")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>ne(BM),providedIn:"root"})}}return n})(),uG=new de(""),BM=(()=>{class n extends sp{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??ne(_r).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return UM(this._baseHref,t)}path(t=!1){let r=this._platformLocation.pathname+Wo(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${r}${i}`:r}pushState(t,r,i,s){let o=this.prepareExternalUrl(i+Wo(s));this._platformLocation.pushState(t,r,o)}replaceState(t,r,i,s){let o=this.prepareExternalUrl(i+Wo(s));this._platformLocation.replaceState(t,r,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(r){return new(r||n)(pe($M),pe(uG,8))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var hu=(()=>{class n{constructor(t){this._subject=new Nn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;let r=this._locationStrategy.getBaseHref();this._basePath=fG(OM(kM(r))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Wo(r))}normalize(t){return n.stripTrailingSlash(hG(this._basePath,kM(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",i=null){this._locationStrategy.pushState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Wo(r)),i)}replaceState(t,r="",i=null){this._locationStrategy.replaceState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Wo(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(i=>i(t,r))}subscribe(t,r,i){return this._subject.subscribe({next:t,error:r,complete:i})}static{this.normalizeQueryParams=Wo}static{this.joinWithSlash=UM}static{this.stripTrailingSlash=OM}static{this.\u0275fac=function(r){return new(r||n)(pe(sp))}}static{this.\u0275prov=ce({token:n,factory:()=>dG(),providedIn:"root"})}}return n})();function dG(){return new hu(pe(sp))}function hG(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function kM(n){return n.replace(/\/index.html$/,"")}function fG(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}function HM(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let r=t.indexOf("="),[i,s]=r==-1?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}var Qw=class{constructor(e,t,r,i){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=i}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},qM=(()=>{class n{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,r,i){this._viewContainer=t,this._template=r,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;if(!this._differ&&t)if(0)try{}catch{}else this._differ=this._differs.find(t).create(this.ngForTrackBy)}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let r=this._viewContainer;t.forEachOperation((i,s,o)=>{if(i.previousIndex==null)r.createEmbeddedView(this._template,new Qw(i.item,this._ngForOf,-1,-1),o===null?void 0:o);else if(o==null)r.remove(s===null?void 0:s);else if(s!==null){let a=r.get(s);r.move(a,o),LM(a,i)}});for(let i=0,s=r.length;i<s;i++){let a=r.get(i).context;a.index=i,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{let s=r.get(i.currentIndex);LM(s,i)})}static ngTemplateContextGuard(t,r){return!0}static{this.\u0275fac=function(r){return new(r||n)(ke(bc),ke(Qf),ke(Kw))}}static{this.\u0275dir=kn({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return n})();function LM(n,e){n.context.$implicit=e.item}var op=(()=>{class n{constructor(t,r){this._viewContainer=t,this._context=new Xw,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){FM("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){FM("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}static{this.\u0275fac=function(r){return new(r||n)(ke(bc),ke(Qf))}}static{this.\u0275dir=kn({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return n})(),Xw=class{constructor(){this.$implicit=null,this.ngIf=null}};function FM(n,e){if(!!!(!e||e.createEmbeddedView))throw new Error(`${n} must be a TemplateRef, but received '${On(e)}'.`)}function pG(n,e){return new he(2100,!1)}var Zw=class{createSubscription(e,t){return Yw(()=>e.subscribe({next:t,error:r=>{throw r}}))}dispose(e){Yw(()=>e.unsubscribe())}},Jw=class{createSubscription(e,t){return e.then(t,r=>{throw r})}dispose(e){}},mG=new Jw,gG=new Zw,zM=(()=>{class n{constructor(t){this._latestValue=null,this.markForCheckOnValueUpdate=!0,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){if(!this._obj){if(t)try{this.markForCheckOnValueUpdate=!1,this._subscribe(t)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,r=>this._updateLatestValue(t,r))}_selectStrategy(t){if(qs(t))return mG;if(qw(t))return gG;throw pG(n,t)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,r){t===this._obj&&(this._latestValue=r,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static{this.\u0275fac=function(r){return new(r||n)(ke(zs,16))}}static{this.\u0275pipe=LR({name:"async",type:n,pure:!1,standalone:!0})}}return n})();var fu=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Ho({type:n})}static{this.\u0275inj=Bo({})}}return n})(),GM="browser",yG="server";function eb(n){return n===yG}var ip=class{};var rb=class extends rp{constructor(){super(...arguments),this.supportsDOMEvents=!0}},ib=class n extends rb{static makeCurrent(){jM(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=_G();return t==null?null:vG(t)}resetBaseElement(){pu=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return HM(document.cookie,e)}},pu=null;function _G(){return pu=pu||document.querySelector("base"),pu?pu.getAttribute("href"):null}function vG(n){return new URL(n,document.baseURI).pathname}var wG=(()=>{class n{build(){return new XMLHttpRequest}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})(),sb=new de(""),XM=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(i=>{i.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,i){return this._findPluginFor(r).addEventListener(t,r,i)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(s=>s.supports(t)),!r)throw new he(5101,!1);return this._eventNameToPlugin.set(t,r),r}static{this.\u0275fac=function(r){return new(r||n)(pe(sb),pe(et))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})(),ap=class{constructor(e){this._doc=e}},tb="ng-app-id",ZM=(()=>{class n{constructor(t,r,i,s={}){this.doc=t,this.appId=r,this.nonce=i,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=eb(s),this.resetHostNodes()}addStyles(t){for(let r of t)this.changeUsageCount(r,1)===1&&this.onStyleAdded(r)}removeStyles(t){for(let r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){let t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(let r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(let r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(let r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){let r=this.styleRef;r.get(t)?.elements?.forEach(i=>i.remove()),r.delete(t)}collectServerRenderedStyles(){let t=this.doc.head?.querySelectorAll(`style[${tb}="${this.appId}"]`);if(t?.length){let r=new Map;return t.forEach(i=>{i.textContent!=null&&r.set(i.textContent,i)}),r}return null}changeUsageCount(t,r){let i=this.styleRef;if(i.has(t)){let s=i.get(t);return s.usage+=r,s.usage}return i.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){let i=this.styleNodesInDOM,s=i?.get(r);if(s?.parentNode===t)return i.delete(r),s.removeAttribute(tb),s;{let o=this.doc.createElement("style");return this.nonce&&o.setAttribute("nonce",this.nonce),o.textContent=r,this.platformIsServer&&o.setAttribute(tb,this.appId),t.appendChild(o),o}}addStyleToHost(t,r){let i=this.getStyleElement(t,r),s=this.styleRef,o=s.get(r)?.elements;o?o.push(i):s.set(r,{elements:[i],usage:1})}resetHostNodes(){let t=this.hostNodes;t.clear(),t.add(this.doc.head)}static{this.\u0275fac=function(r){return new(r||n)(pe(_r),pe(Cw),pe(Dw,8),pe($s))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})(),nb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},ab=/%COMP%/g,JM="%COMP%",bG=`_nghost-${JM}`,EG=`_ngcontent-${JM}`,IG=!0,AG=new de("",{providedIn:"root",factory:()=>IG});function TG(n){return EG.replace(ab,n)}function CG(n){return bG.replace(ab,n)}function eN(n,e){return e.map(t=>t.replace(ab,n))}var KM=(()=>{class n{constructor(t,r,i,s,o,a,c,l=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=eb(a),this.defaultRenderer=new mu(t,o,c,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===ui.ShadowDom&&(r=P(_({},r),{encapsulation:ui.Emulated}));let i=this.getOrCreateRenderer(t,r);return i instanceof cp?i.applyToHost(t):i instanceof gu&&i.applyStyles(),i}getOrCreateRenderer(t,r){let i=this.rendererByCompId,s=i.get(r.id);if(!s){let o=this.doc,a=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(r.encapsulation){case ui.Emulated:s=new cp(c,l,r,this.appId,u,o,a,d);break;case ui.ShadowDom:return new ob(c,l,t,r,o,a,this.nonce,d);default:s=new gu(c,l,r,u,o,a,d);break}i.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(r){return new(r||n)(pe(XM),pe(ZM),pe(Cw),pe(AG),pe(_r),pe($s),pe(et),pe(Dw))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})(),mu=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(nb[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(YM(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(YM(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new he(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=nb[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=nb[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(Yi.DashCase|Yi.Important)?e.style.setProperty(t,r,i&Yi.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Yi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=ts().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function YM(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var ob=class extends mu{constructor(e,t,r,i,s,o,a,c){super(e,s,o,c),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let l=eN(i.id,i.styles);for(let u of l){let d=document.createElement("style");a&&d.setAttribute("nonce",a),d.textContent=u,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},gu=class extends mu{constructor(e,t,r,i,s,o,a,c){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=c?eN(c,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},cp=class extends gu{constructor(e,t,r,i,s,o,a,c){let l=i+"-"+r.id;super(e,t,r,s,o,a,c,l),this.contentAttr=TG(l),this.hostAttr=CG(l)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},SG=(()=>{class n extends ap{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i){return t.addEventListener(r,i,!1),()=>this.removeEventListener(t,r,i)}removeEventListener(t,r,i){return t.removeEventListener(r,i)}static{this.\u0275fac=function(r){return new(r||n)(pe(_r))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})(),QM=["alt","control","meta","shift"],DG={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},xG={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},RG=(()=>{class n extends ap{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,r,i){let s=n.parseEventName(r),o=n.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ts().onAndCancel(t,s.domEventName,o))}static parseEventName(t){let r=t.toLowerCase().split("."),i=r.shift();if(r.length===0||!(i==="keydown"||i==="keyup"))return null;let s=n._normalizeKey(r.pop()),o="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),o="code."),QM.forEach(l=>{let u=r.indexOf(l);u>-1&&(r.splice(u,1),o+=l+".")}),o+=s,r.length!=0||s.length===0)return null;let c={};return c.domEventName=i,c.fullKey=o,c}static matchEventFullKeyCode(t,r){let i=DG[t.key]||t.key,s="";return r.indexOf("code.")>-1&&(i=t.code,s="code."),i==null||!i?!1:(i=i.toLowerCase(),i===" "?i="space":i==="."&&(i="dot"),QM.forEach(o=>{if(o!==i){let a=xG[o];a(t)&&(s+=o+".")}}),s+=i,s===r)}static eventCallback(t,r,i){return s=>{n.matchEventFullKeyCode(s,t)&&i.runGuarded(()=>r(s))}}static _normalizeKey(t){return t==="esc"?"escape":t}static{this.\u0275fac=function(r){return new(r||n)(pe(_r))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac})}}return n})();function tN(n,e){return NM(_({rootComponent:n},PG(e)))}function PG(n){return{appProviders:[...LG,...n?.providers??[]],platformProviders:kG}}function MG(){ib.makeCurrent()}function NG(){return new Ki}function OG(){return kP(document),document}var kG=[{provide:$s,useValue:GM},{provide:Sw,useValue:MG,multi:!0},{provide:_r,useFactory:OG,deps:[]}];var LG=[{provide:$f,useValue:"root"},{provide:Ki,useFactory:NG,deps:[]},{provide:sb,useClass:SG,multi:!0,deps:[_r,et,$s]},{provide:sb,useClass:RG,multi:!0,deps:[_r]},KM,ZM,XM,{provide:nu,useExisting:KM},{provide:ip,useClass:wG,deps:[]},[]];var nN=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static{this.\u0275fac=function(r){return new(r||n)(pe(_r))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Se="primary",Pu=Symbol("RouteTitle"),hb=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Dc(n){return new hb(n)}function jG(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function $G(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!gi(n[t],e[t]))return!1;return!0}function gi(n,e){let t=n?fb(n):void 0,r=e?fb(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!cN(n[i],e[i]))return!1;return!0}function fb(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function cN(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function lN(n){return n.length>0?n[n.length-1]:null}function Ks(n){return Q_(n)?n:qs(n)?Rt(Promise.resolve(n)):Ae(n)}var UG={exact:dN,subset:hN},uN={exact:BG,subset:HG,ignored:()=>!0};function rN(n,e,t){return UG[t.paths](n.root,e.root,t.matrixParams)&&uN[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function BG(n,e){return gi(n,e)}function dN(n,e,t){if(!Yo(n.segments,e.segments)||!dp(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!dN(n.children[r],e.children[r],t))return!1;return!0}function HG(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>cN(n[t],e[t]))}function hN(n,e,t){return fN(n,e,e.segments,t)}function fN(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!Yo(i,t)||e.hasChildren()||!dp(i,t,r))}else if(n.segments.length===t.length){if(!Yo(n.segments,t)||!dp(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!hN(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!Yo(n.segments,i)||!dp(n.segments,i,r)||!n.children[Se]?!1:fN(n.children[Se],e,s,r)}}function dp(n,e,t){return e.every((r,i)=>uN[t](n[i].parameters,r.parameters))}var Gs=class{constructor(e=new it([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Dc(this.queryParams),this._queryParamMap}toString(){return GG.serialize(this)}},it=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return hp(this)}},Ko=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=Dc(this.parameters),this._parameterMap}toString(){return mN(this)}};function qG(n,e){return Yo(n,e)&&n.every((t,r)=>gi(t.parameters,e[r].parameters))}function Yo(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function zG(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===Se&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==Se&&(t=t.concat(e(i,r)))}),t}var jb=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>new pp,providedIn:"root"})}}return n})(),pp=class{parse(e){let t=new mb(e);return new Gs(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${yu(e.root,!0)}`,r=YG(e.queryParams),i=typeof e.fragment=="string"?`#${WG(e.fragment)}`:"";return`${t}${r}${i}`}},GG=new pp;function hp(n){return n.segments.map(e=>mN(e)).join("/")}function yu(n,e){if(!n.hasChildren())return hp(n);if(e){let t=n.children[Se]?yu(n.children[Se],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==Se&&r.push(`${i}:${yu(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=zG(n,(r,i)=>i===Se?[yu(n.children[Se],!1)]:[`${i}:${yu(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[Se]!=null?`${hp(n)}/${t[0]}`:`${hp(n)}/(${t.join("//")})`}}function pN(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function lp(n){return pN(n).replace(/%3B/gi,";")}function WG(n){return encodeURI(n)}function pb(n){return pN(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function fp(n){return decodeURIComponent(n)}function iN(n){return fp(n.replace(/\+/g,"%20"))}function mN(n){return`${pb(n.path)}${KG(n.parameters)}`}function KG(n){return Object.entries(n).map(([e,t])=>`;${pb(e)}=${pb(t)}`).join("")}function YG(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${lp(t)}=${lp(i)}`).join("&"):`${lp(t)}=${lp(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var QG=/^[^\/()?;#]+/;function cb(n){let e=n.match(QG);return e?e[0]:""}var XG=/^[^\/()?;=#]+/;function ZG(n){let e=n.match(XG);return e?e[0]:""}var JG=/^[^=?&#]+/;function e3(n){let e=n.match(JG);return e?e[0]:""}var t3=/^[^&#]+/;function n3(n){let e=n.match(t3);return e?e[0]:""}var mb=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new it([],{}):new it([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[Se]=new it(e,t)),r}parseSegment(){let e=cb(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new he(4009,!1);return this.capture(e),new Ko(fp(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=ZG(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=cb(this.remaining);i&&(r=i,this.capture(r))}e[fp(t)]=fp(r)}parseQueryParam(e){let t=e3(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=n3(this.remaining);o&&(r=o,this.capture(r))}let i=iN(t),s=iN(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=cb(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new he(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=Se);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[Se]:new it([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new he(4011,!1)}};function gN(n){return n.segments.length>0?new it([],{[Se]:n}):n}function yN(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=yN(i);if(r===Se&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new it(n.segments,e);return r3(t)}function r3(n){if(n.numberOfChildren===1&&n.children[Se]){let e=n.children[Se];return new it(n.segments.concat(e.segments),e.children)}return n}function xc(n){return n instanceof Gs}function i3(n,e,t=null,r=null){let i=_N(n);return vN(i,e,t,r)}function _N(n){let e;function t(s){let o={};for(let c of s.children){let l=t(c);o[c.outlet]=l}let a=new it(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=gN(r);return e??i}function vN(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return lb(i,i,i,t,r);let s=s3(e);if(s.toRoot())return lb(i,i,new it([],{}),t,r);let o=o3(s,i,n),a=o.processChildren?wu(o.segmentGroup,o.index,s.commands):bN(o.segmentGroup,o.index,s.commands);return lb(i,o.segmentGroup,a,t,r)}function mp(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Iu(n){return typeof n=="object"&&n!=null&&n.outlets}function lb(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([c,l])=>{s[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`});let o;n===e?o=t:o=wN(n,e,t);let a=gN(yN(o));return new Gs(a,s,i)}function wN(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=wN(s,e,t)}),new it(n.segments,r)}var gp=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&mp(r[0]))throw new he(4003,!1);let i=r.find(Iu);if(i&&i!==lN(r))throw new he(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function s3(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new gp(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([c,l])=>{a[c]=typeof l=="string"?l.split("/"):l}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,c)=>{c==0&&a==="."||(c==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new gp(t,e,r)}var Cc=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function o3(n,e,t){if(n.isAbsolute)return new Cc(e,!0,0);if(!t)return new Cc(e,!1,NaN);if(t.parent===null)return new Cc(t,!0,0);let r=mp(n.commands[0])?0:1,i=t.segments.length-1+r;return a3(t,i,n.numberOfDoubleDots)}function a3(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new he(4005,!1);i=r.segments.length}return new Cc(r,!1,i-s)}function c3(n){return Iu(n[0])?n[0].outlets:{[Se]:n}}function bN(n,e,t){if(n??=new it([],{}),n.segments.length===0&&n.hasChildren())return wu(n,e,t);let r=l3(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new it(n.segments.slice(0,r.pathIndex),{});return s.children[Se]=new it(n.segments.slice(r.pathIndex),n.children),wu(s,0,i)}else return r.match&&i.length===0?new it(n.segments,{}):r.match&&!n.hasChildren()?gb(n,e,t):r.match?wu(n,0,i):gb(n,e,t)}function wu(n,e,t){if(t.length===0)return new it(n.segments,{});{let r=c3(t),i={};if(Object.keys(r).some(s=>s!==Se)&&n.children[Se]&&n.numberOfChildren===1&&n.children[Se].segments.length===0){let s=wu(n.children[Se],e,t);return new it(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=bN(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new it(n.segments,i)}}function l3(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(Iu(a))break;let c=`${a}`,l=r<t.length-1?t[r+1]:null;if(i>0&&c===void 0)break;if(c&&l&&typeof l=="object"&&l.outlets===void 0){if(!oN(c,l,o))return s;r+=2}else{if(!oN(c,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function gb(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Iu(s)){let c=u3(s.outlets);return new it(r,c)}if(i===0&&mp(t[0])){let c=n.segments[e];r.push(new Ko(c.path,sN(t[0]))),i++;continue}let o=Iu(s)?s.outlets[Se]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&mp(a)?(r.push(new Ko(o,sN(a))),i+=2):(r.push(new Ko(o,{})),i++)}return new it(r,{})}function u3(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=gb(new it([],{}),0,r))}),e}function sN(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function oN(n,e,t){return n==t.path&&gi(e,t.parameters)}var bu="imperative",sn=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(sn||{}),vr=class{constructor(e,t){this.id=e,this.url=t}},Au=class extends vr{constructor(e,t,r="imperative",i=null){super(e,t),this.type=sn.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Qo=class extends vr{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=sn.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},or=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(or||{}),yb=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(yb||{}),Ws=class extends vr{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=sn.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Xo=class extends vr{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=sn.NavigationSkipped}},Tu=class extends vr{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=sn.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},yp=class extends vr{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=sn.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},_b=class extends vr{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=sn.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},vb=class extends vr{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=sn.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},wb=class extends vr{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=sn.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},bb=class extends vr{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=sn.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Eb=class{constructor(e){this.route=e,this.type=sn.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Ib=class{constructor(e){this.route=e,this.type=sn.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Ab=class{constructor(e){this.snapshot=e,this.type=sn.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Tb=class{constructor(e){this.snapshot=e,this.type=sn.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Cb=class{constructor(e){this.snapshot=e,this.type=sn.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Sb=class{constructor(e){this.snapshot=e,this.type=sn.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Cu=class{},Su=class{constructor(e){this.url=e}};var Db=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Ip,this.attachRef=null}},Ip=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){let i=this.getOrCreateContext(t);i.outlet=r,this.contexts.set(t,i)}onChildOutletDestroyed(t){let r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new Db,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),_p=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=xb(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=xb(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Rb(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return Rb(e,this._root).map(t=>t.value)}};function xb(n,e){if(n===e.value)return e;for(let t of e.children){let r=xb(n,t);if(r)return r}return null}function Rb(n,e){if(n===e.value)return[e];for(let t of e.children){let r=Rb(n,t);if(r.length)return r.unshift(e),r}return[]}var sr=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Tc(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var vp=class extends _p{constructor(e,t){super(e),this.snapshot=t,Ub(this,e)}toString(){return this.snapshot.toString()}};function EN(n){let e=d3(n),t=new Bt([new Ko("",{})]),r=new Bt({}),i=new Bt({}),s=new Bt({}),o=new Bt(""),a=new Rc(t,r,s,o,i,Se,n,e.root);return a.snapshot=e.root,new vp(new sr(a,[]),e)}function d3(n){let e={},t={},r={},i="",s=new Du([],e,r,i,t,Se,n,null,{});return new wp("",new sr(s,[]))}var Rc=class{constructor(e,t,r,i,s,o,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(He(l=>l[Pu]))??Ae(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(He(e=>Dc(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(He(e=>Dc(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function $b(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:_(_({},e.params),n.params),data:_(_({},e.data),n.data),resolve:_(_(_(_({},n.data),e.data),i?.data),n._resolvedData)}:r={params:_({},n.params),data:_({},n.data),resolve:_(_({},n.data),n._resolvedData??{})},i&&AN(i)&&(r.resolve[Pu]=i.title),r}var Du=class{get title(){return this.data?.[Pu]}constructor(e,t,r,i,s,o,a,c,l){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Dc(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Dc(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},wp=class extends _p{constructor(e,t){super(t),this.url=e,Ub(this,t)}toString(){return IN(this._root)}};function Ub(n,e){e.value._routerState=n,e.children.forEach(t=>Ub(n,t))}function IN(n){let e=n.children.length>0?` { ${n.children.map(IN).join(", ")} } `:"";return`${n.value}${e}`}function ub(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,gi(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),gi(e.params,t.params)||n.paramsSubject.next(t.params),$G(e.url,t.url)||n.urlSubject.next(t.url),gi(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Pb(n,e){let t=gi(n.params,e.params)&&qG(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||Pb(n.parent,e.parent))}function AN(n){return typeof n.title=="string"||n.title===null}var Bb=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=Se,this.activateEvents=new Nn,this.deactivateEvents=new Nn,this.attachEvents=new Nn,this.detachEvents=new Nn,this.parentContexts=ne(Ip),this.location=ne(bc),this.changeDetector=ne(zs),this.environmentInjector=ne(gr),this.inputBinder=ne(Hb,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){let{firstChange:r,previousValue:i}=t.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new he(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new he(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new he(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new he(4013,!1);this._activatedRoute=t;let i=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,c=new Mb(t,a,i.injector);this.activated=i.createComponent(o,{index:i.length,injector:c,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=kn({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[wc]})}}return n})(),Mb=class n{__ngOutletInjector(e){return new n(this.route,this.childContexts,e)}constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Rc?this.route:e===Ip?this.childContexts:this.parent.get(e,t)}},Hb=new de("");function h3(n,e,t){let r=xu(n,e._root,t?t._root:void 0);return new vp(r,e)}function xu(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=f3(n,e,t);return new sr(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>xu(n,a)),o}}let r=p3(e.value),i=e.children.map(s=>xu(n,s));return new sr(r,i)}}function f3(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return xu(n,r,i);return xu(n,r)})}function p3(n){return new Rc(new Bt(n.url),new Bt(n.params),new Bt(n.queryParams),new Bt(n.fragment),new Bt(n.data),n.outlet,n.component,n)}var TN="ngNavigationCancelingError";function CN(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=xc(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=SN(!1,or.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function SN(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[TN]=!0,t.cancellationCode=e,t}function m3(n){return DN(n)&&xc(n.url)}function DN(n){return!!n&&n[TN]}var g3=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=_c({type:n,selectors:[["ng-component"]],standalone:!0,features:[Ic],decls:1,vars:0,template:function(r,i){r&1&&Hs(0,"router-outlet")},dependencies:[Bb],encapsulation:2})}}return n})();function y3(n,e){return n.providers&&!n._injector&&(n._injector=jw(n.providers,e,`Route: ${n.path}`)),n._injector??e}function qb(n){let e=n.children&&n.children.map(qb),t=e?P(_({},n),{children:e}):_({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Se&&(t.component=g3),t}function yi(n){return n.outlet||Se}function _3(n,e){let t=n.filter(r=>yi(r)===e);return t.push(...n.filter(r=>yi(r)!==e)),t}function Mu(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var v3=(n,e,t,r)=>He(i=>(new Nb(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),Nb=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),ub(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=Tc(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Tc(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Tc(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=Tc(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Sb(s.value.snapshot))}),e.children.length&&this.forwardEvent(new Tb(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(ub(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),ub(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=Mu(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},bp=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Sc=class{constructor(e,t){this.component=e,this.route=t}};function w3(n,e,t){let r=n._root,i=e?e._root:null;return _u(r,i,t,[r.value])}function b3(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function Mc(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!ER(n)?n:e.get(n):r}function _u(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Tc(e);return n.children.forEach(o=>{E3(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Eu(a,t.getContext(o),i)),i}function E3(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let c=I3(o,s,s.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new bp(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?_u(n,e,a?a.children:null,r,i):_u(n,e,t,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Sc(a.outlet.component,o))}else o&&Eu(e,a,i),i.canActivateChecks.push(new bp(r)),s.component?_u(n,null,a?a.children:null,r,i):_u(n,null,t,r,i);return i}function I3(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Yo(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Yo(n.url,e.url)||!gi(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Pb(n,e)||!gi(n.queryParams,e.queryParams);case"paramsChange":default:return!Pb(n,e)}}function Eu(n,e,t){let r=Tc(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?Eu(o,e.children.getContext(s),t):Eu(o,null,t):Eu(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Sc(e.outlet.component,i)):t.canDeactivateChecks.push(new Sc(null,i)):t.canDeactivateChecks.push(new Sc(null,i))}function Nu(n){return typeof n=="function"}function A3(n){return typeof n=="boolean"}function T3(n){return n&&Nu(n.canLoad)}function C3(n){return n&&Nu(n.canActivate)}function S3(n){return n&&Nu(n.canActivateChild)}function D3(n){return n&&Nu(n.canDeactivate)}function x3(n){return n&&Nu(n.canMatch)}function xN(n){return n instanceof Gi||n?.name==="EmptyError"}var up=Symbol("INITIAL_VALUE");function Pc(){return Fr(n=>af(n.map(e=>e.pipe(Wi(1),nv(up)))).pipe(He(e=>{for(let t of e)if(t!==!0){if(t===up)return up;if(t===!1||t instanceof Gs)return t}return!0}),Lr(e=>e!==up),Wi(1)))}function R3(n,e){return Ht(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?Ae(P(_({},t),{guardsResult:!0})):P3(o,r,i,n).pipe(Ht(a=>a&&A3(a)?M3(r,s,n,e):Ae(a)),He(a=>P(_({},t),{guardsResult:a})))})}function P3(n,e,t,r){return Rt(n).pipe(Ht(i=>F3(i.component,i.route,t,e,r)),ai(i=>i!==!0,!0))}function M3(n,e,t,r){return Rt(e).pipe(ic(i=>rc(O3(i.route.parent,r),N3(i.route,r),L3(n,i.path,t),k3(n,i.route,t))),ai(i=>i!==!0,!0))}function N3(n,e){return n!==null&&e&&e(new Cb(n)),Ae(!0)}function O3(n,e){return n!==null&&e&&e(new Ab(n)),Ae(!0)}function k3(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return Ae(!0);let i=r.map(s=>cf(()=>{let o=Mu(e)??t,a=Mc(s,o),c=C3(a)?a.canActivate(e,n):qo(o,()=>a(e,n));return Ks(c).pipe(ai())}));return Ae(i).pipe(Pc())}function L3(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>b3(o)).filter(o=>o!==null).map(o=>cf(()=>{let a=o.guards.map(c=>{let l=Mu(o.node)??t,u=Mc(c,l),d=S3(u)?u.canActivateChild(r,n):qo(l,()=>u(r,n));return Ks(d).pipe(ai())});return Ae(a).pipe(Pc())}));return Ae(s).pipe(Pc())}function F3(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return Ae(!0);let o=s.map(a=>{let c=Mu(e)??i,l=Mc(a,c),u=D3(l)?l.canDeactivate(n,e,t,r):qo(c,()=>l(n,e,t,r));return Ks(u).pipe(ai())});return Ae(o).pipe(Pc())}function V3(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return Ae(!0);let s=i.map(o=>{let a=Mc(o,n),c=T3(a)?a.canLoad(e,t):qo(n,()=>a(e,t));return Ks(c)});return Ae(s).pipe(Pc(),RN(r))}function RN(n){return B_(qt(e=>{if(xc(e))throw CN(n,e)}),He(e=>e===!0))}function j3(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return Ae(!0);let s=i.map(o=>{let a=Mc(o,n),c=x3(a)?a.canMatch(e,t):qo(n,()=>a(e,t));return Ks(c)});return Ae(s).pipe(Pc(),RN(r))}var Ru=class{constructor(e){this.segmentGroup=e||null}},Ep=class extends Error{constructor(e){super(),this.urlTree=e}};function Ac(n){return nc(new Ru(n))}function $3(n){return nc(new he(4e3,!1))}function U3(n){return nc(SN(!1,or.GuardRejected))}var Ob=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return Ae(r);if(i.numberOfChildren>1||!i.children[Se])return $3(e.redirectTo);i=i.children[Se]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new Ep(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new Gs(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,c])=>{o[a]=this.createSegmentGroup(e,c,r,i)}),new it(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new he(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},kb={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function B3(n,e,t,r,i){let s=zb(n,e,t);return s.matched?(r=y3(e,r),j3(r,e,t,i).pipe(He(o=>o===!0?s:_({},kb)))):Ae(s)}function zb(n,e,t){if(e.path==="**")return H3(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?_({},kb):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||jG)(t,n,e);if(!i)return _({},kb);let s={};Object.entries(i.posParams??{}).forEach(([a,c])=>{s[a]=c.path});let o=i.consumed.length>0?_(_({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function H3(n){return{matched:!0,parameters:n.length>0?lN(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function aN(n,e,t,r){return t.length>0&&G3(n,t,r)?{segmentGroup:new it(e,z3(r,new it(t,n.children))),slicedSegments:[]}:t.length===0&&W3(n,t,r)?{segmentGroup:new it(n.segments,q3(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new it(n.segments,n.children),slicedSegments:t}}function q3(n,e,t,r){let i={};for(let s of t)if(Ap(n,e,s)&&!r[yi(s)]){let o=new it([],{});i[yi(s)]=o}return _(_({},r),i)}function z3(n,e){let t={};t[Se]=e;for(let r of n)if(r.path===""&&yi(r)!==Se){let i=new it([],{});t[yi(r)]=i}return t}function G3(n,e,t){return t.some(r=>Ap(n,e,r)&&yi(r)!==Se)}function W3(n,e,t){return t.some(r=>Ap(n,e,r))}function Ap(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function K3(n,e,t,r){return yi(n)!==r&&(r===Se||!Ap(e,t,n))?!1:zb(e,n,t).matched}function Y3(n,e,t){return e.length===0&&!n.children[t]}var Lb=class{};function Q3(n,e,t,r,i,s,o="emptyOnly"){return new Fb(n,e,t,r,i,o,s).recognize()}var X3=31,Fb=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new Ob(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new he(4002,`'${e.segmentGroup}'`)}recognize(){let e=aN(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(He(t=>{let r=new Du([],Object.freeze({}),Object.freeze(_({},this.urlTree.queryParams)),this.urlTree.fragment,{},Se,this.rootComponentType,null,{}),i=new sr(r,t),s=new wp("",i),o=i3(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,Se).pipe(Ns(r=>{if(r instanceof Ep)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Ru?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=$b(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(He(s=>s instanceof sr?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return Rt(i).pipe(ic(s=>{let o=r.children[s],a=_3(t,s);return this.processSegmentGroup(e,a,o,s)}),tv((s,o)=>(s.push(...o),s)),Os(null),ev(),Ht(s=>{if(s===null)return Ac(r);let o=PN(s);return Z3(o),Ae(o)}))}processSegment(e,t,r,i,s,o){return Rt(t).pipe(ic(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(Ns(c=>{if(c instanceof Ru)return Ae(null);throw c}))),ai(a=>!!a),Ns(a=>{if(xN(a))return Y3(r,i,s)?Ae(new Lb):Ac(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return K3(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):Ac(i):Ac(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:a,consumedSegments:c,positionalParamSegments:l,remainingSegments:u}=zb(t,i,s);if(!a)return Ac(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>X3&&(this.allowRedirects=!1));let d=this.applyRedirects.applyRedirectCommands(c,i.redirectTo,l);return this.applyRedirects.lineralizeSegments(i,d).pipe(Ht(f=>this.processSegment(e,r,t,f.concat(u),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=B3(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(Fr(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(Fr(({routes:c})=>{let l=r._loadedInjector??e,{consumedSegments:u,remainingSegments:d,parameters:f}=a,p=new Du(u,f,Object.freeze(_({},this.urlTree.queryParams)),this.urlTree.fragment,eW(r),yi(r),r.component??r._loadedComponent??null,r,tW(r)),{segmentGroup:y,slicedSegments:w}=aN(t,u,d,c);if(w.length===0&&y.hasChildren())return this.processChildren(l,c,y).pipe(He(E=>E===null?null:new sr(p,E)));if(c.length===0&&w.length===0)return Ae(new sr(p,[]));let b=yi(r)===s;return this.processSegment(l,c,y,w,b?Se:s,!0).pipe(He(E=>new sr(p,E instanceof sr?[E]:[])))}))):Ac(t)))}getChildConfig(e,t,r){return t.children?Ae({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?Ae({routes:t._loadedRoutes,injector:t._loadedInjector}):V3(e,t,r,this.urlSerializer).pipe(Ht(i=>i?this.configLoader.loadChildren(e,t).pipe(qt(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):U3(t))):Ae({routes:[],injector:e})}};function Z3(n){n.sort((e,t)=>e.value.outlet===Se?-1:t.value.outlet===Se?1:e.value.outlet.localeCompare(t.value.outlet))}function J3(n){let e=n.value.routeConfig;return e&&e.path===""}function PN(n){let e=[],t=new Set;for(let r of n){if(!J3(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=PN(r.children);e.push(new sr(r.value,i))}return e.filter(r=>!t.has(r))}function eW(n){return n.data||{}}function tW(n){return n.resolve||{}}function nW(n,e,t,r,i,s){return Ht(o=>Q3(n,e,t,r,o.extractedUrl,i,s).pipe(He(({state:a,tree:c})=>P(_({},o),{targetSnapshot:a,urlAfterRedirects:c}))))}function rW(n,e){return Ht(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return Ae(t);let s=new Set(i.map(c=>c.route)),o=new Set;for(let c of s)if(!o.has(c))for(let l of MN(c))o.add(l);let a=0;return Rt(o).pipe(ic(c=>s.has(c)?iW(c,r,n,e):(c.data=$b(c,c.parent,n).resolve,Ae(void 0))),qt(()=>a++),sc(1),Ht(c=>a===o.size?Ae(t):nr))})}function MN(n){let e=n.children.map(t=>MN(t)).flat();return[n,...e]}function iW(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!AN(i)&&(s[Pu]=i.title),sW(s,n,e,r).pipe(He(o=>(n._resolvedData=o,n.data=$b(n,n.parent,t).resolve,null)))}function sW(n,e,t,r){let i=fb(n);if(i.length===0)return Ae({});let s={};return Rt(i).pipe(Ht(o=>oW(n[o],e,t,r).pipe(ai(),qt(a=>{s[o]=a}))),sc(1),J_(s),Ns(o=>xN(o)?nr:nc(o)))}function oW(n,e,t,r){let i=Mu(e)??r,s=Mc(n,i),o=s.resolve?s.resolve(e,t):qo(i,()=>s(e,t));return Ks(o)}function db(n){return Fr(e=>{let t=n(e);return t?Rt(t).pipe(He(()=>e)):Ae(e)})}var NN=(()=>{class n{buildTitle(t){let r,i=t.root;for(;i!==void 0;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(s=>s.outlet===Se);return r}getResolvedTitleForRoute(t){return t.data[Pu]}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>ne(aW),providedIn:"root"})}}return n})(),aW=(()=>{class n extends NN{constructor(t){super(),this.title=t}updateTitle(t){let r=this.buildTitle(t);r!==void 0&&this.title.setTitle(r)}static{this.\u0275fac=function(r){return new(r||n)(pe(nN))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Gb=new de("",{providedIn:"root",factory:()=>({})}),Wb=new de(""),cW=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ne(Gw)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Ae(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let r=Ks(t.loadComponent()).pipe(He(ON),qt(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),Gl(()=>{this.componentLoaders.delete(t)})),i=new Za(r,()=>new Pn).pipe(Xa());return this.componentLoaders.set(t,i),i}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Ae({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let s=lW(r,this.compiler,t,this.onLoadEndListener).pipe(Gl(()=>{this.childrenLoaders.delete(r)})),o=new Za(s,()=>new Pn).pipe(Xa());return this.childrenLoaders.set(r,o),o}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function lW(n,e,t,r){return Ks(n.loadChildren()).pipe(He(ON),Ht(i=>i instanceof iu||Array.isArray(i)?Ae(i):Rt(e.compileModuleAsync(i))),He(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(Wb,[],{optional:!0,self:!0}).flat()),{routes:o.map(qb),injector:s}}))}function uW(n){return n&&typeof n=="object"&&"default"in n}function ON(n){return uW(n)?n.default:n}var Kb=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>ne(dW),providedIn:"root"})}}return n})(),dW=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),hW=new de("");var fW=(()=>{class n{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Pn,this.transitionAbortSubject=new Pn,this.configLoader=ne(cW),this.environmentInjector=ne(gr),this.urlSerializer=ne(jb),this.rootContexts=ne(Ip),this.location=ne(hu),this.inputBindingEnabled=ne(Hb,{optional:!0})!==null,this.titleStrategy=ne(NN),this.options=ne(Gb,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=ne(Kb),this.createViewTransition=ne(hW,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Ae(void 0),this.rootComponentType=null;let t=i=>this.events.next(new Eb(i)),r=i=>this.events.next(new Ib(i));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=t}complete(){this.transitions?.complete()}handleNavigationRequest(t){let r=++this.navigationId;this.transitions?.next(P(_(_({},this.transitions.value),t),{id:r}))}setupNavigations(t,r,i){return this.transitions=new Bt({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:bu,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Lr(s=>s.id!==0),He(s=>P(_({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),Fr(s=>{let o=!1,a=!1;return Ae(s).pipe(Fr(c=>{if(this.navigationId>s.id)return this.cancelNavigationTransition(s,"",or.SupersededByNewNavigation),nr;this.currentTransition=s,this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?P(_({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let l=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=c.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!l&&u!=="reload"){let d="";return this.events.next(new Xo(c.id,this.urlSerializer.serialize(c.rawUrl),d,yb.IgnoredSameUrlNavigation)),c.resolve(null),nr}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return Ae(c).pipe(Fr(d=>{let f=this.transitions?.getValue();return this.events.next(new Au(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?nr:Promise.resolve(d)}),nW(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),qt(d=>{s.targetSnapshot=d.targetSnapshot,s.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=P(_({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let f=new yp(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){let{id:d,extractedUrl:f,source:p,restoredState:y,extras:w}=c,b=new Au(d,this.urlSerializer.serialize(f),p,y);this.events.next(b);let E=EN(this.rootComponentType).snapshot;return this.currentTransition=s=P(_({},c),{targetSnapshot:E,urlAfterRedirects:f,extras:P(_({},w),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,Ae(s)}else{let d="";return this.events.next(new Xo(c.id,this.urlSerializer.serialize(c.extractedUrl),d,yb.IgnoredByUrlHandlingStrategy)),c.resolve(null),nr}}),qt(c=>{let l=new _b(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),He(c=>(this.currentTransition=s=P(_({},c),{guards:w3(c.targetSnapshot,c.currentSnapshot,this.rootContexts)}),s)),R3(this.environmentInjector,c=>this.events.next(c)),qt(c=>{if(s.guardsResult=c.guardsResult,xc(c.guardsResult))throw CN(this.urlSerializer,c.guardsResult);let l=new vb(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),Lr(c=>c.guardsResult?!0:(this.cancelNavigationTransition(c,"",or.GuardRejected),!1)),db(c=>{if(c.guards.canActivateChecks.length)return Ae(c).pipe(qt(l=>{let u=new wb(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(u)}),Fr(l=>{let u=!1;return Ae(l).pipe(rW(this.paramsInheritanceStrategy,this.environmentInjector),qt({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(l,"",or.NoDataFromResolver)}}))}),qt(l=>{let u=new bb(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(u)}))}),db(c=>{let l=u=>{let d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(qt(f=>{u.component=f}),He(()=>{})));for(let f of u.children)d.push(...l(f));return d};return af(l(c.targetSnapshot.root)).pipe(Os(null),Wi(1))}),db(()=>this.afterPreactivation()),Fr(()=>{let{currentSnapshot:c,targetSnapshot:l}=s,u=this.createViewTransition?.(this.environmentInjector,c.root,l.root);return u?Rt(u).pipe(He(()=>s)):Ae(s)}),He(c=>{let l=h3(t.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=s=P(_({},c),{targetRouterState:l}),this.currentNavigation.targetRouterState=l,s}),qt(()=>{this.events.next(new Cu)}),v3(this.rootContexts,t.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),Wi(1),qt({next:c=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Qo(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{o=!0}}),rv(this.transitionAbortSubject.pipe(qt(c=>{throw c}))),Gl(()=>{!o&&!a&&this.cancelNavigationTransition(s,"",or.SupersededByNewNavigation),this.currentTransition?.id===s.id&&(this.currentNavigation=null,this.currentTransition=null)}),Ns(c=>{if(a=!0,DN(c))this.events.next(new Ws(s.id,this.urlSerializer.serialize(s.extractedUrl),c.message,c.cancellationCode)),m3(c)?this.events.next(new Su(c.url)):s.resolve(!1);else{this.events.next(new Tu(s.id,this.urlSerializer.serialize(s.extractedUrl),c,s.targetSnapshot??void 0));try{s.resolve(t.errorHandler(c))}catch(l){this.options.resolveNavigationPromiseOnError?s.resolve(!1):s.reject(l)}}return nr}))}))}cancelNavigationTransition(t,r,i){let s=new Ws(t.id,this.urlSerializer.serialize(t.extractedUrl),r,i);this.events.next(s),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function pW(n){return n!==bu}var mW=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>ne(gW),providedIn:"root"})}}return n})(),Vb=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},gW=(()=>{class n extends Vb{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Go(n)))(i||n)}})()}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),kN=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:()=>ne(yW),providedIn:"root"})}}return n})(),yW=(()=>{class n extends kN{constructor(){super(...arguments),this.location=ne(hu),this.urlSerializer=ne(jb),this.options=ne(Gb,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=ne(Kb),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Gs,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=EN(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(r=>{r.type==="popstate"&&t(r.url,r.state)})}handleRouterEvent(t,r){if(t instanceof Au)this.stateMemento=this.createStateMemento();else if(t instanceof Xo)this.rawUrlTree=r.initialUrl;else if(t instanceof yp){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let i=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(i,r)}}else t instanceof Cu?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&(r.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,r))):t instanceof Ws&&(t.code===or.GuardRejected||t.code===or.NoDataFromResolver)?this.restoreHistory(r):t instanceof Tu?this.restoreHistory(r,!0):t instanceof Qo&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,r){let i=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){let s=this.browserPageId,o=_(_({},r.extras.state),this.generateNgRouterState(r.id,s));this.location.replaceState(i,"",o)}else{let s=_(_({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(i,"",s)}}restoreHistory(t,r=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,s=this.currentPageId-i;s!==0?this.location.historyGo(s):this.currentUrlTree===t.finalUrl&&s===0&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Go(n)))(i||n)}})()}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),vu=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(vu||{});function _W(n,e){n.events.pipe(Lr(t=>t instanceof Qo||t instanceof Ws||t instanceof Tu||t instanceof Xo),He(t=>t instanceof Qo||t instanceof Xo?vu.COMPLETE:(t instanceof Ws?t.code===or.Redirect||t.code===or.SupersededByNewNavigation:!1)?vu.REDIRECTING:vu.FAILED),Lr(t=>t!==vu.REDIRECTING),Wi(1)).subscribe(()=>{e()})}function vW(n){throw n}var wW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},bW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},LN=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=ne(tp),this.stateManager=ne(kN),this.options=ne(Gb,{optional:!0})||{},this.pendingTasks=ne(Zf),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=ne(fW),this.urlSerializer=ne(jb),this.location=ne(hu),this.urlHandlingStrategy=ne(Kb),this._events=new Pn,this.errorHandler=this.options.errorHandler||vW,this.navigated=!1,this.routeReuseStrategy=ne(mW),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=ne(Wb,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!ne(Hb,{optional:!0}),this.eventsSubscription=new xt,this.isNgZoneEnabled=ne(et)instanceof et&&et.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(r=>{try{let i=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(i!==null&&s!==null){if(this.stateManager.handleRouterEvent(r,s),r instanceof Ws&&r.code!==or.Redirect&&r.code!==or.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Qo)this.navigated=!0;else if(r instanceof Su){let o=this.urlHandlingStrategy.merge(r.url,i.currentRawUrl),a={info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||pW(i.source)};this.scheduleNavigation(o,bu,null,a,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}IW(r)&&this._events.next(r)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),bu,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",r)},0)})}navigateToSyncWithBrowser(t,r,i){let s={replaceUrl:!0},o=i?.navigationId?i:null;if(i){let c=_({},i);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(s.state=c)}let a=this.parseUrl(t);this.scheduleNavigation(a,r,o,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(qb),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){let{relativeTo:i,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:c}=r,l=c?this.currentUrlTree.fragment:o,u=null;switch(a){case"merge":u=_(_({},this.currentUrlTree.queryParams),s);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=s||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let f=i?i.snapshot:this.routerState.snapshot.root;d=_N(f)}catch{(typeof t[0]!="string"||!t[0].startsWith("/"))&&(t=[]),d=this.currentUrlTree.root}return vN(d,t,u,l??null)}navigateByUrl(t,r={skipLocationChange:!1}){let i=xc(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,bu,null,r)}navigate(t,r={skipLocationChange:!1}){return EW(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,r){let i;if(r===!0?i=_({},wW):r===!1?i=_({},bW):i=r,xc(t))return rN(this.currentUrlTree,t,i);let s=this.parseUrl(t);return rN(this.currentUrlTree,s,i)}removeEmptyProps(t){return Object.entries(t).reduce((r,[i,s])=>(s!=null&&(r[i]=s),r),{})}scheduleNavigation(t,r,i,s,o){if(this.disposed)return Promise.resolve(!1);let a,c,l;o?(a=o.resolve,c=o.reject,l=o.promise):l=new Promise((d,f)=>{a=d,c=f});let u=this.pendingTasks.add();return _W(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:a,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function EW(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new he(4008,!1)}function IW(n){return!(n instanceof Cu)&&!(n instanceof Su)}var AW=new de("");function FN(n,...e){return Wn([{provide:Wb,multi:!0,useValue:n},[],{provide:Rc,useFactory:TW,deps:[LN]},{provide:zw,multi:!0,useFactory:CW},e.map(t=>t.\u0275providers)])}function TW(n){return n.routerState.root}function CW(){let n=ne(yn);return e=>{let t=n.get(du);if(e!==t.components[0])return;let r=n.get(LN),i=n.get(SW);n.get(DW)===1&&r.initialNavigation(),n.get(xW,null,Ne.Optional)?.setUpPreloading(),n.get(AW,null,Ne.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var SW=new de("",{factory:()=>new Pn}),DW=new de("",{providedIn:"root",factory:()=>1});var xW=new de("");var jN=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},RW=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],a=n[t++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},$N={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,a=o?n[i+1]:0,c=i+2<n.length,l=c?n[i+2]:0,u=s>>2,d=(s&3)<<4|a>>4,f=(a&15)<<2|l>>6,p=l&63;c||(p=64,o||(f=64)),r.push(t[u],t[d],t[f],t[p])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(jN(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):RW(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;let l=i<n.length?t[n.charAt(i)]:64;++i;let d=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||a==null||l==null||d==null)throw new Qb;let f=s<<2|a>>4;if(r.push(f),l!==64){let p=a<<4&240|l>>2;if(r.push(p),d!==64){let y=l<<6&192|d;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Qb=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},PW=function(n){let e=jN(n);return $N.encodeByteArray(e,!0)},Ou=function(n){return PW(n).replace(/\./g,"")},Zb=function(n){try{return $N.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function MW(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var NW=()=>MW().__FIREBASE_DEFAULTS__,OW=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},kW=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Zb(n[1]);return e&&JSON.parse(e)},Cp=()=>{try{return NW()||OW()||kW()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Jb=n=>{var e,t;return(t=(e=Cp())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Nc=n=>{let e=Jb(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},eE=()=>{var n;return(n=Cp())===null||n===void 0?void 0:n.config},tE=n=>{var e;return(e=Cp())===null||e===void 0?void 0:e[`_${n}`]};var Tp=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Sp(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Ou(JSON.stringify(t)),Ou(JSON.stringify(o)),""].join(".")}function Xt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function UN(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Xt())}function LW(){var n;let e=(n=Cp())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function BN(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function HN(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function qN(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function zN(){let n=Xt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function GN(){return!LW()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function nE(){try{return typeof indexedDB=="object"}catch{return!1}}function WN(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var FW="FirebaseError",on=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=FW,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ns.prototype.create)}},ns=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?VW(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new on(i,a,r)}};function VW(n,e){return n.replace(jW,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var jW=/\{\$([^}]+)}/g;function KN(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Zo(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],o=e[i];if(VN(s)&&VN(o)){if(!Zo(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function VN(n){return n!==null&&typeof n=="object"}function ku(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function YN(n,e){let t=new Xb(n,e);return t.subscribe.bind(t)}var Xb=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");$W(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Yb),i.error===void 0&&(i.error=Yb),i.complete===void 0&&(i.complete=Yb);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function $W(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Yb(){}var Jde=4*60*60*1e3;function lt(n){return n&&n._delegate?n._delegate:n}var _n=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Jo="[DEFAULT]";var rE=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Tp;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(BW(e))try{this.getOrInitializeService({instanceIdentifier:Jo})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Jo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return g(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Jo){return this.instances.has(e)}getOptions(e=Jo){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:UW(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Jo){return this.component?this.component.multipleInstances?e:Jo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function UW(n){return n===Jo?void 0:n}function BW(n){return n.instantiationMode==="EAGER"}var Dp=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new rE(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var HW=[],ze=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(ze||{}),qW={debug:ze.DEBUG,verbose:ze.VERBOSE,info:ze.INFO,warn:ze.WARN,error:ze.ERROR,silent:ze.SILENT},zW=ze.INFO,GW={[ze.DEBUG]:"log",[ze.VERBOSE]:"log",[ze.INFO]:"info",[ze.WARN]:"warn",[ze.ERROR]:"error"},WW=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=GW[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Ys=class{constructor(e){this.name=e,this._logLevel=zW,this._logHandler=WW,this._userLogHandler=null,HW.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ze))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?qW[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ze.DEBUG,...e),this._logHandler(this,ze.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ze.VERBOSE,...e),this._logHandler(this,ze.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ze.INFO,...e),this._logHandler(this,ze.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ze.WARN,...e),this._logHandler(this,ze.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ze.ERROR,...e),this._logHandler(this,ze.ERROR,...e)}};var KW=(n,e)=>e.some(t=>n instanceof t),QN,XN;function YW(){return QN||(QN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function QW(){return XN||(XN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var ZN=new WeakMap,sE=new WeakMap,JN=new WeakMap,iE=new WeakMap,aE=new WeakMap;function XW(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(_i(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ZN.set(t,n)}).catch(()=>{}),aE.set(e,n),e}function ZW(n){if(sE.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});sE.set(n,e)}var oE={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return sE.get(n);if(e==="objectStoreNames")return n.objectStoreNames||JN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return _i(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function eO(n){oE=n(oE)}function JW(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(xp(this),e,...t);return JN.set(r,e.sort?e.sort():[e]),_i(r)}:QW().includes(n)?function(...e){return n.apply(xp(this),e),_i(ZN.get(this))}:function(...e){return _i(n.apply(xp(this),e))}}function e5(n){return typeof n=="function"?JW(n):(n instanceof IDBTransaction&&ZW(n),KW(n,YW())?new Proxy(n,oE):n)}function _i(n){if(n instanceof IDBRequest)return XW(n);if(iE.has(n))return iE.get(n);let e=e5(n);return e!==n&&(iE.set(n,e),aE.set(e,n)),e}var xp=n=>aE.get(n);function nO(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(n,e),a=_i(o);return r&&o.addEventListener("upgradeneeded",c=>{r(_i(o.result),c.oldVersion,c.newVersion,_i(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}var t5=["get","getKey","getAll","getAllKeys","count"],n5=["put","add","delete","clear"],cE=new Map;function tO(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(cE.get(e))return cE.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=n5.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||t5.includes(t)))return;let s=function(o,...a){return g(this,null,function*(){let c=this.transaction(o,i?"readwrite":"readonly"),l=c.store;return r&&(l=l.index(a.shift())),(yield Promise.all([l[t](...a),i&&c.done]))[0]})};return cE.set(e,s),s}eO(n=>P(_({},n),{get:(e,t,r)=>tO(e,t)||n.get(e,t,r),has:(e,t)=>!!tO(e,t)||n.has(e,t)}));var uE=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(r5(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function r5(n){let e=n.getComponent();return e?.type==="VERSION"}var dE="@firebase/app",rO="0.10.13";var rs=new Ys("@firebase/app"),i5="@firebase/app-compat",s5="@firebase/analytics-compat",o5="@firebase/analytics",a5="@firebase/app-check-compat",c5="@firebase/app-check",l5="@firebase/auth",u5="@firebase/auth-compat",d5="@firebase/database",h5="@firebase/data-connect",f5="@firebase/database-compat",p5="@firebase/functions",m5="@firebase/functions-compat",g5="@firebase/installations",y5="@firebase/installations-compat",_5="@firebase/messaging",v5="@firebase/messaging-compat",w5="@firebase/performance",b5="@firebase/performance-compat",E5="@firebase/remote-config",I5="@firebase/remote-config-compat",A5="@firebase/storage",T5="@firebase/storage-compat",C5="@firebase/firestore",S5="@firebase/vertexai-preview",D5="@firebase/firestore-compat",x5="firebase",R5="10.14.1";var hE="[DEFAULT]",P5={[dE]:"fire-core",[i5]:"fire-core-compat",[o5]:"fire-analytics",[s5]:"fire-analytics-compat",[c5]:"fire-app-check",[a5]:"fire-app-check-compat",[l5]:"fire-auth",[u5]:"fire-auth-compat",[d5]:"fire-rtdb",[h5]:"fire-data-connect",[f5]:"fire-rtdb-compat",[p5]:"fire-fn",[m5]:"fire-fn-compat",[g5]:"fire-iid",[y5]:"fire-iid-compat",[_5]:"fire-fcm",[v5]:"fire-fcm-compat",[w5]:"fire-perf",[b5]:"fire-perf-compat",[E5]:"fire-rc",[I5]:"fire-rc-compat",[A5]:"fire-gcs",[T5]:"fire-gcs-compat",[C5]:"fire-fst",[D5]:"fire-fst-compat",[S5]:"fire-vertex","fire-js":"fire-js",[x5]:"fire-js-all"};var Lu=new Map,M5=new Map,fE=new Map;function iO(n,e){try{n.container.addComponent(e)}catch(t){rs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function wr(n){let e=n.name;if(fE.has(e))return rs.debug(`There were multiple attempts to register component ${e}.`),!1;fE.set(e,n);for(let t of Lu.values())iO(t,n);for(let t of M5.values())iO(t,n);return!0}function is(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function vi(n){return n.settings!==void 0}var N5={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Qs=new ns("app","Firebase",N5);var pE=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _n("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qs.create("app-deleted",{appName:this._name})}};var wi=R5;function yE(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:hE,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Qs.create("bad-app-name",{appName:String(i)});if(t||(t=eE()),!t)throw Qs.create("no-options");let s=Lu.get(i);if(s){if(Zo(t,s.options)&&Zo(r,s.config))return s;throw Qs.create("duplicate-app",{appName:i})}let o=new Dp(i);for(let c of fE.values())o.addComponent(c);let a=new pE(t,r,o);return Lu.set(i,a),a}function bi(n=hE){let e=Lu.get(n);if(!e&&n===hE&&eE())return yE();if(!e)throw Qs.create("no-app",{appName:n});return e}function Rp(){return Array.from(Lu.values())}function st(n,e,t){var r;let i=(r=P5[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),rs.warn(a.join(" "));return}wr(new _n(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var O5="firebase-heartbeat-database",k5=1,Fu="firebase-heartbeat-store",lE=null;function cO(){return lE||(lE=nO(O5,k5,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Fu)}catch(t){console.warn(t)}}}}).catch(n=>{throw Qs.create("idb-open",{originalErrorMessage:n.message})})),lE}function L5(n){return g(this,null,function*(){try{let t=(yield cO()).transaction(Fu),r=yield t.objectStore(Fu).get(lO(n));return yield t.done,r}catch(e){if(e instanceof on)rs.warn(e.message);else{let t=Qs.create("idb-get",{originalErrorMessage:e?.message});rs.warn(t.message)}}})}function sO(n,e){return g(this,null,function*(){try{let r=(yield cO()).transaction(Fu,"readwrite");yield r.objectStore(Fu).put(e,lO(n)),yield r.done}catch(t){if(t instanceof on)rs.warn(t.message);else{let r=Qs.create("idb-set",{originalErrorMessage:t?.message});rs.warn(r.message)}}})}function lO(n){return`${n.name}!${n.options.appId}`}var F5=1024,V5=30*24*60*60*1e3,mE=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new gE(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return g(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=oO();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=V5}),this._storage.overwrite(this._heartbeatsCache))}catch(r){rs.warn(r)}})}getHeartbeatsHeader(){return g(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=oO(),{heartbeatsToSend:r,unsentEntries:i}=j5(this._heartbeatsCache.heartbeats),s=Ou(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return rs.warn(t),""}})}};function oO(){return new Date().toISOString().substring(0,10)}function j5(n,e=F5){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),aO(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),aO(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var gE=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return g(this,null,function*(){return nE()?WN().then(()=>!0).catch(()=>!1):!1})}read(){return g(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield L5(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return sO(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return sO(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function aO(n){return Ou(JSON.stringify({version:2,heartbeats:n})).length}function $5(n){wr(new _n("platform-logger",e=>new uE(e),"PRIVATE")),wr(new _n("heartbeat",e=>new mE(e),"PRIVATE")),st(dE,rO,n),st(dE,rO,"esm2017"),st("fire-js","")}$5("");var U5="firebase",B5="10.14.1";st(U5,B5,"app");var Gr=new Qi("ANGULARFIRE2_VERSION");function Xs(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var ss=(n,e)=>{let t=e?[e]:Rp(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Ei=class{constructor(){return ss(H5)}},H5="app-check";function Oc(){}var Pp=class{zone;delegate;constructor(e,t=K_){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},_E=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Oc,{},Oc,Oc)),t.pipe(qt({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Ii=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Pp(Zone.current)),this.insideAngular=t.run(()=>new Pp(Zone.current,W_)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(pe(et))};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Mp(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function q5(n){return Mp().ngZone.runOutsideAngular(()=>n())}function ea(n){return Mp().ngZone.run(()=>n())}function z5(n){return G5(Mp())(n)}function G5(n){return function(t){return t=t.lift(new _E(n.ngZone)),t.pipe(Ms(n.outsideAngular),Ps(n.insideAngular))}}var W5=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),ea(()=>n.apply(void 0,r))},ot=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=ea(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Oc,{},Oc,Oc))),r[s]=W5(r[s],t));let i=q5(()=>n.apply(this,r));if(!e)if(i instanceof Ye){let s=Mp();return i.pipe(Ms(s.outsideAngular),Ps(s.insideAngular))}else return ea(()=>i);return i instanceof Ye?i.pipe(z5):i instanceof Promise?ea(()=>new Promise((s,o)=>i.then(a=>ea(()=>s(a)),a=>ea(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:ea(()=>i)};var ar=class{constructor(e){return e}},Wr=class{constructor(){return Rp()}};function K5(n){return n&&n.length===1?n[0]:new ar(bi())}var vE=new de("angularfire2._apps"),Y5={provide:ar,useFactory:K5,deps:[[new gt,vE]]},Q5={provide:Wr,deps:[[new gt,vE]]};function X5(n){return(e,t)=>{let r=t.get($s);st("angularfire",Gr.full,"core"),st("angularfire",Gr.full,"app"),st("angular",DM.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new ar(i)}}function uO(n,...e){return Wn([Y5,Q5,{provide:vE,useFactory:X5(n),multi:!0,deps:[et,yn,Ii,...e]}])}var dO=ot(yE,!0);function CO(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var SO=CO,DO=new ns("auth","Firebase",CO());var Vp=new Ys("@firebase/auth");function Z5(n,...e){Vp.logLevel<=ze.WARN&&Vp.warn(`Auth (${wi}): ${n}`,...e)}function Op(n,...e){Vp.logLevel<=ze.ERROR&&Vp.error(`Auth (${wi}): ${n}`,...e)}function eo(n,...e){throw jE(n,...e)}function ta(n,...e){return jE(n,...e)}function xO(n,e,t){let r=Object.assign(Object.assign({},SO()),{[e]:t});return new ns("auth","Firebase",r).create(e,{appName:n.name})}function Js(n){return xO(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function jE(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return DO.create(n,...e)}function ve(n,e,...t){if(!n)throw jE(e,...t)}function os(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Op(e),new Error(e)}function to(n,e){n||os(e)}function IE(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function J5(){return hO()==="http:"||hO()==="https:"}function hO(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function e9(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(J5()||HN()||"connection"in navigator)?navigator.onLine:!0}function t9(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var na=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,to(t>e,"Short delay should be less than long delay!"),this.isMobile=UN()||qN()}get(){return e9()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function $E(n,e){to(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var jp=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;os("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;os("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;os("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var n9={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var r9=new na(3e4,6e4);function Yp(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Lc(s,o,a,c){return g(this,arguments,function*(n,e,t,r,i={}){return RO(n,i,()=>g(this,null,function*(){let l={},u={};r&&(e==="GET"?u=r:l={body:JSON.stringify(r)});let d=ku(Object.assign({key:n.config.apiKey},u)).slice(1),f=yield n._getAdditionalHeaders();f["Content-Type"]="application/json",n.languageCode&&(f["X-Firebase-Locale"]=n.languageCode);let p=Object.assign({method:e,headers:f},l);return BN()||(p.referrerPolicy="no-referrer"),jp.fetch()(MO(n,n.config.apiHost,t,d),p)}))})}function RO(n,e,t){return g(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},n9),e);try{let i=new AE(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw Np(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Np(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Np(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Np(n,"user-disabled",o);let u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw xO(n,u,l);eo(n,u)}}catch(i){if(i instanceof on)throw i;eo(n,"network-request-failed",{message:String(i)})}})}function PO(s,o,a,c){return g(this,arguments,function*(n,e,t,r,i={}){let l=yield Lc(n,e,t,r,i);return"mfaPendingCredential"in l&&eo(n,"multi-factor-auth-required",{_serverResponse:l}),l})}function MO(n,e,t,r){let i=`${e}${t}?${r}`;return n.config.emulator?$E(n.config,i):`${n.config.apiScheme}://${i}`}var AE=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ta(this.auth,"network-request-failed")),r9.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function Np(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=ta(n,e,r);return i.customData._tokenResponse=t,i}function i9(n,e){return g(this,null,function*(){return Lc(n,"POST","/v1/accounts:delete",e)})}function NO(n,e){return g(this,null,function*(){return Lc(n,"POST","/v1/accounts:lookup",e)})}function Vu(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function UE(n,e=!1){return g(this,null,function*(){let t=lt(n),r=yield t.getIdToken(e),i=BE(r);ve(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:Vu(wE(i.auth_time)),issuedAtTime:Vu(wE(i.iat)),expirationTime:Vu(wE(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function wE(n){return Number(n)*1e3}function BE(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Op("JWT malformed, contained fewer than 3 sections"),null;try{let i=Zb(t);return i?JSON.parse(i):(Op("Failed to decode base64 JWT payload"),null)}catch(i){return Op("Caught error parsing JWT payload as JSON",i?.toString()),null}}function fO(n){let e=BE(n);return ve(e,"internal-error"),ve(typeof e.exp<"u","internal-error"),ve(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function $u(n,e,t=!1){return g(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof on&&s9(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function s9({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var TE=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>g(this,null,function*(){yield this.iteration()}),t)}iteration(){return g(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Uu=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Vu(this.lastLoginAt),this.creationTime=Vu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function $p(n){return g(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield $u(n,NO(t,{idToken:r}));ve(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?OO(s.providerUserInfo):[],a=o9(n.providerData,o),c=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!a?.length,u=c?l:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Uu(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,d)})}function HE(n){return g(this,null,function*(){let e=lt(n);yield $p(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function o9(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function OO(n){return n.map(e=>{var{providerId:t}=e,r=Y_(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function a9(n,e){return g(this,null,function*(){let t=yield RO(n,{},()=>g(this,null,function*(){let r=ku({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=MO(n,i,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",jp.fetch()(o,{method:"POST",headers:a,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function c9(n,e){return g(this,null,function*(){return Lc(n,"POST","/v2/accounts:revokeToken",Yp(n,e))})}var ju=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ve(e.idToken,"internal-error"),ve(typeof e.idToken<"u","internal-error"),ve(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):fO(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ve(e.length!==0,"internal-error");let t=fO(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return g(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ve(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return g(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield a9(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new n;return r&&(ve(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(ve(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(ve(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return os("not implemented")}};function Zs(n,e){ve(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var kc=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=Y_(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new TE(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Uu(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return g(this,null,function*(){let t=yield $u(this,this.stsTokenManager.getToken(this.auth,e));return ve(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return UE(this,e)}reload(){return HE(this)}_assign(e){this!==e&&(ve(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ve(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return g(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield $p(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return g(this,null,function*(){if(vi(this.auth.app))return Promise.reject(Js(this.auth));let e=yield this.getIdToken();return yield $u(this,i9(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,a,c,l,u;let d=(r=t.displayName)!==null&&r!==void 0?r:void 0,f=(i=t.email)!==null&&i!==void 0?i:void 0,p=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,y=(o=t.photoURL)!==null&&o!==void 0?o:void 0,w=(a=t.tenantId)!==null&&a!==void 0?a:void 0,b=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,E=(l=t.createdAt)!==null&&l!==void 0?l:void 0,D=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:x,emailVerified:N,isAnonymous:L,providerData:F,stsTokenManager:T}=t;ve(x&&T,e,"internal-error");let A=ju.fromJSON(this.name,T);ve(typeof x=="string",e,"internal-error"),Zs(d,e.name),Zs(f,e.name),ve(typeof N=="boolean",e,"internal-error"),ve(typeof L=="boolean",e,"internal-error"),Zs(p,e.name),Zs(y,e.name),Zs(w,e.name),Zs(b,e.name),Zs(E,e.name),Zs(D,e.name);let C=new n({uid:x,auth:e,email:f,emailVerified:N,displayName:d,isAnonymous:L,photoURL:y,phoneNumber:p,tenantId:w,stsTokenManager:A,createdAt:E,lastLoginAt:D});return F&&Array.isArray(F)&&(C.providerData=F.map(R=>Object.assign({},R))),b&&(C._redirectEventId=b),C}static _fromIdTokenResponse(e,t,r=!1){return g(this,null,function*(){let i=new ju;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield $p(s),s})}static _fromGetAccountInfoResponse(e,t,r){return g(this,null,function*(){let i=t.users[0];ve(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?OO(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,a=new ju;a.updateFromIdToken(r);let c=new n({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Uu(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(c,l),c})}};var pO=new Map;function as(n){to(n instanceof Function,"Expected a class definition");let e=pO.get(n);return e?(to(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,pO.set(n,e),e)}var l9=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return g(this,null,function*(){return!0})}_set(t,r){return g(this,null,function*(){this.storage[t]=r})}_get(t){return g(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return g(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),CE=l9;function kp(n,e,t){return`firebase:${n}:${e}:${t}`}var Up=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=kp(this.userKey,i.apiKey,s),this.fullPersistenceKey=kp("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return g(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?kc._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return g(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return g(this,null,function*(){if(!t.length)return new n(as(CE),e,r);let i=(yield Promise.all(t.map(l=>g(this,null,function*(){if(yield l._isAvailable())return l})))).filter(l=>l),s=i[0]||as(CE),o=kp(r,e.config.apiKey,e.name),a=null;for(let l of t)try{let u=yield l._get(o);if(u){let d=kc._fromJSON(e,u);l!==s&&(a=d),s=l;break}}catch{}let c=i.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new n(s,e,r):(s=c[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(l=>g(this,null,function*(){if(l!==s)try{yield l._remove(o)}catch{}}))),new n(s,e,r))})}};function mO(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(VO(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(kO(e))return"Firefox";if(e.includes("silk/"))return"Silk";if($O(e))return"Blackberry";if(UO(e))return"Webos";if(LO(e))return"Safari";if((e.includes("chrome/")||FO(e))&&!e.includes("edge/"))return"Chrome";if(jO(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function kO(n=Xt()){return/firefox\//i.test(n)}function LO(n=Xt()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function FO(n=Xt()){return/crios\//i.test(n)}function VO(n=Xt()){return/iemobile/i.test(n)}function jO(n=Xt()){return/android/i.test(n)}function $O(n=Xt()){return/blackberry/i.test(n)}function UO(n=Xt()){return/webos/i.test(n)}function qE(n=Xt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function u9(n=Xt()){var e;return qE(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function d9(){return zN()&&document.documentMode===10}function BO(n=Xt()){return qE(n)||jO(n)||UO(n)||$O(n)||/windows phone/i.test(n)||VO(n)}function HO(n,e=[]){let t;switch(n){case"Browser":t=mO(Xt());break;case"Worker":t=`${mO(Xt())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${wi}/${r}`}var SE=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((o,a)=>{try{let c=e(s);o(c)}catch(c){a(c)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return g(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function h9(t){return g(this,arguments,function*(n,e={}){return Lc(n,"GET","/v2/passwordPolicy",Yp(n,e))})}var f9=6,DE=class{constructor(e){var t,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:f9,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,a;let c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var xE=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bp(this),this.idTokenSubscription=new Bp(this),this.beforeStateQueue=new SE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=DO,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=as(t)),this._initializationPromise=this.queue(()=>g(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield Up.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return g(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return g(this,null,function*(){try{let t=yield NO(this,{idToken:e}),r=yield kc._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return g(this,null,function*(){var t;if(vi(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=i?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!o||o===a)&&c?.user&&(i=c.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ve(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return g(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return g(this,null,function*(){try{yield $p(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=t9()}_delete(){return g(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return g(this,null,function*(){if(vi(this.app))return Promise.reject(Js(this));let t=e?lt(e):null;return t&&ve(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return g(this,null,function*(){if(!this._deleted)return e&&ve(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>g(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return g(this,null,function*(){return vi(this.app)?Promise.reject(Js(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return vi(this.app)?Promise.reject(Js(this)):this.queue(()=>g(this,null,function*(){yield this.assertedPersistence.setPersistence(as(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return g(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return g(this,null,function*(){let e=yield h9(this),t=new DE(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ns("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return g(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield c9(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return g(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return g(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&as(e)||this._popupRedirectResolver;ve(t,this,"argument-error"),this.redirectPersistenceManager=yield Up.create(this,[as(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return g(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>g(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return g(this,null,function*(){if(e===this.currentUser)return this.queue(()=>g(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ve(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let c=e.addObserver(t,r,i);return()=>{o=!0,c()}}else{let c=e.addObserver(t);return()=>{o=!0,c()}}}directlySetCurrentUser(e){return g(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ve(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=HO(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return g(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return g(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&Z5(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Qp(n){return lt(n)}var Bp=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=YN(t=>this.observer=t)}get next(){return ve(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var zE={loadJS(){return g(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function p9(n){zE=n}function m9(n){return zE.loadJS(n)}function g9(){return zE.gapiScript}function qO(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function GE(n,e){let t=is(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(Zo(s,e??{}))return i;eo(i,"already-initialized")}return t.initialize({options:e})}function y9(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(as);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Xp(n,e,t){let r=Qp(n);ve(r._canInitEmulator,r,"emulator-config-failed"),ve(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=zO(e),{host:o,port:a}=_9(e),c=a===null?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||v9()}function zO(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function _9(n){let e=zO(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:gO(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:gO(o)}}}function gO(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function v9(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Hp=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return os("not implemented")}_getIdTokenResponse(e){return os("not implemented")}_linkToIdToken(e,t){return os("not implemented")}_getReauthenticationResolver(e){return os("not implemented")}};function bE(n,e){return g(this,null,function*(){return PO(n,"POST","/v1/accounts:signInWithIdp",Yp(n,e))})}var qp=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var RE=class extends qp{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function w9(n,e){return g(this,null,function*(){return PO(n,"POST","/v1/accounts:signUp",Yp(n,e))})}var ra=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return g(this,null,function*(){let s=yield kc._fromIdTokenResponse(e,r,i),o=yO(r);return new n({user:s,providerId:o,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return g(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=yO(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function yO(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}function WE(n){return g(this,null,function*(){var e;if(vi(n.app))return Promise.reject(Js(n));let t=Qp(n);if(yield t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new ra({user:t.currentUser,providerId:null,operationType:"signIn"});let r=yield w9(t,{returnSecureToken:!0}),i=yield ra._fromIdTokenResponse(t,"signIn",r,!0);return yield t._updateCurrentUser(i.user),i})}var PE=class n extends on{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function GO(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?PE._fromErrorAndOperation(n,s,e,r):s})}function b9(n,e,t=!1){return g(this,null,function*(){let r=yield $u(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return ra._forOperation(n,"link",r)})}function E9(n,e,t=!1){return g(this,null,function*(){let{auth:r}=n;if(vi(r.app))return Promise.reject(Js(r));let i="reauthenticate";try{let s=yield $u(n,GO(r,i,e,n),t);ve(s.idToken,r,"internal-error");let o=BE(s.idToken);ve(o,r,"internal-error");let{sub:a}=o;return ve(n.uid===a,r,"user-mismatch"),ra._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&eo(r,"user-mismatch"),s}})}function I9(n,e,t=!1){return g(this,null,function*(){if(vi(n.app))return Promise.reject(Js(n));let r="signIn",i=yield GO(n,r,e),s=yield ra._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function KE(n,e,t,r){return lt(n).onIdTokenChanged(e,t,r)}function YE(n,e,t){return lt(n).beforeAuthStateChanged(e,t)}function QE(n,e,t,r){return lt(n).onAuthStateChanged(e,t,r)}function XE(n){return lt(n).signOut()}var zp="__sak";var Gp=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(zp,"1"),this.storage.removeItem(zp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var A9=1e3,T9=10,C9=(()=>{class n extends Gp{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=BO(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((a,c,l)=>{this.notifyListeners(a,l)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let a=this.storage.getItem(i);!r&&this.localCache[i]===a||this.notifyListeners(i,a)},o=this.storage.getItem(i);d9()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,T9):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},A9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return g(this,null,function*(){yield Kt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return g(this,null,function*(){let r=yield Kt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return g(this,null,function*(){yield Kt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),WO=C9;var S9=(()=>{class n extends Gp{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),ZE=S9;function D9(n){return Promise.all(n.map(e=>g(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var x9=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return g(this,null,function*(){let r=t,{eventId:i,eventType:s,data:o}=r.data,a=this.handlersMap[s];if(!a?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let c=Array.from(a).map(u=>g(this,null,function*(){return u(r.origin,o)})),l=yield D9(c);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:l})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function KO(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var ME=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return g(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{let l=KO("",20);i.port1.start();let u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(d){let f=d;if(f.data.eventId===l)switch(f.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(f.data.response);break;default:clearTimeout(u),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function Ai(){return window}function R9(n){Ai().location.href=n}function YO(){return typeof Ai().WorkerGlobalScope<"u"&&typeof Ai().importScripts=="function"}function P9(){return g(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function M9(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function N9(){return YO()?self:null}var QO="firebaseLocalStorageDb",O9=1,Wp="firebaseLocalStorage",XO="fbase_key",ia=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Zp(n,e){return n.transaction([Wp],e?"readwrite":"readonly").objectStore(Wp)}function k9(){let n=indexedDB.deleteDatabase(QO);return new ia(n).toPromise()}function NE(){let n=indexedDB.open(QO,O9);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Wp,{keyPath:XO})}catch(i){t(i)}}),n.addEventListener("success",()=>g(this,null,function*(){let r=n.result;r.objectStoreNames.contains(Wp)?e(r):(r.close(),yield k9(),e(yield NE()))}))})}function _O(n,e,t){return g(this,null,function*(){let r=Zp(n,!0).put({[XO]:e,value:t});return new ia(r).toPromise()})}function L9(n,e){return g(this,null,function*(){let t=Zp(n,!1).get(e),r=yield new ia(t).toPromise();return r===void 0?null:r.value})}function vO(n,e){let t=Zp(n,!0).delete(e);return new ia(t).toPromise()}var F9=800,V9=3,j9=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return g(this,null,function*(){return this.db?this.db:(this.db=yield NE(),this.db)})}_withRetries(t){return g(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>V9)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return g(this,null,function*(){return YO()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return g(this,null,function*(){this.receiver=x9._getInstance(N9()),this.receiver._subscribe("keyChanged",(t,r)=>g(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>g(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return g(this,null,function*(){var t,r;if(this.activeServiceWorker=yield P9(),!this.activeServiceWorker)return;this.sender=new ME(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return g(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||M9()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return g(this,null,function*(){try{if(!indexedDB)return!1;let t=yield NE();return yield _O(t,zp,"1"),yield vO(t,zp),!0}catch{}return!1})}_withPendingWrite(t){return g(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(i=>_O(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return g(this,null,function*(){let r=yield this._withRetries(i=>L9(i,t));return this.localCache[t]=r,r})}_remove(t){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(r=>vO(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return g(this,null,function*(){let t=yield this._withRetries(s=>{let o=Zp(s,!1).getAll();return new ia(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>g(this,null,function*(){return this._poll()}),F9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),ZO=j9;var Khe=qO("rcb"),Yhe=new na(3e4,6e4);function $9(n,e){return e?as(e):(ve(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Bu=class extends Hp{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return bE(e,this._buildIdpRequest())}_linkToIdToken(e,t){return bE(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return bE(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function U9(n){return I9(n.auth,new Bu(n),n.bypassAuthState)}function B9(n){let{auth:e,user:t}=n;return ve(t,e,"internal-error"),E9(t,new Bu(n),n.bypassAuthState)}function H9(n){return g(this,null,function*(){let{auth:e,user:t}=n;return ve(t,e,"internal-error"),b9(t,new Bu(n),n.bypassAuthState)})}var OE=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>g(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return g(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}let c={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(c))}catch(l){this.reject(l)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return U9;case"linkViaPopup":case"linkViaRedirect":return H9;case"reauthViaPopup":case"reauthViaRedirect":return B9;default:eo(this.auth,"internal-error")}}resolve(e){to(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){to(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var Qhe=new na(2e3,1e4);var q9="pendingRedirect",Lp=new Map,kE=class n extends OE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return g(this,null,function*(){let e=Lp.get(this.auth._key());if(!e){try{let r=(yield z9(this.resolver,this.auth))?yield Kt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Lp.set(this.auth._key(),e)}return this.bypassAuthState||Lp.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return g(this,null,function*(){if(e.type==="signInViaRedirect")return Kt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Kt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return g(this,null,function*(){})}cleanUp(){}};function z9(n,e){return g(this,null,function*(){let t=K9(e),r=W9(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function G9(n,e){Lp.set(n._key(),e)}function W9(n){return as(n._redirectPersistence)}function K9(n){return kp(q9,n.config.apiKey,n.name)}function Y9(n,e,t=!1){return g(this,null,function*(){if(vi(n.app))return Promise.reject(Js(n));let r=Qp(n),i=$9(r,e),o=yield new kE(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})}var Q9=10*60*1e3,LE=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!X9(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!JO(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(ta(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Q9&&this.cachedEventUids.clear(),this.cachedEventUids.has(wO(e))}saveEventToCache(e){this.cachedEventUids.add(wO(e)),this.lastProcessedEventTime=Date.now()}};function wO(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function JO({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function X9(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return JO(n);default:return!1}}function Z9(t){return g(this,arguments,function*(n,e={}){return Lc(n,"GET","/v1/projects",e)})}var J9=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,e6=/^https?/;function t6(n){return g(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield Z9(n);for(let t of e)try{if(n6(t))return}catch{}eo(n,"unauthorized-domain")})}function n6(n){let e=IE(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!e6.test(t))return!1;if(J9.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var r6=new na(3e4,6e4);function bO(){let n=Ai().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function i6(n){return new Promise((e,t)=>{var r,i,s;function o(){bO(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{bO(),t(ta(n,"network-request-failed"))},timeout:r6.get()})}if(!((i=(r=Ai().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Ai().gapi)===null||s===void 0)&&s.load)o();else{let a=qO("iframefcb");return Ai()[a]=()=>{gapi.load?o():t(ta(n,"network-request-failed"))},m9(`${g9()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw Fp=null,e})}var Fp=null;function s6(n){return Fp=Fp||i6(n),Fp}var o6=new na(5e3,15e3),a6="__/auth/iframe",c6="emulator/auth/iframe",l6={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},u6=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function d6(n){let e=n.config;ve(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?$E(e,c6):`https://${n.config.authDomain}/${a6}`,r={apiKey:e.apiKey,appName:n.name,v:wi},i=u6.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${ku(r).slice(1)}`}function h6(n){return g(this,null,function*(){let e=yield s6(n),t=Ai().gapi;return ve(t,n,"internal-error"),e.open({where:document.body,url:d6(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:l6,dontclear:!0},r=>new Promise((i,s)=>g(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let o=ta(n,"network-request-failed"),a=Ai().setTimeout(()=>{s(o)},o6.get());function c(){Ai().clearTimeout(a),i(r)}r.ping(c).then(c,()=>{s(o)})})))})}var f6={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},p6=500,m6=600,g6="_blank",y6="http://localhost",Kp=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function _6(n,e,t,r=p6,i=m6){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),a="",c=Object.assign(Object.assign({},f6),{width:r.toString(),height:i.toString(),top:s,left:o}),l=Xt().toLowerCase();t&&(a=FO(l)?g6:t),kO(l)&&(e=e||y6,c.scrollbars="yes");let u=Object.entries(c).reduce((f,[p,y])=>`${f}${p}=${y},`,"");if(u9(l)&&a!=="_self")return v6(e||"",a),new Kp(null);let d=window.open(e||"",a,u);ve(d,n,"popup-blocked");try{d.focus()}catch{}return new Kp(d)}function v6(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var w6="__/auth/handler",b6="emulator/auth/handler",E6=encodeURIComponent("fac");function EO(n,e,t,r,i,s){return g(this,null,function*(){ve(n.config.authDomain,n,"auth-domain-config-required"),ve(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:wi,eventId:i};if(e instanceof qp){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",KN(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[u,d]of Object.entries(s||{}))o[u]=d}if(e instanceof RE){let u=e.getScopes().filter(d=>d!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);let a=o;for(let u of Object.keys(a))a[u]===void 0&&delete a[u];let c=yield n._getAppCheckToken(),l=c?`#${E6}=${encodeURIComponent(c)}`:"";return`${I6(n)}?${ku(a).slice(1)}${l}`})}function I6({config:n}){return n.emulator?$E(n,b6):`https://${n.authDomain}/${w6}`}var EE="webStorageSupport",FE=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ZE,this._completeRedirectFn=Y9,this._overrideRedirectResult=G9}_openPopup(e,t,r,i){return g(this,null,function*(){var s;to((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield EO(e,t,r,IE(),i);return _6(e,o,KO())})}_openRedirect(e,t,r,i){return g(this,null,function*(){yield this._originValidation(e);let s=yield EO(e,t,r,IE(),i);return R9(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(to(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return g(this,null,function*(){let t=yield h6(e),r=new LE(e);return t.register("authEvent",i=>(ve(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(EE,{type:EE},i=>{var s;let o=(s=i?.[0])===null||s===void 0?void 0:s[EE];o!==void 0&&t(!!o),eo(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=t6(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return BO()||LO()||qE()}},ek=FE;var IO="@firebase/auth",AO="1.7.9";var VE=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return g(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ve(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function A6(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function T6(n){wr(new _n("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ve(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:HO(n)},l=new xE(r,i,s,c);return y9(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),wr(new _n("auth-internal",e=>{let t=Qp(e.getProvider("auth").getImmediate());return(r=>new VE(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),st(IO,AO,A6(n)),st(IO,AO,"esm2017")}var C6=5*60,S6=tE("authIdTokenMaxAge")||C6,TO=null,D6=n=>e=>g(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>S6)return;let i=t?.token;TO!==i&&(TO=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function JE(n=bi()){let e=is(n,"auth");if(e.isInitialized())return e.getImmediate();let t=GE(n,{popupRedirectResolver:ek,persistence:[ZO,WO,ZE]}),r=tE("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let o=D6(s.toString());YE(t,o,()=>o(t.currentUser)),KE(t,a=>o(a))}}let i=Jb("auth");return i&&Xp(t,`http://${i}`),t}function x6(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}p9({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=ta("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",x6().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});T6("Browser");var tk="auth",Kr=class{constructor(e){return e}},cs=class{constructor(){return ss(tk)}};var e0=new de("angularfire2.auth-instances");function w8(n,e){let t=Xs(tk,n,e);return t&&new Kr(t)}function b8(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Kr(r)}}var E8={provide:cs,deps:[[new gt,e0]]},I8={provide:Kr,useFactory:w8,deps:[[new gt,e0],ar]};function nk(n,...e){return st("angularfire",Gr.full,"auth"),Wn([I8,E8,{provide:e0,useFactory:b8(n),multi:!0,deps:[et,yn,Ii,Wr,[new gt,Ei],...e]}])}var rk=ot(Xp,!0);var ik=ot(JE,!0);var sk=ot(QE,!0);var ok=ot(WE,!0);var ak=ot(XE,!0);var ck=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},lk={};var no,n0;(function(){var n;function e(T,A){function C(){}C.prototype=A.prototype,T.D=A.prototype,T.prototype=new C,T.prototype.constructor=T,T.C=function(R,M,O){for(var S=Array(arguments.length-2),Pe=2;Pe<arguments.length;Pe++)S[Pe-2]=arguments[Pe];return A.prototype[M].apply(R,S)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,A,C){C||(C=0);var R=Array(16);if(typeof A=="string")for(var M=0;16>M;++M)R[M]=A.charCodeAt(C++)|A.charCodeAt(C++)<<8|A.charCodeAt(C++)<<16|A.charCodeAt(C++)<<24;else for(M=0;16>M;++M)R[M]=A[C++]|A[C++]<<8|A[C++]<<16|A[C++]<<24;A=T.g[0],C=T.g[1],M=T.g[2];var O=T.g[3],S=A+(O^C&(M^O))+R[0]+3614090360&4294967295;A=C+(S<<7&4294967295|S>>>25),S=O+(M^A&(C^M))+R[1]+3905402710&4294967295,O=A+(S<<12&4294967295|S>>>20),S=M+(C^O&(A^C))+R[2]+606105819&4294967295,M=O+(S<<17&4294967295|S>>>15),S=C+(A^M&(O^A))+R[3]+3250441966&4294967295,C=M+(S<<22&4294967295|S>>>10),S=A+(O^C&(M^O))+R[4]+4118548399&4294967295,A=C+(S<<7&4294967295|S>>>25),S=O+(M^A&(C^M))+R[5]+1200080426&4294967295,O=A+(S<<12&4294967295|S>>>20),S=M+(C^O&(A^C))+R[6]+2821735955&4294967295,M=O+(S<<17&4294967295|S>>>15),S=C+(A^M&(O^A))+R[7]+4249261313&4294967295,C=M+(S<<22&4294967295|S>>>10),S=A+(O^C&(M^O))+R[8]+1770035416&4294967295,A=C+(S<<7&4294967295|S>>>25),S=O+(M^A&(C^M))+R[9]+2336552879&4294967295,O=A+(S<<12&4294967295|S>>>20),S=M+(C^O&(A^C))+R[10]+4294925233&4294967295,M=O+(S<<17&4294967295|S>>>15),S=C+(A^M&(O^A))+R[11]+2304563134&4294967295,C=M+(S<<22&4294967295|S>>>10),S=A+(O^C&(M^O))+R[12]+1804603682&4294967295,A=C+(S<<7&4294967295|S>>>25),S=O+(M^A&(C^M))+R[13]+4254626195&4294967295,O=A+(S<<12&4294967295|S>>>20),S=M+(C^O&(A^C))+R[14]+2792965006&4294967295,M=O+(S<<17&4294967295|S>>>15),S=C+(A^M&(O^A))+R[15]+1236535329&4294967295,C=M+(S<<22&4294967295|S>>>10),S=A+(M^O&(C^M))+R[1]+4129170786&4294967295,A=C+(S<<5&4294967295|S>>>27),S=O+(C^M&(A^C))+R[6]+3225465664&4294967295,O=A+(S<<9&4294967295|S>>>23),S=M+(A^C&(O^A))+R[11]+643717713&4294967295,M=O+(S<<14&4294967295|S>>>18),S=C+(O^A&(M^O))+R[0]+3921069994&4294967295,C=M+(S<<20&4294967295|S>>>12),S=A+(M^O&(C^M))+R[5]+3593408605&4294967295,A=C+(S<<5&4294967295|S>>>27),S=O+(C^M&(A^C))+R[10]+38016083&4294967295,O=A+(S<<9&4294967295|S>>>23),S=M+(A^C&(O^A))+R[15]+3634488961&4294967295,M=O+(S<<14&4294967295|S>>>18),S=C+(O^A&(M^O))+R[4]+3889429448&4294967295,C=M+(S<<20&4294967295|S>>>12),S=A+(M^O&(C^M))+R[9]+568446438&4294967295,A=C+(S<<5&4294967295|S>>>27),S=O+(C^M&(A^C))+R[14]+3275163606&4294967295,O=A+(S<<9&4294967295|S>>>23),S=M+(A^C&(O^A))+R[3]+4107603335&4294967295,M=O+(S<<14&4294967295|S>>>18),S=C+(O^A&(M^O))+R[8]+1163531501&4294967295,C=M+(S<<20&4294967295|S>>>12),S=A+(M^O&(C^M))+R[13]+2850285829&4294967295,A=C+(S<<5&4294967295|S>>>27),S=O+(C^M&(A^C))+R[2]+4243563512&4294967295,O=A+(S<<9&4294967295|S>>>23),S=M+(A^C&(O^A))+R[7]+1735328473&4294967295,M=O+(S<<14&4294967295|S>>>18),S=C+(O^A&(M^O))+R[12]+2368359562&4294967295,C=M+(S<<20&4294967295|S>>>12),S=A+(C^M^O)+R[5]+4294588738&4294967295,A=C+(S<<4&4294967295|S>>>28),S=O+(A^C^M)+R[8]+2272392833&4294967295,O=A+(S<<11&4294967295|S>>>21),S=M+(O^A^C)+R[11]+1839030562&4294967295,M=O+(S<<16&4294967295|S>>>16),S=C+(M^O^A)+R[14]+4259657740&4294967295,C=M+(S<<23&4294967295|S>>>9),S=A+(C^M^O)+R[1]+2763975236&4294967295,A=C+(S<<4&4294967295|S>>>28),S=O+(A^C^M)+R[4]+1272893353&4294967295,O=A+(S<<11&4294967295|S>>>21),S=M+(O^A^C)+R[7]+4139469664&4294967295,M=O+(S<<16&4294967295|S>>>16),S=C+(M^O^A)+R[10]+3200236656&4294967295,C=M+(S<<23&4294967295|S>>>9),S=A+(C^M^O)+R[13]+681279174&4294967295,A=C+(S<<4&4294967295|S>>>28),S=O+(A^C^M)+R[0]+3936430074&4294967295,O=A+(S<<11&4294967295|S>>>21),S=M+(O^A^C)+R[3]+3572445317&4294967295,M=O+(S<<16&4294967295|S>>>16),S=C+(M^O^A)+R[6]+76029189&4294967295,C=M+(S<<23&4294967295|S>>>9),S=A+(C^M^O)+R[9]+3654602809&4294967295,A=C+(S<<4&4294967295|S>>>28),S=O+(A^C^M)+R[12]+3873151461&4294967295,O=A+(S<<11&4294967295|S>>>21),S=M+(O^A^C)+R[15]+530742520&4294967295,M=O+(S<<16&4294967295|S>>>16),S=C+(M^O^A)+R[2]+3299628645&4294967295,C=M+(S<<23&4294967295|S>>>9),S=A+(M^(C|~O))+R[0]+4096336452&4294967295,A=C+(S<<6&4294967295|S>>>26),S=O+(C^(A|~M))+R[7]+1126891415&4294967295,O=A+(S<<10&4294967295|S>>>22),S=M+(A^(O|~C))+R[14]+2878612391&4294967295,M=O+(S<<15&4294967295|S>>>17),S=C+(O^(M|~A))+R[5]+4237533241&4294967295,C=M+(S<<21&4294967295|S>>>11),S=A+(M^(C|~O))+R[12]+1700485571&4294967295,A=C+(S<<6&4294967295|S>>>26),S=O+(C^(A|~M))+R[3]+2399980690&4294967295,O=A+(S<<10&4294967295|S>>>22),S=M+(A^(O|~C))+R[10]+4293915773&4294967295,M=O+(S<<15&4294967295|S>>>17),S=C+(O^(M|~A))+R[1]+2240044497&4294967295,C=M+(S<<21&4294967295|S>>>11),S=A+(M^(C|~O))+R[8]+1873313359&4294967295,A=C+(S<<6&4294967295|S>>>26),S=O+(C^(A|~M))+R[15]+4264355552&4294967295,O=A+(S<<10&4294967295|S>>>22),S=M+(A^(O|~C))+R[6]+2734768916&4294967295,M=O+(S<<15&4294967295|S>>>17),S=C+(O^(M|~A))+R[13]+1309151649&4294967295,C=M+(S<<21&4294967295|S>>>11),S=A+(M^(C|~O))+R[4]+4149444226&4294967295,A=C+(S<<6&4294967295|S>>>26),S=O+(C^(A|~M))+R[11]+3174756917&4294967295,O=A+(S<<10&4294967295|S>>>22),S=M+(A^(O|~C))+R[2]+718787259&4294967295,M=O+(S<<15&4294967295|S>>>17),S=C+(O^(M|~A))+R[9]+3951481745&4294967295,T.g[0]=T.g[0]+A&4294967295,T.g[1]=T.g[1]+(M+(S<<21&4294967295|S>>>11))&4294967295,T.g[2]=T.g[2]+M&4294967295,T.g[3]=T.g[3]+O&4294967295}r.prototype.u=function(T,A){A===void 0&&(A=T.length);for(var C=A-this.blockSize,R=this.B,M=this.h,O=0;O<A;){if(M==0)for(;O<=C;)i(this,T,O),O+=this.blockSize;if(typeof T=="string"){for(;O<A;)if(R[M++]=T.charCodeAt(O++),M==this.blockSize){i(this,R),M=0;break}}else for(;O<A;)if(R[M++]=T[O++],M==this.blockSize){i(this,R),M=0;break}}this.h=M,this.o+=A},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var A=1;A<T.length-8;++A)T[A]=0;var C=8*this.o;for(A=T.length-8;A<T.length;++A)T[A]=C&255,C/=256;for(this.u(T),T=Array(16),A=C=0;4>A;++A)for(var R=0;32>R;R+=8)T[C++]=this.g[A]>>>R&255;return T};function s(T,A){var C=a;return Object.prototype.hasOwnProperty.call(C,T)?C[T]:C[T]=A(T)}function o(T,A){this.h=A;for(var C=[],R=!0,M=T.length-1;0<=M;M--){var O=T[M]|0;R&&O==A||(C[M]=O,R=!1)}this.g=C}var a={};function c(T){return-128<=T&&128>T?s(T,function(A){return new o([A|0],0>A?-1:0)}):new o([T|0],0>T?-1:0)}function l(T){if(isNaN(T)||!isFinite(T))return d;if(0>T)return b(l(-T));for(var A=[],C=1,R=0;T>=C;R++)A[R]=T/C|0,C*=4294967296;return new o(A,0)}function u(T,A){if(T.length==0)throw Error("number format error: empty string");if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(T.charAt(0)=="-")return b(u(T.substring(1),A));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var C=l(Math.pow(A,8)),R=d,M=0;M<T.length;M+=8){var O=Math.min(8,T.length-M),S=parseInt(T.substring(M,M+O),A);8>O?(O=l(Math.pow(A,O)),R=R.j(O).add(l(S))):(R=R.j(C),R=R.add(l(S)))}return R}var d=c(0),f=c(1),p=c(16777216);n=o.prototype,n.m=function(){if(w(this))return-b(this).m();for(var T=0,A=1,C=0;C<this.g.length;C++){var R=this.i(C);T+=(0<=R?R:4294967296+R)*A,A*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(y(this))return"0";if(w(this))return"-"+b(this).toString(T);for(var A=l(Math.pow(T,6)),C=this,R="";;){var M=N(C,A).g;C=E(C,M.j(A));var O=((0<C.g.length?C.g[0]:C.h)>>>0).toString(T);if(C=M,y(C))return O+R;for(;6>O.length;)O="0"+O;R=O+R}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function y(T){if(T.h!=0)return!1;for(var A=0;A<T.g.length;A++)if(T.g[A]!=0)return!1;return!0}function w(T){return T.h==-1}n.l=function(T){return T=E(this,T),w(T)?-1:y(T)?0:1};function b(T){for(var A=T.g.length,C=[],R=0;R<A;R++)C[R]=~T.g[R];return new o(C,~T.h).add(f)}n.abs=function(){return w(this)?b(this):this},n.add=function(T){for(var A=Math.max(this.g.length,T.g.length),C=[],R=0,M=0;M<=A;M++){var O=R+(this.i(M)&65535)+(T.i(M)&65535),S=(O>>>16)+(this.i(M)>>>16)+(T.i(M)>>>16);R=S>>>16,O&=65535,S&=65535,C[M]=S<<16|O}return new o(C,C[C.length-1]&-2147483648?-1:0)};function E(T,A){return T.add(b(A))}n.j=function(T){if(y(this)||y(T))return d;if(w(this))return w(T)?b(this).j(b(T)):b(b(this).j(T));if(w(T))return b(this.j(b(T)));if(0>this.l(p)&&0>T.l(p))return l(this.m()*T.m());for(var A=this.g.length+T.g.length,C=[],R=0;R<2*A;R++)C[R]=0;for(R=0;R<this.g.length;R++)for(var M=0;M<T.g.length;M++){var O=this.i(R)>>>16,S=this.i(R)&65535,Pe=T.i(M)>>>16,Nt=T.i(M)&65535;C[2*R+2*M]+=S*Nt,D(C,2*R+2*M),C[2*R+2*M+1]+=O*Nt,D(C,2*R+2*M+1),C[2*R+2*M+1]+=S*Pe,D(C,2*R+2*M+1),C[2*R+2*M+2]+=O*Pe,D(C,2*R+2*M+2)}for(R=0;R<A;R++)C[R]=C[2*R+1]<<16|C[2*R];for(R=A;R<2*A;R++)C[R]=0;return new o(C,0)};function D(T,A){for(;(T[A]&65535)!=T[A];)T[A+1]+=T[A]>>>16,T[A]&=65535,A++}function x(T,A){this.g=T,this.h=A}function N(T,A){if(y(A))throw Error("division by zero");if(y(T))return new x(d,d);if(w(T))return A=N(b(T),A),new x(b(A.g),b(A.h));if(w(A))return A=N(T,b(A)),new x(b(A.g),A.h);if(30<T.g.length){if(w(T)||w(A))throw Error("slowDivide_ only works with positive integers.");for(var C=f,R=A;0>=R.l(T);)C=L(C),R=L(R);var M=F(C,1),O=F(R,1);for(R=F(R,2),C=F(C,2);!y(R);){var S=O.add(R);0>=S.l(T)&&(M=M.add(C),O=S),R=F(R,1),C=F(C,1)}return A=E(T,M.j(A)),new x(M,A)}for(M=d;0<=T.l(A);){for(C=Math.max(1,Math.floor(T.m()/A.m())),R=Math.ceil(Math.log(C)/Math.LN2),R=48>=R?1:Math.pow(2,R-48),O=l(C),S=O.j(A);w(S)||0<S.l(T);)C-=R,O=l(C),S=O.j(A);y(O)&&(O=f),M=M.add(O),T=E(T,S)}return new x(M,T)}n.A=function(T){return N(this,T).h},n.and=function(T){for(var A=Math.max(this.g.length,T.g.length),C=[],R=0;R<A;R++)C[R]=this.i(R)&T.i(R);return new o(C,this.h&T.h)},n.or=function(T){for(var A=Math.max(this.g.length,T.g.length),C=[],R=0;R<A;R++)C[R]=this.i(R)|T.i(R);return new o(C,this.h|T.h)},n.xor=function(T){for(var A=Math.max(this.g.length,T.g.length),C=[],R=0;R<A;R++)C[R]=this.i(R)^T.i(R);return new o(C,this.h^T.h)};function L(T){for(var A=T.g.length+1,C=[],R=0;R<A;R++)C[R]=T.i(R)<<1|T.i(R-1)>>>31;return new o(C,T.h)}function F(T,A){var C=A>>5;A%=32;for(var R=T.g.length-C,M=[],O=0;O<R;O++)M[O]=0<A?T.i(O+C)>>>A|T.i(O+C+1)<<32-A:T.i(O+C);return new o(M,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,n0=lk.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=u,no=lk.Integer=o}).apply(typeof ck<"u"?ck:typeof self<"u"?self:typeof window<"u"?window:{});var Jp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ls={};var r0,A8,Fc,i0,Hu,em,s0,o0,a0;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(h,m,v){return h==Array.prototype||h==Object.prototype||(h[m]=v.value),h};function t(h){h=[typeof globalThis=="object"&&globalThis,h,typeof window=="object"&&window,typeof self=="object"&&self,typeof Jp=="object"&&Jp];for(var m=0;m<h.length;++m){var v=h[m];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function i(h,m){if(m)e:{var v=r;h=h.split(".");for(var I=0;I<h.length-1;I++){var k=h[I];if(!(k in v))break e;v=v[k]}h=h[h.length-1],I=v[h],m=m(I),m!=I&&m!=null&&e(v,h,{configurable:!0,writable:!0,value:m})}}function s(h,m){h instanceof String&&(h+="");var v=0,I=!1,k={next:function(){if(!I&&v<h.length){var V=v++;return{value:m(V,h[V]),done:!1}}return I=!0,{done:!0,value:void 0}}};return k[Symbol.iterator]=function(){return k},k}i("Array.prototype.values",function(h){return h||function(){return s(this,function(m,v){return v})}});var o=o||{},a=this||self;function c(h){var m=typeof h;return m=m!="object"?m:h?Array.isArray(h)?"array":m:"null",m=="array"||m=="object"&&typeof h.length=="number"}function l(h){var m=typeof h;return m=="object"&&h!=null||m=="function"}function u(h,m,v){return h.call.apply(h.bind,arguments)}function d(h,m,v){if(!h)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var k=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(k,I),h.apply(m,k)}}return function(){return h.apply(m,arguments)}}function f(h,m,v){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?u:d,f.apply(null,arguments)}function p(h,m){var v=Array.prototype.slice.call(arguments,1);return function(){var I=v.slice();return I.push.apply(I,arguments),h.apply(this,I)}}function y(h,m){function v(){}v.prototype=m.prototype,h.aa=m.prototype,h.prototype=new v,h.prototype.constructor=h,h.Qb=function(I,k,V){for(var q=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)q[dt-2]=arguments[dt];return m.prototype[k].apply(I,q)}}function w(h){let m=h.length;if(0<m){let v=Array(m);for(let I=0;I<m;I++)v[I]=h[I];return v}return[]}function b(h,m){for(let v=1;v<arguments.length;v++){let I=arguments[v];if(c(I)){let k=h.length||0,V=I.length||0;h.length=k+V;for(let q=0;q<V;q++)h[k+q]=I[q]}else h.push(I)}}class E{constructor(m,v){this.i=m,this.j=v,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}function D(h){return/^[\s\xa0]*$/.test(h)}function x(){var h=a.navigator;return h&&(h=h.userAgent)?h:""}function N(h){return N[" "](h),h}N[" "]=function(){};var L=x().indexOf("Gecko")!=-1&&!(x().toLowerCase().indexOf("webkit")!=-1&&x().indexOf("Edge")==-1)&&!(x().indexOf("Trident")!=-1||x().indexOf("MSIE")!=-1)&&x().indexOf("Edge")==-1;function F(h,m,v){for(let I in h)m.call(v,h[I],I,h)}function T(h,m){for(let v in h)m.call(void 0,h[v],v,h)}function A(h){let m={};for(let v in h)m[v]=h[v];return m}let C="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(h,m){let v,I;for(let k=1;k<arguments.length;k++){I=arguments[k];for(v in I)h[v]=I[v];for(let V=0;V<C.length;V++)v=C[V],Object.prototype.hasOwnProperty.call(I,v)&&(h[v]=I[v])}}function M(h){var m=1;h=h.split(":");let v=[];for(;0<m&&h.length;)v.push(h.shift()),m--;return h.length&&v.push(h.join(":")),v}function O(h){a.setTimeout(()=>{throw h},0)}function S(){var h=Un;let m=null;return h.g&&(m=h.g,h.g=h.g.next,h.g||(h.h=null),m.next=null),m}class Pe{constructor(){this.h=this.g=null}add(m,v){let I=Nt.get();I.set(m,v),this.h?this.h.next=I:this.g=I,this.h=I}}var Nt=new E(()=>new ee,h=>h.reset());class ee{constructor(){this.next=this.g=this.h=null}set(m,v){this.h=m,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let J,Wt=!1,Un=new Pe,oi=()=>{let h=a.Promise.resolve(void 0);J=()=>{h.then(Bn)}};var Bn=()=>{for(var h;h=S();){try{h.h.call(h.g)}catch(v){O(v)}var m=Nt;m.j(h),100>m.h&&(m.h++,h.next=m.g,m.g=h)}Wt=!1};function ut(){this.s=this.s,this.C=this.C}ut.prototype.s=!1,ut.prototype.ma=function(){this.s||(this.s=!0,this.N())},ut.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ve(h,m){this.type=h,this.g=this.target=m,this.defaultPrevented=!1}Ve.prototype.h=function(){this.defaultPrevented=!0};var Cs=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var h=!1,m=Object.defineProperty({},"passive",{get:function(){h=!0}});try{let v=()=>{};a.addEventListener("test",v,m),a.removeEventListener("test",v,m)}catch{}return h}();function Mr(h,m){if(Ve.call(this,h?h.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,h){var v=this.type=h.type,I=h.changedTouches&&h.changedTouches.length?h.changedTouches[0]:null;if(this.target=h.target||h.srcElement,this.g=m,m=h.relatedTarget){if(L){e:{try{N(m.nodeName);var k=!0;break e}catch{}k=!1}k||(m=null)}}else v=="mouseover"?m=h.fromElement:v=="mouseout"&&(m=h.toElement);this.relatedTarget=m,I?(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=h.clientX!==void 0?h.clientX:h.pageX,this.clientY=h.clientY!==void 0?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0),this.button=h.button,this.key=h.key||"",this.ctrlKey=h.ctrlKey,this.altKey=h.altKey,this.shiftKey=h.shiftKey,this.metaKey=h.metaKey,this.pointerId=h.pointerId||0,this.pointerType=typeof h.pointerType=="string"?h.pointerType:Hn[h.pointerType]||"",this.state=h.state,this.i=h,h.defaultPrevented&&Mr.aa.h.call(this)}}y(Mr,Ve);var Hn={2:"touch",3:"pen",4:"mouse"};Mr.prototype.h=function(){Mr.aa.h.call(this);var h=this.i;h.preventDefault?h.preventDefault():h.returnValue=!1};var rt="closure_listenable_"+(1e6*Math.random()|0),fr=0;function _h(h,m,v,I,k){this.listener=h,this.proxy=null,this.src=m,this.type=v,this.capture=!!I,this.ha=k,this.key=++fr,this.da=this.fa=!1}function $a(h){h.da=!0,h.listener=null,h.proxy=null,h.src=null,h.ha=null}function vh(h){this.src=h,this.g={},this.h=0}vh.prototype.add=function(h,m,v,I,k){var V=h.toString();h=this.g[V],h||(h=this.g[V]=[],this.h++);var q=c_(h,m,I,k);return-1<q?(m=h[q],v||(m.fa=!1)):(m=new _h(m,this.src,V,!!I,k),m.fa=v,h.push(m)),m};function a_(h,m){var v=m.type;if(v in h.g){var I=h.g[v],k=Array.prototype.indexOf.call(I,m,void 0),V;(V=0<=k)&&Array.prototype.splice.call(I,k,1),V&&($a(m),h.g[v].length==0&&(delete h.g[v],h.h--))}}function c_(h,m,v,I){for(var k=0;k<h.length;++k){var V=h[k];if(!V.da&&V.listener==m&&V.capture==!!v&&V.ha==I)return k}return-1}var l_="closure_lm_"+(1e6*Math.random()|0),u_={};function oD(h,m,v,I,k){if(I&&I.once)return cD(h,m,v,I,k);if(Array.isArray(m)){for(var V=0;V<m.length;V++)oD(h,m[V],v,I,k);return null}return v=p_(v),h&&h[rt]?h.K(m,v,l(I)?!!I.capture:!!I,k):aD(h,m,v,!1,I,k)}function aD(h,m,v,I,k,V){if(!m)throw Error("Invalid event type");var q=l(k)?!!k.capture:!!k,dt=h_(h);if(dt||(h[l_]=dt=new vh(h)),v=dt.add(m,v,I,q,V),v.proxy)return v;if(I=tU(),v.proxy=I,I.src=h,I.listener=v,h.addEventListener)Cs||(k=q),k===void 0&&(k=!1),h.addEventListener(m.toString(),I,k);else if(h.attachEvent)h.attachEvent(uD(m.toString()),I);else if(h.addListener&&h.removeListener)h.addListener(I);else throw Error("addEventListener and attachEvent are unavailable.");return v}function tU(){function h(v){return m.call(h.src,h.listener,v)}let m=nU;return h}function cD(h,m,v,I,k){if(Array.isArray(m)){for(var V=0;V<m.length;V++)cD(h,m[V],v,I,k);return null}return v=p_(v),h&&h[rt]?h.L(m,v,l(I)?!!I.capture:!!I,k):aD(h,m,v,!0,I,k)}function lD(h,m,v,I,k){if(Array.isArray(m))for(var V=0;V<m.length;V++)lD(h,m[V],v,I,k);else I=l(I)?!!I.capture:!!I,v=p_(v),h&&h[rt]?(h=h.i,m=String(m).toString(),m in h.g&&(V=h.g[m],v=c_(V,v,I,k),-1<v&&($a(V[v]),Array.prototype.splice.call(V,v,1),V.length==0&&(delete h.g[m],h.h--)))):h&&(h=h_(h))&&(m=h.g[m.toString()],h=-1,m&&(h=c_(m,v,I,k)),(v=-1<h?m[h]:null)&&d_(v))}function d_(h){if(typeof h!="number"&&h&&!h.da){var m=h.src;if(m&&m[rt])a_(m.i,h);else{var v=h.type,I=h.proxy;m.removeEventListener?m.removeEventListener(v,I,h.capture):m.detachEvent?m.detachEvent(uD(v),I):m.addListener&&m.removeListener&&m.removeListener(I),(v=h_(m))?(a_(v,h),v.h==0&&(v.src=null,m[l_]=null)):$a(h)}}}function uD(h){return h in u_?u_[h]:u_[h]="on"+h}function nU(h,m){if(h.da)h=!0;else{m=new Mr(m,this);var v=h.listener,I=h.ha||h.src;h.fa&&d_(h),h=v.call(I,m)}return h}function h_(h){return h=h[l_],h instanceof vh?h:null}var f_="__closure_events_fn_"+(1e9*Math.random()>>>0);function p_(h){return typeof h=="function"?h:(h[f_]||(h[f_]=function(m){return h.handleEvent(m)}),h[f_])}function fn(){ut.call(this),this.i=new vh(this),this.M=this,this.F=null}y(fn,ut),fn.prototype[rt]=!0,fn.prototype.removeEventListener=function(h,m,v,I){lD(this,h,m,v,I)};function xn(h,m){var v,I=h.F;if(I)for(v=[];I;I=I.F)v.push(I);if(h=h.M,I=m.type||m,typeof m=="string")m=new Ve(m,h);else if(m instanceof Ve)m.target=m.target||h;else{var k=m;m=new Ve(I,h),R(m,k)}if(k=!0,v)for(var V=v.length-1;0<=V;V--){var q=m.g=v[V];k=wh(q,I,!0,m)&&k}if(q=m.g=h,k=wh(q,I,!0,m)&&k,k=wh(q,I,!1,m)&&k,v)for(V=0;V<v.length;V++)q=m.g=v[V],k=wh(q,I,!1,m)&&k}fn.prototype.N=function(){if(fn.aa.N.call(this),this.i){var h=this.i,m;for(m in h.g){for(var v=h.g[m],I=0;I<v.length;I++)$a(v[I]);delete h.g[m],h.h--}}this.F=null},fn.prototype.K=function(h,m,v,I){return this.i.add(String(h),m,!1,v,I)},fn.prototype.L=function(h,m,v,I){return this.i.add(String(h),m,!0,v,I)};function wh(h,m,v,I){if(m=h.i.g[String(m)],!m)return!0;m=m.concat();for(var k=!0,V=0;V<m.length;++V){var q=m[V];if(q&&!q.da&&q.capture==v){var dt=q.listener,tn=q.ha||q.src;q.fa&&a_(h.i,q),k=dt.call(tn,I)!==!1&&k}}return k&&!I.defaultPrevented}function dD(h,m,v){if(typeof h=="function")v&&(h=f(h,v));else if(h&&typeof h.handleEvent=="function")h=f(h.handleEvent,h);else throw Error("Invalid listener argument");return 2147483647<Number(m)?-1:a.setTimeout(h,m||0)}function hD(h){h.g=dD(()=>{h.g=null,h.i&&(h.i=!1,hD(h))},h.l);let m=h.h;h.h=null,h.m.apply(null,m)}class rU extends ut{constructor(m,v){super(),this.m=m,this.l=v,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:hD(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Rl(h){ut.call(this),this.h=h,this.g={}}y(Rl,ut);var fD=[];function pD(h){F(h.g,function(m,v){this.g.hasOwnProperty(v)&&d_(m)},h),h.g={}}Rl.prototype.N=function(){Rl.aa.N.call(this),pD(this)},Rl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var m_=a.JSON.stringify,iU=a.JSON.parse,sU=class{stringify(h){return a.JSON.stringify(h,void 0)}parse(h){return a.JSON.parse(h,void 0)}};function g_(){}g_.prototype.h=null;function mD(h){return h.h||(h.h=h.i())}function gD(){}var Pl={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function y_(){Ve.call(this,"d")}y(y_,Ve);function __(){Ve.call(this,"c")}y(__,Ve);var Eo={},yD=null;function bh(){return yD=yD||new fn}Eo.La="serverreachability";function _D(h){Ve.call(this,Eo.La,h)}y(_D,Ve);function Ml(h){let m=bh();xn(m,new _D(m))}Eo.STAT_EVENT="statevent";function vD(h,m){Ve.call(this,Eo.STAT_EVENT,h),this.stat=m}y(vD,Ve);function Rn(h){let m=bh();xn(m,new vD(m,h))}Eo.Ma="timingevent";function wD(h,m){Ve.call(this,Eo.Ma,h),this.size=m}y(wD,Ve);function Nl(h,m){if(typeof h!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){h()},m)}function Ol(){this.g=!0}Ol.prototype.xa=function(){this.g=!1};function oU(h,m,v,I,k,V){h.info(function(){if(h.g)if(V)for(var q="",dt=V.split("&"),tn=0;tn<dt.length;tn++){var Je=dt[tn].split("=");if(1<Je.length){var pn=Je[0];Je=Je[1];var mn=pn.split("_");q=2<=mn.length&&mn[1]=="type"?q+(pn+"="+Je+"&"):q+(pn+"=redacted&")}}else q=null;else q=V;return"XMLHTTP REQ ("+I+") [attempt "+k+"]: "+m+`
`+v+`
`+q})}function aU(h,m,v,I,k,V,q){h.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+k+"]: "+m+`
`+v+`
`+V+" "+q})}function Ua(h,m,v,I){h.info(function(){return"XMLHTTP TEXT ("+m+"): "+lU(h,v)+(I?" "+I:"")})}function cU(h,m){h.info(function(){return"TIMEOUT: "+m})}Ol.prototype.info=function(){};function lU(h,m){if(!h.g)return m;if(!m)return null;try{var v=JSON.parse(m);if(v){for(h=0;h<v.length;h++)if(Array.isArray(v[h])){var I=v[h];if(!(2>I.length)){var k=I[1];if(Array.isArray(k)&&!(1>k.length)){var V=k[0];if(V!="noop"&&V!="stop"&&V!="close")for(var q=1;q<k.length;q++)k[q]=""}}}}return m_(v)}catch{return m}}var Eh={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},bD={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},v_;function Ih(){}y(Ih,g_),Ih.prototype.g=function(){return new XMLHttpRequest},Ih.prototype.i=function(){return{}},v_=new Ih;function Ss(h,m,v,I){this.j=h,this.i=m,this.l=v,this.R=I||1,this.U=new Rl(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ED}function ED(){this.i=null,this.g="",this.h=!1}var ID={},w_={};function b_(h,m,v){h.L=1,h.v=Sh(qi(m)),h.m=v,h.P=!0,AD(h,null)}function AD(h,m){h.F=Date.now(),Ah(h),h.A=qi(h.v);var v=h.A,I=h.R;Array.isArray(I)||(I=[String(I)]),VD(v.i,"t",I),h.C=0,v=h.j.J,h.h=new ED,h.g=nx(h.j,v?m:null,!h.m),0<h.O&&(h.M=new rU(f(h.Y,h,h.g),h.O)),m=h.U,v=h.g,I=h.ca;var k="readystatechange";Array.isArray(k)||(k&&(fD[0]=k.toString()),k=fD);for(var V=0;V<k.length;V++){var q=oD(v,k[V],I||m.handleEvent,!1,m.h||m);if(!q)break;m.g[q.key]=q}m=h.H?A(h.H):{},h.m?(h.u||(h.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",h.g.ea(h.A,h.u,h.m,m)):(h.u="GET",h.g.ea(h.A,h.u,null,m)),Ml(),oU(h.i,h.u,h.A,h.l,h.R,h.m)}Ss.prototype.ca=function(h){h=h.target;let m=this.M;m&&zi(h)==3?m.j():this.Y(h)},Ss.prototype.Y=function(h){try{if(h==this.g)e:{let mn=zi(this.g);var m=this.g.Ba();let qa=this.g.Z();if(!(3>mn)&&(mn!=3||this.g&&(this.h.h||this.g.oa()||zD(this.g)))){this.J||mn!=4||m==7||(m==8||0>=qa?Ml(3):Ml(2)),E_(this);var v=this.g.Z();this.X=v;t:if(TD(this)){var I=zD(this.g);h="";var k=I.length,V=zi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Io(this),kl(this);var q="";break t}this.h.i=new a.TextDecoder}for(m=0;m<k;m++)this.h.h=!0,h+=this.h.i.decode(I[m],{stream:!(V&&m==k-1)});I.length=0,this.h.g+=h,this.C=0,q=this.h.g}else q=this.g.oa();if(this.o=v==200,aU(this.i,this.u,this.A,this.l,this.R,mn,v),this.o){if(this.T&&!this.K){t:{if(this.g){var dt,tn=this.g;if((dt=tn.g?tn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(dt)){var Je=dt;break t}}Je=null}if(v=Je)Ua(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,I_(this,v);else{this.o=!1,this.s=3,Rn(12),Io(this),kl(this);break e}}if(this.P){v=!0;let Nr;for(;!this.J&&this.C<q.length;)if(Nr=uU(this,q),Nr==w_){mn==4&&(this.s=4,Rn(14),v=!1),Ua(this.i,this.l,null,"[Incomplete Response]");break}else if(Nr==ID){this.s=4,Rn(15),Ua(this.i,this.l,q,"[Invalid Chunk]"),v=!1;break}else Ua(this.i,this.l,Nr,null),I_(this,Nr);if(TD(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),mn!=4||q.length!=0||this.h.h||(this.s=1,Rn(16),v=!1),this.o=this.o&&v,!v)Ua(this.i,this.l,q,"[Invalid Chunked Response]"),Io(this),kl(this);else if(0<q.length&&!this.W){this.W=!0;var pn=this.j;pn.g==this&&pn.ba&&!pn.M&&(pn.j.info("Great, no buffering proxy detected. Bytes received: "+q.length),x_(pn),pn.M=!0,Rn(11))}}else Ua(this.i,this.l,q,null),I_(this,q);mn==4&&Io(this),this.o&&!this.J&&(mn==4?ZD(this.j,this):(this.o=!1,Ah(this)))}else SU(this.g),v==400&&0<q.indexOf("Unknown SID")?(this.s=3,Rn(12)):(this.s=0,Rn(13)),Io(this),kl(this)}}}catch{}finally{}};function TD(h){return h.g?h.u=="GET"&&h.L!=2&&h.j.Ca:!1}function uU(h,m){var v=h.C,I=m.indexOf(`
`,v);return I==-1?w_:(v=Number(m.substring(v,I)),isNaN(v)?ID:(I+=1,I+v>m.length?w_:(m=m.slice(I,I+v),h.C=I+v,m)))}Ss.prototype.cancel=function(){this.J=!0,Io(this)};function Ah(h){h.S=Date.now()+h.I,CD(h,h.I)}function CD(h,m){if(h.B!=null)throw Error("WatchDog timer not null");h.B=Nl(f(h.ba,h),m)}function E_(h){h.B&&(a.clearTimeout(h.B),h.B=null)}Ss.prototype.ba=function(){this.B=null;let h=Date.now();0<=h-this.S?(cU(this.i,this.A),this.L!=2&&(Ml(),Rn(17)),Io(this),this.s=2,kl(this)):CD(this,this.S-h)};function kl(h){h.j.G==0||h.J||ZD(h.j,h)}function Io(h){E_(h);var m=h.M;m&&typeof m.ma=="function"&&m.ma(),h.M=null,pD(h.U),h.g&&(m=h.g,h.g=null,m.abort(),m.ma())}function I_(h,m){try{var v=h.j;if(v.G!=0&&(v.g==h||A_(v.h,h))){if(!h.K&&A_(v.h,h)&&v.G==3){try{var I=v.Da.g.parse(m)}catch{I=null}if(Array.isArray(I)&&I.length==3){var k=I;if(k[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<h.F)Mh(v),Rh(v);else break e;D_(v),Rn(18)}}else v.za=k[1],0<v.za-v.T&&37500>k[2]&&v.F&&v.v==0&&!v.C&&(v.C=Nl(f(v.Za,v),6e3));if(1>=xD(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else To(v,11)}else if((h.K||v.g==h)&&Mh(v),!D(m))for(k=v.Da.g.parse(m),m=0;m<k.length;m++){let Je=k[m];if(v.T=Je[0],Je=Je[1],v.G==2)if(Je[0]=="c"){v.K=Je[1],v.ia=Je[2];let pn=Je[3];pn!=null&&(v.la=pn,v.j.info("VER="+v.la));let mn=Je[4];mn!=null&&(v.Aa=mn,v.j.info("SVER="+v.Aa));let qa=Je[5];qa!=null&&typeof qa=="number"&&0<qa&&(I=1.5*qa,v.L=I,v.j.info("backChannelRequestTimeoutMs_="+I)),I=v;let Nr=h.g;if(Nr){let Oh=Nr.g?Nr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Oh){var V=I.h;V.g||Oh.indexOf("spdy")==-1&&Oh.indexOf("quic")==-1&&Oh.indexOf("h2")==-1||(V.j=V.l,V.g=new Set,V.h&&(T_(V,V.h),V.h=null))}if(I.D){let R_=Nr.g?Nr.g.getResponseHeader("X-HTTP-Session-Id"):null;R_&&(I.ya=R_,mt(I.I,I.D,R_))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-h.F,v.j.info("Handshake RTT: "+v.R+"ms")),I=v;var q=h;if(I.qa=tx(I,I.J?I.ia:null,I.W),q.K){RD(I.h,q);var dt=q,tn=I.L;tn&&(dt.I=tn),dt.B&&(E_(dt),Ah(dt)),I.g=q}else QD(I);0<v.i.length&&Ph(v)}else Je[0]!="stop"&&Je[0]!="close"||To(v,7);else v.G==3&&(Je[0]=="stop"||Je[0]=="close"?Je[0]=="stop"?To(v,7):S_(v):Je[0]!="noop"&&v.l&&v.l.ta(Je),v.v=0)}}Ml(4)}catch{}}var dU=class{constructor(h,m){this.g=h,this.map=m}};function SD(h){this.l=h||10,a.PerformanceNavigationTiming?(h=a.performance.getEntriesByType("navigation"),h=0<h.length&&(h[0].nextHopProtocol=="hq"||h[0].nextHopProtocol=="h2")):h=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=h?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function DD(h){return h.h?!0:h.g?h.g.size>=h.j:!1}function xD(h){return h.h?1:h.g?h.g.size:0}function A_(h,m){return h.h?h.h==m:h.g?h.g.has(m):!1}function T_(h,m){h.g?h.g.add(m):h.h=m}function RD(h,m){h.h&&h.h==m?h.h=null:h.g&&h.g.has(m)&&h.g.delete(m)}SD.prototype.cancel=function(){if(this.i=PD(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let h of this.g.values())h.cancel();this.g.clear()}};function PD(h){if(h.h!=null)return h.i.concat(h.h.D);if(h.g!=null&&h.g.size!==0){let m=h.i;for(let v of h.g.values())m=m.concat(v.D);return m}return w(h.i)}function hU(h){if(h.V&&typeof h.V=="function")return h.V();if(typeof Map<"u"&&h instanceof Map||typeof Set<"u"&&h instanceof Set)return Array.from(h.values());if(typeof h=="string")return h.split("");if(c(h)){for(var m=[],v=h.length,I=0;I<v;I++)m.push(h[I]);return m}m=[],v=0;for(I in h)m[v++]=h[I];return m}function fU(h){if(h.na&&typeof h.na=="function")return h.na();if(!h.V||typeof h.V!="function"){if(typeof Map<"u"&&h instanceof Map)return Array.from(h.keys());if(!(typeof Set<"u"&&h instanceof Set)){if(c(h)||typeof h=="string"){var m=[];h=h.length;for(var v=0;v<h;v++)m.push(v);return m}m=[],v=0;for(let I in h)m[v++]=I;return m}}}function MD(h,m){if(h.forEach&&typeof h.forEach=="function")h.forEach(m,void 0);else if(c(h)||typeof h=="string")Array.prototype.forEach.call(h,m,void 0);else for(var v=fU(h),I=hU(h),k=I.length,V=0;V<k;V++)m.call(void 0,I[V],v&&v[V],h)}var ND=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pU(h,m){if(h){h=h.split("&");for(var v=0;v<h.length;v++){var I=h[v].indexOf("="),k=null;if(0<=I){var V=h[v].substring(0,I);k=h[v].substring(I+1)}else V=h[v];m(V,k?decodeURIComponent(k.replace(/\+/g," ")):"")}}}function Ao(h){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,h instanceof Ao){this.h=h.h,Th(this,h.j),this.o=h.o,this.g=h.g,Ch(this,h.s),this.l=h.l;var m=h.i,v=new Vl;v.i=m.i,m.g&&(v.g=new Map(m.g),v.h=m.h),OD(this,v),this.m=h.m}else h&&(m=String(h).match(ND))?(this.h=!1,Th(this,m[1]||"",!0),this.o=Ll(m[2]||""),this.g=Ll(m[3]||"",!0),Ch(this,m[4]),this.l=Ll(m[5]||"",!0),OD(this,m[6]||"",!0),this.m=Ll(m[7]||"")):(this.h=!1,this.i=new Vl(null,this.h))}Ao.prototype.toString=function(){var h=[],m=this.j;m&&h.push(Fl(m,kD,!0),":");var v=this.g;return(v||m=="file")&&(h.push("//"),(m=this.o)&&h.push(Fl(m,kD,!0),"@"),h.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&h.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&h.push("/"),h.push(Fl(v,v.charAt(0)=="/"?yU:gU,!0))),(v=this.i.toString())&&h.push("?",v),(v=this.m)&&h.push("#",Fl(v,vU)),h.join("")};function qi(h){return new Ao(h)}function Th(h,m,v){h.j=v?Ll(m,!0):m,h.j&&(h.j=h.j.replace(/:$/,""))}function Ch(h,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);h.s=m}else h.s=null}function OD(h,m,v){m instanceof Vl?(h.i=m,wU(h.i,h.h)):(v||(m=Fl(m,_U)),h.i=new Vl(m,h.h))}function mt(h,m,v){h.i.set(m,v)}function Sh(h){return mt(h,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),h}function Ll(h,m){return h?m?decodeURI(h.replace(/%25/g,"%2525")):decodeURIComponent(h):""}function Fl(h,m,v){return typeof h=="string"?(h=encodeURI(h).replace(m,mU),v&&(h=h.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h):null}function mU(h){return h=h.charCodeAt(0),"%"+(h>>4&15).toString(16)+(h&15).toString(16)}var kD=/[#\/\?@]/g,gU=/[#\?:]/g,yU=/[#\?]/g,_U=/[#\?@]/g,vU=/#/g;function Vl(h,m){this.h=this.g=null,this.i=h||null,this.j=!!m}function Ds(h){h.g||(h.g=new Map,h.h=0,h.i&&pU(h.i,function(m,v){h.add(decodeURIComponent(m.replace(/\+/g," ")),v)}))}n=Vl.prototype,n.add=function(h,m){Ds(this),this.i=null,h=Ba(this,h);var v=this.g.get(h);return v||this.g.set(h,v=[]),v.push(m),this.h+=1,this};function LD(h,m){Ds(h),m=Ba(h,m),h.g.has(m)&&(h.i=null,h.h-=h.g.get(m).length,h.g.delete(m))}function FD(h,m){return Ds(h),m=Ba(h,m),h.g.has(m)}n.forEach=function(h,m){Ds(this),this.g.forEach(function(v,I){v.forEach(function(k){h.call(m,k,I,this)},this)},this)},n.na=function(){Ds(this);let h=Array.from(this.g.values()),m=Array.from(this.g.keys()),v=[];for(let I=0;I<m.length;I++){let k=h[I];for(let V=0;V<k.length;V++)v.push(m[I])}return v},n.V=function(h){Ds(this);let m=[];if(typeof h=="string")FD(this,h)&&(m=m.concat(this.g.get(Ba(this,h))));else{h=Array.from(this.g.values());for(let v=0;v<h.length;v++)m=m.concat(h[v])}return m},n.set=function(h,m){return Ds(this),this.i=null,h=Ba(this,h),FD(this,h)&&(this.h-=this.g.get(h).length),this.g.set(h,[m]),this.h+=1,this},n.get=function(h,m){return h?(h=this.V(h),0<h.length?String(h[0]):m):m};function VD(h,m,v){LD(h,m),0<v.length&&(h.i=null,h.g.set(Ba(h,m),w(v)),h.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let h=[],m=Array.from(this.g.keys());for(var v=0;v<m.length;v++){var I=m[v];let V=encodeURIComponent(String(I)),q=this.V(I);for(I=0;I<q.length;I++){var k=V;q[I]!==""&&(k+="="+encodeURIComponent(String(q[I]))),h.push(k)}}return this.i=h.join("&")};function Ba(h,m){return m=String(m),h.j&&(m=m.toLowerCase()),m}function wU(h,m){m&&!h.j&&(Ds(h),h.i=null,h.g.forEach(function(v,I){var k=I.toLowerCase();I!=k&&(LD(this,I),VD(this,k,v))},h)),h.j=m}function bU(h,m){let v=new Ol;if(a.Image){let I=new Image;I.onload=p(xs,v,"TestLoadImage: loaded",!0,m,I),I.onerror=p(xs,v,"TestLoadImage: error",!1,m,I),I.onabort=p(xs,v,"TestLoadImage: abort",!1,m,I),I.ontimeout=p(xs,v,"TestLoadImage: timeout",!1,m,I),a.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=h}else m(!1)}function EU(h,m){let v=new Ol,I=new AbortController,k=setTimeout(()=>{I.abort(),xs(v,"TestPingServer: timeout",!1,m)},1e4);fetch(h,{signal:I.signal}).then(V=>{clearTimeout(k),V.ok?xs(v,"TestPingServer: ok",!0,m):xs(v,"TestPingServer: server error",!1,m)}).catch(()=>{clearTimeout(k),xs(v,"TestPingServer: error",!1,m)})}function xs(h,m,v,I,k){try{k&&(k.onload=null,k.onerror=null,k.onabort=null,k.ontimeout=null),I(v)}catch{}}function IU(){this.g=new sU}function AU(h,m,v){let I=v||"";try{MD(h,function(k,V){let q=k;l(k)&&(q=m_(k)),m.push(I+V+"="+encodeURIComponent(q))})}catch(k){throw m.push(I+"type="+encodeURIComponent("_badmap")),k}}function jl(h){this.l=h.Ub||null,this.j=h.eb||!1}y(jl,g_),jl.prototype.g=function(){return new Dh(this.l,this.j)},jl.prototype.i=function(h){return function(){return h}}({});function Dh(h,m){fn.call(this),this.D=h,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(Dh,fn),n=Dh.prototype,n.open=function(h,m){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=h,this.A=m,this.readyState=1,Ul(this)},n.send=function(h){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};h&&(m.body=h),(this.D||a).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,$l(this)),this.readyState=0},n.Sa=function(h){if(this.g&&(this.l=h,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=h.headers,this.readyState=2,Ul(this)),this.g&&(this.readyState=3,Ul(this),this.g)))if(this.responseType==="arraybuffer")h.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in h){if(this.j=h.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;jD(this)}else h.text().then(this.Ra.bind(this),this.ga.bind(this))};function jD(h){h.j.read().then(h.Pa.bind(h)).catch(h.ga.bind(h))}n.Pa=function(h){if(this.g){if(this.o&&h.value)this.response.push(h.value);else if(!this.o){var m=h.value?h.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!h.done}))&&(this.response=this.responseText+=m)}h.done?$l(this):Ul(this),this.readyState==3&&jD(this)}},n.Ra=function(h){this.g&&(this.response=this.responseText=h,$l(this))},n.Qa=function(h){this.g&&(this.response=h,$l(this))},n.ga=function(){this.g&&$l(this)};function $l(h){h.readyState=4,h.l=null,h.j=null,h.v=null,Ul(h)}n.setRequestHeader=function(h,m){this.u.append(h,m)},n.getResponseHeader=function(h){return this.h&&this.h.get(h.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let h=[],m=this.h.entries();for(var v=m.next();!v.done;)v=v.value,h.push(v[0]+": "+v[1]),v=m.next();return h.join(`\r
`)};function Ul(h){h.onreadystatechange&&h.onreadystatechange.call(h)}Object.defineProperty(Dh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(h){this.m=h?"include":"same-origin"}});function $D(h){let m="";return F(h,function(v,I){m+=I,m+=":",m+=v,m+=`\r
`}),m}function C_(h,m,v){e:{for(I in v){var I=!1;break e}I=!0}I||(v=$D(v),typeof h=="string"?v!=null&&encodeURIComponent(String(v)):mt(h,m,v))}function At(h){fn.call(this),this.headers=new Map,this.o=h||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(At,fn);var TU=/^https?$/i,CU=["POST","PUT"];n=At.prototype,n.Ha=function(h){this.J=h},n.ea=function(h,m,v,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+h);m=m?m.toUpperCase():"GET",this.D=h,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():v_.g(),this.v=this.o?mD(this.o):mD(v_),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(m,String(h),!0),this.B=!1}catch(V){UD(this,V);return}if(h=v||"",v=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var k in I)v.set(k,I[k]);else if(typeof I.keys=="function"&&typeof I.get=="function")for(let V of I.keys())v.set(V,I.get(V));else throw Error("Unknown input type for opt_headers: "+String(I));I=Array.from(v.keys()).find(V=>V.toLowerCase()=="content-type"),k=a.FormData&&h instanceof a.FormData,!(0<=Array.prototype.indexOf.call(CU,m,void 0))||I||k||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[V,q]of v)this.g.setRequestHeader(V,q);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qD(this),this.u=!0,this.g.send(h),this.u=!1}catch(V){UD(this,V)}};function UD(h,m){h.h=!1,h.g&&(h.j=!0,h.g.abort(),h.j=!1),h.l=m,h.m=5,BD(h),xh(h)}function BD(h){h.A||(h.A=!0,xn(h,"complete"),xn(h,"error"))}n.abort=function(h){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=h||7,xn(this,"complete"),xn(this,"abort"),xh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xh(this,!0)),At.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?HD(this):this.bb())},n.bb=function(){HD(this)};function HD(h){if(h.h&&typeof o<"u"&&(!h.v[1]||zi(h)!=4||h.Z()!=2)){if(h.u&&zi(h)==4)dD(h.Ea,0,h);else if(xn(h,"readystatechange"),zi(h)==4){h.h=!1;try{let q=h.Z();e:switch(q){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var v;if(!(v=m)){var I;if(I=q===0){var k=String(h.D).match(ND)[1]||null;!k&&a.self&&a.self.location&&(k=a.self.location.protocol.slice(0,-1)),I=!TU.test(k?k.toLowerCase():"")}v=I}if(v)xn(h,"complete"),xn(h,"success");else{h.m=6;try{var V=2<zi(h)?h.g.statusText:""}catch{V=""}h.l=V+" ["+h.Z()+"]",BD(h)}}finally{xh(h)}}}}function xh(h,m){if(h.g){qD(h);let v=h.g,I=h.v[0]?()=>{}:null;h.g=null,h.v=null,m||xn(h,"ready");try{v.onreadystatechange=I}catch{}}}function qD(h){h.I&&(a.clearTimeout(h.I),h.I=null)}n.isActive=function(){return!!this.g};function zi(h){return h.g?h.g.readyState:0}n.Z=function(){try{return 2<zi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(h){if(this.g){var m=this.g.responseText;return h&&m.indexOf(h)==0&&(m=m.substring(h.length)),iU(m)}};function zD(h){try{if(!h.g)return null;if("response"in h.g)return h.g.response;switch(h.H){case"":case"text":return h.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in h.g)return h.g.mozResponseArrayBuffer}return null}catch{return null}}function SU(h){let m={};h=(h.g&&2<=zi(h)&&h.g.getAllResponseHeaders()||"").split(`\r
`);for(let I=0;I<h.length;I++){if(D(h[I]))continue;var v=M(h[I]);let k=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();let V=m[k]||[];m[k]=V,V.push(v)}T(m,function(I){return I.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Bl(h,m,v){return v&&v.internalChannelParams&&v.internalChannelParams[h]||m}function GD(h){this.Aa=0,this.i=[],this.j=new Ol,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Bl("failFast",!1,h),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Bl("baseRetryDelayMs",5e3,h),this.cb=Bl("retryDelaySeedMs",1e4,h),this.Wa=Bl("forwardChannelMaxRetries",2,h),this.wa=Bl("forwardChannelRequestTimeoutMs",2e4,h),this.pa=h&&h.xmlHttpFactory||void 0,this.Xa=h&&h.Tb||void 0,this.Ca=h&&h.useFetchStreams||!1,this.L=void 0,this.J=h&&h.supportsCrossDomainXhr||!1,this.K="",this.h=new SD(h&&h.concurrentRequestLimit),this.Da=new IU,this.P=h&&h.fastHandshake||!1,this.O=h&&h.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=h&&h.Rb||!1,h&&h.xa&&this.j.xa(),h&&h.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&h&&h.detectBufferingProxy||!1,this.ja=void 0,h&&h.longPollingTimeout&&0<h.longPollingTimeout&&(this.ja=h.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=GD.prototype,n.la=8,n.G=1,n.connect=function(h,m,v,I){Rn(0),this.W=h,this.H=m||{},v&&I!==void 0&&(this.H.OSID=v,this.H.OAID=I),this.F=this.X,this.I=tx(this,null,this.W),Ph(this)};function S_(h){if(WD(h),h.G==3){var m=h.U++,v=qi(h.I);if(mt(v,"SID",h.K),mt(v,"RID",m),mt(v,"TYPE","terminate"),Hl(h,v),m=new Ss(h,h.j,m),m.L=2,m.v=Sh(qi(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(m.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=m.v,v=!0),v||(m.g=nx(m.j,null),m.g.ea(m.v)),m.F=Date.now(),Ah(m)}ex(h)}function Rh(h){h.g&&(x_(h),h.g.cancel(),h.g=null)}function WD(h){Rh(h),h.u&&(a.clearTimeout(h.u),h.u=null),Mh(h),h.h.cancel(),h.s&&(typeof h.s=="number"&&a.clearTimeout(h.s),h.s=null)}function Ph(h){if(!DD(h.h)&&!h.s){h.s=!0;var m=h.Ga;J||oi(),Wt||(J(),Wt=!0),Un.add(m,h),h.B=0}}function DU(h,m){return xD(h.h)>=h.h.j-(h.s?1:0)?!1:h.s?(h.i=m.D.concat(h.i),!0):h.G==1||h.G==2||h.B>=(h.Va?0:h.Wa)?!1:(h.s=Nl(f(h.Ga,h,m),JD(h,h.B)),h.B++,!0)}n.Ga=function(h){if(this.s)if(this.s=null,this.G==1){if(!h){this.U=Math.floor(1e5*Math.random()),h=this.U++;let k=new Ss(this,this.j,h),V=this.o;if(this.S&&(V?(V=A(V),R(V,this.S)):V=this.S),this.m!==null||this.O||(k.H=V,V=null),this.P)e:{for(var m=0,v=0;v<this.i.length;v++){t:{var I=this.i[v];if("__data__"in I.map&&(I=I.map.__data__,typeof I=="string")){I=I.length;break t}I=void 0}if(I===void 0)break;if(m+=I,4096<m){m=v;break e}if(m===4096||v===this.i.length-1){m=v+1;break e}}m=1e3}else m=1e3;m=YD(this,k,m),v=qi(this.I),mt(v,"RID",h),mt(v,"CVER",22),this.D&&mt(v,"X-HTTP-Session-Id",this.D),Hl(this,v),V&&(this.O?m="headers="+encodeURIComponent(String($D(V)))+"&"+m:this.m&&C_(v,this.m,V)),T_(this.h,k),this.Ua&&mt(v,"TYPE","init"),this.P?(mt(v,"$req",m),mt(v,"SID","null"),k.T=!0,b_(k,v,null)):b_(k,v,m),this.G=2}}else this.G==3&&(h?KD(this,h):this.i.length==0||DD(this.h)||KD(this))};function KD(h,m){var v;m?v=m.l:v=h.U++;let I=qi(h.I);mt(I,"SID",h.K),mt(I,"RID",v),mt(I,"AID",h.T),Hl(h,I),h.m&&h.o&&C_(I,h.m,h.o),v=new Ss(h,h.j,v,h.B+1),h.m===null&&(v.H=h.o),m&&(h.i=m.D.concat(h.i)),m=YD(h,v,1e3),v.I=Math.round(.5*h.wa)+Math.round(.5*h.wa*Math.random()),T_(h.h,v),b_(v,I,m)}function Hl(h,m){h.H&&F(h.H,function(v,I){mt(m,I,v)}),h.l&&MD({},function(v,I){mt(m,I,v)})}function YD(h,m,v){v=Math.min(h.i.length,v);var I=h.l?f(h.l.Na,h.l,h):null;e:{var k=h.i;let V=-1;for(;;){let q=["count="+v];V==-1?0<v?(V=k[0].g,q.push("ofs="+V)):V=0:q.push("ofs="+V);let dt=!0;for(let tn=0;tn<v;tn++){let Je=k[tn].g,pn=k[tn].map;if(Je-=V,0>Je)V=Math.max(0,k[tn].g-100),dt=!1;else try{AU(pn,q,"req"+Je+"_")}catch{I&&I(pn)}}if(dt){I=q.join("&");break e}}}return h=h.i.splice(0,v),m.D=h,I}function QD(h){if(!h.g&&!h.u){h.Y=1;var m=h.Fa;J||oi(),Wt||(J(),Wt=!0),Un.add(m,h),h.v=0}}function D_(h){return h.g||h.u||3<=h.v?!1:(h.Y++,h.u=Nl(f(h.Fa,h),JD(h,h.v)),h.v++,!0)}n.Fa=function(){if(this.u=null,XD(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var h=2*this.R;this.j.info("BP detection timer enabled: "+h),this.A=Nl(f(this.ab,this),h)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Rn(10),Rh(this),XD(this))};function x_(h){h.A!=null&&(a.clearTimeout(h.A),h.A=null)}function XD(h){h.g=new Ss(h,h.j,"rpc",h.Y),h.m===null&&(h.g.H=h.o),h.g.O=0;var m=qi(h.qa);mt(m,"RID","rpc"),mt(m,"SID",h.K),mt(m,"AID",h.T),mt(m,"CI",h.F?"0":"1"),!h.F&&h.ja&&mt(m,"TO",h.ja),mt(m,"TYPE","xmlhttp"),Hl(h,m),h.m&&h.o&&C_(m,h.m,h.o),h.L&&(h.g.I=h.L);var v=h.g;h=h.ia,v.L=1,v.v=Sh(qi(m)),v.m=null,v.P=!0,AD(v,h)}n.Za=function(){this.C!=null&&(this.C=null,Rh(this),D_(this),Rn(19))};function Mh(h){h.C!=null&&(a.clearTimeout(h.C),h.C=null)}function ZD(h,m){var v=null;if(h.g==m){Mh(h),x_(h),h.g=null;var I=2}else if(A_(h.h,m))v=m.D,RD(h.h,m),I=1;else return;if(h.G!=0){if(m.o)if(I==1){v=m.m?m.m.length:0,m=Date.now()-m.F;var k=h.B;I=bh(),xn(I,new wD(I,v)),Ph(h)}else QD(h);else if(k=m.s,k==3||k==0&&0<m.X||!(I==1&&DU(h,m)||I==2&&D_(h)))switch(v&&0<v.length&&(m=h.h,m.i=m.i.concat(v)),k){case 1:To(h,5);break;case 4:To(h,10);break;case 3:To(h,6);break;default:To(h,2)}}}function JD(h,m){let v=h.Ta+Math.floor(Math.random()*h.cb);return h.isActive()||(v*=2),v*m}function To(h,m){if(h.j.info("Error code "+m),m==2){var v=f(h.fb,h),I=h.Xa;let k=!I;I=new Ao(I||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Th(I,"https"),Sh(I),k?bU(I.toString(),v):EU(I.toString(),v)}else Rn(2);h.G=0,h.l&&h.l.sa(m),ex(h),WD(h)}n.fb=function(h){h?(this.j.info("Successfully pinged google.com"),Rn(2)):(this.j.info("Failed to ping google.com"),Rn(1))};function ex(h){if(h.G=0,h.ka=[],h.l){let m=PD(h.h);(m.length!=0||h.i.length!=0)&&(b(h.ka,m),b(h.ka,h.i),h.h.i.length=0,w(h.i),h.i.length=0),h.l.ra()}}function tx(h,m,v){var I=v instanceof Ao?qi(v):new Ao(v);if(I.g!="")m&&(I.g=m+"."+I.g),Ch(I,I.s);else{var k=a.location;I=k.protocol,m=m?m+"."+k.hostname:k.hostname,k=+k.port;var V=new Ao(null);I&&Th(V,I),m&&(V.g=m),k&&Ch(V,k),v&&(V.l=v),I=V}return v=h.D,m=h.ya,v&&m&&mt(I,v,m),mt(I,"VER",h.la),Hl(h,I),I}function nx(h,m,v){if(m&&!h.J)throw Error("Can't create secondary domain capable XhrIo object.");return m=h.Ca&&!h.pa?new At(new jl({eb:v})):new At(h.pa),m.Ha(h.J),m}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function rx(){}n=rx.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Nh(){}Nh.prototype.g=function(h,m){return new er(h,m)};function er(h,m){fn.call(this),this.g=new GD(m),this.l=h,this.h=m&&m.messageUrlParams||null,h=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(h?h["X-Client-Protocol"]="webchannel":h={"X-Client-Protocol":"webchannel"}),this.g.o=h,h=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(h?h["X-WebChannel-Content-Type"]=m.messageContentType:h={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(h?h["X-WebChannel-Client-Profile"]=m.va:h={"X-WebChannel-Client-Profile":m.va}),this.g.S=h,(h=m&&m.Sb)&&!D(h)&&(this.g.m=h),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!D(m)&&(this.g.D=m,h=this.h,h!==null&&m in h&&(h=this.h,m in h&&delete h[m])),this.j=new Ha(this)}y(er,fn),er.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},er.prototype.close=function(){S_(this.g)},er.prototype.o=function(h){var m=this.g;if(typeof h=="string"){var v={};v.__data__=h,h=v}else this.u&&(v={},v.__data__=m_(h),h=v);m.i.push(new dU(m.Ya++,h)),m.G==3&&Ph(m)},er.prototype.N=function(){this.g.l=null,delete this.j,S_(this.g),delete this.g,er.aa.N.call(this)};function ix(h){y_.call(this),h.__headers__&&(this.headers=h.__headers__,this.statusCode=h.__status__,delete h.__headers__,delete h.__status__);var m=h.__sm__;if(m){e:{for(let v in m){h=v;break e}h=void 0}(this.i=h)&&(h=this.i,m=m!==null&&h in m?m[h]:void 0),this.data=m}else this.data=h}y(ix,y_);function sx(){__.call(this),this.status=1}y(sx,__);function Ha(h){this.g=h}y(Ha,rx),Ha.prototype.ua=function(){xn(this.g,"a")},Ha.prototype.ta=function(h){xn(this.g,new ix(h))},Ha.prototype.sa=function(h){xn(this.g,new sx)},Ha.prototype.ra=function(){xn(this.g,"b")},Nh.prototype.createWebChannel=Nh.prototype.g,er.prototype.send=er.prototype.o,er.prototype.open=er.prototype.m,er.prototype.close=er.prototype.close,a0=ls.createWebChannelTransport=function(){return new Nh},o0=ls.getStatEventTarget=function(){return bh()},s0=ls.Event=Eo,em=ls.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Eh.NO_ERROR=0,Eh.TIMEOUT=8,Eh.HTTP_ERROR=6,Hu=ls.ErrorCode=Eh,bD.COMPLETE="complete",i0=ls.EventType=bD,gD.EventType=Pl,Pl.OPEN="a",Pl.CLOSE="b",Pl.ERROR="c",Pl.MESSAGE="d",fn.prototype.listen=fn.prototype.K,Fc=ls.WebChannel=gD,A8=ls.FetchXmlHttpFactory=jl,At.prototype.listenOnce=At.prototype.L,At.prototype.getLastError=At.prototype.Ka,At.prototype.getLastErrorCode=At.prototype.Ba,At.prototype.getStatus=At.prototype.Z,At.prototype.getResponseJson=At.prototype.Oa,At.prototype.getResponseText=At.prototype.oa,At.prototype.send=At.prototype.ea,At.prototype.setWithCredentials=At.prototype.Ha,r0=ls.XhrIo=At}).apply(typeof Jp<"u"?Jp:typeof self<"u"?self:typeof window<"u"?window:{});var uk="@firebase/firestore";var Zt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Zt.UNAUTHENTICATED=new Zt(null),Zt.GOOGLE_CREDENTIALS=new Zt("google-credentials-uid"),Zt.FIRST_PARTY=new Zt("first-party-uid"),Zt.MOCK_USER=new Zt("mock-user");var sl="10.14.0";var aa=new Ys("@firebase/firestore");function qu(){return aa.logLevel}function te(n,...e){if(aa.logLevel<=ze.DEBUG){let t=e.map(KI);aa.debug(`Firestore (${sl}): ${n}`,...t)}}function us(n,...e){if(aa.logLevel<=ze.ERROR){let t=e.map(KI);aa.error(`Firestore (${sl}): ${n}`,...t)}}function zc(n,...e){if(aa.logLevel<=ze.WARN){let t=e.map(KI);aa.warn(`Firestore (${sl}): ${n}`,...t)}}function KI(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function me(n="Unexpected state"){let e=`FIRESTORE (${sl}) INTERNAL ASSERTION FAILED: `+n;throw us(e),new Error(e)}function at(n,e){n||me()}function be(n,e){return n}var j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},K=class extends on{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ci=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var sm=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},h0=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Zt.UNAUTHENTICATED))}shutdown(){}},f0=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},p0=class{constructor(e){this.t=e,this.currentUser=Zt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){at(this.o===void 0);let r=this.i,i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve(),s=new Ci;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ci,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>g(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{te("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(te("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ci)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(te("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(at(typeof r.accessToken=="string"),new sm(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return at(e===null||typeof e=="string"),new Zt(e)}},m0=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Zt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},g0=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new m0(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Zt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},y0=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},_0=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){at(this.o===void 0);let r=s=>{s.error!=null&&te("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,te("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{te("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):te("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(at(typeof t.token=="string"),this.R=t.token,new y0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function T8(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var om=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=T8(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function tt(n,e){return n<e?-1:n>e?1:0}function Gc(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var an=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new K(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new K(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new K(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new K(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tt(this.nanoseconds,e.nanoseconds):tt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var Te=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new an(0,0))}static max(){return new n(new an(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var am=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&me(),r===void 0?r=e.length-t:r>e.length-t&&me(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},Et=class n extends am{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new K(j.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},C8=/^[_a-zA-Z][_a-zA-Z0-9]*$/,lr=class n extends am{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return C8.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new K(j.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new K(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new K(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new K(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var le=class n{constructor(e){this.path=e}static fromPath(e){return new n(Et.fromString(e))}static fromName(e){return new n(Et.fromString(e).popFirst(5))}static empty(){return new n(Et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Et.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Et.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new Et(e.slice()))}};var v0=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};v0.UNKNOWN_ID=-1;function S8(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Te.fromTimestamp(r===1e9?new an(t+1,0):new an(t,r));return new ca(i,le.empty(),e)}function D8(n){return new ca(n.readTime,n.key,-1)}var ca=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(Te.min(),le.empty(),-1)}static max(){return new n(Te.max(),le.empty(),-1)}};function x8(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=le.comparator(n.documentKey,e.documentKey),t!==0?t:tt(n.largestBatchId,e.largestBatchId))}var R8="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",w0=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function cd(n){return g(this,null,function*(){if(n.code!==j.FAILED_PRECONDITION||n.message!==R8)throw n;te("LocalStore","Unexpectedly lost primary lease")})}var H=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&me(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},c=>r(c))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let l=c;t(e[l]).next(u=>{o[l]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function P8(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ld(n){return n.name==="IndexedDbTransactionError"}var qk=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Lm(n){return n==null}function Qu(n){return n===0&&1/n==-1/0}function M8(n){return typeof n=="number"&&Number.isInteger(n)&&!Qu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var N8=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Kfe=[...N8,"documentOverlays"],O8=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],k8=O8,L8=[...k8,"indexConfiguration","indexState","indexEntries"];var Yfe=[...L8,"globals"];function dk(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ma(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function zk(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Ct=class n{constructor(e,t){this.comparator=e,this.root=t||Si.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Si.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Si.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Uc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Uc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Uc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Uc(this.root,e,this.comparator,!0)}},Uc=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Si=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw me();let e=this.left.check();if(e!==this.right.check())throw me();return e+(this.isRed()?0:1)}};Si.EMPTY=null,Si.RED=!0,Si.BLACK=!1;Si.EMPTY=new class{constructor(){this.size=0}get key(){throw me()}get value(){throw me()}get color(){throw me()}get left(){throw me()}get right(){throw me()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Si(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var wn=class n{constructor(e){this.comparator=e,this.data=new Ct(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new cm(this.data.getIterator())}getIteratorFrom(e){return new cm(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},cm=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var br=class n{constructor(e){this.fields=e,e.sort(lr.comparator)}static empty(){return new n([])}unionWith(e){let t=new wn(lr.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Gc(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var lm=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var bn=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new lm("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};bn.EMPTY_BYTE_STRING=new bn("");var F8=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ds(n){if(at(!!n),typeof n=="string"){let e=0,t=F8.exec(n);if(at(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:vt(n.seconds),nanos:vt(n.nanos)}}function vt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function so(n){return typeof n=="string"?bn.fromBase64String(n):bn.fromUint8Array(n)}function YI(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function QI(n){let e=n.mapValue.fields.__previous_value__;return YI(e)?QI(e):e}function Xu(n){let e=ds(n.mapValue.fields.__local_write_time__.timestampValue);return new an(e.seconds,e.nanos)}var b0=class{constructor(e,t,r,i,s,o,a,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l}},um=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var tm={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function la(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?YI(n)?4:Wk(n)?9007199254740991:Gk(n)?10:11:me()}function Ri(n,e){if(n===e)return!0;let t=la(n);if(t!==la(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Xu(n).isEqual(Xu(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=ds(i.timestampValue),a=ds(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return so(i.bytesValue).isEqual(so(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return vt(i.geoPointValue.latitude)===vt(s.geoPointValue.latitude)&&vt(i.geoPointValue.longitude)===vt(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return vt(i.integerValue)===vt(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=vt(i.doubleValue),a=vt(s.doubleValue);return o===a?Qu(o)===Qu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Gc(n.arrayValue.values||[],e.arrayValue.values||[],Ri);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(dk(o)!==dk(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Ri(o[c],a[c])))return!1;return!0}(n,e);default:return me()}}function Zu(n,e){return(n.values||[]).find(t=>Ri(t,e))!==void 0}function Wc(n,e){if(n===e)return 0;let t=la(n),r=la(e);if(t!==r)return tt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return tt(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=vt(s.integerValue||s.doubleValue),c=vt(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return hk(n.timestampValue,e.timestampValue);case 4:return hk(Xu(n),Xu(e));case 5:return tt(n.stringValue,e.stringValue);case 6:return function(s,o){let a=so(s),c=so(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let l=0;l<a.length&&l<c.length;l++){let u=tt(a[l],c[l]);if(u!==0)return u}return tt(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=tt(vt(s.latitude),vt(o.latitude));return a!==0?a:tt(vt(s.longitude),vt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return fk(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,c,l,u;let d=s.fields||{},f=o.fields||{},p=(a=d.value)===null||a===void 0?void 0:a.arrayValue,y=(c=f.value)===null||c===void 0?void 0:c.arrayValue,w=tt(((l=p?.values)===null||l===void 0?void 0:l.length)||0,((u=y?.values)===null||u===void 0?void 0:u.length)||0);return w!==0?w:fk(p,y)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===tm.mapValue&&o===tm.mapValue)return 0;if(s===tm.mapValue)return 1;if(o===tm.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),l=o.fields||{},u=Object.keys(l);c.sort(),u.sort();for(let d=0;d<c.length&&d<u.length;++d){let f=tt(c[d],u[d]);if(f!==0)return f;let p=Wc(a[c[d]],l[u[d]]);if(p!==0)return p}return tt(c.length,u.length)}(n.mapValue,e.mapValue);default:throw me()}}function hk(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return tt(n,e);let t=ds(n),r=ds(e),i=tt(t.seconds,r.seconds);return i!==0?i:tt(t.nanos,r.nanos)}function fk(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Wc(t[i],r[i]);if(s)return s}return tt(t.length,r.length)}function Kc(n){return E0(n)}function E0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=ds(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return so(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return le.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=E0(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${E0(t.fields[o])}`;return i+"}"}(n.mapValue):me()}function pk(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function I0(n){return!!n&&"integerValue"in n}function XI(n){return!!n&&"arrayValue"in n}function mk(n){return!!n&&"nullValue"in n}function gk(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function rm(n){return!!n&&"mapValue"in n}function Gk(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Gu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return ma(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Gu(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Wk(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var cr=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!rm(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gu(t)}setAll(e){let t=lr.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Gu(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());rm(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ri(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];rm(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){ma(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Gu(this.value))}};function Kk(n){let e=[];return ma(n.fields,(t,r)=>{let i=new lr([t]);if(rm(r)){let s=Kk(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new br(e)}var Yr=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,Te.min(),Te.min(),Te.min(),cr.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,Te.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,Te.min(),Te.min(),cr.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Te.min(),Te.min(),cr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Te.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=cr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=cr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Yc=class{constructor(e,t){this.position=e,this.inclusive=t}};function yk(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=le.comparator(le.fromName(o.referenceValue),t.key):r=Wc(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function _k(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ri(n.position[t],e.position[t]))return!1;return!0}var ua=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function V8(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var dm=class{},Ft=class n extends dm{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new T0(e,t,r):t==="array-contains"?new D0(e,r):t==="in"?new x0(e,r):t==="not-in"?new R0(e,r):t==="array-contains-any"?new P0(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new C0(e,r):new S0(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Wc(t,this.value)):t!==null&&la(this.value)===la(t)&&this.matchesComparison(Wc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return me()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Qr=class n extends dm{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return Yk(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Yk(n){return n.op==="and"}function Qk(n){return j8(n)&&Yk(n)}function j8(n){for(let e of n.filters)if(e instanceof Qr)return!1;return!0}function A0(n){if(n instanceof Ft)return n.field.canonicalString()+n.op.toString()+Kc(n.value);if(Qk(n))return n.filters.map(e=>A0(e)).join(",");{let e=n.filters.map(t=>A0(t)).join(",");return`${n.op}(${e})`}}function Xk(n,e){return n instanceof Ft?function(r,i){return i instanceof Ft&&r.op===i.op&&r.field.isEqual(i.field)&&Ri(r.value,i.value)}(n,e):n instanceof Qr?function(r,i){return i instanceof Qr&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Xk(o,i.filters[a]),!0):!1}(n,e):void me()}function Zk(n){return n instanceof Ft?function(t){return`${t.field.canonicalString()} ${t.op} ${Kc(t.value)}`}(n):n instanceof Qr?function(t){return t.op.toString()+" {"+t.getFilters().map(Zk).join(" ,")+"}"}(n):"Filter"}var T0=class extends Ft{constructor(e,t,r){super(e,t,r),this.key=le.fromName(r.referenceValue)}matches(e){let t=le.comparator(e.key,this.key);return this.matchesComparison(t)}},C0=class extends Ft{constructor(e,t){super(e,"in",t),this.keys=Jk("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},S0=class extends Ft{constructor(e,t){super(e,"not-in",t),this.keys=Jk("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Jk(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>le.fromName(r.referenceValue))}var D0=class extends Ft{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return XI(t)&&Zu(t.arrayValue,this.value)}},x0=class extends Ft{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Zu(this.value.arrayValue,t)}},R0=class extends Ft{constructor(e,t){super(e,"not-in",t)}matches(e){if(Zu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Zu(this.value.arrayValue,t)}},P0=class extends Ft{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!XI(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Zu(this.value.arrayValue,r))}};var M0=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function vk(n,e=null,t=[],r=[],i=null,s=null,o=null){return new M0(n,e,t,r,i,s,o)}function ZI(n){let e=be(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>A0(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Lm(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Kc(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Kc(r)).join(",")),e.ue=t}return e.ue}function JI(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!V8(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Xk(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!_k(n.startAt,e.startAt)&&_k(n.endAt,e.endAt)}function N0(n){return le.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var oo=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function $8(n,e,t,r,i,s,o,a){return new oo(n,e,t,r,i,s,o,a)}function e1(n){return new oo(n)}function wk(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function t1(n){return n.collectionGroup!==null}function Wu(n){let e=be(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new wn(lr.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new ua(s,r))}),t.has(lr.keyField().canonicalString())||e.ce.push(new ua(lr.keyField(),r))}return e.ce}function Di(n){let e=be(n);return e.le||(e.le=U8(e,Wu(n))),e.le}function U8(n,e){if(n.limitType==="F")return vk(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new ua(i.field,s)});let t=n.endAt?new Yc(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Yc(n.startAt.position,n.startAt.inclusive):null;return vk(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function O0(n,e){let t=n.filters.concat([e]);return new oo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function k0(n,e,t){return new oo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Fm(n,e){return JI(Di(n),Di(e))&&n.limitType===e.limitType}function n1(n){return`${ZI(Di(n))}|lt:${n.limitType}`}function Vc(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Zk(i)).join(", ")}]`),Lm(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Kc(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Kc(i)).join(",")),`Target(${r})`}(Di(n))}; limitType=${n.limitType})`}function Vm(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):le.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Wu(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){let l=yk(o,a,c);return o.inclusive?l<=0:l<0}(r.startAt,Wu(r),i)||r.endAt&&!function(o,a,c){let l=yk(o,a,c);return o.inclusive?l>=0:l>0}(r.endAt,Wu(r),i))}(n,e)}function B8(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function r1(n){return(e,t)=>{let r=!1;for(let i of Wu(n)){let s=H8(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function H8(n,e,t){let r=n.field.isKeyField()?le.comparator(e.key,t.key):function(s,o,a){let c=o.data.field(s),l=a.data.field(s);return c!==null&&l!==null?Wc(c,l):me()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return me()}}var ao=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ma(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return zk(this.inner)}size(){return this.innerSize}};var q8=new Ct(le.comparator);function hs(){return q8}var i1=new Ct(le.comparator);function zu(...n){let e=i1;for(let t of n)e=e.insert(t.key,t);return e}function s1(n){let e=i1;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function sa(){return Ku()}function o1(){return Ku()}function Ku(){return new ao(n=>n.toString(),(n,e)=>n.isEqual(e))}var z8=new Ct(le.comparator),G8=new wn(le.comparator);function Ge(...n){let e=G8;for(let t of n)e=e.add(t);return e}var W8=new wn(tt);function K8(){return W8}function eA(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qu(e)?"-0":e}}function a1(n){return{integerValue:""+n}}function Y8(n,e){return M8(e)?a1(e):eA(n,e)}var Qc=class{constructor(){this._=void 0}};function Q8(n,e,t){return n instanceof Xc?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&YI(s)&&(s=QI(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof da?l1(n,e):n instanceof ha?u1(n,e):function(i,s){let o=c1(i,s),a=bk(o)+bk(i.Pe);return I0(o)&&I0(i.Pe)?a1(a):eA(i.serializer,a)}(n,e)}function X8(n,e,t){return n instanceof da?l1(n,e):n instanceof ha?u1(n,e):t}function c1(n,e){return n instanceof Zc?function(r){return I0(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Xc=class extends Qc{},da=class extends Qc{constructor(e){super(),this.elements=e}};function l1(n,e){let t=d1(e);for(let r of n.elements)t.some(i=>Ri(i,r))||t.push(r);return{arrayValue:{values:t}}}var ha=class extends Qc{constructor(e){super(),this.elements=e}};function u1(n,e){let t=d1(e);for(let r of n.elements)t=t.filter(i=>!Ri(i,r));return{arrayValue:{values:t}}}var Zc=class extends Qc{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function bk(n){return vt(n.integerValue||n.doubleValue)}function d1(n){return XI(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Z8(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof da&&i instanceof da||r instanceof ha&&i instanceof ha?Gc(r.elements,i.elements,Ri):r instanceof Zc&&i instanceof Zc?Ri(r.Pe,i.Pe):r instanceof Xc&&i instanceof Xc}(n.transform,e.transform)}var L0=class{constructor(e,t){this.version=e,this.transformResults=t}},ro=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function im(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Jc=class{};function h1(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new hm(n.key,ro.none()):new fa(n.key,n.data,ro.none());{let t=n.data,r=cr.empty(),i=new wn(lr.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Pi(n.key,r,new br(i.toArray()),ro.none())}}function J8(n,e,t){n instanceof fa?function(i,s,o){let a=i.value.clone(),c=Ik(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Pi?function(i,s,o){if(!im(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=Ik(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(f1(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Yu(n,e,t,r){return n instanceof fa?function(s,o,a,c){if(!im(s.precondition,o))return a;let l=s.value.clone(),u=Ak(s.fieldTransforms,c,o);return l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof Pi?function(s,o,a,c){if(!im(s.precondition,o))return a;let l=Ak(s.fieldTransforms,c,o),u=o.data;return u.setAll(f1(s)),u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(n,e,t,r):function(s,o,a){return im(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function eK(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=c1(r.transform,i||null);s!=null&&(t===null&&(t=cr.empty()),t.set(r.field,s))}return t||null}function Ek(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Gc(r,i,(s,o)=>Z8(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var fa=class extends Jc{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Pi=class extends Jc{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function f1(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Ik(n,e,t){let r=new Map;at(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,X8(o,a,t[i]))}return r}function Ak(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,Q8(s,o,e))}return r}var hm=class extends Jc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},F0=class extends Jc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var V0=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&J8(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Yu(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Yu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=o1();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let c=h1(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(Te.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ge())}isEqual(e){return this.batchId===e.batchId&&Gc(this.mutations,e.mutations,(t,r)=>Ek(t,r))&&Gc(this.baseMutations,e.baseMutations,(t,r)=>Ek(t,r))}},j0=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){at(e.mutations.length===r.length);let i=function(){return z8}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var $0=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var U0=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var kt,Xe;function tK(n){switch(n){default:return me();case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0}}function p1(n){if(n===void 0)return us("GRPC error has no .code"),j.UNKNOWN;switch(n){case kt.OK:return j.OK;case kt.CANCELLED:return j.CANCELLED;case kt.UNKNOWN:return j.UNKNOWN;case kt.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case kt.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case kt.INTERNAL:return j.INTERNAL;case kt.UNAVAILABLE:return j.UNAVAILABLE;case kt.UNAUTHENTICATED:return j.UNAUTHENTICATED;case kt.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case kt.NOT_FOUND:return j.NOT_FOUND;case kt.ALREADY_EXISTS:return j.ALREADY_EXISTS;case kt.PERMISSION_DENIED:return j.PERMISSION_DENIED;case kt.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case kt.ABORTED:return j.ABORTED;case kt.OUT_OF_RANGE:return j.OUT_OF_RANGE;case kt.UNIMPLEMENTED:return j.UNIMPLEMENTED;case kt.DATA_LOSS:return j.DATA_LOSS;default:return me()}}(Xe=kt||(kt={}))[Xe.OK=0]="OK",Xe[Xe.CANCELLED=1]="CANCELLED",Xe[Xe.UNKNOWN=2]="UNKNOWN",Xe[Xe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xe[Xe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xe[Xe.NOT_FOUND=5]="NOT_FOUND",Xe[Xe.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xe[Xe.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xe[Xe.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xe[Xe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xe[Xe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xe[Xe.ABORTED=10]="ABORTED",Xe[Xe.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xe[Xe.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xe[Xe.INTERNAL=13]="INTERNAL",Xe[Xe.UNAVAILABLE=14]="UNAVAILABLE",Xe[Xe.DATA_LOSS=15]="DATA_LOSS";var Tk=null;function nK(){return new TextEncoder}var rK=new no([4294967295,4294967295],0);function Ck(n){let e=nK().encode(n),t=new n0;return t.update(e),new Uint8Array(t.digest())}function Sk(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new no([t,r],0),new no([i,s],0)]}var B0=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new oa(`Invalid padding: ${t}`);if(r<0)throw new oa(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new oa(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new oa(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=no.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(no.fromNumber(r)));return i.compare(rK)===1&&(i=new no([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Ck(e),[r,i]=Sk(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=Ck(e),[r,i]=Sk(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},oa=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var fm=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Ju.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(Te.min(),i,new Ct(tt),hs(),Ge())}},Ju=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Ge(),Ge(),Ge())}};var Hc=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},pm=class{constructor(e,t){this.targetId=e,this.me=t}},mm=class{constructor(e,t,r=bn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},gm=class{constructor(){this.fe=0,this.ge=xk(),this.pe=bn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ge(),t=Ge(),r=Ge();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:me()}}),new Ju(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=xk()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,at(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},H0=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=hs(),this.qe=Dk(),this.Qe=new Ct(tt)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:me()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(N0(s))if(r===0){let o=new le(s.path);this.Ue(t,o,Yr.newNoDocument(o,Te.min()))}else at(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),c=a?this.Xe(a,e,o):1;if(c!==0){this.je(t);let l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,l)}Tk?.et(function(u,d,f,p,y){var w,b,E,D,x,N;let L={localCacheCount:u,existenceFilterCount:d.count,databaseId:f.database,projectId:f.projectId},F=d.unchangedNames;return F&&(L.bloomFilter={applied:y===0,hashCount:(w=F?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(D=(E=(b=F?.bits)===null||b===void 0?void 0:b.bitmap)===null||E===void 0?void 0:E.length)!==null&&D!==void 0?D:0,padding:(N=(x=F?.bits)===null||x===void 0?void 0:x.padding)!==null&&N!==void 0?N:0,mightContain:T=>{var A;return(A=p?.mightContain(T))!==null&&A!==void 0&&A}}),L}(o,e.me,this.Le.tt(),a,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=so(r).toUint8Array()}catch(c){if(c instanceof lm)return zc("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new B0(o,i,s)}catch(c){return zc(c instanceof oa?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&N0(a.target)){let c=new le(a.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,Yr.newNoDocument(c,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=Ge();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let l=this.Je(c);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new fm(e,t,this.Qe,this.ke,r);return this.ke=hs(),this.qe=Dk(),this.Qe=new Ct(tt),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new gm,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new wn(tt),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||te("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new gm),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Dk(){return new Ct(le.comparator)}function xk(){return new Ct(le.comparator)}var iK={asc:"ASCENDING",desc:"DESCENDING"},sK={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oK={and:"AND",or:"OR"},q0=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function z0(n,e){return n.useProto3Json||Lm(e)?e:{value:e}}function ym(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function m1(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function aK(n,e){return ym(n,e.toTimestamp())}function xi(n){return at(!!n),Te.fromTimestamp(function(t){let r=ds(t);return new an(r.seconds,r.nanos)}(n))}function tA(n,e){return G0(n,e).canonicalString()}function G0(n,e){let t=function(i){return new Et(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function g1(n){let e=Et.fromString(n);return at(b1(e)),e}function W0(n,e){return tA(n.databaseId,e.path)}function c0(n,e){let t=g1(e);if(t.get(1)!==n.databaseId.projectId)throw new K(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new K(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new le(_1(t))}function y1(n,e){return tA(n.databaseId,e)}function cK(n){let e=g1(n);return e.length===4?Et.emptyPath():_1(e)}function K0(n){return new Et(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function _1(n){return at(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Rk(n,e,t){return{name:W0(n,e),fields:t.value.mapValue.fields}}function lK(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:me()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,u){return l.useProto3Json?(at(u===void 0||typeof u=="string"),bn.fromBase64String(u||"")):(at(u===void 0||u instanceof Buffer||u instanceof Uint8Array),bn.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){let u=l.code===void 0?j.UNKNOWN:p1(l.code);return new K(u,l.message||"")}(o);t=new mm(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=c0(n,r.document.name),s=xi(r.document.updateTime),o=r.document.createTime?xi(r.document.createTime):Te.min(),a=new cr({mapValue:{fields:r.document.fields}}),c=Yr.newFoundDocument(i,s,o,a),l=r.targetIds||[],u=r.removedTargetIds||[];t=new Hc(l,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=c0(n,r.document),s=r.readTime?xi(r.readTime):Te.min(),o=Yr.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Hc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=c0(n,r.document),s=r.removedTargetIds||[];t=new Hc([],s,i,null)}else{if(!("filter"in e))return me();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new U0(i,s),a=r.targetId;t=new pm(a,o)}}return t}function uK(n,e){let t;if(e instanceof fa)t={update:Rk(n,e.key,e.value)};else if(e instanceof hm)t={delete:W0(n,e.key)};else if(e instanceof Pi)t={update:Rk(n,e.key,e.data),updateMask:vK(e.fieldMask)};else{if(!(e instanceof F0))return me();t={verify:W0(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Xc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof da)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ha)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Zc)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw me()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:aK(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:me()}(n,e.precondition)),t}function dK(n,e){return n&&n.length>0?(at(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?xi(i.updateTime):xi(s);return o.isEqual(Te.min())&&(o=xi(s)),new L0(o,i.transformResults||[])}(t,e))):[]}function hK(n,e){return{documents:[y1(n,e.path)]}}function fK(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=y1(n,i);let s=function(l){if(l.length!==0)return w1(Qr.create(l,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(l){if(l.length!==0)return l.map(u=>function(f){return{field:jc(f.field),direction:gK(f.dir)}}(u))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=z0(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{_t:t,parent:i}}function pK(n){let e=cK(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){at(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=function(d){let f=v1(d);return f instanceof Qr&&Qk(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(d){return d.map(f=>function(y){return new ua($c(y.field),function(b){switch(b){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(f))}(t.orderBy));let a=null;t.limit&&(a=function(d){let f;return f=typeof d=="object"?d.value:d,Lm(f)?null:f}(t.limit));let c=null;t.startAt&&(c=function(d){let f=!!d.before,p=d.values||[];return new Yc(p,f)}(t.startAt));let l=null;return t.endAt&&(l=function(d){let f=!d.before,p=d.values||[];return new Yc(p,f)}(t.endAt)),$8(e,i,o,s,a,"F",c,l)}function mK(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return me()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function v1(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=$c(t.unaryFilter.field);return Ft.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=$c(t.unaryFilter.field);return Ft.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=$c(t.unaryFilter.field);return Ft.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=$c(t.unaryFilter.field);return Ft.create(o,"!=",{nullValue:"NULL_VALUE"});default:return me()}}(n):n.fieldFilter!==void 0?function(t){return Ft.create($c(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return me()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Qr.create(t.compositeFilter.filters.map(r=>v1(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return me()}}(t.compositeFilter.op))}(n):me()}function gK(n){return iK[n]}function yK(n){return sK[n]}function _K(n){return oK[n]}function jc(n){return{fieldPath:n.canonicalString()}}function $c(n){return lr.fromServerFormat(n.fieldPath)}function w1(n){return n instanceof Ft?function(t){if(t.op==="=="){if(gk(t.value))return{unaryFilter:{field:jc(t.field),op:"IS_NAN"}};if(mk(t.value))return{unaryFilter:{field:jc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(gk(t.value))return{unaryFilter:{field:jc(t.field),op:"IS_NOT_NAN"}};if(mk(t.value))return{unaryFilter:{field:jc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jc(t.field),op:yK(t.op),value:t.value}}}(n):n instanceof Qr?function(t){let r=t.getFilters().map(i=>w1(i));return r.length===1?r[0]:{compositeFilter:{op:_K(t.op),filters:r}}}(n):me()}function vK(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function b1(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ed=class n{constructor(e,t,r,i,s=Te.min(),o=Te.min(),a=bn.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Y0=class{constructor(e){this.ct=e}};function wK(n){let e=pK({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?k0(e,e.limit,"L"):e}var _m=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(vt(e.integerValue));else if("doubleValue"in e){let r=vt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Qu(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ds(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(so(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Wk(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Gk(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):me()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let o="value",a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(vt(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),le.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};_m.vt=new _m;var Q0=class{constructor(){this.un=new X0}addToCollectionParentIndex(e,t){return this.un.add(t),H.resolve()}getCollectionParents(e,t){return H.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return H.resolve()}deleteFieldIndex(e,t){return H.resolve()}deleteAllFieldIndexes(e){return H.resolve()}createTargetIndexes(e,t){return H.resolve()}getDocumentsMatchingTarget(e,t){return H.resolve(null)}getIndexType(e,t){return H.resolve(0)}getFieldIndexes(e,t){return H.resolve([])}getNextCollectionGroupToUpdate(e){return H.resolve(null)}getMinOffset(e,t){return H.resolve(ca.min())}getMinOffsetFromCollectionGroup(e,t){return H.resolve(ca.min())}updateCollectionGroup(e,t,r){return H.resolve()}updateIndexEntries(e,t){return H.resolve()}},X0=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new wn(Et.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new wn(Et.comparator)).toArray()}};var Xfe=new Uint8Array(0);var Ti=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Ti.DEFAULT_COLLECTION_PERCENTILE=10,Ti.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ti.DEFAULT=new Ti(41943040,Ti.DEFAULT_COLLECTION_PERCENTILE,Ti.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ti.DISABLED=new Ti(-1,0,0);var td=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var Z0=class{constructor(){this.changes=new ao(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Yr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?H.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var J0=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var eI=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Yu(r.mutation,i,br.empty(),an.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ge()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ge()){let i=sa();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=zu();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=sa();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ge()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=hs(),o=Ku(),a=function(){return Ku()}();return t.forEach((c,l)=>{let u=r.get(l.key);i.has(l.key)&&(u===void 0||u.mutation instanceof Pi)?s=s.insert(l.key,l):u!==void 0?(o.set(l.key,u.mutation.getFieldMask()),Yu(u.mutation,l,u.mutation.getFieldMask(),an.now())):o.set(l.key,br.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((l,u)=>o.set(l,u)),t.forEach((l,u)=>{var d;return a.set(l,new J0(u,(d=o.get(l))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Ku(),i=new Ct((o,a)=>o-a),s=Ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let l=t.get(c);if(l===null)return;let u=r.get(c)||br.empty();u=a.applyToLocalView(l,u),r.set(c,u);let d=(i.get(a.batchId)||Ge()).add(c);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),l=c.key,u=c.value,d=o1();u.forEach(f=>{if(!s.has(f)){let p=h1(t.get(f),r.get(f));p!==null&&d.set(f,p),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,d))}return H.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return le.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):t1(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):H.resolve(sa()),a=-1,c=s;return o.next(l=>H.forEach(l,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?H.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{c=c.insert(u,f)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,c,l,Ge())).next(u=>({batchId:a,changes:s1(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new le(t)).next(r=>{let i=zu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=zu();return this.indexManager.getCollectionParents(e,s).next(a=>H.forEach(a,c=>{let l=function(d,f){return new oo(f,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(u=>{u.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((c,l)=>{let u=l.getKey();o.get(u)===null&&(o=o.insert(u,Yr.newInvalidDocument(u)))});let a=zu();return o.forEach((c,l)=>{let u=s.get(c);u!==void 0&&Yu(u.mutation,l,br.empty(),an.now()),Vm(t,l)&&(a=a.insert(c,l))}),a})}};var tI=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return H.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:xi(i.createTime)}}(t)),H.resolve()}getNamedQuery(e,t){return H.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:wK(i.bundledQuery),readTime:xi(i.readTime)}}(t)),H.resolve()}};var nI=class{constructor(){this.overlays=new Ct(le.comparator),this.Ir=new Map}getOverlay(e,t){return H.resolve(this.overlays.get(t))}getOverlays(e,t){let r=sa();return H.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),H.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),H.resolve()}getOverlaysForCollection(e,t,r){let i=sa(),s=t.length+1,o=new le(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return H.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ct((l,u)=>l-u),o=this.overlays.getIterator();for(;o.hasNext();){let l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let u=s.get(l.largestBatchId);u===null&&(u=sa(),s=s.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}let a=sa(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=i)););return H.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new $0(t,r));let s=this.Ir.get(t);s===void 0&&(s=Ge(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var rI=class{constructor(){this.sessionToken=bn.EMPTY_BYTE_STRING}getSessionToken(e){return H.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,H.resolve()}};var nd=class{constructor(){this.Tr=new wn(Lt.Er),this.dr=new wn(Lt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new Lt(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Lt(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new le(new Et([])),r=new Lt(t,e),i=new Lt(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new le(new Et([])),r=new Lt(t,e),i=new Lt(t,e+1),s=Ge();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Lt(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Lt=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return le.comparator(e.key,t.key)||tt(e.wr,t.wr)}static Ar(e,t){return tt(e.wr,t.wr)||le.comparator(e.key,t.key)}};var iI=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new wn(Lt.Er)}checkEmpty(e){return H.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new V0(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.br=this.br.add(new Lt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return H.resolve(o)}lookupMutationBatch(e,t){return H.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return H.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return H.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return H.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Lt(t,0),i=new Lt(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let a=this.Dr(o.wr);s.push(a)}),H.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new wn(tt);return t.forEach(i=>{let s=new Lt(i,0),o=new Lt(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{r=r.add(a.wr)})}),H.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;le.isDocumentKey(s)||(s=s.child(""));let o=new Lt(new le(s),0),a=new wn(tt);return this.br.forEachWhile(c=>{let l=c.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(a=a.add(c.wr)),!0)},o),H.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){at(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return H.forEach(t.mutations,i=>{let s=new Lt(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new Lt(t,0),i=this.br.firstAfterOrEqual(r);return H.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,H.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var sI=class{constructor(e){this.Mr=e,this.docs=function(){return new Ct(le.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return H.resolve(r?r.document.mutableCopy():Yr.newInvalidDocument(t))}getEntries(e,t){let r=hs();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Yr.newInvalidDocument(i))}),H.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=hs(),o=t.path,a=new le(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:l,value:{document:u}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||x8(D8(u),r)<=0||(i.has(u.key)||Vm(t,u))&&(s=s.insert(u.key,u.mutableCopy()))}return H.resolve(s)}getAllFromCollectionGroup(e,t,r,i){me()}Or(e,t){return H.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new oI(this)}getSize(e){return H.resolve(this.size)}},oI=class extends Z0{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),H.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var aI=class{constructor(e){this.persistence=e,this.Nr=new ao(t=>ZI(t),JI),this.lastRemoteSnapshotVersion=Te.min(),this.highestTargetId=0,this.Lr=0,this.Br=new nd,this.targetCount=0,this.kr=td.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),H.resolve()}getLastRemoteSnapshotVersion(e){return H.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return H.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),H.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),H.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new td(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,H.resolve()}updateTargetData(e,t){return this.Kn(t),H.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,H.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),H.waitFor(s).next(()=>i)}getTargetCount(e){return H.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return H.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),H.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),H.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),H.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return H.resolve(r)}containsKey(e,t){return H.resolve(this.Br.containsKey(t))}};var cI=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new qk(0),this.Kr=!1,this.Kr=!0,this.$r=new rI,this.referenceDelegate=e(this),this.Ur=new aI(this),this.indexManager=new Q0,this.remoteDocumentCache=function(i){return new sI(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Y0(t),this.Gr=new tI(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nI,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new iI(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){te("MemoryPersistence","Starting transaction:",e);let i=new lI(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return H.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},lI=class extends w0{constructor(e){super(),this.currentSequenceNumber=e}},uI=class n{constructor(e){this.persistence=e,this.Jr=new nd,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw me()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),H.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),H.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),H.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return H.forEach(this.Xr,r=>{let i=le.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,Te.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return H.or([()=>H.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var dI=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=Ge(),i=Ge();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var hI=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var fI=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return GN()?8:P8(Xt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new hI;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(qu()<=ze.DEBUG&&te("QueryEngine","SDK will not create cache indexes for query:",Vc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),H.resolve()):(qu()<=ze.DEBUG&&te("QueryEngine","Query:",Vc(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(qu()<=ze.DEBUG&&te("QueryEngine","The SDK decides to create cache indexes for query:",Vc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Di(t))):H.resolve())}Yi(e,t){if(wk(t))return H.resolve(null);let r=Di(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=k0(t,null,"F"),r=Di(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Ge(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{let l=this.ts(t,a);return this.ns(t,l,o,c.readTime)?this.Yi(e,k0(t,null,"F")):this.rs(e,l,t,c)}))})))}Zi(e,t,r,i){return wk(t)||i.isEqual(Te.min())?H.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let o=this.ts(t,s);return this.ns(t,o,r,i)?H.resolve(null):(qu()<=ze.DEBUG&&te("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Vc(t)),this.rs(e,o,t,S8(i,-1)).next(a=>a))})}ts(e,t){let r=new wn(r1(e));return t.forEach((i,s)=>{Vm(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return qu()<=ze.DEBUG&&te("QueryEngine","Using full collection scan to execute query:",Vc(t)),this.Ji.getDocumentsMatchingQuery(e,t,ca.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var pI=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new Ct(tt),this._s=new ao(s=>ZI(s),JI),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new eI(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function bK(n,e,t,r){return new pI(n,e,t,r)}function E1(n,e){return g(this,null,function*(){let t=be(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=Ge();for(let l of i){o.push(l.batchId);for(let u of l.mutations)c=c.add(u.key)}for(let l of s){a.push(l.batchId);for(let u of l.mutations)c=c.add(u.key)}return t.localDocuments.getDocuments(r,c).next(l=>({hs:l,removedBatchIds:o,addedBatchIds:a}))})})})}function EK(n,e){let t=be(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,c,l,u){let d=l.batch,f=d.keys(),p=H.resolve();return f.forEach(y=>{p=p.next(()=>u.getEntry(c,y)).next(w=>{let b=l.docVersions.get(y);at(b!==null),w.version.compareTo(b)<0&&(d.applyToRemoteDocument(w,l),w.isValidDocument()&&(w.setReadTime(l.commitVersion),u.addEntry(w)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(c,d))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=Ge();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(c=c.add(a.batch.mutations[l].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function I1(n){let e=be(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function IK(n,e){let t=be(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let a=[];e.targetChanges.forEach((u,d)=>{let f=i.get(d);if(!f)return;a.push(t.Ur.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.Ur.addMatchingKeys(s,u.addedDocuments,d)));let p=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?p=p.withResumeToken(bn.EMPTY_BYTE_STRING,Te.min()).withLastLimboFreeSnapshotVersion(Te.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(d,p),function(w,b,E){return w.resumeToken.approximateByteSize()===0||b.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0}(f,p,u)&&a.push(t.Ur.updateTargetData(s,p))});let c=hs(),l=Ge();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(AK(s,o,e.documentUpdates).next(u=>{c=u.Ps,l=u.Is})),!r.isEqual(Te.min())){let u=t.Ur.getLastRemoteSnapshotVersion(s).next(d=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return H.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,l)).next(()=>c)}).then(s=>(t.os=i,s))}function AK(n,e,t){let r=Ge(),i=Ge();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=hs();return t.forEach((a,c)=>{let l=s.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(Te.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):te("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{Ps:o,Is:i}})}function TK(n,e){let t=be(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function CK(n,e){let t=be(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,H.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new ed(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function mI(n,e,t){return g(this,null,function*(){let r=be(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!ld(o))throw o;te("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function Pk(n,e,t){let r=be(n),i=Te.min(),s=Ge();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,l,u){let d=be(c),f=d._s.get(u);return f!==void 0?H.resolve(d.os.get(f)):d.Ur.getTargetData(l,u)}(r,o,Di(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:Te.min(),t?s:Ge())).next(a=>(SK(r,B8(e),a),{documents:a,Ts:s})))}function SK(n,e,t){let r=n.us.get(e)||Te.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}var vm=class{constructor(){this.activeTargetIds=K8()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var gI=class{constructor(){this.so=new vm,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new vm,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var yI=class{_o(e){}shutdown(){}};var wm=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){te("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){te("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var nm=null;function l0(){return nm===null?nm=function(){return 268435456+Math.round(2147483648*Math.random())}():nm++,"0x"+nm.toString(16)}var DK={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var _I=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var vn="WebChannelConnection",vI=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){let a=l0(),c=this.xo(t,r.toUriEncodedString());te("RestConnection",`Sending RPC '${t}' ${a}:`,c,i);let l={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(l,s,o),this.No(t,c,l,i).then(u=>(te("RestConnection",`Received RPC '${t}' ${a}: `,u),u),u=>{throw zc("RestConnection",`RPC '${t}' ${a} failed with error: `,u,"url: ",c,"request:",i),u})}Lo(t,r,i,s,o,a){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+sl}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){let i=DK[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=l0();return new Promise((o,a)=>{let c=new r0;c.setWithCredentials(!0),c.listenOnce(i0.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Hu.NO_ERROR:let u=c.getResponseJson();te(vn,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(u)),o(u);break;case Hu.TIMEOUT:te(vn,`RPC '${e}' ${s} timed out`),a(new K(j.DEADLINE_EXCEEDED,"Request time out"));break;case Hu.HTTP_ERROR:let d=c.getStatus();if(te(vn,`RPC '${e}' ${s} failed with status:`,d,"response text:",c.getResponseText()),d>0){let f=c.getResponseJson();Array.isArray(f)&&(f=f[0]);let p=f?.error;if(p&&p.status&&p.message){let y=function(b){let E=b.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(E)>=0?E:j.UNKNOWN}(p.status);a(new K(y,p.message))}else a(new K(j.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new K(j.UNAVAILABLE,"Connection failed."));break;default:me()}}finally{te(vn,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(i);te(vn,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",l,r,15)})}Bo(e,t,r){let i=l0(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=a0(),a=o0(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;let u=s.join("");te(vn,`Creating RPC '${e}' stream ${i}: ${u}`,c);let d=o.createWebChannel(u,c),f=!1,p=!1,y=new _I({Io:b=>{p?te(vn,`Not sending because RPC '${e}' stream ${i} is closed:`,b):(f||(te(vn,`Opening RPC '${e}' stream ${i} transport.`),d.open(),f=!0),te(vn,`RPC '${e}' stream ${i} sending:`,b),d.send(b))},To:()=>d.close()}),w=(b,E,D)=>{b.listen(E,x=>{try{D(x)}catch(N){setTimeout(()=>{throw N},0)}})};return w(d,Fc.EventType.OPEN,()=>{p||(te(vn,`RPC '${e}' stream ${i} transport opened.`),y.yo())}),w(d,Fc.EventType.CLOSE,()=>{p||(p=!0,te(vn,`RPC '${e}' stream ${i} transport closed`),y.So())}),w(d,Fc.EventType.ERROR,b=>{p||(p=!0,zc(vn,`RPC '${e}' stream ${i} transport errored:`,b),y.So(new K(j.UNAVAILABLE,"The operation could not be completed")))}),w(d,Fc.EventType.MESSAGE,b=>{var E;if(!p){let D=b.data[0];at(!!D);let x=D,N=x.error||((E=x[0])===null||E===void 0?void 0:E.error);if(N){te(vn,`RPC '${e}' stream ${i} received error:`,N);let L=N.status,F=function(C){let R=kt[C];if(R!==void 0)return p1(R)}(L),T=N.message;F===void 0&&(F=j.INTERNAL,T="Unknown error status: "+L+" with message "+N.message),p=!0,y.So(new K(F,T)),d.close()}else te(vn,`RPC '${e}' stream ${i} received:`,D),y.bo(D)}}),w(a,s0.STAT_EVENT,b=>{b.stat===em.PROXY?te(vn,`RPC '${e}' stream ${i} detected buffering proxy`):b.stat===em.NOPROXY&&te(vn,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{y.wo()},0),y}};function u0(){return typeof document<"u"?document:null}function jm(n){return new q0(n,!0)}var bm=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&te("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Em=class{constructor(e,t,r,i,s,o,a,c){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new bm(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return g(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return g(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return g(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===j.RESOURCE_EXHAUSTED?(us(t.toString()),us("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===j.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new K(j.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>g(this,null,function*(){this.state=0,this.start()}))}I_(e){return te("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(te("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},wI=class extends Em{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=lK(this.serializer,e),r=function(s){if(!("targetChange"in s))return Te.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?Te.min():o.readTime?xi(o.readTime):Te.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=K0(this.serializer),t.addTarget=function(s,o){let a,c=o.target;if(a=N0(c)?{documents:hK(s,c)}:{query:fK(s,c)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=m1(s,o.resumeToken);let l=z0(s,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(Te.min())>0){a.readTime=ym(s,o.snapshotVersion.toTimestamp());let l=z0(s,o.expectedCount);l!==null&&(a.expectedCount=l)}return a}(this.serializer,e);let r=mK(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=K0(this.serializer),t.removeTarget=e,this.a_(t)}},bI=class extends Em{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return at(!!e.streamToken),this.lastStreamToken=e.streamToken,at(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){at(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=dK(e.writeResults,e.commitTime),r=xi(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=K0(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>uK(this.serializer,r))};this.a_(t)}};var EI=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new K(j.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,G0(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new K(j.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,G0(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new K(j.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},II=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(us(t),this.D_=!1):te("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var AI=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>g(this,null,function*(){ga(this)&&(te("RemoteStore","Restarting streams for network reachability change."),yield function(c){return g(this,null,function*(){let l=be(c);l.L_.add(4),yield ud(l),l.q_.set("Unknown"),l.L_.delete(4),yield $m(l)})}(this))}))}),this.q_=new II(r,i)}};function $m(n){return g(this,null,function*(){if(ga(n))for(let e of n.B_)yield e(!0)})}function ud(n){return g(this,null,function*(){for(let e of n.B_)yield e(!1)})}function A1(n,e){let t=be(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),sA(t)?iA(t):ol(t).r_()&&rA(t,e))}function nA(n,e){let t=be(n),r=ol(t);t.N_.delete(e),r.r_()&&T1(t,e),t.N_.size===0&&(r.r_()?r.o_():ga(t)&&t.q_.set("Unknown"))}function rA(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Te.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ol(n).A_(e)}function T1(n,e){n.Q_.xe(e),ol(n).R_(e)}function iA(n){n.Q_=new H0({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ol(n).start(),n.q_.v_()}function sA(n){return ga(n)&&!ol(n).n_()&&n.N_.size>0}function ga(n){return be(n).L_.size===0}function C1(n){n.Q_=void 0}function xK(n){return g(this,null,function*(){n.q_.set("Online")})}function RK(n){return g(this,null,function*(){n.N_.forEach((e,t)=>{rA(n,e)})})}function PK(n,e){return g(this,null,function*(){C1(n),sA(n)?(n.q_.M_(e),iA(n)):n.q_.set("Unknown")})}function MK(n,e,t){return g(this,null,function*(){if(n.q_.set("Online"),e instanceof mm&&e.state===2&&e.cause)try{yield function(i,s){return g(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.N_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.N_.delete(a),i.Q_.removeTarget(a))})}(n,e)}catch(r){te("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Im(n,r)}else if(e instanceof Hc?n.Q_.Ke(e):e instanceof pm?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Te.min()))try{let r=yield I1(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.Q_.rt(o);return a.targetChanges.forEach((c,l)=>{if(c.resumeToken.approximateByteSize()>0){let u=s.N_.get(l);u&&s.N_.set(l,u.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,l)=>{let u=s.N_.get(c);if(!u)return;s.N_.set(c,u.withResumeToken(bn.EMPTY_BYTE_STRING,u.snapshotVersion)),T1(s,c);let d=new ed(u.target,c,l,u.sequenceNumber);rA(s,d)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){te("RemoteStore","Failed to raise snapshot:",r),yield Im(n,r)}})}function Im(n,e,t){return g(this,null,function*(){if(!ld(e))throw e;n.L_.add(1),yield ud(n),n.q_.set("Offline"),t||(t=()=>I1(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){te("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield $m(n)}))})}function S1(n,e){return e().catch(t=>Im(n,t,e))}function Um(n){return g(this,null,function*(){let e=be(n),t=co(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;NK(e);)try{let i=yield TK(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,OK(e,i)}catch(i){yield Im(e,i)}D1(e)&&x1(e)})}function NK(n){return ga(n)&&n.O_.length<10}function OK(n,e){n.O_.push(e);let t=co(n);t.r_()&&t.V_&&t.m_(e.mutations)}function D1(n){return ga(n)&&!co(n).n_()&&n.O_.length>0}function x1(n){co(n).start()}function kK(n){return g(this,null,function*(){co(n).p_()})}function LK(n){return g(this,null,function*(){let e=co(n);for(let t of n.O_)e.m_(t.mutations)})}function FK(n,e,t){return g(this,null,function*(){let r=n.O_.shift(),i=j0.from(r,e,t);yield S1(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Um(n)})}function VK(n,e){return g(this,null,function*(){e&&co(n).V_&&(yield function(r,i){return g(this,null,function*(){if(function(o){return tK(o)&&o!==j.ABORTED}(i.code)){let s=r.O_.shift();co(r).s_(),yield S1(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Um(r)}})}(n,e)),D1(n)&&x1(n)})}function Mk(n,e){return g(this,null,function*(){let t=be(n);t.asyncQueue.verifyOperationInProgress(),te("RemoteStore","RemoteStore received new credentials");let r=ga(t);t.L_.add(3),yield ud(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield $m(t)})}function jK(n,e){return g(this,null,function*(){let t=be(n);e?(t.L_.delete(2),yield $m(t)):e||(t.L_.add(2),yield ud(t),t.q_.set("Unknown"))})}function ol(n){return n.K_||(n.K_=function(t,r,i){let s=be(t);return s.w_(),new wI(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:xK.bind(null,n),Ro:RK.bind(null,n),mo:PK.bind(null,n),d_:MK.bind(null,n)}),n.B_.push(e=>g(this,null,function*(){e?(n.K_.s_(),sA(n)?iA(n):n.q_.set("Unknown")):(yield n.K_.stop(),C1(n))}))),n.K_}function co(n){return n.U_||(n.U_=function(t,r,i){let s=be(t);return s.w_(),new bI(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:kK.bind(null,n),mo:VK.bind(null,n),f_:LK.bind(null,n),g_:FK.bind(null,n)}),n.B_.push(e=>g(this,null,function*(){e?(n.U_.s_(),yield Um(n)):(yield n.U_.stop(),n.O_.length>0&&(te("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var TI=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ci,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new K(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function oA(n,e){if(us("AsyncQueue",`${e}: ${n}`),ld(n))return new K(j.UNAVAILABLE,`${e}: ${n}`);throw n}var Am=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||le.comparator(t.key,r.key):(t,r)=>le.comparator(t.key,r.key),this.keyedMap=zu(),this.sortedSet=new Ct(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Tm=class{constructor(){this.W_=new Ct(le.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):me():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},el=class n{constructor(e,t,r,i,s,o,a,c,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Am.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Fm(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var CI=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},SI=class{constructor(){this.queries=Nk(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=be(t),s=i.queries;i.queries=Nk(),s.forEach((o,a)=>{for(let c of a.j_)c.onError(r)})})(this,new K(j.ABORTED,"Firestore shutting down"))}};function Nk(){return new ao(n=>n1(n),Fm)}function $K(n,e){return g(this,null,function*(){let t=be(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new CI,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=oA(o,`Initialization of query '${Vc(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&aA(t)})}function UK(n,e){return g(this,null,function*(){let t=be(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function BK(n,e){let t=be(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.j_)a.X_(i)&&(r=!0);o.z_=i}}r&&aA(t)}function HK(n,e,t){let r=be(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function aA(n){n.Y_.forEach(e=>{e.next()})}var DI,Ok;(Ok=DI||(DI={})).ea="default",Ok.Cache="cache";var xI=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new el(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=el.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==DI.Cache}};var Cm=class{constructor(e){this.key=e}},Sm=class{constructor(e){this.key=e}},RI=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ge(),this.mutatedKeys=Ge(),this.Aa=r1(e),this.Ra=new Am(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new Tm,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let f=i.get(u),p=Vm(this.query,d)?d:null,y=!!f&&this.mutatedKeys.has(f.key),w=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations),b=!1;f&&p?f.data.isEqual(p.data)?y!==w&&(r.track({type:3,doc:p}),b=!0):this.ga(f,p)||(r.track({type:2,doc:p}),b=!0,(c&&this.Aa(p,c)>0||l&&this.Aa(p,l)<0)&&(a=!0)):!f&&p?(r.track({type:0,doc:p}),b=!0):f&&!p&&(r.track({type:1,doc:f}),b=!0,(c||l)&&(a=!0)),b&&(p?(o=o.add(p),s=w?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{Ra:o,fa:r,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((u,d)=>function(p,y){let w=b=>{switch(b){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return me()}};return w(p)-w(y)}(u.type,d.type)||this.Aa(u.doc,d.doc)),this.pa(r),i=i!=null&&i;let a=t&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,l=c!==this.Ea;return this.Ea=c,o.length!==0||l?{snapshot:new el(this.query,e.Ra,s,o,e.mutatedKeys,c===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Tm,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=Ge(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Sm(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Cm(r))}),t}ba(e){this.Ta=e.Ts,this.da=Ge();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return el.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},PI=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},MI=class{constructor(e){this.key=e,this.va=!1}},NI=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ao(a=>n1(a),Fm),this.Ma=new Map,this.xa=new Set,this.Oa=new Ct(le.comparator),this.Na=new Map,this.La=new nd,this.Ba={},this.ka=new Map,this.qa=td.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function qK(n,e,t=!0){return g(this,null,function*(){let r=k1(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield R1(r,e,t,!0),i})}function zK(n,e){return g(this,null,function*(){let t=k1(n);yield R1(t,e,!0,!1)})}function R1(n,e,t,r){return g(this,null,function*(){let i=yield CK(n.localStore,Di(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield GK(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&A1(n.remoteStore,i),a})}function GK(n,e,t,r,i){return g(this,null,function*(){n.Ka=(d,f,p)=>function(w,b,E,D){return g(this,null,function*(){let x=b.view.ma(E);x.ns&&(x=yield Pk(w.localStore,b.query,!1).then(({documents:T})=>b.view.ma(T,x)));let N=D&&D.targetChanges.get(b.targetId),L=D&&D.targetMismatches.get(b.targetId)!=null,F=b.view.applyChanges(x,w.isPrimaryClient,N,L);return Lk(w,b.targetId,F.wa),F.snapshot})}(n,d,f,p);let s=yield Pk(n.localStore,e,!0),o=new RI(e,s.Ts),a=o.ma(s.documents),c=Ju.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),l=o.applyChanges(a,n.isPrimaryClient,c);Lk(n,t,l.wa);let u=new PI(e,t,o);return n.Fa.set(e,u),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),l.snapshot})}function WK(n,e,t){return g(this,null,function*(){let r=be(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!Fm(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield mI(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&nA(r.remoteStore,i.targetId),OI(r,i.targetId)}).catch(cd))):(OI(r,i.targetId),yield mI(r.localStore,i.targetId,!0))})}function KK(n,e){return g(this,null,function*(){let t=be(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),nA(t.remoteStore,r.targetId))})}function YK(n,e,t){return g(this,null,function*(){let r=n7(n);try{let i=yield function(o,a){let c=be(o),l=an.now(),u=a.reduce((p,y)=>p.add(y.key),Ge()),d,f;return c.persistence.runTransaction("Locally write mutations","readwrite",p=>{let y=hs(),w=Ge();return c.cs.getEntries(p,u).next(b=>{y=b,y.forEach((E,D)=>{D.isValidDocument()||(w=w.add(E))})}).next(()=>c.localDocuments.getOverlayedDocuments(p,y)).next(b=>{d=b;let E=[];for(let D of a){let x=eK(D,d.get(D.key).overlayedDocument);x!=null&&E.push(new Pi(D.key,x,Kk(x.value.mapValue),ro.exists(!0)))}return c.mutationQueue.addMutationBatch(p,l,E,a)}).next(b=>{f=b;let E=b.applyToLocalDocumentSet(d,w);return c.documentOverlayCache.saveOverlays(p,b.batchId,E)})}).then(()=>({batchId:f.batchId,changes:s1(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let l=o.Ba[o.currentUser.toKey()];l||(l=new Ct(tt)),l=l.insert(a,c),o.Ba[o.currentUser.toKey()]=l}(r,i.batchId,t),yield dd(r,i.changes),yield Um(r.remoteStore)}catch(i){let s=oA(i,"Failed to persist write");t.reject(s)}})}function P1(n,e){return g(this,null,function*(){let t=be(n);try{let r=yield IK(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(at(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?at(o.va):i.removedDocuments.size>0&&(at(o.va),o.va=!1))}),yield dd(t,r,e)}catch(r){yield cd(r)}})}function kk(n,e,t){let r=be(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,o)=>{let a=o.view.Z_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=be(o);c.onlineState=a;let l=!1;c.queries.forEach((u,d)=>{for(let f of d.j_)f.Z_(a)&&(l=!0)}),l&&aA(c)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function QK(n,e,t){return g(this,null,function*(){let r=be(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let o=new Ct(le.comparator);o=o.insert(s,Yr.newNoDocument(s,Te.min()));let a=Ge().add(s),c=new fm(Te.min(),new Map,new Ct(tt),o,a);yield P1(r,c),r.Oa=r.Oa.remove(s),r.Na.delete(e),cA(r)}else yield mI(r.localStore,e,!1).then(()=>OI(r,e,t)).catch(cd)})}function XK(n,e){return g(this,null,function*(){let t=be(n),r=e.batch.batchId;try{let i=yield EK(t.localStore,e);N1(t,r,null),M1(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield dd(t,i)}catch(i){yield cd(i)}})}function ZK(n,e,t){return g(this,null,function*(){let r=be(n);try{let i=yield function(o,a){let c=be(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let u;return c.mutationQueue.lookupMutationBatch(l,a).next(d=>(at(d!==null),u=d.keys(),c.mutationQueue.removeMutationBatch(l,d))).next(()=>c.mutationQueue.performConsistencyCheck(l)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(l,u,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,u)).next(()=>c.localDocuments.getDocuments(l,u))})}(r.localStore,e);N1(r,e,t),M1(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield dd(r,i)}catch(i){yield cd(i)}})}function M1(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function N1(n,e,t){let r=be(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function OI(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||O1(n,r)})}function O1(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(nA(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),cA(n))}function Lk(n,e,t){for(let r of t)r instanceof Cm?(n.La.addReference(r.key,e),JK(n,r)):r instanceof Sm?(te("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||O1(n,r.key)):me()}function JK(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(te("SyncEngine","New document in limbo: "+t),n.xa.add(r),cA(n))}function cA(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new le(Et.fromString(e)),r=n.qa.next();n.Na.set(r,new MI(t)),n.Oa=n.Oa.insert(t,r),A1(n.remoteStore,new ed(Di(e1(t.path)),r,"TargetPurposeLimboResolution",qk.oe))}}function dd(n,e,t){return g(this,null,function*(){let r=be(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,c)=>{o.push(r.Ka(c,e,t).then(l=>{var u;if((l||t)&&r.isPrimaryClient){let d=l?!l.fromCache:(u=t?.targetChanges.get(c.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(c.targetId,d?"current":"not-current")}if(l){i.push(l);let d=dI.Wi(c.targetId,l);s.push(d)}}))}),yield Promise.all(o),r.Ca.d_(i),yield function(c,l){return g(this,null,function*(){let u=be(c);try{yield u.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>H.forEach(l,f=>H.forEach(f.$i,p=>u.persistence.referenceDelegate.addReference(d,f.targetId,p)).next(()=>H.forEach(f.Ui,p=>u.persistence.referenceDelegate.removeReference(d,f.targetId,p)))))}catch(d){if(!ld(d))throw d;te("LocalStore","Failed to update sequence numbers: "+d)}for(let d of l){let f=d.targetId;if(!d.fromCache){let p=u.os.get(f),y=p.snapshotVersion,w=p.withLastLimboFreeSnapshotVersion(y);u.os=u.os.insert(f,w)}}})}(r.localStore,s))})}function e7(n,e){return g(this,null,function*(){let t=be(n);if(!t.currentUser.isEqual(e)){te("SyncEngine","User change. New user:",e.toKey());let r=yield E1(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(c=>{c.reject(new K(j.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield dd(t,r.hs)}})}function t7(n,e){let t=be(n),r=t.Na.get(e);if(r&&r.va)return Ge().add(r.key);{let i=Ge(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let a=t.Fa.get(o);i=i.unionWith(a.view.Va)}return i}}function k1(n){let e=be(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=P1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=t7.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=QK.bind(null,e),e.Ca.d_=BK.bind(null,e.eventManager),e.Ca.$a=HK.bind(null,e.eventManager),e}function n7(n){let e=be(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=XK.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ZK.bind(null,e),e}var Fk=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return g(this,null,function*(){this.serializer=jm(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,r){return null}Ha(t,r){return null}za(t){return bK(this.persistence,new fI,t.initialUser,this.serializer)}Ga(t){return new cI(uI.Zr,this.serializer)}Wa(t){return new gI}terminate(){return g(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var r7=(()=>{class n{initialize(t,r){return g(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>kk(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=e7.bind(null,this.syncEngine),yield jK(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new SI}()}createDatastore(t){let r=jm(t.databaseInfo.databaseId),i=function(o){return new vI(o)}(t.databaseInfo);return function(o,a,c,l){return new EI(o,a,c,l)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,o,a,c){return new AI(i,s,o,a,c)}(this.localStore,this.datastore,t.asyncQueue,r=>kk(this.syncEngine,r,0),function(){return wm.D()?new wm:new yI}())}createSyncEngine(t,r){return function(s,o,a,c,l,u,d){let f=new NI(s,o,a,c,l,u);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return g(this,null,function*(){var t,r;yield function(s){return g(this,null,function*(){let o=be(s);te("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield ud(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var kI=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):us("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var LI=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Zt.UNAUTHENTICATED,this.clientId=om.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>g(this,null,function*(){te("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(te("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ci;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=oA(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function d0(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),te("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>g(this,null,function*(){r.isEqual(i)||(yield E1(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Vk(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield i7(n);te("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Mk(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Mk(e.remoteStore,i)),n._onlineComponents=e})}function i7(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){te("FirestoreClient","Using user provided OfflineComponentProvider");try{yield d0(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===j.FAILED_PRECONDITION||i.code===j.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;zc("Error using user provided cache. Falling back to memory cache: "+t),yield d0(n,new Fk)}}else te("FirestoreClient","Using default OfflineComponentProvider"),yield d0(n,new Fk);return n._offlineComponents})}function L1(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(te("FirestoreClient","Using user provided OnlineComponentProvider"),yield Vk(n,n._uninitializedComponentsProvider._online)):(te("FirestoreClient","Using default OnlineComponentProvider"),yield Vk(n,new r7))),n._onlineComponents})}function s7(n){return L1(n).then(e=>e.syncEngine)}function o7(n){return g(this,null,function*(){let e=yield L1(n),t=e.eventManager;return t.onListen=qK.bind(null,e.syncEngine),t.onUnlisten=WK.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=zK.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=KK.bind(null,e.syncEngine),t})}function a7(n,e,t={}){let r=new Ci;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(s,o,a,c,l){let u=new kI({next:f=>{u.Za(),o.enqueueAndForget(()=>UK(s,d)),f.fromCache&&c.source==="server"?l.reject(new K(j.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(f)},error:f=>l.reject(f)}),d=new xI(a,u,{includeMetadataChanges:!0,_a:!0});return $K(s,d)}(yield o7(n),n.asyncQueue,e,t,r)})),r.promise}function F1(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var jk=new Map;function V1(n,e,t){if(!t)throw new K(j.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function c7(n,e,t,r){if(e===!0&&r===!0)throw new K(j.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function $k(n){if(!le.isDocumentKey(n))throw new K(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Uk(n){if(le.isDocumentKey(n))throw new K(j.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Bm(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":me()}function tl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new K(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Bm(n);throw new K(j.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Dm=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new K(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new K(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}c7("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=F1((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new K(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new K(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new K(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},nl=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Dm({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new K(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new K(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Dm(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new h0;switch(r.type){case"firstParty":return new g0(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new K(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return g(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=jk.get(t);r&&(te("ComponentProvider","Removing Datastore"),jk.delete(t),r.terminate())}(this),Promise.resolve()}};function lA(n,e,t,r={}){var i;let s=(n=tl(n,nl))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&zc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=Zt.MOCK_USER;else{a=Sp(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new K(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Zt(l)}n._authCredentials=new f0(new sm(a,c))}}var pa=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ur=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new io(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},io=class n extends pa{constructor(e,t,r){super(e,t,e1(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ur(this.firestore,null,new le(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function j1(n,e,...t){if(n=lt(n),V1("collection","path",e),n instanceof nl){let r=Et.fromString(e,...t);return Uk(r),new io(n,null,r)}{if(!(n instanceof ur||n instanceof io))throw new K(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Et.fromString(e,...t));return Uk(r),new io(n.firestore,null,r)}}function uA(n,e,...t){if(n=lt(n),arguments.length===1&&(e=om.newId()),V1("doc","path",e),n instanceof nl){let r=Et.fromString(e,...t);return $k(r),new ur(n,null,new le(r))}{if(!(n instanceof ur||n instanceof io))throw new K(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Et.fromString(e,...t));return $k(r),new ur(n.firestore,n instanceof io?n.converter:null,new le(r))}}var xm=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new bm(this,"async_queue_retry"),this.Vu=()=>{let r=u0();r&&te("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;let t=u0();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=u0();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new Ci;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return g(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ld(e))throw e;te("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw us("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let i=TI.createAndSchedule(this,e,t,r,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&me()}verifyOperationInProgress(){}wu(){return g(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};var rl=class extends nl{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new xm,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return g(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new xm(e),this._firestoreClient=void 0,yield e}})}};function $1(n,e){let t=typeof n=="object"?n:bi(),r=typeof n=="string"?n:e||"(default)",i=is(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Nc("firestore");s&&lA(i,...s)}return i}function U1(n){if(n._terminated)throw new K(j.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||l7(n),n._firestoreClient}function l7(n){var e,t,r;let i=n._freezeSettings(),s=function(a,c,l,u){return new b0(a,c,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,F1(u.experimentalLongPollingOptions),u.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new LI(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){let c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}}(n._componentsProvider))}var rd=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(bn.fromBase64String(e))}catch(t){throw new K(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(bn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var il=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new K(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new lr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var id=class{constructor(e){this._methodName=e}};var sd=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new K(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new K(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return tt(this._lat,e._lat)||tt(this._long,e._long)}};var od=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var u7=/^__.*__$/,FI=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Pi(e,this.data,this.fieldMask,t,this.fieldTransforms):new fa(e,this.data,t,this.fieldTransforms)}},Rm=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Pi(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function B1(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw me()}}var VI=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Mm(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(B1(this.Cu)&&u7.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},jI=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||jm(e)}Qu(e,t,r,i=!1){return new VI({Cu:e,methodName:t,qu:r,path:lr.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function dA(n){let e=n._freezeSettings(),t=jm(n._databaseId);return new jI(n._databaseId,!!e.ignoreUndefinedProperties,t)}function d7(n,e,t,r,i,s={}){let o=n.Qu(s.merge||s.mergeFields?2:0,e,t,i);hA("Data must be an object, but it was:",o,r);let a=H1(r,o),c,l;if(s.merge)c=new br(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let f=$I(e,d,t);if(!o.contains(f))throw new K(j.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);z1(u,f)||u.push(f)}c=new br(u),l=o.fieldTransforms.filter(d=>c.covers(d.field))}else c=null,l=o.fieldTransforms;return new FI(new cr(a),c,l)}var Pm=class n extends id{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function h7(n,e,t,r){let i=n.Qu(1,e,t);hA("Data must be an object, but it was:",i,r);let s=[],o=cr.empty();ma(r,(c,l)=>{let u=fA(e,c,t);l=lt(l);let d=i.Nu(u);if(l instanceof Pm)s.push(u);else{let f=hd(l,d);f!=null&&(s.push(u),o.set(u,f))}});let a=new br(s);return new Rm(o,a,i.fieldTransforms)}function f7(n,e,t,r,i,s){let o=n.Qu(1,e,t),a=[$I(e,r,t)],c=[i];if(s.length%2!=0)throw new K(j.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push($I(e,s[f])),c.push(s[f+1]);let l=[],u=cr.empty();for(let f=a.length-1;f>=0;--f)if(!z1(l,a[f])){let p=a[f],y=c[f];y=lt(y);let w=o.Nu(p);if(y instanceof Pm)l.push(p);else{let b=hd(y,w);b!=null&&(l.push(p),u.set(p,b))}}let d=new br(l);return new Rm(u,d,o.fieldTransforms)}function p7(n,e,t,r=!1){return hd(t,n.Qu(r?4:3,e))}function hd(n,e){if(q1(n=lt(n)))return hA("Unsupported field value:",e,n),H1(n,e);if(n instanceof id)return function(r,i){if(!B1(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let c=hd(a,i.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=lt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Y8(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=an.fromDate(r);return{timestampValue:ym(i.serializer,s)}}if(r instanceof an){let s=new an(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ym(i.serializer,s)}}if(r instanceof sd)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof rd)return{bytesValue:m1(i.serializer,r._byteString)};if(r instanceof ur){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:tA(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof od)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Bu("VectorValues must only contain numeric values.");return eA(a.serializer,c)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${Bm(r)}`)}(n,e)}function H1(n,e){let t={};return zk(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ma(n,(r,i)=>{let s=hd(i,e.Mu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function q1(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof an||n instanceof sd||n instanceof rd||n instanceof ur||n instanceof id||n instanceof od)}function hA(n,e,t){if(!q1(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Bm(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function $I(n,e,t){if((e=lt(e))instanceof il)return e._internalPath;if(typeof e=="string")return fA(n,e);throw Mm("Field path arguments must be of type string or ",n,!1,void 0,t)}var m7=new RegExp("[~\\*/\\[\\]]");function fA(n,e,t){if(e.search(m7)>=0)throw Mm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new il(...e.split("."))._internalPath}catch{throw Mm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Mm(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new K(j.INVALID_ARGUMENT,a+n+c)}function z1(n,e){return n.some(t=>t.isEqual(e))}var Nm=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ur(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new UI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Hm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},UI=class extends Nm{data(){return super.data()}};function Hm(n,e){return typeof e=="string"?fA(n,e):e instanceof il?e._internalPath:e._delegate._internalPath}function g7(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new K(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ad=class{},Om=class extends ad{};function G1(n,e,...t){let r=[];e instanceof ad&&r.push(e),r=r.concat(t),function(s){let o=s.filter(c=>c instanceof BI).length,a=s.filter(c=>c instanceof km).length;if(o>1||o>0&&a>0)throw new K(j.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var km=class n extends Om{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Y1(e._query,t),new pa(e.firestore,e.converter,O0(e._query,t))}_parse(e){let t=dA(e.firestore);return function(s,o,a,c,l,u,d){let f;if(l.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new K(j.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){Hk(d,u);let p=[];for(let y of d)p.push(Bk(c,s,y));f={arrayValue:{values:p}}}else f=Bk(c,s,d)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||Hk(d,u),f=p7(a,o,d,u==="in"||u==="not-in");return Ft.create(l,u,f)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function W1(n,e,t){let r=e,i=Hm("where",n);return km._create(i,r,t)}var BI=class n extends ad{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Qr.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let c of a)Y1(o,c),o=O0(o,c)}(e._query,t),new pa(e.firestore,e.converter,O0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var HI=class n extends Om{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new K(j.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new K(j.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ua(s,o)}(e._query,this._field,this._direction);return new pa(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new oo(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function K1(n,e="asc"){let t=e,r=Hm("orderBy",n);return HI._create(r,t)}function Bk(n,e,t){if(typeof(t=lt(t))=="string"){if(t==="")throw new K(j.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!t1(e)&&t.indexOf("/")!==-1)throw new K(j.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(Et.fromString(t));if(!le.isDocumentKey(r))throw new K(j.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return pk(n,new le(r))}if(t instanceof ur)return pk(n,t._key);throw new K(j.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Bm(t)}.`)}function Hk(n,e){if(!Array.isArray(n)||n.length===0)throw new K(j.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Y1(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new K(j.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new K(j.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var qI=class{convertValue(e,t="none"){switch(la(e)){case 0:return null;case 1:return e.booleanValue;case 2:return vt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(so(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw me()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return ma(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>vt(o.doubleValue));return new od(s)}convertGeoPoint(e){return new sd(vt(e.latitude),vt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=QI(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Xu(e));default:return null}}convertTimestamp(e){let t=ds(e);return new an(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=Et.fromString(e);at(b1(r));let i=new um(r.get(1),r.get(3)),s=new le(r.popFirst(5));return i.isEqual(t)||us(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function y7(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Bc=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},zI=class extends Nm{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new qc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Hm("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},qc=class extends zI{data(e={}){return super.data(e)}},GI=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Bc(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new qc(this._firestore,this._userDataWriter,r.key,r,new Bc(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new K(j.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new qc(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Bc(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new qc(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Bc(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),l=-1,u=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:_7(a.type),doc:c,oldIndex:l,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function _7(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return me()}}var WI=class extends qI{constructor(e){super(),this.firestore=e}convertBytes(e){return new rd(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ur(this.firestore,null,t)}};function Q1(n){n=tl(n,pa);let e=tl(n.firestore,rl),t=U1(e),r=new WI(e);return g7(n._query),a7(t,n._query).then(i=>new GI(e,r,n,i))}function X1(n,e,t,...r){n=tl(n,ur);let i=tl(n.firestore,rl),s=dA(i),o;return o=typeof(e=lt(e))=="string"||e instanceof il?f7(s,"updateDoc",n._key,e,t,r):h7(s,"updateDoc",n._key,e),J1(i,[o.toMutation(n._key,ro.exists(!0))])}function Z1(n,e){let t=tl(n.firestore,rl),r=uA(n),i=y7(n.converter,e);return J1(t,[d7(dA(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,ro.exists(!1))]).then(()=>r)}function J1(n,e){return function(r,i){let s=new Ci;return r.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return YK(yield s7(r),i,s)})),s.promise}(U1(n),e)}(function(e,t=!0){(function(i){sl=i})(wi),wr(new _n("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new rl(new p0(r.getProvider("auth-internal")),new _0(r.getProvider("app-check-internal")),function(l,u){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new K(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new um(l.options.projectId,u)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),st(uk,"4.7.3",e),st(uk,"4.7.3","esm2017")})();var fs=class{constructor(e){return e}},eL="firestore",pA=class{constructor(){return ss(eL)}};var mA=new de("angularfire2.firestore-instances");function v7(n,e){let t=Xs(eL,n,e);return t&&new fs(t)}function w7(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new fs(r)}}var b7={provide:pA,deps:[[new gt,mA]]},E7={provide:fs,useFactory:v7,deps:[[new gt,mA],ar]};function tL(n,...e){return st("angularfire",Gr.full,"fst"),Wn([E7,b7,{provide:mA,useFactory:w7(n),multi:!0,deps:[et,yn,Ii,Wr,[new gt,cs],[new gt,Ei],...e]}])}var lo=ot(Z1,!0);var Xr=ot(j1,!0);var nL=ot(lA,!0);var rL=ot(uA,!0);var fd=ot(Q1,!0);var iL=ot($1,!0);var pd=ot(K1,!0);var md=ot(G1,!0);var sL=ot(X1,!0);var qm=ot(W1,!0);var fL="firebasestorage.googleapis.com",pL="storageBucket",I7=2*60*1e3,A7=10*60*1e3;var St=class n extends on{constructor(e,t,r=0){super(gA(e),`Firebase Storage: ${t} (${gA(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return gA(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},Pt=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(Pt||{});function gA(n){return"storage/"+n}function EA(){let n="An unknown error occurred, please check the error payload for server response.";return new St(Pt.UNKNOWN,n)}function T7(n){return new St(Pt.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function C7(n){return new St(Pt.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function S7(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new St(Pt.UNAUTHENTICATED,n)}function D7(){return new St(Pt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function x7(n){return new St(Pt.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function R7(){return new St(Pt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function P7(){return new St(Pt.CANCELED,"User canceled the upload/download.")}function M7(n){return new St(Pt.INVALID_URL,"Invalid URL '"+n+"'.")}function N7(n){return new St(Pt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function O7(){return new St(Pt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+pL+"' property when initializing the app?")}function k7(){return new St(Pt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function L7(){return new St(Pt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function F7(n){return new St(Pt.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function yA(n){return new St(Pt.INVALID_ARGUMENT,n)}function mL(){return new St(Pt.APP_DELETED,"The Firebase app was deleted.")}function V7(n){return new St(Pt.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function yd(n,e){return new St(Pt.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function gd(n){throw new St(Pt.INTERNAL_ERROR,"Internal error: "+n)}var Zr=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw N7(e)}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(N){N.path.charAt(N.path.length-1)==="/"&&(N.path_=N.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),c={bucket:1,path:3};function l(N){N.path_=decodeURIComponent(N.path)}let u="v[A-Za-z0-9_]+",d=t.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",p=new RegExp(`^https?://${d}/${u}/b/${i}/o${f}`,"i"),y={bucket:1,path:3},w=t===fL?"(?:storage.googleapis.com|storage.cloud.google.com)":t,b="([^?#]*)",E=new RegExp(`^https?://${w}/${i}/${b}`,"i"),x=[{regex:a,indices:c,postModify:s},{regex:p,indices:y,postModify:l},{regex:E,indices:{bucket:1,path:2},postModify:l}];for(let N=0;N<x.length;N++){let L=x[N],F=L.regex.exec(e);if(F){let T=F[L.indices.bucket],A=F[L.indices.path];A||(A=""),r=new n(T,A),L.postModify(r);break}}if(r==null)throw M7(e);return r}},_A=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function j7(n,e,t){let r=1,i=null,s=null,o=!1,a=0;function c(){return a===2}let l=!1;function u(...b){l||(l=!0,e.apply(null,b))}function d(b){i=setTimeout(()=>{i=null,n(p,c())},b)}function f(){s&&clearTimeout(s)}function p(b,...E){if(l){f();return}if(b){f(),u.call(null,b,...E);return}if(c()||o){f(),u.call(null,b,...E);return}r<64&&(r*=2);let x;a===1?(a=2,x=0):x=(r+Math.random())*1e3,d(x)}let y=!1;function w(b){y||(y=!0,f(),!l&&(i!==null?(b||(a=2),clearTimeout(i),d(0)):b||(a=1)))}return d(0),s=setTimeout(()=>{o=!0,w(!0)},t),w}function $7(n){n(!1)}function U7(n){return n!==void 0}function B7(n){return typeof n=="object"&&!Array.isArray(n)}function IA(n){return typeof n=="string"||n instanceof String}function aL(n){return AA()&&n instanceof Blob}function AA(){return typeof Blob<"u"}function cL(n,e,t,r){if(r<e)throw yA(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw yA(`Invalid value for '${n}'. Expected ${t} or less.`)}function TA(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function gL(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var cl=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(cl||{});function H7(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}var vA=class{constructor(e,t,r,i,s,o,a,c,l,u,d,f=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=d,this.retry=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((p,y)=>{this.resolve_=p,this.reject_=y,this.start_()})}start_(){let e=(r,i)=>{if(i){r(!1,new al(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=a=>{let c=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,l)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let a=s.getErrorCode()===cl.NO_ERROR,c=s.getStatus();if(!a||H7(c,this.additionalRetryCodes_)&&this.retry){let u=s.getErrorCode()===cl.ABORT;r(!1,new al(!1,null,u));return}let l=this.successCodes_.indexOf(c)!==-1;r(!0,new al(l,s))})},t=(r,i)=>{let s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{let c=this.callback_(a,a.getResponse());U7(c)?s(c):s()}catch(c){o(c)}else if(a!==null){let c=EA();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(i.canceled){let c=this.appDelete_?mL():P7();o(c)}else{let c=R7();o(c)}};this.canceled_?t(!1,new al(!1,null,!0)):this.backoffId_=j7(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&$7(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},al=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};function q7(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function z7(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function G7(n,e){e&&(n["X-Firebase-GMPID"]=e)}function W7(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function K7(n,e,t,r,i,s,o=!0){let a=gL(n.urlParams),c=n.url+a,l=Object.assign({},n.headers);return G7(l,e),q7(l,t),z7(l,s),W7(l,r),new vA(c,n.method,l,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}function Y7(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Q7(...n){let e=Y7();if(e!==void 0){let t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(AA())return new Blob(n);throw new St(Pt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function X7(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}function Z7(n){if(typeof atob>"u")throw F7("base-64");return atob(n)}var Mi={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},_d=class{constructor(e,t){this.data=e,this.contentType=t||null}};function J7(n,e){switch(n){case Mi.RAW:return new _d(yL(e));case Mi.BASE64:case Mi.BASE64URL:return new _d(_L(n,e));case Mi.DATA_URL:return new _d(tY(e),nY(e))}throw EA()}function yL(n){let e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{let s=r,o=n.charCodeAt(++t);r=65536|(s&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function eY(n){let e;try{e=decodeURIComponent(n)}catch{throw yd(Mi.DATA_URL,"Malformed data URL.")}return yL(e)}function _L(n,e){switch(n){case Mi.BASE64:{let i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw yd(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Mi.BASE64URL:{let i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw yd(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=Z7(e)}catch(i){throw i.message.includes("polyfill")?i:yd(n,"Invalid character found")}let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}var Gm=class{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(t===null)throw yd(Mi.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=t[1]||null;r!=null&&(this.base64=rY(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}};function tY(n){let e=new Gm(n);return e.base64?_L(Mi.BASE64,e.rest):eY(e.rest)}function nY(n){return new Gm(n).contentType}function rY(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}var Wm=class n{constructor(e,t){let r=0,i="";aL(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(aL(this.data_)){let r=this.data_,i=X7(r,e,t);return i===null?null:new n(i)}else{let r=new Uint8Array(this.data_.buffer,e,t-e);return new n(r,!0)}}static getBlob(...e){if(AA()){let t=e.map(r=>r instanceof n?r.data_:r);return new n(Q7.apply(null,t))}else{let t=e.map(o=>IA(o)?J7(Mi.RAW,o).data:o.data_),r=0;t.forEach(o=>{r+=o.byteLength});let i=new Uint8Array(r),s=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)i[s++]=o[a]}),new n(i,!0)}}uploadData(){return this.data_}};function vL(n){let e;try{e=JSON.parse(n)}catch{return null}return B7(e)?e:null}function iY(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function sY(n,e){let t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function wL(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function oY(n,e){return e}var cn=class{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||oY}},zm=null;function aY(n){return!IA(n)||n.length<2?n:wL(n)}function bL(){if(zm)return zm;let n=[];n.push(new cn("bucket")),n.push(new cn("generation")),n.push(new cn("metageneration")),n.push(new cn("name","fullPath",!0));function e(s,o){return aY(o)}let t=new cn("name");t.xform=e,n.push(t);function r(s,o){return o!==void 0?Number(o):o}let i=new cn("size");return i.xform=r,n.push(i),n.push(new cn("timeCreated")),n.push(new cn("updated")),n.push(new cn("md5Hash",null,!0)),n.push(new cn("cacheControl",null,!0)),n.push(new cn("contentDisposition",null,!0)),n.push(new cn("contentEncoding",null,!0)),n.push(new cn("contentLanguage",null,!0)),n.push(new cn("contentType",null,!0)),n.push(new cn("metadata","customMetadata",!0)),zm=n,zm}function cY(n,e){function t(){let r=n.bucket,i=n.fullPath,s=new Zr(r,i);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function lY(n,e,t){let r={};r.type="file";let i=t.length;for(let s=0;s<i;s++){let o=t[s];r[o.local]=o.xform(r,e[o.server])}return cY(r,n),r}function EL(n,e,t){let r=vL(e);return r===null?null:lY(n,r,t)}function uY(n,e,t,r){let i=vL(e);if(i===null||!IA(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(l=>{let u=n.bucket,d=n.fullPath,f="/b/"+o(u)+"/o/"+o(d),p=TA(f,t,r),y=gL({alt:"media",token:l});return p+y})[0]}function dY(n,e){let t={},r=e.length;for(let i=0;i<r;i++){let s=e[i];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}var Km=class{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function IL(n){if(!n)throw EA()}function hY(n,e){function t(r,i){let s=EL(n,i,e);return IL(s!==null),s}return t}function fY(n,e){function t(r,i){let s=EL(n,i,e);return IL(s!==null),uY(s,i,n.host,n._protocol)}return t}function AL(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=D7():i=S7():t.getStatus()===402?i=C7(n.bucket):t.getStatus()===403?i=x7(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function pY(n){let e=AL(n);function t(r,i){let s=e(r,i);return r.getStatus()===404&&(s=T7(n.path)),s.serverResponse=i.serverResponse,s}return t}function mY(n,e,t){let r=e.fullServerUrl(),i=TA(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new Km(i,s,fY(n,t),o);return a.errorHandler=pY(e),a}function gY(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function yY(n,e,t){let r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=gY(null,e)),r}function _Y(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let x="";for(let N=0;N<2;N++)x=x+Math.random().toString().slice(2);return x}let c=a();o["Content-Type"]="multipart/related; boundary="+c;let l=yY(e,r,i),u=dY(l,t),d="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+c+`\r
Content-Type: `+l.contentType+`\r
\r
`,f=`\r
--`+c+"--",p=Wm.getBlob(d,r,f);if(p===null)throw k7();let y={name:l.fullPath},w=TA(s,n.host,n._protocol),b="POST",E=n.maxUploadRetryTime,D=new Km(w,b,hY(n,t),E);return D.urlParams=y,D.headers=o,D.body=p.uploadData(),D.errorHandler=AL(e),D}var vme=256*1024;var lL=null,wA=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=cl.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=cl.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=cl.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw gd("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw gd("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw gd("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw gd("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw gd("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},bA=class extends wA{initXhr(){this.xhr_.responseType="text"}};function TL(){return lL?lL():new bA}var ll=class n{constructor(e,t){this._service=e,t instanceof Zr?this._location=t:this._location=Zr.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new Zr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return wL(this._location.path)}get storage(){return this._service}get parent(){let e=iY(this._location.path);if(e===null)return null;let t=new Zr(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw V7(e)}};function vY(n,e,t){n._throwIfRoot("uploadBytes");let r=_Y(n.storage,n._location,bL(),new Wm(e,!0),t);return n.storage.makeRequestWithTokens(r,TL).then(i=>({metadata:i,ref:n}))}function wY(n){n._throwIfRoot("getDownloadURL");let e=mY(n.storage,n._location,bL());return n.storage.makeRequestWithTokens(e,TL).then(t=>{if(t===null)throw L7();return t})}function bY(n,e){let t=sY(n._location.path,e),r=new Zr(n._location.bucket,t);return new ll(n.storage,r)}function EY(n){return/^[A-Za-z]+:\/\//.test(n)}function IY(n,e){return new ll(n,e)}function CL(n,e){if(n instanceof vd){let t=n;if(t._bucket==null)throw O7();let r=new ll(t,t._bucket);return e!=null?CL(r,e):r}else return e!==void 0?bY(n,e):n}function AY(n,e){if(e&&EY(e)){if(n instanceof vd)return IY(n,e);throw yA("To use ref(service, url), the first argument must be a Storage instance.")}else return CL(n,e)}function uL(n,e){let t=e?.[pL];return t==null?null:Zr.makeFromBucketSpec(t,n)}function TY(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:Sp(i,n.app.options.projectId))}var vd=class{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=fL,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=I7,this._maxUploadRetryTime=A7,this._requests=new Set,i!=null?this._bucket=Zr.makeFromBucketSpec(i,this._host):this._bucket=uL(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Zr.makeFromBucketSpec(this._url,e):this._bucket=uL(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){cL("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){cL("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return g(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return g(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ll(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new _A(mL());{let o=K7(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return g(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()})}},dL="@firebase/storage",hL="0.13.2";var SL="storage";function DL(n,e,t){return n=lt(n),vY(n,e,t)}function xL(n){return n=lt(n),wY(n)}function RL(n,e){return n=lt(n),AY(n,e)}function PL(n=bi(),e){n=lt(n);let r=is(n,SL).getImmediate({identifier:e}),i=Nc("storage");return i&&CA(r,...i),r}function CA(n,e,t,r={}){TY(n,e,t,r)}function CY(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new vd(t,r,i,e,wi)}function SY(){wr(new _n(SL,CY,"PUBLIC").setMultipleInstances(!0)),st(dL,hL,""),st(dL,hL,"esm2017")}SY();var ya=class{constructor(e){return e}},ML="storage",SA=class{constructor(){return ss(ML)}};var DA=new de("angularfire2.storage-instances");function DY(n,e){let t=Xs(ML,n,e);return t&&new ya(t)}function xY(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ya(r)}}var RY={provide:SA,deps:[[new gt,DA]]},PY={provide:ya,useFactory:DY,deps:[[new gt,DA],ar]};function NL(n,...e){return st("angularfire",Gr.full,"gcs"),Wn([PY,RY,{provide:DA,useFactory:xY(n),multi:!0,deps:[et,yn,Ii,Wr,[new gt,cs],[new gt,Ei],...e]}])}var OL=ot(CA,!0);var kL=ot(xL,!0);var LL=ot(PL,!0);var FL=ot(RL,!0);var VL=ot(DL,!0);var NY="type.googleapis.com/google.protobuf.Int64Value",OY="type.googleapis.com/google.protobuf.UInt64Value";function BL(n,e){let t={};for(let r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function xA(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>xA(e));if(typeof n=="function"||typeof n=="object")return BL(n,e=>xA(e));throw new Error("Data cannot be encoded in JSON: "+n)}function Ym(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case NY:case OY:{let e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>Ym(e)):typeof n=="function"||typeof n=="object"?BL(n,e=>Ym(e)):n}var NA="functions";var jL={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},uo=class extends on{constructor(e,t,r){super(`${NA}/${e}`,t||""),this.details=r}};function kY(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function LY(n,e){let t=kY(n),r=t,i;try{let s=e&&e.error;if(s){let o=s.status;if(typeof o=="string"){if(!jL[o])return new uo("internal","internal");t=jL[o],r=o}let a=s.message;typeof a=="string"&&(r=a),i=s.details,i!==void 0&&(i=Ym(i))}}catch{}return t==="ok"?null:new uo(t,r,i)}var RA=class{constructor(e,t,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(i=>this.auth=i,()=>{}),this.messaging||t.get().then(i=>this.messaging=i,()=>{}),this.appCheck||r.get().then(i=>this.appCheck=i,()=>{})}getAuthToken(){return g(this,null,function*(){if(this.auth)try{let e=yield this.auth.getToken();return e?.accessToken}catch{return}})}getMessagingToken(){return g(this,null,function*(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return yield this.messaging.getToken()}catch{return}})}getAppCheckToken(e){return g(this,null,function*(){if(this.appCheck){let t=e?yield this.appCheck.getLimitedUseToken():yield this.appCheck.getToken();return t.error?null:t.token}return null})}getContext(e){return g(this,null,function*(){let t=yield this.getAuthToken(),r=yield this.getMessagingToken(),i=yield this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:i}})}};var PA="us-central1";function FY(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new uo("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}var MA=class{constructor(e,t,r,i,s=PA,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new RA(t,r,i),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{let a=new URL(s);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=PA}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){let t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}};function VY(n,e,t){n.emulatorOrigin=`http://${e}:${t}`}function jY(n,e,t){return r=>UY(n,e,r,t||{})}function $Y(n,e,t,r){return g(this,null,function*(){t["Content-Type"]="application/json";let i;try{i=yield r(n,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let s=null;try{s=yield i.json()}catch{}return{status:i.status,json:s}})}function UY(n,e,t,r){let i=n._url(e);return BY(n,i,t,r)}function BY(n,e,t,r){return g(this,null,function*(){t=xA(t);let i={data:t},s={},o=yield n.contextProvider.getContext(r.limitedUseAppCheckTokens);o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(s["X-Firebase-AppCheck"]=o.appCheckToken);let a=r.timeout||7e4,c=FY(a),l=yield Promise.race([$Y(e,i,s,n.fetchImpl),c.promise,n.cancelAllRequests]);if(c.cancel(),!l)throw new uo("cancelled","Firebase Functions instance was deleted.");let u=LY(l.status,l.json);if(u)throw u;if(!l.json)throw new uo("internal","Response is not valid JSON object.");let d=l.json.data;if(typeof d>"u"&&(d=l.json.result),typeof d>"u")throw new uo("internal","Response is missing data field.");return{data:Ym(d)}})}var $L="@firebase/functions",UL="0.11.8";var HY="auth-internal",qY="app-check-internal",zY="messaging-internal";function GY(n,e){let t=(r,{instanceIdentifier:i})=>{let s=r.getProvider("app").getImmediate(),o=r.getProvider(HY),a=r.getProvider(zY),c=r.getProvider(qY);return new MA(s,o,a,c,i,n)};wr(new _n(NA,t,"PUBLIC").setMultipleInstances(!0)),st($L,UL,e),st($L,UL,"esm2017")}function HL(n=bi(),e=PA){let r=is(lt(n),NA).getImmediate({identifier:e}),i=Nc("functions");return i&&OA(r,...i),r}function OA(n,e,t){VY(lt(n),e,t)}function qL(n,e,t){return jY(lt(n),e,t)}GY(fetch.bind(self));var ps=class{constructor(e){return e}},zL="functions",kA=class{constructor(){return ss(zL)}};var LA=new de("angularfire2.functions-instances");function WY(n,e){let t=Xs(zL,n,e);return t&&new ps(t)}function KY(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ps(r)}}var YY={provide:kA,deps:[[new gt,LA]]},QY={provide:ps,useFactory:WY,deps:[[new gt,LA],ar]};function GL(n,...e){return st("angularfire",Gr.full,"fn"),Wn([QY,YY,{provide:LA,useFactory:KY(n),multi:!0,deps:[et,yn,Ii,Wr,[new gt,cs],[new gt,Ei],...e]}])}var WL=ot(OA,!0),KL=ot(HL,!0),Qm=ot(qL,!0);var iF=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(r){return new(r||n)(ke(Us),ke(Ji))}}static{this.\u0275dir=kn({type:n})}}return n})(),UA=(()=>{class n extends iF{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Go(n)))(i||n)}})()}static{this.\u0275dir=kn({type:n,features:[Bs]})}}return n})(),eg=new de("");var XY={provide:eg,useExisting:Uo(()=>tg),multi:!0};function ZY(){let n=ts()?ts().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var JY=new de(""),tg=(()=>{class n extends iF{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!ZY())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(r){return new(r||n)(ke(Us),ke(Ji),ke(JY,8))}}static{this.\u0275dir=kn({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&Tt("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[uu([XY]),Bs]})}}return n})();var eQ=new de(""),tQ=new de("");function sF(n){return n!=null}function oF(n){return qs(n)?Rt(n):n}function aF(n){let e={};return n.forEach(t=>{e=t!=null?_(_({},e),t):e}),Object.keys(e).length===0?null:e}function cF(n,e){return e.map(t=>t(n))}function nQ(n){return!n.validate}function lF(n){return n.map(e=>nQ(e)?e:t=>e.validate(t))}function rQ(n){if(!n)return null;let e=n.filter(sF);return e.length==0?null:function(t){return aF(cF(t,e))}}function uF(n){return n!=null?rQ(lF(n)):null}function iQ(n){if(!n)return null;let e=n.filter(sF);return e.length==0?null:function(t){let r=cF(t,e).map(oF);return Z_(r).pipe(He(aF))}}function dF(n){return n!=null?iQ(lF(n)):null}function QL(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function sQ(n){return n._rawValidators}function oQ(n){return n._rawAsyncValidators}function FA(n){return n?Array.isArray(n)?n:[n]:[]}function Zm(n,e){return Array.isArray(n)?n.includes(e):n===e}function XL(n,e){let t=FA(e);return FA(n).forEach(i=>{Zm(t,i)||t.push(i)}),t}function ZL(n,e){return FA(e).filter(t=>!Zm(n,t))}var Jm=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=uF(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=dF(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},VA=class extends Jm{get formDirective(){return null}get path(){return null}},Ed=class extends Jm{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},jA=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},aQ={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},vge=P(_({},aQ),{"[class.ng-submitted]":"isSubmitted"}),hF=(()=>{class n extends jA{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(ke(Ed,2))}}static{this.\u0275dir=kn({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&pi("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Bs]})}}return n})();var wd="VALID",Xm="INVALID",ul="PENDING",bd="DISABLED";function cQ(n){return(ng(n)?n.validators:n)||null}function lQ(n){return Array.isArray(n)?uF(n):n||null}function uQ(n,e){return(ng(e)?e.asyncValidators:n)||null}function dQ(n){return Array.isArray(n)?dF(n):n||null}function ng(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}var $A=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===wd}get invalid(){return this.status===Xm}get pending(){return this.status==ul}get disabled(){return this.status===bd}get enabled(){return this.status!==bd}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(XL(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(XL(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(ZL(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(ZL(e,this._rawAsyncValidators))}hasValidator(e){return Zm(this._rawValidators,e)}hasAsyncValidator(e){return Zm(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=ul,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=bd,this.errors=null,this._forEachChild(r=>{r.disable(P(_({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(P(_({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=wd,this._forEachChild(r=>{r.enable(P(_({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(P(_({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===wd||this.status===ul)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?bd:wd}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=ul,this._hasOwnPendingAsyncValidator=!0;let t=oF(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Nn,this.statusChanges=new Nn}_calculateStatus(){return this._allControlsDisabled()?bd:this.errors?Xm:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ul)?ul:this._anyControlsHaveStatus(Xm)?Xm:wd}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ng(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=lQ(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=dQ(this._rawAsyncValidators)}};var fF=new de("CallSetDisabledState",{providedIn:"root",factory:()=>BA}),BA="always";function hQ(n,e){return[...e.path,n]}function fQ(n,e,t=BA){mQ(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),gQ(n,e),_Q(n,e),yQ(n,e),pQ(n,e)}function JL(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function pQ(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function mQ(n,e){let t=sQ(n);e.validator!==null?n.setValidators(QL(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=oQ(n);e.asyncValidator!==null?n.setAsyncValidators(QL(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();JL(e._rawValidators,i),JL(e._rawAsyncValidators,i)}function gQ(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&pF(n,e)})}function yQ(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&pF(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function pF(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function _Q(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function vQ(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function wQ(n){return Object.getPrototypeOf(n.constructor)===UA}function bQ(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===tg?t=s:wQ(s)?r=s:i=s}),i||r||t||null}function eF(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function tF(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var EQ=class extends $A{constructor(e=null,t,r){super(cQ(t),uQ(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ng(t)&&(t.nonNullable||t.initialValueIsDefault)&&(tF(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){eF(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){eF(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){tF(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var IQ={provide:Ed,useExisting:Uo(()=>HA)},nF=Promise.resolve(),HA=(()=>{class n extends Ed{constructor(t,r,i,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new EQ,this._registered=!1,this.name="",this.update=new Nn,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=bQ(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),vQ(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){fQ(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){nF.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,i=r!==0&&np(r);nF.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?hQ(t,this._parent):[t]}static{this.\u0275fac=function(r){return new(r||n)(ke(VA,9),ke(eQ,10),ke(tQ,10),ke(eg,10),ke(zs,8),ke(fF,8))}}static{this.\u0275dir=kn({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[mr.None,"disabled","isDisabled"],model:[mr.None,"ngModel","model"],options:[mr.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[uu([IQ]),Bs,wc]})}}return n})();var AQ={provide:eg,useExisting:Uo(()=>rg),multi:!0};function mF(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function TQ(n){return n.split(":")[0]}var rg=(()=>{class n extends UA{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;let r=this._getOptionId(t),i=mF(r,t);this.setProperty("value",i)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){let r=TQ(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Go(n)))(i||n)}})()}static{this.\u0275dir=kn({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,i){r&1&&Tt("change",function(o){return i.onChange(o.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[uu([AQ]),Bs]})}}return n})(),gF=(()=>{class n{constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption())}set ngValue(t){this._select!=null&&(this._select._optionMap.set(this.id,t),this._setElementValue(mF(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(r){return new(r||n)(ke(Ji),ke(Us),ke(rg,9))}}static{this.\u0275dir=kn({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return n})(),CQ={provide:eg,useExisting:Uo(()=>yF),multi:!0};function rF(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function SQ(n){return n.split(":")[0]}var yF=(()=>{class n extends UA{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;let r;if(Array.isArray(t)){let i=t.map(s=>this._getOptionId(s));r=(s,o)=>{s._setSelected(i.indexOf(o.toString())>-1)}}else r=(i,s)=>{i._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{let i=[],s=r.selectedOptions;if(s!==void 0){let o=s;for(let a=0;a<o.length;a++){let c=o[a],l=this._getOptionValue(c.value);i.push(l)}}else{let o=r.options;for(let a=0;a<o.length;a++){let c=o[a];if(c.selected){let l=this._getOptionValue(c.value);i.push(l)}}}this.value=i,t(i)}}_registerOption(t){let r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){let r=SQ(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Go(n)))(i||n)}})()}static{this.\u0275dir=kn({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,i){r&1&&Tt("change",function(o){return i.onChange(o.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[uu([CQ]),Bs]})}}return n})(),_F=(()=>{class n{constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){this._select!=null&&(this._value=t,this._setElementValue(rF(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(rF(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(r){return new(r||n)(ke(Ji),ke(Us),ke(yF,9))}}static{this.\u0275dir=kn({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return n})();var DQ=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Ho({type:n})}static{this.\u0275inj=Bo({})}}return n})();var vF=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:fF,useValue:t.callSetDisabledState??BA}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Ho({type:n})}static{this.\u0275inj=Bo({imports:[DQ]})}}return n})();var Dd={};Dd.d=(n,e)=>{for(var t in e)Dd.o(e,t)&&!Dd.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};Dd.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var ye=globalThis.pdfjsLib={};Dd.d(ye,{AbortException:()=>ki,AnnotationEditorLayer:()=>CX,AnnotationEditorParamsType:()=>We,AnnotationEditorType:()=>De,AnnotationEditorUIManager:()=>Od,AnnotationLayer:()=>iC,AnnotationMode:()=>ho,ColorPicker:()=>Fg,DOMSVGFactory:()=>jd,DrawLayer:()=>fC,FeatureTest:()=>ln,GlobalWorkerOptions:()=>va,ImageKind:()=>lg,InvalidPDFException:()=>Rd,MissingPDFException:()=>wa,OPS:()=>Jr,OutputScale:()=>Nd,PDFDataRangeTransport:()=>Tg,PDFDateString:()=>hg,PDFWorker:()=>fl,PasswordResponses:()=>OQ,PermissionFlag:()=>NQ,PixelsPerInch:()=>po,RenderingCancelledException:()=>Md,TextLayer:()=>Fd,TouchManager:()=>pg,UnexpectedResponseException:()=>pl,Util:()=>se,VerbosityLevel:()=>$g,XfaLayer:()=>Dg,build:()=>IX,createValidAbsoluteUrl:()=>VQ,fetchData:()=>qg,getDocument:()=>vX,getFilenameFromUrl:()=>GQ,getPdfFilenameFromUrl:()=>WQ,getXfaPageViewport:()=>KQ,isDataScheme:()=>zg,isPdfFile:()=>gC,noContextMenu:()=>ei,normalizeUnicode:()=>HQ,setLayerDimensions:()=>ba,shadow:()=>Le,stopEvent:()=>hr,version:()=>EX});var An=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),kF=[1,0,0,1,0,0],YA=[.001,0,0,.001,0,0],RQ=1e7,cg=1.35,PQ=.35,Ege=PQ/cg,dr={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},ho={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},MQ="pdfjs_internal_editor_",De={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},We={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},NQ={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},En={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},lg={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Gt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Id={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var $g={ERRORS:0,WARNINGS:1,INFOS:5},Jr={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},OQ={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Ug=$g.WARNINGS;function kQ(n){Number.isInteger(n)&&(Ug=n)}function LQ(){return Ug}function Bg(n){Ug>=$g.INFOS&&console.log(`Info: ${n}`)}function xe(n){Ug>=$g.WARNINGS&&console.log(`Warning: ${n}`)}function ft(n){throw new Error(n)}function jt(n,e){n||ft(e)}function FQ(n){switch(n?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function VQ(n,e=null,t=null){if(!n)return null;try{if(t&&typeof n=="string"&&(t.addDefaultProtocol&&n.startsWith("www.")&&n.match(/\./g)?.length>=2&&(n=`http://${n}`),t.tryConvertEncoding))try{n=BQ(n)}catch{}let r=e?new URL(n,e):new URL(n);if(FQ(r))return r}catch{}return null}function Le(n,e,t,r=!1){return Object.defineProperty(n,e,{value:t,enumerable:!r,configurable:!0,writable:!1}),t}var mo=function(){function e(t,r){this.message=t,this.name=r}return e.prototype=new Error,e.constructor=e,e}(),ug=class extends mo{constructor(e,t){super(e,"PasswordException"),this.code=t}},xd=class extends mo{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},Rd=class extends mo{constructor(e){super(e,"InvalidPDFException")}},wa=class extends mo{constructor(e){super(e,"MissingPDFException")}},pl=class extends mo{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},QA=class extends mo{constructor(e){super(e,"FormatError")}},ki=class extends mo{constructor(e){super(e,"AbortException")}};function LF(n){(typeof n!="object"||n?.length===void 0)&&ft("Invalid argument for bytesToString");let e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);let r=[];for(let i=0;i<e;i+=t){let s=Math.min(i+t,e),o=n.subarray(i,s);r.push(String.fromCharCode.apply(null,o))}return r.join("")}function Hg(n){typeof n!="string"&&ft("Invalid argument for stringToBytes");let e=n.length,t=new Uint8Array(e);for(let r=0;r<e;++r)t[r]=n.charCodeAt(r)&255;return t}function jQ(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function pC(n){let e=Object.create(null);for(let[t,r]of n)e[t]=r;return e}function $Q(){let n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function UQ(){try{return new Function(""),!0}catch{return!1}}var ln=class{static get isLittleEndian(){return Le(this,"isLittleEndian",$Q())}static get isEvalSupported(){return Le(this,"isEvalSupported",UQ())}static get isOffscreenCanvasSupported(){return Le(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Le(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?Le(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):Le(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return Le(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}},qA=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0")),se=class{static makeHexColor(e,t,r){return`#${qA[e]}${qA[t]}${qA[r]}`}static scaleMinMax(e,t){let r;e[0]?(e[0]<0&&(r=t[0],t[0]=t[2],t[2]=r),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(r=t[1],t[1]=t[3],t[3]=r),t[1]*=e[3],t[3]*=e[3]):(r=t[0],t[0]=t[1],t[1]=r,r=t[2],t[2]=t[3],t[3]=r,e[1]<0&&(r=t[1],t[1]=t[3],t[3]=r),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(r=t[0],t[0]=t[2],t[2]=r),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let r=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[r,i]}static applyInverseTransform(e,t){let r=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/r,s=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/r;return[i,s]}static getAxialAlignedBoundingBox(e,t){let r=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),s=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],r=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],s=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(r+o)/2,c=Math.sqrt((r+o)**2-4*(r*o-s*i))/2,l=a+c||1,u=a-c||1;return[Math.sqrt(l),Math.sqrt(u)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let r=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(r>i)return null;let s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>o?null:[r,s,i,o]}static#e(e,t,r,i,s,o,a,c,l,u){if(l<=0||l>=1)return;let d=1-l,f=l*l,p=f*l,y=d*(d*(d*e+3*l*t)+3*f*r)+p*i,w=d*(d*(d*s+3*l*o)+3*f*a)+p*c;u[0]=Math.min(u[0],y),u[1]=Math.min(u[1],w),u[2]=Math.max(u[2],y),u[3]=Math.max(u[3],w)}static#t(e,t,r,i,s,o,a,c,l,u,d,f){if(Math.abs(l)<1e-12){Math.abs(u)>=1e-12&&this.#e(e,t,r,i,s,o,a,c,-d/u,f);return}let p=u**2-4*d*l;if(p<0)return;let y=Math.sqrt(p),w=2*l;this.#e(e,t,r,i,s,o,a,c,(-u+y)/w,f),this.#e(e,t,r,i,s,o,a,c,(-u-y)/w,f)}static bezierBoundingBox(e,t,r,i,s,o,a,c,l){return l?(l[0]=Math.min(l[0],e,a),l[1]=Math.min(l[1],t,c),l[2]=Math.max(l[2],e,a),l[3]=Math.max(l[3],t,c)):l=[Math.min(e,a),Math.min(t,c),Math.max(e,a),Math.max(t,c)],this.#t(e,r,s,a,t,i,o,c,3*(-e+3*(r-s)+a),6*(e-2*r+s),3*(r-e),l),this.#t(e,r,s,a,t,i,o,c,3*(-t+3*(i-o)+c),6*(t-2*i+o),3*(i-t),l),l}};function BQ(n){return decodeURIComponent(escape(n))}var zA=null,wF=null;function HQ(n){return zA||(zA=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,wF=new Map([["\uFB05","\u017Ft"]])),n.replaceAll(zA,(e,t,r)=>t?t.normalize("NFKC"):wF.get(r))}function qQ(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let n=new Uint8Array(32);return crypto.getRandomValues(n),LF(n)}var mC="pdfjs_internal_id_";function zQ(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(LF(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});var ms="http://www.w3.org/2000/svg",po=class{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF};function qg(n,e="text"){return g(this,null,function*(){if(Sd(n,document.baseURI)){let t=yield fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,r)=>{let i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}r(new Error(i.statusText))}},i.send(null)})})}var Pd=class n{constructor({viewBox:e,userUnit:t,scale:r,rotation:i,offsetX:s=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=r,this.rotation=i,this.offsetX=s,this.offsetY=o,r*=t;let c=(e[2]+e[0])/2,l=(e[3]+e[1])/2,u,d,f,p;switch(i%=360,i<0&&(i+=360),i){case 180:u=-1,d=0,f=0,p=1;break;case 90:u=0,d=1,f=1,p=0;break;case 270:u=0,d=-1,f=-1,p=0;break;case 0:u=1,d=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(f=-f,p=-p);let y,w,b,E;u===0?(y=Math.abs(l-e[1])*r+s,w=Math.abs(c-e[0])*r+o,b=(e[3]-e[1])*r,E=(e[2]-e[0])*r):(y=Math.abs(c-e[0])*r+s,w=Math.abs(l-e[1])*r+o,b=(e[2]-e[0])*r,E=(e[3]-e[1])*r),this.transform=[u*r,d*r,f*r,p*r,y-u*r*c-f*r*l,w-d*r*c-p*r*l],this.width=b,this.height=E}get rawDims(){let{userUnit:e,viewBox:t}=this,r=t.map(i=>i*e);return Le(this,"rawDims",{pageWidth:r[2]-r[0],pageHeight:r[3]-r[1],pageX:r[0],pageY:r[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:r=this.offsetX,offsetY:i=this.offsetY,dontFlip:s=!1}={}){return new n({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:r,offsetY:i,dontFlip:s})}convertToViewportPoint(e,t){return se.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=se.applyTransform([e[0],e[1]],this.transform),r=se.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],r[0],r[1]]}convertToPdfPoint(e,t){return se.applyInverseTransform([e,t],this.transform)}},Md=class extends mo{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function zg(n){let e=n.length,t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function gC(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function GQ(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function WQ(n,e="document.pdf"){if(typeof n!="string")return e;if(zg(n))return xe('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,r=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(n),s=r.exec(i[1])||r.exec(i[2])||r.exec(i[3]);if(s&&(s=s[0],s.includes("%")))try{s=r.exec(decodeURIComponent(s))[0]}catch{}return s||e}var dg=class{started=Object.create(null);times=[];time(e){e in this.started&&xe(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||xe(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:r}of this.times)t=Math.max(r.length,t);for(let{name:r,start:i,end:s}of this.times)e.push(`${r.padEnd(t)} ${s-i}ms
`);return e.join("")}};function Sd(n,e){try{let{protocol:t}=e?new URL(n,e):new URL(n);return t==="http:"||t==="https:"}catch{return!1}}function ei(n){n.preventDefault()}function hr(n){n.preventDefault(),n.stopPropagation()}var hg=class{static#e;static toDateObject(e){if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let t=this.#e.exec(e);if(!t)return null;let r=parseInt(t[1],10),i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;let l=t[7]||"Z",u=parseInt(t[8],10);u=u>=0&&u<=23?u:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,l==="-"?(o+=u,a+=d):l==="+"&&(o-=u,a-=d),new Date(Date.UTC(r,i,s,o,a,c))}};function KQ(n,{scale:e=1,rotation:t=0}){let{width:r,height:i}=n.attributes.style,s=[0,0,parseInt(r),parseInt(i)];return new Pd({viewBox:s,userUnit:1,scale:e,rotation:t})}function yC(n){if(n.startsWith("#")){let e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(xe(`Not a valid color format: "${n}"`),[0,0,0])}function YQ(n){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of n.keys()){e.style.color=t;let r=window.getComputedStyle(e).color;n.set(t,yC(r))}e.remove()}function wt(n){let{a:e,b:t,c:r,d:i,e:s,f:o}=n.getTransform();return[e,t,r,i,s,o]}function Ni(n){let{a:e,b:t,c:r,d:i,e:s,f:o}=n.getTransform().invertSelf();return[e,t,r,i,s,o]}function ba(n,e,t=!1,r=!0){if(e instanceof Pd){let{pageWidth:i,pageHeight:s}=e.rawDims,{style:o}=n,a=ln.isCSSRoundSupported,c=`var(--scale-factor) * ${i}px`,l=`var(--scale-factor) * ${s}px`,u=a?`round(down, ${c}, var(--scale-round-x, 1px))`:`calc(${c})`,d=a?`round(down, ${l}, var(--scale-round-y, 1px))`:`calc(${l})`;!t||e.rotation%180===0?(o.width=u,o.height=d):(o.width=d,o.height=u)}r&&n.setAttribute("data-main-rotation",e.rotation)}var Nd=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},XA=class n{#e=null;#t=null;#n;#r=null;#s=null;static#i=null;constructor(e){this.#n=e,n.#i||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){let e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=this.#n._uiManager._signal;e.addEventListener("contextmenu",ei,{signal:t}),e.addEventListener("pointerdown",n.#c,{signal:t});let r=this.#r=document.createElement("div");r.className="buttons",e.append(r);let i=this.#n.toolbarPosition;if(i){let{style:s}=e,o=this.#n._uiManager.direction==="ltr"?1-i[0]:i[0];s.insetInlineEnd=`${100*o}%`,s.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return this.#h(),e}get div(){return this.#e}static#c(e){e.stopPropagation()}#a(e){this.#n._focusEventsAllowed=!1,hr(e)}#u(e){this.#n._focusEventsAllowed=!0,hr(e)}#l(e){let t=this.#n._uiManager._signal;e.addEventListener("focusin",this.#a.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#u.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",ei,{signal:t})}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#s?.shown()}#h(){let{editorType:e,_uiManager:t}=this.#n,r=document.createElement("button");r.className="delete",r.tabIndex=0,r.setAttribute("data-l10n-id",n.#i[e]),this.#l(r),r.addEventListener("click",i=>{t.delete()},{signal:t._signal}),this.#r.append(r)}get#d(){let e=document.createElement("div");return e.className="divider",e}addAltText(e){return g(this,null,function*(){let t=yield e.render();this.#l(t),this.#r.prepend(t,this.#d),this.#s=e})}addColorPicker(e){this.#t=e;let t=e.renderButton();this.#l(t),this.#r.prepend(t,this.#d)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}},ZA=class{#e=null;#t=null;#n;constructor(e){this.#n=e}#r(){let e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",ei,{signal:this.#n._signal});let t=this.#e=document.createElement("div");return t.className="buttons",e.append(t),this.#i(),e}#s(e,t){let r=0,i=0;for(let s of e){let o=s.y+s.height;if(o<r)continue;let a=s.x+(t?s.width:0);if(o>r){i=a,r=o;continue}t?a>i&&(i=a):a<i&&(i=a)}return[t?1-i:i,r]}show(e,t,r){let[i,s]=this.#s(t,r),{style:o}=this.#t||=this.#r();e.append(this.#t),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#i(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let r=this.#n._signal;e.addEventListener("contextmenu",ei,{signal:r}),e.addEventListener("click",()=>{this.#n.highlightSelection("floating_button")},{signal:r}),this.#e.append(e)}};function fg(n,e,t){for(let r of t)e.addEventListener(r,n[r].bind(n))}var JA=class{#e=0;get id(){return`${MQ}${this.#e++}`}},eT=class n{#e=qQ();#t=0;#n=null;static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',r=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;let s=i.decode().then(()=>(r.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(r.getImageData(0,0,1,1).data.buffer)[0]===0));return Le(this,"_isSVGFittingCanvas",s)}#r(e,t){return g(this,null,function*(){this.#n||=new Map;let r=this.#n.get(e);if(r===null)return null;if(r?.bitmap)return r.refCounter+=1,r;try{r||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let i;if(typeof t=="string"?(r.url=t,i=yield qg(t,"blob")):t instanceof File?i=r.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){let s=n._isSVGFittingCanvas,o=new FileReader,a=new Image,c=new Promise((l,u)=>{a.onload=()=>{r.bitmap=a,r.isSvg=!0,l()},o.onload=()=>g(this,null,function*(){let d=r.svgUrl=o.result;a.src=(yield s)?`${d}#svgView(preserveAspectRatio(none))`:d}),a.onerror=o.onerror=u});o.readAsDataURL(i),yield c}else r.bitmap=yield createImageBitmap(i);r.refCounter=1}catch(i){xe(i),r=null}return this.#n.set(e,r),r&&this.#n.set(r.id,r),r})}getFromFile(e){return g(this,null,function*(){let{lastModified:t,name:r,size:i,type:s}=e;return this.#r(`${t}_${r}_${i}_${s}`,e)})}getFromUrl(e){return g(this,null,function*(){return this.#r(e,e)})}getFromBlob(e,t){return g(this,null,function*(){let r=yield t;return this.#r(e,r)})}getFromId(e){return g(this,null,function*(){this.#n||=new Map;let t=this.#n.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:r}=t;return delete t.blobPromise,this.getFromBlob(t.id,r)}return this.getFromUrl(t.url)})}getFromCanvas(e,t){this.#n||=new Map;let r=this.#n.get(e);if(r?.bitmap)return r.refCounter+=1,r;let i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),r={bitmap:i.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#n.set(e,r),this.#n.set(r.id,r),r}getSvgUrl(e){let t=this.#n.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#n||=new Map;let t=this.#n.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:r}=t;if(!t.url&&!t.file){let i=new OffscreenCanvas(r.width,r.height);i.getContext("bitmaprenderer").transferFromImageBitmap(r),t.blobPromise=i.convertToBlob()}r.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}},tT=class{#e=[];#t=!1;#n;#r=-1;constructor(e=128){this.#n=e}add({cmd:e,undo:t,post:r,mustExec:i,type:s=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(i&&e(),this.#t)return;let c={cmd:e,undo:t,post:r,type:s};if(this.#r===-1){this.#e.length>0&&(this.#e.length=0),this.#r=0,this.#e.push(c);return}if(o&&this.#e[this.#r].type===s){a&&(c.undo=this.#e[this.#r].undo),this.#e[this.#r]=c;return}let l=this.#r+1;l===this.#n?this.#e.splice(0,1):(this.#r=l,l<this.#e.length&&this.#e.splice(l)),this.#e.push(c)}undo(){if(this.#r===-1)return;this.#t=!0;let{undo:e,post:t}=this.#e[this.#r];e(),t?.(),this.#t=!1,this.#r-=1}redo(){if(this.#r<this.#e.length-1){this.#r+=1,this.#t=!0;let{cmd:e,post:t}=this.#e[this.#r];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#r!==-1}hasSomethingToRedo(){return this.#r<this.#e.length-1}cleanType(e){if(this.#r!==-1){for(let t=this.#r;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#r-t),this.#r=t;return}this.#e.length=0,this.#r=-1}}destroy(){this.#e=null}},Ea=class{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=ln.platform;for(let[r,i,s={}]of e)for(let o of r){let a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:i,options:s}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:i,options:s}),this.allKeys.add(o.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;let r=this.callbacks.get(this.#e(t));if(!r)return;let{callback:i,options:{bubbles:s=!1,args:o=[],checker:a=null}}=r;a&&!a(e,t)||(i.bind(e,...o,t)(),s||hr(t))}},nT=class n{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return YQ(e),Le(this,"_colors",e)}convert(e){let t=yC(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[r,i]of this._colors)if(i.every((s,o)=>s===t[o]))return n._colorsMapping.get(r);return t}getHexCode(e){let t=this._colors.get(e);return t?se.makeHexColor(...t):e}},Od=(()=>{class n{#e=new AbortController;#t=null;#n=new Map;#r=new Map;#s=null;#i=null;#c=null;#a=new tT;#u=null;#l=null;#h=0;#d=new Set;#f=null;#o=null;#p=new Set;_editorUndoBar=null;#g=!1;#m=!1;#y=!1;#w=null;#_=null;#b=null;#I=null;#T=!1;#S=null;#x=new JA;#E=!1;#D=!1;#C=null;#P=null;#O=null;#L=null;#A=De.NONE;#v=new Set;#N=null;#U=null;#B=null;#H={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#F=[0,0];#k=null;#V=null;#q=null;#M=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let t=n.prototype,r=a=>a.#V.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),i=(a,{target:c})=>{if(c instanceof HTMLInputElement){let{type:l}=c;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return Le(this,"_keyboardManager",new Ea([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:c})=>!(c instanceof HTMLButtonElement)&&a.#V.contains(c)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:c})=>!(c instanceof HTMLButtonElement)&&a.#V.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:r}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-o,0],checker:r}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:r}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[o,0],checker:r}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:r}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-o],checker:r}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:r}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,o],checker:r}]]))}constructor(t,r,i,s,o,a,c,l,u,d,f,p,y){let w=this._signal=this.#e.signal;this.#V=t,this.#q=r,this.#s=i,this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:w}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),s._on("setpreference",this.onSetPreference.bind(this),{signal:w}),s._on("switchannotationeditorparams",b=>this.updateParams(b.type,b.value),{signal:w}),this.#te(),this.#se(),this.#K(),this.#i=o.annotationStorage,this.#w=o.filterFactory,this.#U=a,this.#I=c||null,this.#g=l,this.#m=u,this.#y=d,this.#L=f||null,this.viewParameters={realScale:po.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=y!==!1}destroy(){this.#M?.resolve(),this.#M=null,this.#e?.abort(),this.#e=null,this._signal=null;for(let t of this.#r.values())t.destroy();this.#r.clear(),this.#n.clear(),this.#p.clear(),this.#t=null,this.#v.clear(),this.#a.destroy(),this.#s?.destroy(),this.#S?.hide(),this.#S=null,this.#_&&(clearTimeout(this.#_),this.#_=null),this.#k&&(clearTimeout(this.#k),this.#k=null),this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#L}get useNewAltTextFlow(){return this.#m}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return Le(this,"hcmFilter",this.#U?this.#w.addHCMFilter(this.#U.foreground,this.#U.background):"none")}get direction(){return Le(this,"direction",getComputedStyle(this.#V).direction)}get highlightColors(){return Le(this,"highlightColors",this.#I?new Map(this.#I.split(",").map(t=>t.split("=").map(r=>r.trim()))):null)}get highlightColorNames(){return Le(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#l=t}setMainHighlightColorPicker(t){this.#O=t}editAltText(t,r=!1){this.#s?.editAltText(this,t,r)}switchToMode(t,r){this._eventBus.on("annotationeditormodechanged",r,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,r){this._eventBus.dispatch("setpreference",{source:this,name:t,value:r})}onSetPreference({name:t,value:r}){switch(t){case"enableNewAltTextWhenAddingImage":this.#y=r;break}}onPageChanging({pageNumber:t}){this.#h=t-1}focusMainContainer(){this.#V.focus()}findParent(t,r){for(let i of this.#r.values()){let{x:s,y:o,width:a,height:c}=i.div.getBoundingClientRect();if(t>=s&&t<=s+a&&r>=o&&r<=o+c)return i}return null}disableUserSelect(t=!1){this.#q.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*po.PDF_TO_CSS_UNITS;for(let r of this.#p)r.onScaleChanging();this.#l?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#j({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#W(t){let{currentLayer:r}=this;if(r.hasTextLayer(t))return r;for(let i of this.#r.values())if(i.hasTextLayer(t))return i;return null}highlightSelection(t=""){let r=document.getSelection();if(!r||r.isCollapsed)return;let{anchorNode:i,anchorOffset:s,focusNode:o,focusOffset:a}=r,c=r.toString(),u=this.#j(r).closest(".textLayer"),d=this.getSelectionBoxes(u);if(!d)return;r.empty();let f=this.#W(u),p=this.#A===De.NONE,y=()=>{f?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:i,anchorOffset:s,focusNode:o,focusOffset:a,text:c}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(De.HIGHLIGHT,y);return}y()}#J(){let t=document.getSelection();if(!t||t.isCollapsed)return;let i=this.#j(t).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(this.#S||=new ZA(this),this.#S.show(i,s,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#i&&!this.#i.has(t.id)&&this.#i.setValue(t.id,t)}#ee(){let t=document.getSelection();if(!t||t.isCollapsed){this.#N&&(this.#S?.hide(),this.#N=null,this.#R({hasSelectedText:!1}));return}let{anchorNode:r}=t;if(r===this.#N)return;let s=this.#j(t).closest(".textLayer");if(!s){this.#N&&(this.#S?.hide(),this.#N=null,this.#R({hasSelectedText:!1}));return}if(this.#S?.hide(),this.#N=r,this.#R({hasSelectedText:!0}),!(this.#A!==De.HIGHLIGHT&&this.#A!==De.NONE)&&(this.#A===De.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#T=this.isShiftKeyDown,!this.isShiftKeyDown)){let o=this.#A===De.HIGHLIGHT?this.#W(s):null;o?.toggleDrawing();let a=new AbortController,c=this.combinedSignal(a),l=u=>{u.type==="pointerup"&&u.button!==0||(a.abort(),o?.toggleDrawing(!0),u.type==="pointerup"&&this.#G("main_toolbar"))};window.addEventListener("pointerup",l,{signal:c}),window.addEventListener("blur",l,{signal:c})}}#G(t=""){this.#A===De.HIGHLIGHT?this.highlightSelection(t):this.#g&&this.#J()}#te(){document.addEventListener("selectionchange",this.#ee.bind(this),{signal:this._signal})}#ne(){if(this.#b)return;this.#b=new AbortController;let t=this.combinedSignal(this.#b);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#re(){this.#b?.abort(),this.#b=null}blur(){if(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#G("main_toolbar")),!this.hasSelection)return;let{activeElement:t}=document;for(let r of this.#v)if(r.div.contains(t)){this.#P=[r,t],r._focusEventsAllowed=!1;break}}focus(){if(!this.#P)return;let[t,r]=this.#P;this.#P=null,r.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),r.focus()}#K(){if(this.#C)return;this.#C=new AbortController;let t=this.combinedSignal(this.#C);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ie(){this.#C?.abort(),this.#C=null}#Y(){if(this.#u)return;this.#u=new AbortController;let t=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#Q(){this.#u?.abort(),this.#u=null}#se(){let t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#K(),this.#Y()}removeEditListeners(){this.#ie(),this.#Q()}dragOver(t){for(let{type:r}of t.dataTransfer.items)for(let i of this.#o)if(i.isHandlingMimeForPasting(r)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(let r of t.dataTransfer.items)for(let i of this.#o)if(i.isHandlingMimeForPasting(r.type)){i.paste(r,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;let r=[];for(let i of this.#v){let s=i.serialize(!0);s&&r.push(s)}r.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(r))}cut(t){this.copy(t),this.delete()}paste(t){return g(this,null,function*(){t.preventDefault();let{clipboardData:r}=t;for(let o of r.items)for(let a of this.#o)if(a.isHandlingMimeForPasting(o.type)){a.paste(o,this.currentLayer);return}let i=r.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(o){xe(`paste: "${o.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();let s=this.currentLayer;try{let o=[];for(let l of i){let u=yield s.deserialize(l);if(!u)return;o.push(u)}let a=()=>{for(let l of o)this.#X(l);this.#Z(o)},c=()=>{for(let l of o)l.remove()};this.addCommands({cmd:a,undo:c,mustExec:!0})}catch(o){xe(`paste: "${o.message}".`)}})}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#A!==De.NONE&&!this.isEditorHandlingKeyboard&&n._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#G("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#R(t){Object.entries(t).some(([i,s])=>this.#H[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#H,t)}),this.#A===De.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#$([[We.HIGHLIGHT_FREE,!0]]))}#$(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ne(),this.#Y(),this.#R({isEditing:this.#A!==De.NONE,isEmpty:this.#z(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#re(),this.#Q(),this.#R({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#o){this.#o=t;for(let r of this.#o)this.#$(r.defaultPropertiesToUpdate)}}getId(){return this.#x.id}get currentLayer(){return this.#r.get(this.#h)}getLayer(t){return this.#r.get(t)}get currentPageIndex(){return this.#h}addLayer(t){this.#r.set(t.pageIndex,t),this.#E?t.enable():t.disable()}removeLayer(t){this.#r.delete(t.pageIndex)}updateMode(t,r=null,i=!1){return g(this,null,function*(){if(this.#A!==t&&!(this.#M&&(yield this.#M.promise,!this.#M))){if(this.#M=Promise.withResolvers(),this.#A=t,t===De.NONE){this.setEditingState(!1),this.#ae(),this._editorUndoBar?.hide(),this.#M.resolve();return}this.setEditingState(!0),yield this.#oe(),this.unselectAll();for(let s of this.#r.values())s.updateMode(t);if(!r){i&&this.addNewEditorFromKeyboard(),this.#M.resolve();return}for(let s of this.#n.values())s.annotationElementId===r?(this.setSelected(s),s.enterInEditMode()):s.unselect();this.#M.resolve()}})}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==this.#A&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,r){if(this.#o){switch(t){case We.CREATE:this.currentLayer.addNewEditor();return;case We.HIGHLIGHT_DEFAULT_COLOR:this.#O?.updateColor(r);break;case We.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#B||=new Map).set(t,r),this.showAllEditors("highlight",r);break}for(let i of this.#v)i.updateParams(t,r);for(let i of this.#o)i.updateDefaultParams(t,r)}}showAllEditors(t,r,i=!1){for(let o of this.#n.values())o.editorType===t&&o.show(r);(this.#B?.get(We.HIGHLIGHT_SHOW_ALL)??!0)!==r&&this.#$([[We.HIGHLIGHT_SHOW_ALL,r]])}enableWaiting(t=!1){if(this.#D!==t){this.#D=t;for(let r of this.#r.values())t?r.disableClick():r.enableClick(),r.div.classList.toggle("waiting",t)}}#oe(){return g(this,null,function*(){if(!this.#E){this.#E=!0;let t=[];for(let r of this.#r.values())t.push(r.enable());yield Promise.all(t);for(let r of this.#n.values())r.enable()}})}#ae(){if(this.unselectAll(),this.#E){this.#E=!1;for(let t of this.#r.values())t.disable();for(let t of this.#n.values())t.disable()}}getEditors(t){let r=[];for(let i of this.#n.values())i.pageIndex===t&&r.push(i);return r}getEditor(t){return this.#n.get(t)}addEditor(t){this.#n.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.focusMainContainer(),this.#_=null},0)),this.#n.delete(t.id),this.unselect(t),(!t.annotationElementId||!this.#d.has(t.annotationElementId))&&this.#i?.remove(t.id)}addDeletedAnnotationElement(t){this.#d.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#d.has(t)}removeDeletedAnnotationElement(t){this.#d.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#X(t){let r=this.#r.get(t.pageIndex);r?r.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#t!==t&&(this.#t=t,t&&this.#$(t.propertiesToUpdate))}get#ce(){let t=null;for(t of this.#v);return t}updateUI(t){this.#ce===t&&this.#$(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#$(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#v.has(t)){this.#v.delete(t),t.unselect(),this.#R({hasSelectedEditor:this.hasSelection});return}this.#v.add(t),t.select(),this.#$(t.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}setSelected(t){this.#l?.commitOrRemove();for(let r of this.#v)r!==t&&r.unselect();this.#v.clear(),this.#v.add(t),t.select(),this.#$(t.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}isSelected(t){return this.#v.has(t)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(t){t.unselect(),this.#v.delete(t),this.#R({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#a.undo(),this.#R({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#z()}),this._editorUndoBar?.hide()}redo(){this.#a.redo(),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#z()})}addCommands(t){this.#a.add(t),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#z()})}cleanUndoStack(t){this.#a.cleanType(t)}#z(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(let t of this.#n.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();let t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;let r=t?[t]:[...this.#v],i=()=>{this._editorUndoBar?.show(s,r.length===1?r[0].editorType:r.length);for(let o of r)o.remove()},s=()=>{for(let o of r)this.#X(o)};this.addCommands({cmd:i,undo:s,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#Z(t){for(let r of this.#v)r.unselect();this.#v.clear();for(let r of t)r.isEmpty()||(this.#v.add(r),r.select());this.#R({hasSelectedEditor:this.hasSelection})}selectAll(){for(let t of this.#v)t.commit();this.#Z(this.#n.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#A!==De.NONE))&&!this.#l?.commitOrRemove()&&this.hasSelection){for(let t of this.#v)t.unselect();this.#v.clear(),this.#R({hasSelectedEditor:!1})}}translateSelectedEditors(t,r,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#F[0]+=t,this.#F[1]+=r;let[s,o]=this.#F,a=[...this.#v],c=1e3;this.#k&&clearTimeout(this.#k),this.#k=setTimeout(()=>{this.#k=null,this.#F[0]=this.#F[1]=0,this.addCommands({cmd:()=>{for(let l of a)this.#n.has(l.id)&&l.translateInPage(s,o)},undo:()=>{for(let l of a)this.#n.has(l.id)&&l.translateInPage(-s,-o)},mustExec:!1})},c);for(let l of a)l.translateInPage(t,r)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(let t of this.#v)this.#f.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);let t=this.#f;this.#f=null;let r=!1;for(let[{x:s,y:o,pageIndex:a},c]of t)c.newX=s,c.newY=o,c.newPageIndex=a,r||=s!==c.savedX||o!==c.savedY||a!==c.savedPageIndex;if(!r)return!1;let i=(s,o,a,c)=>{if(this.#n.has(s.id)){let l=this.#r.get(c);l?s._setParentAndPosition(l,o,a):(s.pageIndex=c,s.x=o,s.y=a)}};return this.addCommands({cmd:()=>{for(let[s,{newX:o,newY:a,newPageIndex:c}]of t)i(s,o,a,c)},undo:()=>{for(let[s,{savedX:o,savedY:a,savedPageIndex:c}]of t)i(s,o,a,c)},mustExec:!0}),!0}dragSelectedEditors(t,r){if(this.#f)for(let i of this.#f.keys())i.drag(t,r)}rebuild(t){if(t.parent===null){let r=this.getLayer(t.pageIndex);r?(r.changeParent(t),r.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#t===t}getActive(){return this.#t}getMode(){return this.#A}get imageManager(){return Le(this,"imageManager",new eT)}getSelectionBoxes(t){if(!t)return null;let r=document.getSelection();for(let u=0,d=r.rangeCount;u<d;u++)if(!t.contains(r.getRangeAt(u).commonAncestorContainer))return null;let{x:i,y:s,width:o,height:a}=t.getBoundingClientRect(),c;switch(t.getAttribute("data-main-rotation")){case"90":c=(u,d,f,p)=>({x:(d-s)/a,y:1-(u+f-i)/o,width:p/a,height:f/o});break;case"180":c=(u,d,f,p)=>({x:1-(u+f-i)/o,y:1-(d+p-s)/a,width:f/o,height:p/a});break;case"270":c=(u,d,f,p)=>({x:1-(d+p-s)/a,y:(u-i)/o,width:p/a,height:f/o});break;default:c=(u,d,f,p)=>({x:(u-i)/o,y:(d-s)/a,width:f/o,height:p/a});break}let l=[];for(let u=0,d=r.rangeCount;u<d;u++){let f=r.getRangeAt(u);if(!f.collapsed)for(let{x:p,y,width:w,height:b}of f.getClientRects())w===0||b===0||l.push(c(p,y,w,b))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:r}){(this.#c||=new Map).set(t,r)}removeChangedExistingAnnotation({annotationElementId:t}){this.#c?.delete(t)}renderAnnotationElement(t){let r=this.#c?.get(t.data.id);if(!r)return;let i=this.#i.getRawValue(r);i&&(this.#A===De.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}}return n})(),bF=(()=>{class n{#e=null;#t=!1;#n=null;#r=null;#s=null;#i=null;#c=!1;#a=null;#u=null;#l=null;#h=null;#d=!1;static#f=null;static _l10n=null;constructor(t){this.#u=t,this.#d=t._uiManager.useNewAltTextFlow,n.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){n._l10n??=t}render(){return g(this,null,function*(){let t=this.#n=document.createElement("button");t.className="altText",t.tabIndex="0";let r=this.#r=document.createElement("span");t.append(r),this.#d?(t.classList.add("new"),t.setAttribute("data-l10n-id",n.#f.missing),r.setAttribute("data-l10n-id",n.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),r.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let i=this.#u._uiManager._signal;t.addEventListener("contextmenu",ei,{signal:i}),t.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:i});let s=o=>{o.preventDefault(),this.#u._uiManager.editAltText(this.#u),this.#d&&this.#u._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#o}})};return t.addEventListener("click",s,{capture:!0,signal:i}),t.addEventListener("keydown",o=>{o.target===t&&o.key==="Enter"&&(this.#c=!0,s(o))},{signal:i}),yield this.#p(),t})}get#o(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#c}),this.#c=!1)}isEmpty(){return this.#d?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#d?this.#e!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}setGuessedText(t){return g(this,null,function*(){this.#e===null&&(this.#l=t,this.#h=yield n._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())})}toggleAltTextBadge(t=!1){if(!this.#d||this.#e){this.#a?.remove(),this.#a=null;return}if(!this.#a){let r=this.#a=document.createElement("div");r.className="noAltTextBadge",this.#u.div.append(r)}this.#a.classList.toggle("hidden",!t)}serialize(t){let r=this.#e;return!t&&this.#l===r&&(r=this.#h),{altText:r,decorative:this.#t,guessedText:this.#l,textWithDisclaimer:this.#h}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:t,decorative:r,guessedText:i,textWithDisclaimer:s,cancel:o=!1}){i&&(this.#l=i,this.#h=s),!(this.#e===t&&this.#t===r)&&(o||(this.#e=t,this.#t=r),this.#p())}toggle(t=!1){this.#n&&(!t&&this.#i&&(clearTimeout(this.#i),this.#i=null),this.#n.disabled=!t)}shown(){this.#u._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#o}})}destroy(){this.#n?.remove(),this.#n=null,this.#r=null,this.#s=null,this.#a?.remove(),this.#a=null}#p(){return g(this,null,function*(){let t=this.#n;if(!t)return;if(this.#d){if(t.classList.toggle("done",!!this.#e),t.setAttribute("data-l10n-id",n.#f[this.#o]),this.#r?.setAttribute("data-l10n-id",n.#f[`${this.#o}-label`]),!this.#e){this.#s?.remove();return}}else{if(!this.#e&&!this.#t){t.classList.remove("done"),this.#s?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let r=this.#s;if(!r){this.#s=r=document.createElement("span"),r.className="tooltip",r.setAttribute("role","tooltip"),r.id=`alt-text-tooltip-${this.#u.id}`;let s=100,o=this.#u._uiManager._signal;o.addEventListener("abort",()=>{clearTimeout(this.#i),this.#i=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#i=setTimeout(()=>{this.#i=null,this.#s.classList.add("show"),this.#u._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:o}),t.addEventListener("mouseleave",()=>{this.#i&&(clearTimeout(this.#i),this.#i=null),this.#s?.classList.remove("show")},{signal:o})}this.#t?r.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(r.removeAttribute("data-l10n-id"),r.textContent=this.#e),r.parentNode||t.append(r),this.#u.getImageForAltText()?.setAttribute("aria-describedby",r.id)})}}return n})(),pg=class n{#e;#t=!1;#n=null;#r;#s;#i;#c;#a;#u=null;#l;#h=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:r=null,onPinchStart:i=null,onPinching:s=null,onPinchEnd:o=null,signal:a}){this.#e=e,this.#n=r,this.#r=t,this.#s=i,this.#i=s,this.#c=o,this.#l=new AbortController,this.#a=AbortSignal.any([a,this.#l.signal]),e.addEventListener("touchstart",this.#d.bind(this),{passive:!1,signal:this.#a})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Le(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}#d(e){if(this.#r?.()||e.touches.length<2)return;if(!this.#h){this.#h=new AbortController;let i=AbortSignal.any([this.#a,this.#h.signal]),s=this.#e,o={signal:i,passive:!1};s.addEventListener("touchmove",this.#f.bind(this),o),s.addEventListener("touchend",this.#o.bind(this),o),s.addEventListener("touchcancel",this.#o.bind(this),o),this.#s?.()}if(hr(e),e.touches.length!==2||this.#n?.()){this.#u=null;return}let[t,r]=e.touches;t.identifier>r.identifier&&([t,r]=[r,t]),this.#u={touch0X:t.screenX,touch0Y:t.screenY,touch1X:r.screenX,touch1Y:r.screenY}}#f(e){if(!this.#u||e.touches.length!==2)return;let[t,r]=e.touches;t.identifier>r.identifier&&([t,r]=[r,t]);let{screenX:i,screenY:s}=t,{screenX:o,screenY:a}=r,c=this.#u,{touch0X:l,touch0Y:u,touch1X:d,touch1Y:f}=c,p=d-l,y=f-u,w=o-i,b=a-s,E=Math.hypot(w,b)||1,D=Math.hypot(p,y)||1;if(!this.#t&&Math.abs(D-E)<=n.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=i,c.touch0Y=s,c.touch1X=o,c.touch1Y=a,e.preventDefault(),!this.#t){this.#t=!0;return}let x=[(i+o)/2,(s+a)/2];this.#i?.(x,D,E)}#o(e){this.#h.abort(),this.#h=null,this.#c?.(),this.#u&&(e.preventDefault(),this.#u=null,this.#t=!1)}destroy(){this.#l?.abort(),this.#l=null}},It=class n{#e=null;#t=null;#n=null;#r=!1;#s=null;#i="";#c=!1;#a=null;#u=null;#l=null;#h=null;#d="";#f=!1;#o=null;#p=!1;#g=!1;#m=!1;#y=null;#w=0;#_=0;#b=null;#I=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#T=!1;#S=n._zIndex++;static _borderLineWidth=-1;static _colorManager=new nT;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let e=n.prototype._resizeWithKeyboard,t=Od.TRANSLATE_SMALL,r=Od.TRANSLATE_BIG;return Le(this,"_resizerKeyboardManager",new Ea([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-r,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[r,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-r]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,r]}],[["Escape","mac+Escape"],n.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:r,pageHeight:i,pageX:s,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,i],this.pageTranslation=[s,o];let[a,c]=this.parentDimensions;this.x=e.x/a,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Le(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new rT({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(n._l10n??=e,n._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),n._borderLineWidth!==-1)return;let r=getComputedStyle(document.documentElement);n._borderLineWidth=parseFloat(r.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){ft("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#T}set _isDraggable(e){this.#T=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#S}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#j(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,r,i){let[s,o]=this.parentDimensions;[r,i]=this.screenToPageTranslation(r,i),this.x=(e+r)/s,this.y=(t+i)/o,this.fixAndSetPosition()}#x([e,t],r,i){[r,i]=this.screenToPageTranslation(r,i),this.x+=r/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#x(this.parentDimensions,e,t)}translateInPage(e,t){this.#o||=[this.x,this.y,this.width,this.height],this.#x(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){this.#o||=[this.x,this.y,this.width,this.height];let{div:r,parentDimensions:[i,s]}=this;if(this.x+=e/i,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:d,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this,[c,l]=this.getBaseTranslation();o+=c,a+=l;let{style:u}=r;u.left=`${(100*o).toFixed(2)}%`,u.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),r.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#o&&(this.#o[0]!==this.x||this.#o[1]!==this.y)}get _hasBeenResized(){return!!this.#o&&(this.#o[2]!==this.width||this.#o[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:r}=n,i=r/e,s=r/t;switch(this.rotation){case 90:return[-i,s];case 180:return[i,s];case 270:return[i,-s];default:return[-i,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[r,i]}=this,{x:s,y:o,width:a,height:c}=this;if(a*=r,c*=i,s*=r,o*=i,this._mustFixPosition)switch(e){case 0:s=Math.max(0,Math.min(r-a,s)),o=Math.max(0,Math.min(i-c,o));break;case 90:s=Math.max(0,Math.min(r-c,s)),o=Math.min(i,Math.max(a,o));break;case 180:s=Math.min(r,Math.max(a,s)),o=Math.min(i,Math.max(c,o));break;case 270:s=Math.min(r,Math.max(c,s)),o=Math.max(0,Math.min(i-a,o));break}this.x=s/=r,this.y=o/=i;let[l,u]=this.getBaseTranslation();s+=l,o+=u,t.left=`${(100*s).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#E(e,t,r){switch(r){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return n.#E(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return n.#E(e,t,360-this.parentRotation)}#D(e){switch(e){case 90:{let[t,r]=this.pageDimensions;return[0,-t/r,r/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,r]=this.pageDimensions;return[0,t/r,-r/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,r]}=this;return[t*e,r*e]}setDims(e,t){let[r,i]=this.parentDimensions,{style:s}=this.div;s.width=`${(100*e/r).toFixed(2)}%`,this.#c||(s.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:r}=e,i=r.endsWith("%"),s=!this.#c&&t.endsWith("%");if(i&&s)return;let[o,a]=this.parentDimensions;i||(e.width=`${(100*parseFloat(r)/o).toFixed(2)}%`),!this.#c&&!s&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#C(){if(this.#a)return;this.#a=document.createElement("div"),this.#a.classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let r of e){let i=document.createElement("div");this.#a.append(i),i.classList.add("resizer",r),i.setAttribute("data-resizer-name",r),i.addEventListener("pointerdown",this.#P.bind(this,r),{signal:t}),i.addEventListener("contextmenu",ei,{signal:t}),i.tabIndex=-1}this.div.prepend(this.#a)}#P(e,t){t.preventDefault();let{isMac:r}=ln.platform;if(t.button!==0||t.ctrlKey&&r)return;this.#n?.toggle(!1);let i=this._isDraggable;this._isDraggable=!1,this.#u=[t.screenX,t.screenY];let s=new AbortController,o=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#A.bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",hr,{passive:!1,signal:o}),window.addEventListener("contextmenu",ei,{signal:o}),this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let a=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let l=()=>{s.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=c,this.#L()};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})}#O(e,t,r,i){this.width=r,this.height=i,this.x=e,this.y=t;let[s,o]=this.parentDimensions;this.setDims(s*r,o*i),this.fixAndSetPosition(),this._onResized()}_onResized(){}#L(){if(!this.#l)return;let{savedX:e,savedY:t,savedWidth:r,savedHeight:i}=this.#l;this.#l=null;let s=this.x,o=this.y,a=this.width,c=this.height;s===e&&o===t&&a===r&&c===i||this.addCommands({cmd:this.#O.bind(this,s,o,a,c),undo:this.#O.bind(this,e,t,r,i),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#A(e,t){let[r,i]=this.parentDimensions,s=this.x,o=this.y,a=this.width,c=this.height,l=n.MIN_SIZE/r,u=n.MIN_SIZE/i,d=this.#D(this.rotation),f=(ee,J)=>[d[0]*ee+d[2]*J,d[1]*ee+d[3]*J],p=this.#D(360-this.rotation),y=(ee,J)=>[p[0]*ee+p[2]*J,p[1]*ee+p[3]*J],w,b,E=!1,D=!1;switch(e){case"topLeft":E=!0,w=(ee,J)=>[0,0],b=(ee,J)=>[ee,J];break;case"topMiddle":w=(ee,J)=>[ee/2,0],b=(ee,J)=>[ee/2,J];break;case"topRight":E=!0,w=(ee,J)=>[ee,0],b=(ee,J)=>[0,J];break;case"middleRight":D=!0,w=(ee,J)=>[ee,J/2],b=(ee,J)=>[0,J/2];break;case"bottomRight":E=!0,w=(ee,J)=>[ee,J],b=(ee,J)=>[0,0];break;case"bottomMiddle":w=(ee,J)=>[ee/2,J],b=(ee,J)=>[ee/2,0];break;case"bottomLeft":E=!0,w=(ee,J)=>[0,J],b=(ee,J)=>[ee,0];break;case"middleLeft":D=!0,w=(ee,J)=>[0,J/2],b=(ee,J)=>[ee,J/2];break}let x=w(a,c),N=b(a,c),L=f(...N),F=n._round(s+L[0]),T=n._round(o+L[1]),A=1,C=1,R,M;if(t.fromKeyboard)({deltaX:R,deltaY:M}=t);else{let{screenX:ee,screenY:J}=t,[Wt,Un]=this.#u;[R,M]=this.screenToPageTranslation(ee-Wt,J-Un),this.#u[0]=ee,this.#u[1]=J}if([R,M]=y(R/r,M/i),E){let ee=Math.hypot(a,c);A=C=Math.max(Math.min(Math.hypot(N[0]-x[0]-R,N[1]-x[1]-M)/ee,1/a,1/c),l/a,u/c)}else D?A=Math.max(l,Math.min(1,Math.abs(N[0]-x[0]-R)))/a:C=Math.max(u,Math.min(1,Math.abs(N[1]-x[1]-M)))/c;let O=n._round(a*A),S=n._round(c*C);L=f(...b(O,S));let Pe=F-L[0],Nt=T-L[1];this.#o||=[this.x,this.y,this.width,this.height],this.width=O,this.height=S,this.x=Pe,this.y=Nt,this.setDims(r*O,i*S),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}addEditToolbar(){return g(this,null,function*(){return this._editToolbar||this.#g?this._editToolbar:(this._editToolbar=new XA(this),this.div.append(this._editToolbar.render()),this.#n&&(yield this._editToolbar.addAltText(this.#n)),this._editToolbar)})}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#n?.destroy())}addContainer(e){let t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}addAltTextButton(){return g(this,null,function*(){this.#n||(bF.initialize(n._l10n),this.#n=new bF(this),this.#e&&(this.#n.data=this.#e,this.#e=null),yield this.addEditToolbar())})}get altTextData(){return this.#n?.data}set altTextData(e){this.#n&&(this.#n.data=e)}get guessedAltText(){return this.#n?.guessedText}setGuessedAltText(e){return g(this,null,function*(){yield this.#n?.setGuessedText(e)})}serializeAltText(e){return this.#n?.serialize(e)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#r?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#F();let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[r,i]=this.getInitialTranslation();return this.translate(r,i),fg(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#I||=new pg({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#v.bind(this),onPinching:this.#N.bind(this),onPinchEnd:this.#U.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),this.div}#v(){this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#N(e,t,r){let s=.7*(r/t)+1-.7;if(s===1)return;let o=this.#D(this.rotation),a=(F,T)=>[o[0]*F+o[2]*T,o[1]*F+o[3]*T],[c,l]=this.parentDimensions,u=this.x,d=this.y,f=this.width,p=this.height,y=n.MIN_SIZE/c,w=n.MIN_SIZE/l;s=Math.max(Math.min(s,1/f,1/p),y/f,w/p);let b=n._round(f*s),E=n._round(p*s);if(b===f&&E===p)return;this.#o||=[u,d,f,p];let D=a(f/2,p/2),x=n._round(u+D[0]),N=n._round(d+D[1]),L=a(b/2,E/2);this.x=x-L[0],this.y=N-L[1],this.width=b,this.height=E,this.setDims(c*b,l*E),this.fixAndSetPosition(),this._onResizing()}#U(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#L()}pointerdown(e){let{isMac:t}=ln.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#H(e);return}this.#B(e)}get isSelected(){return this._uiManager.isSelected(this)}#B(e){let{isMac:t}=ln.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#H(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let r=!1,i=new AbortController,s=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:s},a=l=>{i.abort(),this.#s=null,this.#f=!1,this._uiManager.endDragSession()||this.#B(l),r&&this._onStopDragging()};t&&(this.#w=e.clientX,this.#_=e.clientY,this.#s=e.pointerId,this.#i=e.pointerType,window.addEventListener("pointermove",l=>{r||(r=!0,this._onStartDragging());let{clientX:u,clientY:d,pointerId:f}=l;if(f!==this.#s){hr(l);return}let[p,y]=this.screenToPageTranslation(u-this.#w,d-this.#_);this.#w=u,this.#_=d,this._uiManager.dragSelectedEditors(p,y)},o),window.addEventListener("touchmove",hr,o),window.addEventListener("pointerdown",l=>{l.pointerType===this.#i&&(this.#I||l.isPrimary)&&a(l),hr(l)},o));let c=l=>{if(!this.#s||this.#s===l.pointerId){a(l);return}hr(l)};window.addEventListener("pointerup",c,{signal:s}),window.addEventListener("blur",c,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,r){e.changeParent(this),this.x=t,this.y=r,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,r=this.rotation){let i=this.parentScale,[s,o]=this.pageDimensions,[a,c]=this.pageTranslation,l=e/i,u=t/i,d=this.x*s,f=this.y*o,p=this.width*s,y=this.height*o;switch(r){case 0:return[d+l+a,o-f-u-y+c,d+l+p+a,o-f-u+c];case 90:return[d+u+a,o-f+l+c,d+u+y+a,o-f+l+p+c];case 180:return[d-l-p+a,o-f+u+c,d-l+a,o-f+u+y+c];case 270:return[d-u-y+a,o-f-l-p+c,d-u+a,o-f-l+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[r,i,s,o]=e,a=s-r,c=o-i;switch(this.rotation){case 0:return[r,t-o,a,c];case 90:return[r,t-i,c,a];case 180:return[s,t-i,a,c];case 270:return[s,t-o,c,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){this.#g=!0}disableEditMode(){this.#g=!1}isInEditMode(){return this.#g}shouldGetKeyboardEvents(){return this.#m}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:r,right:i}=this.getClientDimensions(),{innerHeight:s,innerWidth:o}=window;return t<o&&i>0&&e<s&&r>0}#F(){if(this.#h||!this.div)return;this.#h=new AbortController;let e=this._uiManager.combinedSignal(this.#h);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#F()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){ft("An editor must be serializable")}static deserialize(e,t,r){return g(this,null,function*(){let i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:r});i.rotation=e.rotation,i.#e=e.accessibilityData;let[s,o]=i.pageDimensions,[a,c,l,u]=i.getRectInCurrentCoords(e.rect,o);return i.x=a/s,i.y=c/o,i.width=l/s,i.height=u/o,i})}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#h?.abort(),this.#h=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#j(),this.removeEditToolbar(),this.#b){for(let e of this.#b.values())clearTimeout(e);this.#b=null}this.parent=null,this.#I?.destroy(),this.#I=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#C(),this.#a.classList.remove("hidden"),fg(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let t=this.#a.children;if(!this.#t){this.#t=Array.from(t);let o=this.#k.bind(this),a=this.#V.bind(this),c=this._uiManager._signal;for(let l of this.#t){let u=l.getAttribute("data-resizer-name");l.setAttribute("role","spinbutton"),l.addEventListener("keydown",o,{signal:c}),l.addEventListener("blur",a,{signal:c}),l.addEventListener("focus",this.#q.bind(this,u),{signal:c}),l.setAttribute("data-l10n-id",n._l10nResizer[u])}}let r=this.#t[0],i=0;for(let o of t){if(o===r)break;i++}let s=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(s!==i){if(s<i)for(let a=0;a<i-s;a++)this.#a.append(this.#a.firstChild);else if(s>i)for(let a=0;a<s-i;a++)this.#a.firstChild.before(this.#a.lastChild);let o=0;for(let a of t){let l=this.#t[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",n._l10nResizer[l])}}this.#M(0),this.#m=!0,this.#a.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#k(e){n._resizerKeyboardManager.exec(this,e)}#V(e){this.#m&&e.relatedTarget?.parentNode!==this.#a&&this.#j()}#q(e){this.#d=this.#m?e:""}#M(e){if(this.#t)for(let t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#m&&this.#A(this.#d,{deltaX:e,deltaY:t,fromKeyboard:!0})}#j(){this.#m=!1,this.#M(-1),this.#L()}_stopResizingWithKeyboard(){this.#j(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}unselect(){this.#a?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#c=!0;let r=e/t,{style:i}=this.div;i.aspectRatio=r,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#b||=new Map;let{action:r}=e,i=this.#b.get(r);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),this.#b.delete(r),this.#b.size===0&&(this.#b=null)},n._telemetryTimeout),this.#b.set(r,i);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let r=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),r.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}},rT=class extends It{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},EF=3285377520,Er=4294901760,Oi=65535,mg=class{constructor(e){this.h1=e?e&4294967295:EF,this.h2=e?e&4294967295:EF}update(e){let t,r;if(typeof e=="string"){t=new Uint8Array(e.length*2),r=0;for(let w=0,b=e.length;w<b;w++){let E=e.charCodeAt(w);E<=255?t[r++]=E:(t[r++]=E>>>8,t[r++]=E&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),r=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let i=r>>2,s=r-i*4,o=new Uint32Array(t.buffer,0,i),a=0,c=0,l=this.h1,u=this.h2,d=3432918353,f=461845907,p=d&Oi,y=f&Oi;for(let w=0;w<i;w++)w&1?(a=o[w],a=a*d&Er|a*p&Oi,a=a<<15|a>>>17,a=a*f&Er|a*y&Oi,l^=a,l=l<<13|l>>>19,l=l*5+3864292196):(c=o[w],c=c*d&Er|c*p&Oi,c=c<<15|c>>>17,c=c*f&Er|c*y&Oi,u^=c,u=u<<13|u>>>19,u=u*5+3864292196);switch(a=0,s){case 3:a^=t[i*4+2]<<16;case 2:a^=t[i*4+1]<<8;case 1:a^=t[i*4],a=a*d&Er|a*p&Oi,a=a<<15|a>>>17,a=a*f&Er|a*y&Oi,i&1?l^=a:u^=a}this.h1=l,this.h2=u}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Er|e*36045&Oi,t=t*4283543511&Er|((t<<16|e>>>16)*2950163797&Er)>>>16,e^=t>>>1,e=e*444984403&Er|e*60499&Oi,t=t*3301882366&Er|((t<<16|e>>>16)*3120437893&Er)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},iT=Object.freeze({map:null,hash:"",transfer:void 0}),kd=class{#e=!1;#t=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let r=this.#n.get(e);return r===void 0?t:Object.assign(t,r)}getRawValue(e){return this.#n.get(e)}remove(e){if(this.#n.delete(e),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of this.#n.values())if(t instanceof It)return;this.onAnnotationEditor(null)}}setValue(e,t){let r=this.#n.get(e),i=!1;if(r!==void 0)for(let[s,o]of Object.entries(t))r[s]!==o&&(i=!0,r[s]=o);else i=!0,this.#n.set(e,t);i&&this.#r(),t instanceof It&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#n.has(e)}getAll(){return this.#n.size>0?pC(this.#n):null}setAll(e){for(let[t,r]of Object.entries(e))this.setValue(t,r)}get size(){return this.#n.size}#r(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new gg(this)}get serializable(){if(this.#n.size===0)return iT;let e=new Map,t=new mg,r=[],i=Object.create(null),s=!1;for(let[o,a]of this.#n){let c=a instanceof It?a.serialize(!1,i):a;c&&(e.set(o,c),t.update(`${o}:${JSON.stringify(c)}`),s||=!!c.bitmap)}if(s)for(let o of e.values())o.bitmap&&r.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:r}:iT}get editorStats(){let e=null,t=new Map;for(let r of this.#n.values()){if(!(r instanceof It))continue;let i=r.telemetryFinalData;if(!i)continue;let{type:s}=i;t.has(s)||t.set(s,Object.getPrototypeOf(r).constructor),e||=Object.create(null);let o=e[s]||=new Map;for(let[a,c]of Object.entries(i)){if(a==="type")continue;let l=o.get(a);l||(l=new Map,o.set(a,l));let u=l.get(c)??0;l.set(c,u+1)}}for(let[r,i]of t)e[r]=i.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){this.#t=null}get modifiedIds(){if(this.#t)return this.#t;let e=[];for(let t of this.#n.values())!(t instanceof It)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}},gg=class extends kd{#e;constructor(e){super();let{map:t,hash:r,transfer:i}=e.serializable,s=structuredClone(t,i?{transfer:i}:null);this.#e={map:s,hash:r,transfer:i}}get print(){ft("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return Le(this,"modifiedIds",{ids:new Set,hash:""})}},sT=class{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont(r){return g(this,arguments,function*({systemFontInfo:e,_inspectFont:t}){if(!(!e||this.#e.has(e.loadedName))){if(jt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:i,src:s,style:o}=e,a=new FontFace(i,s,o);this.addNativeFontFace(a);try{yield a.load(),this.#e.add(i),t?.(e)}catch{xe(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}ft("Not implemented: loadSystemFont without the Font Loading API.")}})}bind(e){return g(this,null,function*(){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){yield this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let r=e.createNativeFontFace();if(r){this.addNativeFontFace(r);try{yield r.loaded}catch(i){throw xe(`Failed to load font '${r.family}': '${i}'.`),e.disableFontFace=!0,i}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;yield new Promise(r=>{let i=this._queueLoadingCallback(r);this._prepareFontLoadEvent(e,i)})}})}get isFontLoadingAPISupported(){let e=!!this._document?.fonts;return Le(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(An||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),Le(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(jt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;r.length>0&&r[0].done;){let s=r.shift();setTimeout(s.callback,0)}}let{loadingRequests:r}=this,i={done:!1,complete:t,callback:e};return r.push(i),i}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Le(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function r(N,L){return N.charCodeAt(L)<<24|N.charCodeAt(L+1)<<16|N.charCodeAt(L+2)<<8|N.charCodeAt(L+3)&255}function i(N,L,F,T){let A=N.substring(0,L),C=N.substring(L+F);return A+T+C}let s,o,a=this._document.createElement("canvas");a.width=1,a.height=1;let c=a.getContext("2d"),l=0;function u(N,L){if(++l>30){xe("Load test font never loaded."),L();return}if(c.font="30px "+N,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){L();return}setTimeout(u.bind(null,N,L))}let d=`lt${Date.now()}${this.loadTestFontId++}`,f=this._loadTestFont;f=i(f,976,d.length,d);let y=16,w=1482184792,b=r(f,y);for(s=0,o=d.length-3;s<o;s+=4)b=b-w+r(d,s)|0;s<d.length&&(b=b-w+r(d+"XXX",s)|0),f=i(f,y,4,jQ(b));let E=`url(data:font/opentype;base64,${btoa(f)});`,D=`@font-face {font-family:"${d}";src:${E}}`;this.insertRule(D);let x=this._document.createElement("div");x.style.visibility="hidden",x.style.width=x.style.height="10px",x.style.position="absolute",x.style.top=x.style.left="0px";for(let N of[e.loadedName,d]){let L=this._document.createElement("span");L.textContent="Hi",L.style.fontFamily=N,x.append(L)}this._document.body.append(x),u(d,()=>{x.remove(),t.complete()})}},oT=class{constructor(e,{disableFontFace:t=!1,fontExtraProperties:r=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(let s in e)this[s]=e[s];this.disableFontFace=t===!0,this.fontExtraProperties=r===!0,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${zQ(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let r=this.loadedName+"_path_"+t,i;try{i=e.get(r)}catch(o){xe(`getPathGenerator - ignoring character: "${o}".`)}let s=new Path2D(i||"");return this.fontExtraProperties||e.delete(r),this.compiledGlyphs[t]=s}},ig={DATA:1,ERROR:2},Vt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function IF(){}function Qn(n){if(n instanceof ki||n instanceof Rd||n instanceof wa||n instanceof ug||n instanceof pl||n instanceof xd)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||ft('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new ki(n.message);case"InvalidPDFException":return new Rd(n.message);case"MissingPDFException":return new wa(n.message);case"PasswordException":return new ug(n.message,n.code);case"UnexpectedResponseException":return new pl(n.message,n.status);case"UnknownErrorException":return new xd(n.message,n.details)}return new xd(n.message,n.toString())}var _a=class{#e=new AbortController;constructor(e,t,r){this.sourceName=e,this.targetName=t,this.comObj=r,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),r.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#r(e);return}if(e.callback){let r=e.callbackId,i=this.callbackCapabilities[r];if(!i)throw new Error(`Cannot resolve callback ${r}`);if(delete this.callbackCapabilities[r],e.callback===ig.DATA)i.resolve(e.data);else if(e.callback===ig.ERROR)i.reject(Qn(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let r=this.sourceName,i=e.sourceName,s=this.comObj;Promise.try(t,e.data).then(function(o){s.postMessage({sourceName:r,targetName:i,callback:ig.DATA,callbackId:e.callbackId,data:o})},function(o){s.postMessage({sourceName:r,targetName:i,callback:ig.ERROR,callbackId:e.callbackId,reason:Qn(o)})});return}if(e.streamId){this.#n(e);return}t(e.data)}on(e,t){let r=this.actionHandler;if(r[e])throw new Error(`There is already an actionName called "${e}"`);r[e]=t}send(e,t,r){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},r)}sendWithPromise(e,t,r){let i=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[i]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},r)}catch(o){s.reject(o)}return s.promise}sendWithStream(e,t,r,i){let s=this.streamId++,o=this.sourceName,a=this.targetName,c=this.comObj;return new ReadableStream({start:l=>{let u=Promise.withResolvers();return this.streamControllers[s]={controller:l,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:a,action:e,streamId:s,data:t,desiredSize:l.desiredSize},i),u.promise},pull:l=>{let u=Promise.withResolvers();return this.streamControllers[s].pullCall=u,c.postMessage({sourceName:o,targetName:a,stream:Vt.PULL,streamId:s,desiredSize:l.desiredSize}),u.promise},cancel:l=>{jt(l instanceof Error,"cancel must have a valid reason");let u=Promise.withResolvers();return this.streamControllers[s].cancelCall=u,this.streamControllers[s].isClosed=!0,c.postMessage({sourceName:o,targetName:a,stream:Vt.CANCEL,streamId:s,reason:Qn(l)}),u.promise}},r)}#n(e){let t=e.streamId,r=this.sourceName,i=e.sourceName,s=this.comObj,o=this,a=this.actionHandler[e.action],c={enqueue(l,u=1,d){if(this.isCancelled)return;let f=this.desiredSize;this.desiredSize-=u,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:r,targetName:i,stream:Vt.ENQUEUE,streamId:t,chunk:l},d)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:r,targetName:i,stream:Vt.CLOSE,streamId:t}),delete o.streamSinks[t])},error(l){jt(l instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:r,targetName:i,stream:Vt.ERROR,streamId:t,reason:Qn(l)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,Promise.try(a,e.data,c).then(function(){s.postMessage({sourceName:r,targetName:i,stream:Vt.START_COMPLETE,streamId:t,success:!0})},function(l){s.postMessage({sourceName:r,targetName:i,stream:Vt.START_COMPLETE,streamId:t,reason:Qn(l)})})}#r(e){let t=e.streamId,r=this.sourceName,i=e.sourceName,s=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Vt.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Qn(e.reason));break;case Vt.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Qn(e.reason));break;case Vt.PULL:if(!a){s.postMessage({sourceName:r,targetName:i,stream:Vt.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||IF).then(function(){s.postMessage({sourceName:r,targetName:i,stream:Vt.PULL_COMPLETE,streamId:t,success:!0})},function(l){s.postMessage({sourceName:r,targetName:i,stream:Vt.PULL_COMPLETE,streamId:t,reason:Qn(l)})});break;case Vt.ENQUEUE:if(jt(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Vt.CLOSE:if(jt(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#s(o,t);break;case Vt.ERROR:jt(o,"error should have stream controller"),o.controller.error(Qn(e.reason)),this.#s(o,t);break;case Vt.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Qn(e.reason)),this.#s(o,t);break;case Vt.CANCEL:if(!a)break;let c=Qn(e.reason);Promise.try(a.onCancel||IF,c).then(function(){s.postMessage({sourceName:r,targetName:i,stream:Vt.CANCEL_COMPLETE,streamId:t,success:!0})},function(l){s.postMessage({sourceName:r,targetName:i,stream:Vt.CANCEL_COMPLETE,streamId:t,reason:Qn(l)})}),a.sinkCapability.reject(c),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}#s(e,t){return g(this,null,function*(){yield Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]})}destroy(){this.#e?.abort(),this.#e=null}},yg=class{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let r=this._createCanvas(e,t);return{canvas:r,context:r.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,r){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||r<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=r}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){ft("Abstract method `_createCanvas` called.")}},aT=class extends yg{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let r=this._document.createElement("canvas");return r.width=e,r.height=t,r}},_g=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}fetch(t){return g(this,arguments,function*({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let r=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(r).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${r}`)})})}_fetch(e){return g(this,null,function*(){ft("Abstract method `_fetch` called.")})}},vg=class extends _g{_fetch(e){return g(this,null,function*(){let t=yield qg(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Hg(t)})}},wg=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,r,i,s){return"none"}destroy(e=!1){}},cT=class extends wg{#e;#t;#n;#r;#s;#i;#c=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#r=e,this.#s=t}get#a(){return this.#t||=new Map}get#u(){return this.#i||=new Map}get#l(){if(!this.#n){let e=this.#s.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;let r=this.#s.createElementNS(ms,"svg");r.setAttribute("width",0),r.setAttribute("height",0),this.#n=this.#s.createElementNS(ms,"defs"),e.append(r),r.append(this.#n),this.#s.body.append(e)}return this.#n}#h(e){if(e.length===1){let c=e[0],l=new Array(256);for(let d=0;d<256;d++)l[d]=c[d]/255;let u=l.join(",");return[u,u,u]}let[t,r,i]=e,s=new Array(256),o=new Array(256),a=new Array(256);for(let c=0;c<256;c++)s[c]=t[c]/255,o[c]=r[c]/255,a[c]=i[c]/255;return[s.join(","),o.join(","),a.join(",")]}#d(e){if(this.#e===void 0){this.#e="";let t=this.#s.URL;t!==this.#s.baseURI&&(zg(t)?xe('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=t.split("#",1)[0])}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#a.get(e);if(t)return t;let[r,i,s]=this.#h(e),o=e.length===1?r:`${r}${i}${s}`;if(t=this.#a.get(o),t)return this.#a.set(e,t),t;let a=`g_${this.#r}_transfer_map_${this.#c++}`,c=this.#d(a);this.#a.set(e,c),this.#a.set(o,c);let l=this.#p(a);return this.#m(r,i,s,l),c}addHCMFilter(e,t){let r=`${e}-${t}`,i="base",s=this.#u.get(i);if(s?.key===r||(s?(s.filter?.remove(),s.key=r,s.url="none",s.filter=null):(s={key:r,url:"none",filter:null},this.#u.set(i,s)),!e||!t))return s.url;let o=this.#w(e);e=se.makeHexColor(...o);let a=this.#w(t);if(t=se.makeHexColor(...a),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return s.url;let c=new Array(256);for(let p=0;p<=255;p++){let y=p/255;c[p]=y<=.03928?y/12.92:((y+.055)/1.055)**2.4}let l=c.join(","),u=`g_${this.#r}_hcm_filter`,d=s.filter=this.#p(u);this.#m(l,l,l,d),this.#o(d);let f=(p,y)=>{let w=o[p]/255,b=a[p]/255,E=new Array(y+1);for(let D=0;D<=y;D++)E[D]=w+D/y*(b-w);return E.join(",")};return this.#m(f(0,5),f(1,5),f(2,5),d),s.url=this.#d(u),s.url}addAlphaFilter(e){let t=this.#a.get(e);if(t)return t;let[r]=this.#h([e]),i=`alpha_${r}`;if(t=this.#a.get(i),t)return this.#a.set(e,t),t;let s=`g_${this.#r}_alpha_map_${this.#c++}`,o=this.#d(s);this.#a.set(e,o),this.#a.set(i,o);let a=this.#p(s);return this.#y(r,a),o}addLuminosityFilter(e){let t=this.#a.get(e||"luminosity");if(t)return t;let r,i;if(e?([r]=this.#h([e]),i=`luminosity_${r}`):i="luminosity",t=this.#a.get(i),t)return this.#a.set(e,t),t;let s=`g_${this.#r}_luminosity_map_${this.#c++}`,o=this.#d(s);this.#a.set(e,o),this.#a.set(i,o);let a=this.#p(s);return this.#f(a),e&&this.#y(r,a),o}addHighlightHCMFilter(e,t,r,i,s){let o=`${t}-${r}-${i}-${s}`,a=this.#u.get(e);if(a?.key===o||(a?(a.filter?.remove(),a.key=o,a.url="none",a.filter=null):(a={key:o,url:"none",filter:null},this.#u.set(e,a)),!t||!r))return a.url;let[c,l]=[t,r].map(this.#w.bind(this)),u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[f,p]=[i,s].map(this.#w.bind(this));d<u&&([u,d,f,p]=[d,u,p,f]),this.#l.style.color="";let y=(E,D,x)=>{let N=new Array(256),L=(d-u)/x,F=E/255,T=(D-E)/(255*x),A=0;for(let C=0;C<=x;C++){let R=Math.round(u+C*L),M=F+C*T;for(let O=A;O<=R;O++)N[O]=M;A=R+1}for(let C=A;C<256;C++)N[C]=N[A-1];return N.join(",")},w=`g_${this.#r}_hcm_${e}_filter`,b=a.filter=this.#p(w);return this.#o(b),this.#m(y(f[0],p[0],5),y(f[1],p[1],5),y(f[2],p[2],5),b),a.url=this.#d(w),a.url}destroy(e=!1){e&&this.#i?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#t?.clear(),this.#t=null,this.#i?.clear(),this.#i=null,this.#c=0)}#f(e){let t=this.#s.createElementNS(ms,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#o(e){let t=this.#s.createElementNS(ms,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#p(e){let t=this.#s.createElementNS(ms,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#g(e,t,r){let i=this.#s.createElementNS(ms,t);i.setAttribute("type","discrete"),i.setAttribute("tableValues",r),e.append(i)}#m(e,t,r,i){let s=this.#s.createElementNS(ms,"feComponentTransfer");i.append(s),this.#g(s,"feFuncR",e),this.#g(s,"feFuncG",t),this.#g(s,"feFuncB",r)}#y(e,t){let r=this.#s.createElementNS(ms,"feComponentTransfer");t.append(r),this.#g(r,"feFuncA",e)}#w(e){return this.#l.style.color=e,yC(getComputedStyle(this.#l).getPropertyValue("color"))}},bg=class{constructor({baseUrl:e=null}){this.baseUrl=e}fetch(t){return g(this,arguments,function*({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let r=`${this.baseUrl}${e}`;return this._fetch(r).catch(i=>{throw new Error(`Unable to load font data at: ${r}`)})})}_fetch(e){return g(this,null,function*(){ft("Abstract method `_fetch` called.")})}},Eg=class extends bg{_fetch(e){return g(this,null,function*(){let t=yield qg(e,"arraybuffer");return new Uint8Array(t)})}};An&&xe("Please use the `legacy` build in Node.js environments.");function FF(n){return g(this,null,function*(){let t=yield process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)})}var lT=class extends wg{},uT=class extends yg{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}},dT=class extends _g{_fetch(e){return g(this,null,function*(){return FF(e)})}},hT=class extends bg{_fetch(e){return g(this,null,function*(){return FF(e)})}},In={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function fT(n,e){if(!e)return;let t=e[2]-e[0],r=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,r),n.clip(i)}var Ld=class{getPattern(){ft("Abstract method `getPattern` called.")}},pT=class extends Ld{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let r of this._colorStops)t.addColorStop(r[0],r[1]);return t}getPattern(e,t,r,i){let s;if(i===In.STROKE||i===In.FILL){let o=t.current.getClippedPathBoundingBox(i,wt(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,c=Math.ceil(o[3]-o[1])||1,l=t.cachedCanvases.getCanvas("pattern",a,c),u=l.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-o[0],-o[1]),r=se.transform(r,[1,0,0,1,o[0],o[1]]),u.transform(...t.baseTransform),this.matrix&&u.transform(...this.matrix),fT(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),s=e.createPattern(l.canvas,"no-repeat");let d=new DOMMatrix(r);s.setTransform(d)}else fT(e,this._bbox),s=this._createGradient(e);return s}};function GA(n,e,t,r,i,s,o,a){let c=e.coords,l=e.colors,u=n.data,d=n.width*4,f;c[t+1]>c[r+1]&&(f=t,t=r,r=f,f=s,s=o,o=f),c[r+1]>c[i+1]&&(f=r,r=i,i=f,f=o,o=a,a=f),c[t+1]>c[r+1]&&(f=t,t=r,r=f,f=s,s=o,o=f);let p=(c[t]+e.offsetX)*e.scaleX,y=(c[t+1]+e.offsetY)*e.scaleY,w=(c[r]+e.offsetX)*e.scaleX,b=(c[r+1]+e.offsetY)*e.scaleY,E=(c[i]+e.offsetX)*e.scaleX,D=(c[i+1]+e.offsetY)*e.scaleY;if(y>=D)return;let x=l[s],N=l[s+1],L=l[s+2],F=l[o],T=l[o+1],A=l[o+2],C=l[a],R=l[a+1],M=l[a+2],O=Math.round(y),S=Math.round(D),Pe,Nt,ee,J,Wt,Un,oi,Bn;for(let ut=O;ut<=S;ut++){if(ut<b){let rt=ut<y?0:(y-ut)/(y-b);Pe=p-(p-w)*rt,Nt=x-(x-F)*rt,ee=N-(N-T)*rt,J=L-(L-A)*rt}else{let rt;ut>D?rt=1:b===D?rt=0:rt=(b-ut)/(b-D),Pe=w-(w-E)*rt,Nt=F-(F-C)*rt,ee=T-(T-R)*rt,J=A-(A-M)*rt}let Ve;ut<y?Ve=0:ut>D?Ve=1:Ve=(y-ut)/(y-D),Wt=p-(p-E)*Ve,Un=x-(x-C)*Ve,oi=N-(N-R)*Ve,Bn=L-(L-M)*Ve;let Cs=Math.round(Math.min(Pe,Wt)),Mr=Math.round(Math.max(Pe,Wt)),Hn=d*ut+Cs*4;for(let rt=Cs;rt<=Mr;rt++)Ve=(Pe-rt)/(Pe-Wt),Ve<0?Ve=0:Ve>1&&(Ve=1),u[Hn++]=Nt-(Nt-Un)*Ve|0,u[Hn++]=ee-(ee-oi)*Ve|0,u[Hn++]=J-(J-Bn)*Ve|0,u[Hn++]=255}}function QQ(n,e,t){let r=e.coords,i=e.colors,s,o;switch(e.type){case"lattice":let a=e.verticesPerRow,c=Math.floor(r.length/a)-1,l=a-1;for(s=0;s<c;s++){let u=s*a;for(let d=0;d<l;d++,u++)GA(n,t,r[u],r[u+1],r[u+a],i[u],i[u+1],i[u+a]),GA(n,t,r[u+a+1],r[u+1],r[u+a],i[u+a+1],i[u+1],i[u+a])}break;case"triangles":for(s=0,o=r.length;s<o;s+=3)GA(n,t,r[s],r[s+1],r[s+2],i[s],i[s+1],i[s+2]);break;default:throw new Error("illegal figure")}}var mT=class extends Ld{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,r){let a=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),l=Math.ceil(this._bounds[2])-a,u=Math.ceil(this._bounds[3])-c,d=Math.min(Math.ceil(Math.abs(l*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(u*e[1]*1.1)),3e3),p=l/d,y=u/f,w={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-c,scaleX:1/p,scaleY:1/y},b=d+2*2,E=f+2*2,D=r.getCanvas("mesh",b,E),x=D.context,N=x.createImageData(d,f);if(t){let F=N.data;for(let T=0,A=F.length;T<A;T+=4)F[T]=t[0],F[T+1]=t[1],F[T+2]=t[2],F[T+3]=255}for(let F of this._figures)QQ(N,F,w);return x.putImageData(N,2,2),{canvas:D.canvas,offsetX:a-2*p,offsetY:c-2*y,scaleX:p,scaleY:y}}getPattern(e,t,r,i){fT(e,this._bbox);let s;if(i===In.SHADING)s=se.singularValueDecompose2dScale(wt(e));else if(s=se.singularValueDecompose2dScale(t.baseTransform),this.matrix){let a=se.singularValueDecompose2dScale(this.matrix);s=[s[0]*a[0],s[1]*a[1]]}let o=this._createMeshCanvas(s,i===In.SHADING?null:this._background,t.cachedCanvases);return i!==In.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}},gT=class extends Ld{getPattern(){return"hotpink"}};function XQ(n){switch(n[0]){case"RadialAxial":return new pT(n);case"Mesh":return new mT(n);case"Dummy":return new gT}throw new Error(`Unknown IR type: ${n[0]}`)}var AF={COLORED:1,UNCOLORED:2},ZQ=(()=>{class n{static MAX_PATTERN_SIZE=3e3;constructor(t,r,i,s,o){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=r,this.ctx=i,this.canvasGraphicsFactory=s,this.baseTransform=o}createPatternCanvas(t){let{bbox:r,operatorList:i,paintType:s,tilingType:o,color:a,canvasGraphicsFactory:c}=this,{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),Bg("TilingType: "+o);let d=r[0],f=r[1],p=r[2],y=r[3],w=p-d,b=y-f,E=se.singularValueDecompose2dScale(this.matrix),D=se.singularValueDecompose2dScale(this.baseTransform),x=E[0]*D[0],N=E[1]*D[1],L=w,F=b,T=!1,A=!1,C=Math.ceil(l*x),R=Math.ceil(u*N),M=Math.ceil(w*x),O=Math.ceil(b*N);C>=M?L=l:T=!0,R>=O?F=u:A=!0;let S=this.getSizeAndScale(L,this.ctx.canvas.width,x),Pe=this.getSizeAndScale(F,this.ctx.canvas.height,N),Nt=t.cachedCanvases.getCanvas("pattern",S.size,Pe.size),ee=Nt.context,J=c.createCanvasGraphics(ee);if(J.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(J,s,a),ee.translate(-S.scale*d,-Pe.scale*f),J.transform(S.scale,0,0,Pe.scale,0,0),ee.save(),this.clipBbox(J,d,f,p,y),J.baseTransform=wt(J.ctx),J.executeOperatorList(i),J.endDrawing(),ee.restore(),T||A){let Wt=Nt.canvas;T&&(L=l),A&&(F=u);let Un=this.getSizeAndScale(L,this.ctx.canvas.width,x),oi=this.getSizeAndScale(F,this.ctx.canvas.height,N),Bn=Un.size,ut=oi.size,Ve=t.cachedCanvases.getCanvas("pattern-workaround",Bn,ut),Cs=Ve.context,Mr=T?Math.floor(w/l):0,Hn=A?Math.floor(b/u):0;for(let rt=0;rt<=Mr;rt++)for(let fr=0;fr<=Hn;fr++)Cs.drawImage(Wt,Bn*rt,ut*fr,Bn,ut,0,0,Bn,ut);return{canvas:Ve.canvas,scaleX:Un.scale,scaleY:oi.scale,offsetX:d,offsetY:f}}return{canvas:Nt.canvas,scaleX:S.scale,scaleY:Pe.scale,offsetX:d,offsetY:f}}getSizeAndScale(t,r,i){let s=Math.max(n.MAX_PATTERN_SIZE,r),o=Math.ceil(t*i);return o>=s?o=s:i=o/t,{scale:i,size:o}}clipBbox(t,r,i,s,o){let a=s-r,c=o-i;t.ctx.rect(r,i,a,c),t.current.updateRectMinMax(wt(t.ctx),[r,i,s,o]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,r,i){let s=t.ctx,o=t.current;switch(r){case AF.COLORED:let a=this.ctx;s.fillStyle=a.fillStyle,s.strokeStyle=a.strokeStyle,o.fillColor=a.fillStyle,o.strokeColor=a.strokeStyle;break;case AF.UNCOLORED:let c=se.makeHexColor(i[0],i[1],i[2]);s.fillStyle=c,s.strokeStyle=c,o.fillColor=c,o.strokeColor=c;break;default:throw new QA(`Unsupported paint type: ${r}`)}}getPattern(t,r,i,s){let o=i;s!==In.SHADING&&(o=se.transform(o,r.baseTransform),this.matrix&&(o=se.transform(o,this.matrix)));let a=this.createPatternCanvas(r),c=new DOMMatrix(o);c=c.translate(a.offsetX,a.offsetY),c=c.scale(1/a.scaleX,1/a.scaleY);let l=t.createPattern(a.canvas,"repeat");return l.setTransform(c),l}}return n})();function JQ({src:n,srcPos:e=0,dest:t,width:r,height:i,nonBlackColor:s=4294967295,inverseDecode:o=!1}){let a=ln.isLittleEndian?4278190080:255,[c,l]=o?[s,a]:[a,s],u=r>>3,d=r&7,f=n.length;t=new Uint32Array(t.buffer);let p=0;for(let y=0;y<i;y++){for(let b=e+u;e<b;e++){let E=e<f?n[e]:255;t[p++]=E&128?l:c,t[p++]=E&64?l:c,t[p++]=E&32?l:c,t[p++]=E&16?l:c,t[p++]=E&8?l:c,t[p++]=E&4?l:c,t[p++]=E&2?l:c,t[p++]=E&1?l:c}if(d===0)continue;let w=e<f?n[e++]:255;for(let b=0;b<d;b++)t[p++]=w&1<<7-b?l:c}return{srcPos:e,destPos:p}}var TF=16,CF=100,eX=15,SF=10,DF=1e3,Xn=16;function tX(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(r,i){e.translate(r,i),this.__originalTranslate(r,i)},n.scale=function(r,i){e.scale(r,i),this.__originalScale(r,i)},n.transform=function(r,i,s,o,a,c){e.transform(r,i,s,o,a,c),this.__originalTransform(r,i,s,o,a,c)},n.setTransform=function(r,i,s,o,a,c){e.setTransform(r,i,s,o,a,c),this.__originalSetTransform(r,i,s,o,a,c)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(r){e.rotate(r),this.__originalRotate(r)},n.clip=function(r){e.clip(r),this.__originalClip(r)},n.moveTo=function(t,r){e.moveTo(t,r),this.__originalMoveTo(t,r)},n.lineTo=function(t,r){e.lineTo(t,r),this.__originalLineTo(t,r)},n.bezierCurveTo=function(t,r,i,s,o,a){e.bezierCurveTo(t,r,i,s,o,a),this.__originalBezierCurveTo(t,r,i,s,o,a)},n.rect=function(t,r,i,s){e.rect(t,r,i,s),this.__originalRect(t,r,i,s)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var yT=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,r){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,r)):(i=this.canvasFactory.create(t,r),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function sg(n,e,t,r,i,s,o,a,c,l){let[u,d,f,p,y,w]=wt(n);if(d===0&&f===0){let D=o*u+y,x=Math.round(D),N=a*p+w,L=Math.round(N),F=(o+c)*u+y,T=Math.abs(Math.round(F)-x)||1,A=(a+l)*p+w,C=Math.abs(Math.round(A)-L)||1;return n.setTransform(Math.sign(u),0,0,Math.sign(p),x,L),n.drawImage(e,t,r,i,s,0,0,T,C),n.setTransform(u,d,f,p,y,w),[T,C]}if(u===0&&p===0){let D=a*f+y,x=Math.round(D),N=o*d+w,L=Math.round(N),F=(a+l)*f+y,T=Math.abs(Math.round(F)-x)||1,A=(o+c)*d+w,C=Math.abs(Math.round(A)-L)||1;return n.setTransform(0,Math.sign(d),Math.sign(f),0,x,L),n.drawImage(e,t,r,i,s,0,0,C,T),n.setTransform(u,d,f,p,y,w),[C,T]}n.drawImage(e,t,r,i,s,o,a,c,l);let b=Math.hypot(u,d),E=Math.hypot(f,p);return[b*c,E*l]}function nX(n){let{width:e,height:t}=n;if(e>DF||t>DF)return null;let r=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),s=e+1,o=new Uint8Array(s*(t+1)),a,c,l,u=e+7&-8,d=new Uint8Array(u*t),f=0;for(let E of n.data){let D=128;for(;D>0;)d[f++]=E&D?0:255,D>>=1}let p=0;for(f=0,d[f]!==0&&(o[0]=1,++p),c=1;c<e;c++)d[f]!==d[f+1]&&(o[c]=d[f]?2:1,++p),f++;for(d[f]!==0&&(o[c]=2,++p),a=1;a<t;a++){f=a*u,l=a*s,d[f-u]!==d[f]&&(o[l]=d[f]?1:8,++p);let E=(d[f]?4:0)+(d[f-u]?8:0);for(c=1;c<e;c++)E=(E>>2)+(d[f+1]?4:0)+(d[f-u+1]?8:0),i[E]&&(o[l+c]=i[E],++p),f++;if(d[f-u]!==d[f]&&(o[l+c]=d[f]?2:4,++p),p>r)return null}for(f=u*(t-1),l=a*s,d[f]!==0&&(o[l]=8,++p),c=1;c<e;c++)d[f]!==d[f+1]&&(o[l+c]=d[f]?4:8,++p),f++;if(d[f]!==0&&(o[l+c]=4,++p),p>r)return null;let y=new Int32Array([0,s,-1,0,-s,0,0,0,1]),w=new Path2D;for(a=0;p&&a<=t;a++){let E=a*s,D=E+e;for(;E<D&&!o[E];)E++;if(E===D)continue;w.moveTo(E%s,a);let x=E,N=o[E];do{let L=y[N];do E+=L;while(!o[E]);let F=o[E];F!==5&&F!==10?(N=F,o[E]=0):(N=F&51*N>>4,o[E]&=N>>2|N<<2),w.lineTo(E%s,E/s|0),o[E]||--p}while(x!==E);--a}return d=null,o=null,function(E){E.save(),E.scale(1/e,-1/t),E.translate(0,-t),E.fill(w),E.beginPath(),E.restore()}}var Ig=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=kF,this.textMatrixScale=1,this.fontMatrix=YA,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=En.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,r){[t,r]=se.applyTransform([t,r],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,r),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,r)}updateRectMinMax(e,t){let r=se.applyTransform(t,e),i=se.applyTransform(t.slice(2),e),s=se.applyTransform([t[0],t[3]],e),o=se.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,r[0],i[0],s[0],o[0]),this.minY=Math.min(this.minY,r[1],i[1],s[1],o[1]),this.maxX=Math.max(this.maxX,r[0],i[0],s[0],o[0]),this.maxY=Math.max(this.maxY,r[1],i[1],s[1],o[1])}updateScalingPathMinMax(e,t){se.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,r,i,s,o,a,c,l,u){let d=se.bezierBoundingBox(t,r,i,s,o,a,c,l,u);u||this.updateRectMinMax(e,d)}getPathBoundingBox(e=In.FILL,t=null){let r=[this.minX,this.minY,this.maxX,this.maxY];if(e===In.STROKE){t||ft("Stroke bounding box must include transform.");let i=se.singularValueDecompose2dScale(t),s=i[0]*this.lineWidth/2,o=i[1]*this.lineWidth/2;r[0]-=s,r[1]-=o,r[2]+=s,r[3]+=o}return r}updateClipFromPath(){let e=se.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=In.FILL,t=null){return se.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function xF(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}let t=e.height,r=e.width,i=t%Xn,s=(t-i)/Xn,o=i===0?s:s+1,a=n.createImageData(r,Xn),c=0,l,u=e.data,d=a.data,f,p,y,w;if(e.kind===lg.GRAYSCALE_1BPP){let b=u.byteLength,E=new Uint32Array(d.buffer,0,d.byteLength>>2),D=E.length,x=r+7>>3,N=4294967295,L=ln.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(y=f<s?Xn:i,l=0,p=0;p<y;p++){let F=b-c,T=0,A=F>x?r:F*8-7,C=A&-8,R=0,M=0;for(;T<C;T+=8)M=u[c++],E[l++]=M&128?N:L,E[l++]=M&64?N:L,E[l++]=M&32?N:L,E[l++]=M&16?N:L,E[l++]=M&8?N:L,E[l++]=M&4?N:L,E[l++]=M&2?N:L,E[l++]=M&1?N:L;for(;T<A;T++)R===0&&(M=u[c++],R=128),E[l++]=M&R?N:L,R>>=1}for(;l<D;)E[l++]=0;n.putImageData(a,0,f*Xn)}}else if(e.kind===lg.RGBA_32BPP){for(p=0,w=r*Xn*4,f=0;f<s;f++)d.set(u.subarray(c,c+w)),c+=w,n.putImageData(a,0,p),p+=Xn;f<o&&(w=r*i*4,d.set(u.subarray(c,c+w)),n.putImageData(a,0,p))}else if(e.kind===lg.RGB_24BPP)for(y=Xn,w=r*y,f=0;f<o;f++){for(f>=s&&(y=i,w=r*y),l=0,p=w;p--;)d[l++]=u[c++],d[l++]=u[c++],d[l++]=u[c++],d[l++]=255;n.putImageData(a,0,f*Xn)}else throw new Error(`bad image kind: ${e.kind}`)}function RF(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}let t=e.height,r=e.width,i=t%Xn,s=(t-i)/Xn,o=i===0?s:s+1,a=n.createImageData(r,Xn),c=0,l=e.data,u=a.data;for(let d=0;d<o;d++){let f=d<s?Xn:i;({srcPos:c}=JQ({src:l,srcPos:c,dest:u,width:r,height:f,nonBlackColor:0})),n.putImageData(a,0,d*Xn)}}function Ad(n,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let r of t)n[r]!==void 0&&(e[r]=n[r]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function og(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!An){let{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}}function PF(n,e){if(e)return!0;let t=se.singularValueDecompose2dScale(n);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let r=Math.fround((globalThis.devicePixelRatio||1)*po.PDF_TO_CSS_UNITS);return t[0]<=r&&t[1]<=r}var rX=["butt","round","square"],iX=["miter","round","bevel"],sX={},MF={},hl=class n{constructor(e,t,r,i,s,{optionalContentConfig:o,markedContentStack:a=null},c,l){this.ctx=e,this.current=new Ig(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=r,this.canvasFactory=i,this.filterFactory=s,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new yT(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:r=!1,background:i=null}){let s=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,s,o),this.ctx.fillStyle=a,r){let c=this.cachedCanvases.getCanvas("transparent",s,o);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...wt(this.compositeCtx))}this.ctx.save(),og(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=wt(this.ctx)}executeOperatorList(e,t,r,i){let s=e.argsArray,o=e.fnArray,a=t||0,c=s.length;if(c===a)return a;let l=c-a>SF&&typeof r=="function",u=l?Date.now()+eX:0,d=0,f=this.commonObjs,p=this.objs,y;for(;;){if(i!==void 0&&a===i.nextBreakPoint)return i.breakIt(a,r),a;if(y=o[a],y!==Jr.dependency)this[y].apply(this,s[a]);else for(let w of s[a]){let b=w.startsWith("g_")?f:p;if(!b.has(w))return b.get(w,r),a}if(a++,a===c)return a;if(l&&++d>SF){if(Date.now()>u)return r(),a;d=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){let r=e.width??e.displayWidth,i=e.height??e.displayHeight,s=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=r,c=i,l="prescale1",u,d;for(;s>2&&a>1||o>2&&c>1;){let f=a,p=c;s>2&&a>1&&(f=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),s/=a/f),o>2&&c>1&&(p=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/p),u=this.cachedCanvases.getCanvas(l,f,p),d=u.context,d.clearRect(0,0,f,p),d.drawImage(e,0,0,a,c,0,0,f,p),e=u.canvas,a=f,c=p,l=l==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:c}}_createMaskCanvas(e){let t=this.ctx,{width:r,height:i}=e,s=this.current.fillColor,o=this.current.patternFill,a=wt(t),c,l,u,d;if((e.bitmap||e.data)&&e.count>1){let A=e.bitmap||e.data.buffer;l=JSON.stringify(o?a:[a.slice(0,4),s]),c=this._cachedBitmapsMap.get(A),c||(c=new Map,this._cachedBitmapsMap.set(A,c));let C=c.get(l);if(C&&!o){let R=Math.round(Math.min(a[0],a[2])+a[4]),M=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:C,offsetX:R,offsetY:M}}u=C}u||(d=this.cachedCanvases.getCanvas("maskCanvas",r,i),RF(d.context,e));let f=se.transform(a,[1/r,0,0,-1/i,0,0]);f=se.transform(f,[1,0,0,1,0,-i]);let[p,y,w,b]=se.getAxialAlignedBoundingBox([0,0,r,i],f),E=Math.round(w-p)||1,D=Math.round(b-y)||1,x=this.cachedCanvases.getCanvas("fillCanvas",E,D),N=x.context,L=p,F=y;N.translate(-L,-F),N.transform(...f),u||(u=this._scaleImage(d.canvas,Ni(N)),u=u.img,c&&o&&c.set(l,u)),N.imageSmoothingEnabled=PF(wt(N),e.interpolate),sg(N,u,0,0,u.width,u.height,0,0,r,i),N.globalCompositeOperation="source-in";let T=se.transform(Ni(N),[1,0,0,1,-L,-F]);return N.fillStyle=o?s.getPattern(t,this,T,In.FILL):s,N.fillRect(0,0,r,i),c&&!o&&(this.cachedCanvases.delete("fillCanvas"),c.set(l,x.canvas)),{canvas:x.canvas,offsetX:Math.round(L),offsetY:Math.round(F)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=rX[e]}setLineJoin(e){this.ctx.lineJoin=iX[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(e),r.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,r]of e)switch(t){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r[0],r[1]);break;case"CA":this.current.strokeAlpha=r;break;case"ca":this.current.fillAlpha=r,this.ctx.globalAlpha=r;break;case"BM":this.ctx.globalCompositeOperation=r;break;case"SMask":this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(r,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;let s=this.ctx;s.setTransform(...wt(this.suspendedCtx)),Ad(this.suspendedCtx,s),tX(s,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Ad(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,r=this.suspendedCtx;this.composeSMask(r,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,r,i){let s=i[0],o=i[1],a=i[2]-s,c=i[3]-o;a===0||c===0||(this.genericComposeSMask(t.context,r,a,c,t.subtype,t.backdrop,t.transferMap,s,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(r.canvas,0,0),e.restore())}genericComposeSMask(e,t,r,i,s,o,a,c,l,u,d){let f=e.canvas,p=c-u,y=l-d;if(o){let b=se.makeHexColor(...o);if(p<0||y<0||p+r>f.width||y+i>f.height){let E=this.cachedCanvases.getCanvas("maskExtension",r,i),D=E.context;D.drawImage(f,-p,-y),D.globalCompositeOperation="destination-atop",D.fillStyle=b,D.fillRect(0,0,r,i),D.globalCompositeOperation="source-over",f=E.canvas,p=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let E=new Path2D;E.rect(p,y,r,i),e.clip(E),e.globalCompositeOperation="destination-atop",e.fillStyle=b,e.fillRect(p,y,r,i),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),s==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):s==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));let w=new Path2D;w.rect(c,l,r,i),t.clip(w),t.globalCompositeOperation="destination-in",t.drawImage(f,p,y,r,i,c,l,r,i),t.restore()}save(){this.inSMaskMode?(Ad(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Ad(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,r,i,s,o){this.ctx.transform(e,t,r,i,s,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,r){let i=this.ctx,s=this.current,o=s.x,a=s.y,c,l,u=wt(i),d=u[0]===0&&u[3]===0||u[1]===0&&u[2]===0,f=d?r.slice(0):null;for(let p=0,y=0,w=e.length;p<w;p++)switch(e[p]|0){case Jr.rectangle:o=t[y++],a=t[y++];let b=t[y++],E=t[y++],D=o+b,x=a+E;i.moveTo(o,a),b===0||E===0?i.lineTo(D,x):(i.lineTo(D,a),i.lineTo(D,x),i.lineTo(o,x)),d||s.updateRectMinMax(u,[o,a,D,x]),i.closePath();break;case Jr.moveTo:o=t[y++],a=t[y++],i.moveTo(o,a),d||s.updatePathMinMax(u,o,a);break;case Jr.lineTo:o=t[y++],a=t[y++],i.lineTo(o,a),d||s.updatePathMinMax(u,o,a);break;case Jr.curveTo:c=o,l=a,o=t[y+4],a=t[y+5],i.bezierCurveTo(t[y],t[y+1],t[y+2],t[y+3],o,a),s.updateCurvePathMinMax(u,c,l,t[y],t[y+1],t[y+2],t[y+3],o,a,f),y+=6;break;case Jr.curveTo2:c=o,l=a,i.bezierCurveTo(o,a,t[y],t[y+1],t[y+2],t[y+3]),s.updateCurvePathMinMax(u,c,l,o,a,t[y],t[y+1],t[y+2],t[y+3],f),o=t[y+2],a=t[y+3],y+=4;break;case Jr.curveTo3:c=o,l=a,o=t[y+2],a=t[y+3],i.bezierCurveTo(t[y],t[y+1],o,a,o,a),s.updateCurvePathMinMax(u,c,l,t[y],t[y+1],o,a,o,a,f),y+=4;break;case Jr.closePath:i.closePath();break}d&&s.updateScalingPathMinMax(u,f),s.setCurrentPoint(o,a)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,r=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof r=="object"&&r?.getPattern?(t.save(),t.strokeStyle=r.getPattern(t,this,Ni(t),In.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,r=this.current.fillColor,i=this.current.patternFill,s=!1;i&&(t.save(),t.fillStyle=r.getPattern(t,this,Ni(t),In.FILL),s=!0);let o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),s&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=sX}eoClip(){this.pendingClip=MF}beginText(){this.current.textMatrix=kF,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}let r=new Path2D,i=t.getTransform().invertSelf();for(let{transform:s,x:o,y:a,fontSize:c,path:l}of e)r.addPath(l,new DOMMatrix(s).preMultiplySelf(i).translate(o,a).scale(c,-c));t.clip(r),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){let r=this.commonObjs.get(e),i=this.current;if(!r)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=r.fontMatrix||YA,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&xe("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=r,this.current.fontSize=t,r.isType3Font)return;let s=r.loadedName||"sans-serif",o=r.systemFontInfo?.css||`"${s}", ${r.fallbackName}`,a="normal";r.black?a="900":r.bold&&(a="bold");let c=r.italic?"italic":"normal",l=t;t<TF?l=TF:t>CF&&(l=CF),this.current.fontSizeScale=t/l,this.ctx.font=`${c} ${a} ${l}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,r,i,s,o){this.current.textMatrix=[e,t,r,i,s,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#n(e,t,r){let i=new Path2D;return i.addPath(e,new DOMMatrix(r).invertSelf().multiplySelf(t)),i}paintChar(e,t,r,i,s){let o=this.ctx,a=this.current,c=a.font,l=a.textRenderingMode,u=a.fontSize/a.fontSizeScale,d=l&En.FILL_STROKE_MASK,f=!!(l&En.ADD_TO_PATH_FLAG),p=a.patternFill&&!c.missingFile,y=a.patternStroke&&!c.missingFile,w;if((c.disableFontFace||f||p||y)&&(w=c.getPathGenerator(this.commonObjs,e)),c.disableFontFace||p||y){if(o.save(),o.translate(t,r),o.scale(u,-u),d===En.FILL||d===En.FILL_STROKE)if(i){let b=o.getTransform();o.setTransform(...i),o.fill(this.#n(w,b,i))}else o.fill(w);if(d===En.STROKE||d===En.FILL_STROKE)if(s){let b=o.getTransform();o.setTransform(...s),o.stroke(this.#n(w,b,s))}else o.lineWidth/=u,o.stroke(w);o.restore()}else(d===En.FILL||d===En.FILL_STROKE)&&o.fillText(e,t,r),(d===En.STROKE||d===En.FILL_STROKE)&&o.strokeText(e,t,r);f&&(this.pendingTextPaths||=[]).push({transform:wt(o),x:t,y:r,fontSize:u,path:w})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,r=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){r=!0;break}return Le(this,"isFontSubpixelAAEnabled",r)}showText(e){let t=this.current,r=t.font;if(r.isType3Font)return this.showType3Text(e);let i=t.fontSize;if(i===0)return;let s=this.ctx,o=t.fontSizeScale,a=t.charSpacing,c=t.wordSpacing,l=t.fontDirection,u=t.textHScale*l,d=e.length,f=r.vertical,p=f?1:-1,y=r.defaultVMetrics,w=i*t.fontMatrix[0],b=t.textRenderingMode===En.FILL&&!r.disableFontFace&&!t.patternFill;s.save(),s.transform(...t.textMatrix),s.translate(t.x,t.y+t.textRise),l>0?s.scale(u,-1):s.scale(u,1);let E,D;if(t.patternFill){s.save();let T=t.fillColor.getPattern(s,this,Ni(s),In.FILL);E=wt(s),s.restore(),s.fillStyle=T}if(t.patternStroke){s.save();let T=t.strokeColor.getPattern(s,this,Ni(s),In.STROKE);D=wt(s),s.restore(),s.strokeStyle=T}let x=t.lineWidth,N=t.textMatrixScale;if(N===0||x===0){let T=t.textRenderingMode&En.FILL_STROKE_MASK;(T===En.STROKE||T===En.FILL_STROKE)&&(x=this.getSinglePixelWidth())}else x/=N;if(o!==1&&(s.scale(o,o),x/=o),s.lineWidth=x,r.isInvalidPDFjsFont){let T=[],A=0;for(let C of e)T.push(C.unicode),A+=C.width;s.fillText(T.join(""),0,0),t.x+=A*w*u,s.restore(),this.compose();return}let L=0,F;for(F=0;F<d;++F){let T=e[F];if(typeof T=="number"){L+=p*T*i/1e3;continue}let A=!1,C=(T.isSpace?c:0)+a,R=T.fontChar,M=T.accent,O,S,Pe=T.width;if(f){let ee=T.vmetric||y,J=-(T.vmetric?ee[1]:Pe*.5)*w,Wt=ee[2]*w;Pe=ee?-ee[0]:Pe,O=J/o,S=(L+Wt)/o}else O=L/o,S=0;if(r.remeasure&&Pe>0){let ee=s.measureText(R).width*1e3/i*o;if(Pe<ee&&this.isFontSubpixelAAEnabled){let J=Pe/ee;A=!0,s.save(),s.scale(J,1),O/=J}else Pe!==ee&&(O+=(Pe-ee)/2e3*i/o)}if(this.contentVisible&&(T.isInFont||r.missingFile)){if(b&&!M)s.fillText(R,O,S);else if(this.paintChar(R,O,S,E,D),M){let ee=O+i*M.offset.x/o,J=S-i*M.offset.y/o;this.paintChar(M.fontChar,ee,J,E,D)}}let Nt=f?Pe*w-C*l:Pe*w+C*l;L+=Nt,A&&s.restore()}f?t.y-=L:t.x+=L*u,s.restore(),this.compose()}showType3Text(e){let t=this.ctx,r=this.current,i=r.font,s=r.fontSize,o=r.fontDirection,a=i.vertical?1:-1,c=r.charSpacing,l=r.wordSpacing,u=r.textHScale*o,d=r.fontMatrix||YA,f=e.length,p=r.textRenderingMode===En.INVISIBLE,y,w,b,E;if(!(p||s===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...r.textMatrix),t.translate(r.x,r.y),t.scale(u,o),y=0;y<f;++y){if(w=e[y],typeof w=="number"){E=a*w*s/1e3,this.ctx.translate(E,0),r.x+=E*u;continue}let D=(w.isSpace?l:0)+c,x=i.charProcOperatorList[w.operatorListId];if(!x){xe(`Type3 character "${w.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=w,this.save(),t.scale(s,s),t.transform(...d),this.executeOperatorList(x),this.restore()),b=se.applyTransform([w.width,0],d)[0]*s+D,t.translate(b,0),r.x+=b*u}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,r,i,s,o){this.ctx.rect(r,i,s-r,o-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let r=e[1],i=this.baseTransform||wt(this.ctx),s={createCanvasGraphics:o=>new n(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new ZQ(e,r,this.ctx,s,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,r){this.ctx.strokeStyle=this.current.strokeColor=se.makeHexColor(e,t,r),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,r){this.ctx.fillStyle=this.current.fillColor=se.makeHexColor(e,t,r),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let r;return this.cachedPatterns.has(e)?r=this.cachedPatterns.get(e):(r=XQ(this.getObject(e)),this.cachedPatterns.set(e,r)),t&&(r.matrix=t),r}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let r=this._getPattern(e);t.fillStyle=r.getPattern(t,this,Ni(t),In.SHADING);let i=Ni(t);if(i){let{width:s,height:o}=t.canvas,[a,c,l,u]=se.getAxialAlignedBoundingBox([0,0,s,o],i);this.ctx.fillRect(a,c,l-a,u-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ft("Should not call beginInlineImage")}beginImageData(){ft("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=wt(this.ctx),t)){let r=t[2]-t[0],i=t[3]-t[1];this.ctx.rect(t[0],t[1],r,i),this.current.updateRectMinMax(wt(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||Bg("TODO: Support non-isolated groups."),e.knockout&&xe("Knockout groups not supported.");let r=wt(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=se.getAxialAlignedBoundingBox(e.bbox,wt(t)),s=[0,0,t.canvas.width,t.canvas.height];i=se.intersect(i,s)||[0,0,0,0];let o=Math.floor(i[0]),a=Math.floor(i[1]),c=Math.max(Math.ceil(i[2])-o,1),l=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,c,l]);let u="groupAt"+this.groupLevel;e.smask&&(u+="_smask_"+this.smaskCounter++%2);let d=this.cachedCanvases.getCanvas(u,c,l),f=d.context;f.translate(-o,-a),f.transform(...r),e.smask?this.smaskStack.push({canvas:d.canvas,context:f,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),Ad(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let i=wt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);let s=se.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(s)}}beginAnnotation(e,t,r,i,s){if(this.#e(),og(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let o=t[2]-t[0],a=t[3]-t[1];if(s&&this.annotationCanvasMap){r=r.slice(),r[4]-=t[0],r[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=a;let[c,l]=se.singularValueDecompose2dScale(wt(this.ctx)),{viewportScale:u}=this,d=Math.ceil(o*this.outputScaleX*u),f=Math.ceil(a*this.outputScaleY*u);this.annotationCanvas=this.canvasFactory.create(d,f);let{canvas:p,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(c,0,0,-l,0,a*l),og(this.ctx)}else og(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Ig(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...r),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let r=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=nX(e)),i.compiled)){i.compiled(r);return}let s=this._createMaskCanvas(e),o=s.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(o,s.offsetX,s.offsetY),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,r=0,i=0,s,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);let a=this.ctx;a.save();let c=wt(a);a.transform(t,r,i,s,0,0);let l=this._createMaskCanvas(e);a.setTransform(1,0,0,1,l.offsetX-c[4],l.offsetY-c[5]);for(let u=0,d=o.length;u<d;u+=2){let f=se.transform(c,[t,r,i,s,o[u],o[u+1]]),[p,y]=se.applyTransform([0,0],f);a.drawImage(l.canvas,p,y)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,r=this.current.fillColor,i=this.current.patternFill;for(let s of e){let{data:o,width:a,height:c,transform:l}=s,u=this.cachedCanvases.getCanvas("maskCanvas",a,c),d=u.context;d.save();let f=this.getObject(o,s);RF(d,f),d.globalCompositeOperation="source-in",d.fillStyle=i?r.getPattern(d,this,Ni(t),In.FILL):r,d.fillRect(0,0,a,c),d.restore(),t.save(),t.transform(...l),t.scale(1,-1),sg(t,u.canvas,0,0,a,c,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){xe("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,r,i){if(!this.contentVisible)return;let s=this.getObject(e);if(!s){xe("Dependent image isn't ready yet");return}let o=s.width,a=s.height,c=[];for(let l=0,u=i.length;l<u;l+=2)c.push({transform:[t,0,0,r,i[l],i[l+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(s,c)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:r,height:i}=e,s=this.cachedCanvases.getCanvas("inlineImage",r,i),o=s.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",s.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,r=e.height,i=this.ctx;if(this.save(),!An){let{filter:a}=i;a!=="none"&&a!==""&&(i.filter="none")}i.scale(1/t,-1/r);let s;if(e.bitmap)s=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)s=e;else{let c=this.cachedCanvases.getCanvas("inlineImage",t,r).context;xF(c,e),s=this.applyTransferMapsToCanvas(c)}let o=this._scaleImage(s,Ni(i));i.imageSmoothingEnabled=PF(wt(i),e.interpolate),sg(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-r,t,r),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let r=this.ctx,i;if(e.bitmap)i=e.bitmap;else{let s=e.width,o=e.height,c=this.cachedCanvases.getCanvas("inlineImage",s,o).context;xF(c,e),i=this.applyTransferMapsToCanvas(c)}for(let s of t)r.save(),r.transform(...s.transform),r.scale(1,-1),sg(r,i,s.x,s.y,s.w,s.h,0,-1,1,1),r.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let r=this.ctx;this.pendingClip&&(t||(this.pendingClip===MF?r.clip("evenodd"):r.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),r.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=wt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),r=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(r,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:r,c:i,d:s}=this.ctx.getTransform(),o,a;if(r===0&&i===0){let c=Math.abs(t),l=Math.abs(s);if(c===l)if(e===0)o=a=1/c;else{let u=c*e;o=a=u<1?1/u:1}else if(e===0)o=1/c,a=1/l;else{let u=c*e,d=l*e;o=u<1?1/u:1,a=d<1?1/d:1}}else{let c=Math.abs(t*s-r*i),l=Math.hypot(t,r),u=Math.hypot(i,s);if(e===0)o=u/c,a=l/c;else{let d=e*c;o=u>d?u/d:1,a=l>d?l/d:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:r}=this.current,[i,s]=this.getScaleForStroking();if(t.lineWidth=r||1,i===1&&s===1){t.stroke();return}let o=t.getLineDash();if(e&&t.save(),t.scale(i,s),o.length>0){let a=Math.max(i,s);t.setLineDash(o.map(c=>c/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};for(let n in Jr)hl.prototype[n]!==void 0&&(hl.prototype[Jr[n]]=hl.prototype[n]);var va=class{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}},_T=class{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}getAll(){return pC(this.#e)}has(e){return this.#e.has(e)}},dl=Symbol("INTERNAL"),vT=class{#e=!1;#t=!1;#n=!1;#r=!0;constructor(e,{name:t,intent:r,usage:i,rbGroups:s}){this.#e=!!(e&dr.DISPLAY),this.#t=!!(e&dr.PRINT),this.name=t,this.intent=r,this.usage=i,this.rbGroups=s}get visible(){if(this.#n)return this.#r;if(!this.#r)return!1;let{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,r=!1){e!==dl&&ft("Internal method `_setVisible` called."),this.#n=r,this.#r=t}},wT=class{#e=null;#t=new Map;#n=null;#r=null;constructor(e,t=dr.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#r=e.order;for(let r of e.groups)this.#t.set(r.id,new vT(t,r));if(e.baseState==="OFF")for(let r of this.#t.values())r._setVisible(dl,!1);for(let r of e.on)this.#t.get(r)._setVisible(dl,!0);for(let r of e.off)this.#t.get(r)._setVisible(dl,!1);this.#n=this.getHash()}}#s(e){let t=e.length;if(t<2)return!0;let r=e[0];for(let i=1;i<t;i++){let s=e[i],o;if(Array.isArray(s))o=this.#s(s);else if(this.#t.has(s))o=this.#t.get(s).visible;else return xe(`Optional content group not found: ${s}`),!0;switch(r){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return r==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return Bg("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(xe(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#s(e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!this.#t.has(t))return xe(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!this.#t.has(t))return xe(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!this.#t.has(t))return xe(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!this.#t.has(t))return xe(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return xe(`Unknown optional content policy ${e.policy}.`),!0}return xe(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,r=!0){let i=this.#t.get(e);if(!i){xe(`Optional content group not found: ${e}`);return}if(r&&t&&i.rbGroups.length)for(let s of i.rbGroups)for(let o of s)o!==e&&this.#t.get(o)?._setVisible(dl,!1,!0);i._setVisible(dl,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let r;for(let i of e){switch(i){case"ON":case"OFF":case"Toggle":r=i;continue}let s=this.#t.get(i);if(s)switch(r){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!s.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#t.size?this.#r?this.#r.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?pC(this.#t):null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;let e=new mg;for(let[t,r]of this.#t)e.update(`${t}:${r.visible}`);return this.#e=e.hexdigest()}},bT=class{constructor(e,{disableRange:t=!1,disableStream:r=!1}){jt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:i,initialData:s,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,s?.length>0){let c=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!r,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,l)=>{this._onReceiveData({begin:c,chunk:l})}),e.addProgressListener((c,l)=>{this._onProgress({loaded:c,total:l})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let r=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r);else{let i=this._rangeReaders.some(function(s){return s._begin!==e?!1:(s._enqueue(r),!0)});jt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){jt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new ET(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let r=new IT(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}},ET=class{constructor(e,t,r=!1,i=null){this._stream=e,this._done=r||!1,this._filename=gC(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(let s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){return g(this,null,function*(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},IT=class{constructor(e,t,r){this._stream=e,this._begin=t,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){return g(this,null,function*(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function oX(n){let e=!0,t=r("filename\\*","i").exec(n);if(t){t=t[1];let u=a(t);return u=unescape(u),u=c(u),u=l(u),s(u)}if(t=o(n),t){let u=l(t);return s(u)}if(t=r("filename","i").exec(n),t){t=t[1];let u=a(t);return u=l(u),s(u)}function r(u,d){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(u,d){if(u){if(!/^[\x00-\xFF]+$/.test(d))return d;try{let f=new TextDecoder(u,{fatal:!0}),p=Hg(d);d=f.decode(p),e=!1}catch{}}return d}function s(u){return e&&/[\x80-\xff]/.test(u)&&(u=i("utf-8",u),e&&(u=i("iso-8859-1",u))),u}function o(u){let d=[],f,p=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(u))!==null;){let[,w,b,E]=f;if(w=parseInt(w,10),w in d){if(w===0)break;continue}d[w]=[b,E]}let y=[];for(let w=0;w<d.length&&w in d;++w){let[b,E]=d[w];E=a(E),b&&(E=unescape(E),w===0&&(E=c(E))),y.push(E)}return y.join("")}function a(u){if(u.startsWith('"')){let d=u.slice(1).split('\\"');for(let f=0;f<d.length;++f){let p=d[f].indexOf('"');p!==-1&&(d[f]=d[f].slice(0,p),d.length=f+1),d[f]=d[f].replaceAll(/\\(.)/g,"$1")}u=d.join('"')}return u}function c(u){let d=u.indexOf("'");if(d===-1)return u;let f=u.slice(0,d),y=u.slice(d+1).replace(/^[^']*'/,"");return i(f,y)}function l(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,f,p,y){if(p==="q"||p==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(w,b){return String.fromCharCode(parseInt(b,16))}),i(f,y);try{y=atob(y)}catch{}return i(f,y)})}return""}function VF(n,e){let t=new Headers;if(!n||!e||typeof e!="object")return t;for(let r in e){let i=e[r];i!==void 0&&t.append(r,i)}return t}function Gg(n){try{return new URL(n).origin}catch{}return null}function jF({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:r}){let i={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(n.get("Content-Length"),10);return!Number.isInteger(s)||(i.suggestedLength=s,s<=2*t)||r||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function $F(n){let e=n.get("Content-Disposition");if(e){let t=oX(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(gC(t))return t}return null}function Wg(n,e){return n===404||n===0&&e.startsWith("file:")?new wa('Missing PDF "'+e+'".'):new pl(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n)}function UF(n){return n===200||n===206}function BF(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function HF(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(xe(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}var Ag=class{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=VF(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return jt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new AT(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let r=new TT(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},AT=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let r=new Headers(e.headers),i=t.url;fetch(i,BF(r,this._withCredentials,this._abortController)).then(s=>{if(e._responseOrigin=Gg(s.url),!UF(s.status))throw Wg(s.status,i);this._reader=s.body.getReader(),this._headersCapability.resolve();let o=s.headers,{allowRangeRequests:a,suggestedLength:c}=jF({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=c||this._contentLength,this._filename=$F(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ki("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return g(this,null,function*(){yield this._headersCapability.promise;let{value:e,done:t}=yield this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:HF(e),done:!1})})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},TT=class{constructor(e,t,r){this._stream=e,this._reader=null,this._loaded=0;let i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;let s=new Headers(e.headers);s.append("Range",`bytes=${t}-${r-1}`);let o=i.url;fetch(o,BF(s,this._withCredentials,this._abortController)).then(a=>{let c=Gg(a.url);if(c!==e._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${e._responseOrigin}".`);if(!UF(a.status))throw Wg(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){return g(this,null,function*(){yield this._readCapability.promise;let{value:e,done:t}=yield this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:HF(e),done:!1})})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},WA=200,KA=206;function aX(n){let e=n.response;return typeof e!="string"?e:Hg(e).buffer}var CT=class{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:r}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=VF(this.isHttp,t),this.withCredentials=r||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let t=new XMLHttpRequest,r=this.currXhrId++,i=this.pendingRequests[r]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[s,o]of this.headers)t.setRequestHeader(s,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=KA):i.expectedStatus=WA,t.responseType="arraybuffer",jt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,r),t.onprogress=this.onProgress.bind(this,r),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),r}onProgress(e,t){let r=this.pendingRequests[e];r&&r.onProgress?.(t)}onStateChange(e,t){let r=this.pendingRequests[e];if(!r)return;let i=r.xhr;if(i.readyState>=2&&r.onHeadersReceived&&(r.onHeadersReceived(),delete r.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){r.onError(i.status);return}let s=i.status||WA;if(!(s===WA&&r.expectedStatus===KA)&&s!==r.expectedStatus){r.onError(i.status);return}let a=aX(i);if(s===KA){let c=i.getResponseHeader("Content-Range"),l=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);l?r.onDone({begin:parseInt(l[1],10),chunk:a}):(xe('Missing or invalid "Content-Range" header.'),r.onError(0))}else a?r.onDone({begin:0,chunk:a}):r.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},ST=class{constructor(e){this._source=e,this._manager=new CT(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return jt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new DT(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let r=new xT(this._manager,e,t);return r.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},DT=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Gg(t.responseURL);let r=t.getAllResponseHeaders(),i=new Headers(r?r.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[c,...l]=a.split(": ");return[c,l.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:o}=jF({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=$F(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Wg(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}read(){return g(this,null,function*(){if(yield this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},xT=class{constructor(e,t,r){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:r,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let e=Gg(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=Wg(e,this._url);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}read(){return g(this,null,function*(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},cX=/^[a-z][a-z0-9\-+.]+:/i;function lX(n){if(cX.test(n))return new URL(n);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}var RT=class{constructor(e){this.source=e,this.url=lX(e.url),jt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return jt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new PT(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let r=new MT(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},PT=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let r=process.getBuiltinModule("fs");r.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(r.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new wa(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return g(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ki("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},MT=class{constructor(e,t,r){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let i=e.source;this._isStreamingSupported=!i.disableStream;let s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:r-1}))}get isStreamingSupported(){return this._isStreamingSupported}read(){return g(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},uX=1e5,Yn=30,dX=.8,Fd=class n{#e=Promise.withResolvers();#t=null;#n=!1;#r=!!globalThis.FontInspector?.enabled;#s=null;#i=null;#c=0;#a=0;#u=null;#l=null;#h=0;#d=0;#f=Object.create(null);#o=[];#p=null;#g=[];#m=new WeakMap;#y=null;static#w=new Map;static#_=new Map;static#b=new WeakMap;static#I=null;static#T=new Set;constructor({textContentSource:e,container:t,viewport:r}){if(e instanceof ReadableStream)this.#p=e;else if(typeof e=="object")this.#p=new ReadableStream({start(c){c.enqueue(e),c.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#l=t,this.#d=r.scale*(globalThis.devicePixelRatio||1),this.#h=r.rotation,this.#i={div:null,properties:null,ctx:null};let{pageWidth:i,pageHeight:s,pageX:o,pageY:a}=r.rawDims;this.#y=[1,0,0,-1,-o,a+s],this.#a=i,this.#c=s,n.#P(),ba(t,r),this.#e.promise.finally(()=>{n.#T.delete(this),this.#i=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=ln.platform;return Le(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{this.#u.read().then(({value:t,done:r})=>{if(r){this.#e.resolve();return}this.#s??=t.lang,Object.assign(this.#f,t.styles),this.#S(t.items),e()},this.#e.reject)};return this.#u=this.#p.getReader(),n.#T.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){let r=e.scale*(globalThis.devicePixelRatio||1),i=e.rotation;if(i!==this.#h&&(t?.(),this.#h=i,ba(this.#l,{rotation:i})),r!==this.#d){t?.(),this.#d=r;let s={div:null,properties:null,ctx:n.#D(this.#s)};for(let o of this.#g)s.properties=this.#m.get(o),s.div=o,this.#E(s)}}cancel(){let e=new ki("TextLayer task cancelled.");this.#u?.cancel(e).catch(()=>{}),this.#u=null,this.#e.reject(e)}get textDivs(){return this.#g}get textContentItemsStr(){return this.#o}#S(e){if(this.#n)return;this.#i.ctx??=n.#D(this.#s);let t=this.#g,r=this.#o;for(let i of e){if(t.length>uX){xe("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(i.str===void 0){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){let s=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),i.id!==null&&this.#t.setAttribute("id",`${i.id}`),s.append(this.#t)}else i.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}r.push(i.str),this.#x(i)}}#x(e){let t=document.createElement("span"),r={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#g.push(t);let i=se.transform(this.#y,e.transform),s=Math.atan2(i[1],i[0]),o=this.#f[e.fontName];o.vertical&&(s+=Math.PI/2);let a=this.#r&&o.fontSubstitution||o.fontFamily;a=n.fontFamilyMap.get(a)||a;let c=Math.hypot(i[2],i[3]),l=c*n.#O(a,this.#s),u,d;s===0?(u=i[4],d=i[5]-l):(u=i[4]+l*Math.sin(s),d=i[5]-l*Math.cos(s));let f="calc(var(--scale-factor)*",p=t.style;this.#t===this.#l?(p.left=`${(100*u/this.#a).toFixed(2)}%`,p.top=`${(100*d/this.#c).toFixed(2)}%`):(p.left=`${f}${u.toFixed(2)}px)`,p.top=`${f}${d.toFixed(2)}px)`),p.fontSize=`${f}${(n.#I*c).toFixed(2)}px)`,p.fontFamily=a,r.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#r&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),s!==0&&(r.angle=s*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let w=Math.abs(e.transform[0]),b=Math.abs(e.transform[3]);w!==b&&Math.max(w,b)/Math.min(w,b)>1.5&&(y=!0)}if(y&&(r.canvasWidth=o.vertical?e.height:e.width),this.#m.set(t,r),this.#i.div=t,this.#i.properties=r,this.#E(this.#i),r.hasText&&this.#t.append(t),r.hasEOL){let w=document.createElement("br");w.setAttribute("role","presentation"),this.#t.append(w)}}#E(e){let{div:t,properties:r,ctx:i}=e,{style:s}=t,o="";if(n.#I>1&&(o=`scale(${1/n.#I})`),r.canvasWidth!==0&&r.hasText){let{fontFamily:a}=s,{canvasWidth:c,fontSize:l}=r;n.#C(i,l*this.#d,a);let{width:u}=i.measureText(t.textContent);u>0&&(o=`scaleX(${c*this.#d/u}) ${o}`)}r.angle!==0&&(o=`rotate(${r.angle}deg) ${o}`),o.length>0&&(s.transform=o)}static cleanup(){if(!(this.#T.size>0)){this.#w.clear();for(let{canvas:e}of this.#_.values())e.remove();this.#_.clear()}}static#D(e=null){let t=this.#_.get(e||="");if(!t){let r=document.createElement("canvas");r.className="hiddenCanvasElement",r.lang=e,document.body.append(r),t=r.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#_.set(e,t),this.#b.set(t,{size:0,family:""})}return t}static#C(e,t,r){let i=this.#b.get(e);t===i.size&&r===i.family||(e.font=`${t}px ${r}`,i.size=t,i.family=r)}static#P(){if(this.#I!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#I=e.getBoundingClientRect().height,e.remove()}static#O(e,t){let r=this.#w.get(e);if(r)return r;let i=this.#D(t);i.canvas.width=i.canvas.height=Yn,this.#C(i,Yn,e);let s=i.measureText(""),o=s.fontBoundingBoxAscent,a=Math.abs(s.fontBoundingBoxDescent);if(o){let u=o/(o+a);return this.#w.set(e,u),i.canvas.width=i.canvas.height=0,u}i.strokeStyle="red",i.clearRect(0,0,Yn,Yn),i.strokeText("g",0,0);let c=i.getImageData(0,0,Yn,Yn).data;a=0;for(let u=c.length-1-3;u>=0;u-=4)if(c[u]>0){a=Math.ceil(u/4/Yn);break}i.clearRect(0,0,Yn,Yn),i.strokeText("A",0,Yn),c=i.getImageData(0,0,Yn,Yn).data,o=0;for(let u=0,d=c.length;u<d;u+=4)if(c[u]>0){o=Yn-Math.floor(u/4/Yn);break}i.canvas.width=i.canvas.height=0;let l=o?o/(o+a):dX;return this.#w.set(e,l),l}},Vd=class n{static textContent(e){let t=[],r={items:t,styles:Object.create(null)};function i(s){if(!s)return;let o=null,a=s.name;if(a==="#text")o=s.value;else if(n.shouldBuildText(a))s?.attributes?.textContent?o=s.attributes.textContent:s.value&&(o=s.value);else return;if(o!==null&&t.push({str:o}),!!s.children)for(let c of s.children)i(c)}return i(e),r}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},hX=65536,fX=100,pX=5e3,mX=An?uT:aT,gX=An?dT:vg,yX=An?lT:cT,_X=An?hT:Eg;function vX(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});let e=new NT,{docId:t}=e,r=n.url?wX(n.url):null,i=n.data?bX(n.data):null,s=n.httpHeaders||null,o=n.withCredentials===!0,a=n.password??null,c=n.range instanceof Tg?n.range:null,l=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:hX,u=n.worker instanceof fl?n.worker:null,d=n.verbosity,f=typeof n.docBaseUrl=="string"&&!zg(n.docBaseUrl)?n.docBaseUrl:null,p=typeof n.cMapUrl=="string"?n.cMapUrl:null,y=n.cMapPacked!==!1,w=n.CMapReaderFactory||gX,b=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,E=n.StandardFontDataFactory||_X,D=n.stopAtErrors!==!0,x=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,N=n.isEvalSupported!==!1,L=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!An,F=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!An&&(ln.platform.isFirefox||!globalThis.chrome),T=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,A=typeof n.disableFontFace=="boolean"?n.disableFontFace:An,C=n.fontExtraProperties===!0,R=n.enableXfa===!0,M=n.ownerDocument||globalThis.document,O=n.disableRange===!0,S=n.disableStream===!0,Pe=n.disableAutoFetch===!0,Nt=n.pdfBug===!0,ee=n.CanvasFactory||mX,J=n.FilterFactory||yX,Wt=n.enableHWA===!0,Un=c?c.length:n.length??NaN,oi=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!An&&!A,Bn=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:w===vg&&E===Eg&&p&&b&&Sd(p,document.baseURI)&&Sd(b,document.baseURI),ut=null;kQ(d);let Ve={canvasFactory:new ee({ownerDocument:M,enableHWA:Wt}),filterFactory:new J({docId:t,ownerDocument:M}),cMapReaderFactory:Bn?null:new w({baseUrl:p,isCompressed:y}),standardFontDataFactory:Bn?null:new E({baseUrl:b})};if(!u){let Hn={verbosity:d,port:va.workerPort};u=Hn.port?fl.fromPort(Hn):new fl(Hn),e._worker=u}let Cs={docId:t,apiVersion:"4.10.38",data:i,password:a,disableAutoFetch:Pe,rangeChunkSize:l,length:Un,docBaseUrl:f,enableXfa:R,evaluatorOptions:{maxImageSize:x,disableFontFace:A,ignoreErrors:D,isEvalSupported:N,isOffscreenCanvasSupported:L,isImageDecoderSupported:F,canvasMaxAreaInBytes:T,fontExtraProperties:C,useSystemFonts:oi,cMapUrl:Bn?p:null,standardFontDataUrl:Bn?b:null}},Mr={disableFontFace:A,fontExtraProperties:C,ownerDocument:M,pdfBug:Nt,styleElement:ut,loadingParams:{disableAutoFetch:Pe,enableXfa:R}};return u.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");let Hn=u.messageHandler.sendWithPromise("GetDocRequest",Cs,i?[i.buffer]:null),rt;if(c)rt=new bT(c,{disableRange:O,disableStream:S});else if(!i){if(!r)throw new Error("getDocument - no `url` parameter provided.");let fr;if(An)if(Sd(r)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");fr=Ag}else fr=RT;else fr=Sd(r)?Ag:ST;rt=new fr({url:r,length:Un,httpHeaders:s,withCredentials:o,rangeChunkSize:l,disableRange:O,disableStream:S})}return Hn.then(fr=>{if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");let _h=new _a(t,fr,u.port),$a=new FT(_h,e,rt,Mr,Ve);e._transport=$a,_h.send("Ready",null)})}).catch(e._capability.reject),e}function wX(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(An&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function bX(n){if(An&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return Hg(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n?.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function NF(n){return typeof n=="object"&&Number.isInteger(n?.num)&&n.num>=0&&Number.isInteger(n?.gen)&&n.gen>=0}var NT=class n{static#e=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${n.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}destroy(){return g(this,null,function*(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),yield this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null})}},Tg=class{constructor(e,t,r=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=r,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let r of this._rangeListeners)r(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let r of this._progressListeners)r(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){ft("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},OT=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Le(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},kT=class{#e=null;#t=!1;constructor(e,t,r,i=!1){this._pageIndex=e,this._pageInfo=t,this._transport=r,this._stats=i?new dg:null,this._pdfBug=i,this.commonObjs=r.commonObjs,this.objs=new Cg,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:r=0,offsetY:i=0,dontFlip:s=!1}={}){return new Pd({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:r,offsetY:i,dontFlip:s})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Le(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){return g(this,null,function*(){return this._transport._htmlForXfa?.children[this._pageIndex]||null})}render({canvasContext:e,viewport:t,intent:r="display",annotationMode:i=ho.ENABLE,transform:s=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:c=null,pageColors:l=null,printAnnotationStorage:u=null,isEditing:d=!1}){this._stats?.time("Overall");let f=this._transport.getRenderingIntent(r,i,u,d),{renderingIntent:p,cacheKey:y}=f;this.#t=!1,this.#r(),a||=this._transport.getOptionalContentConfig(p);let w=this._intentStates.get(y);w||(w=Object.create(null),this._intentStates.set(y,w)),w.streamReaderCancelTimeout&&(clearTimeout(w.streamReaderCancelTimeout),w.streamReaderCancelTimeout=null);let b=!!(p&dr.PRINT);w.displayReadyCapability||(w.displayReadyCapability=Promise.withResolvers(),w.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(f));let E=N=>{w.renderTasks.delete(D),(this._maybeCleanupAfterRender||b)&&(this.#t=!0),this.#n(!b),N?(D.capability.reject(N),this._abortOperatorList({intentState:w,reason:N instanceof Error?N:new Error(N)})):D.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},D=new jT({callback:E,params:{canvasContext:e,viewport:t,transform:s,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:w.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:l});(w.renderTasks||=new Set).add(D);let x=D.task;return Promise.all([w.displayReadyCapability.promise,a]).then(([N,L])=>{if(this.destroyed){E();return}if(this._stats?.time("Rendering"),!(L.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");D.initializeGraphics({transparency:N,optionalContentConfig:L}),D.operatorListChanged()}).catch(E),x}getOperatorList({intent:e="display",annotationMode:t=ho.ENABLE,printAnnotationStorage:r=null,isEditing:i=!1}={}){function s(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(c))}let o=this._transport.getRenderingIntent(e,t,r,i,!0),a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let c;return a.opListReadCapability||(c=Object.create(null),c.operatorListChanged=s,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(c),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(r=>Vd.textContent(r));let t=this.streamTextContent(e);return new Promise(function(r,i){function s(){o.read().then(function({value:c,done:l}){if(l){r(a);return}a.lang??=c.lang,Object.assign(a.styles,c.styles),a.items.push(...c.items),s()},i)}let o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let r of t.renderTasks)e.push(r.completed),r.cancel();return this.objs.clear(),this.#t=!1,this.#r(),Promise.all(e)}cleanup(e=!1){this.#t=!0;let t=this.#n(!1);return e&&t&&(this._stats&&=new dg),t}#n(e=!1){if(this.#r(),!this.#t||this.destroyed)return!1;if(e)return this.#e=setTimeout(()=>{this.#e=null,this.#n(!1)},pX),!1;for(let{renderTasks:t,operatorList:r}of this._intentStates.values())if(t.size>0||!r.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}#r(){this.#e&&(clearTimeout(this.#e),this.#e=null)}_startRenderPage(e,t){let r=this._intentStates.get(t);r&&(this._stats?.timeEnd("Page Request"),r.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let r=0,i=e.length;r<i;r++)t.operatorList.fnArray.push(e.fnArray[r]),t.operatorList.argsArray.push(e.argsArray[r]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let r of t.renderTasks)r.operatorListChanged();e.lastChunk&&this.#n(!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:r,modifiedIds:i}){let{map:s,transfer:o}=r,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:s,modifiedIds:i},o).getReader(),l=this._intentStates.get(t);l.streamReader=c;let u=()=>{c.read().then(({value:d,done:f})=>{if(f){l.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,l),u())},d=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(let f of l.renderTasks)f.operatorListChanged();this.#n(!0)}if(l.displayReadyCapability)l.displayReadyCapability.reject(d);else if(l.opListReadCapability)l.opListReadCapability.reject(d);else throw d}})};u()}_abortOperatorList({intentState:e,reason:t,force:r=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!r){if(e.renderTasks.size>0)return;if(t instanceof Md){let i=fX;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new ki(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[i,s]of this._intentStates)if(s===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}},LT=class{#e=new Map;#t=Promise.resolve();postMessage(e,t){let r={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(let[i]of this.#e)i.call(this,r)})}addEventListener(e,t,r=null){let i=null;if(r?.signal instanceof AbortSignal){let{signal:s}=r;if(s.aborted){xe("LoopbackPort - cannot use an `aborted` signal.");return}let o=()=>this.removeEventListener(e,t);i=()=>s.removeEventListener("abort",o),s.addEventListener("abort",o)}this.#e.set(t,i)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(let[,e]of this.#e)e?.();this.#e.clear()}},fl=class n{static#e=0;static#t=!1;static#n;static{An&&(this.#t=!0,va.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(e,t)=>{let r;try{if(r=new URL(e),!r.origin||r.origin==="null")return!1}catch{return!1}let i=new URL(t,r);return r.origin===i.origin},this._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}}constructor({name:e=null,port:t=null,verbosity:r=LQ()}={}){if(this.name=e,this.destroyed=!1,this.verbosity=r,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(n.#n?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(n.#n||=new WeakMap).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}#r(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new _a("main","worker",e),this._messageHandler.on("ready",function(){}),this.#r()}_initialize(){if(n.#t||n.#s){this._setupFakeWorker();return}let{workerSrc:e}=n;try{n._isSameOrigin(window.location.href,e)||(e=n._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),r=new _a("main","worker",t),i=()=>{s.abort(),r.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},s=new AbortController;t.addEventListener("error",()=>{this._webWorker||i()},{signal:s.signal}),r.on("test",a=>{if(s.abort(),this.destroyed||!a){i();return}this._messageHandler=r,this._port=t,this._webWorker=t,this.#r()}),r.on("ready",a=>{if(s.abort(),this.destroyed){i();return}try{o()}catch{this._setupFakeWorker()}});let o=()=>{let a=new Uint8Array;r.send("test",a,[a.buffer])};o();return}catch{Bg("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){n.#t||(xe("Setting up fake worker."),n.#t=!0),n._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new LT;this._port=t;let r=`fake${n.#e++}`,i=new _a(r+"_worker",r,t);e.setup(i,t),this._messageHandler=new _a(r,r+"_worker",t),this.#r()}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,n.#n?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");let t=this.#n?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new n(e)}static get workerSrc(){if(va.workerSrc)return va.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#s(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return Le(this,"_setupFakeWorkerGlobal",g(this,null,function*(){return this.#s?this.#s:(yield import(this.workerSrc)).WorkerMessageHandler}))}},FT=class{#e=new Map;#t=new Map;#n=new Map;#r=new Map;#s=null;constructor(e,t,r,i,s){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Cg,this.fontLoader=new sT({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#i(e,t=null){let r=this.#e.get(e);if(r)return r;let i=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,i),i}get annotationStorage(){return Le(this,"annotationStorage",new kd)}getRenderingIntent(e,t=ho.ENABLE,r=null,i=!1,s=!1){let o=dr.DISPLAY,a=iT;switch(e){case"any":o=dr.ANY;break;case"display":break;case"print":o=dr.PRINT;break;default:xe(`getRenderingIntent - invalid intent: ${e}`)}let c=o&dr.PRINT&&r instanceof gg?r:this.annotationStorage;switch(t){case ho.DISABLE:o+=dr.ANNOTATIONS_DISABLE;break;case ho.ENABLE:break;case ho.ENABLE_FORMS:o+=dr.ANNOTATIONS_FORMS;break;case ho.ENABLE_STORAGE:o+=dr.ANNOTATIONS_STORAGE,a=c.serializable;break;default:xe(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=dr.IS_EDITING),s&&(o+=dr.OPLIST);let{ids:l,hash:u}=c.modifiedIds,d=[o,a.hash,u];return{renderingIntent:o,cacheKey:d.join("_"),annotationStorageSerializable:a,modifiedIds:l}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#s?.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let r of this.#t.values())e.push(r._destroy());this.#t.clear(),this.#n.clear(),this.#r.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),Fd.cleanup(),this._networkStream?.cancelAllRequests(new ki("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(r,i)=>{jt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},i.onPull=()=>{this._fullReader.read().then(function({value:s,done:o}){if(o){i.close();return}jt(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{i.error(s)})},i.onCancel=s=>{this._fullReader.cancel(s),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",r=>g(this,null,function*(){yield this._fullReader.headersReady;let{isStreamingSupported:i,isRangeSupported:s,contentLength:o}=this._fullReader;return(!i||!s)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{t.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:i,isRangeSupported:s,contentLength:o}})),e.on("GetRangeReader",(r,i)=>{jt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let s=this._networkStream.getRangeReader(r.begin,r.end);if(!s){i.close();return}i.onPull=()=>{s.read().then(function({value:o,done:a}){if(a){i.close();return}jt(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{s.cancel(o),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:r})=>{this._numPages=r.numPages,this._htmlForXfa=r.htmlForXfa,delete r.htmlForXfa,t._capability.resolve(new OT(r,this))}),e.on("DocException",r=>{t._capability.reject(Qn(r))}),e.on("PasswordRequest",r=>{this.#s=Promise.withResolvers();try{if(!t.onPassword)throw Qn(r);let i=s=>{s instanceof Error?this.#s.reject(s):this.#s.resolve({password:s})};t.onPassword(i,r.code)}catch(i){this.#s.reject(i)}return this.#s.promise}),e.on("DataLoaded",r=>{t.onProgress?.({loaded:r.length,total:r.length}),this.downloadInfoCapability.resolve(r)}),e.on("StartRenderPage",r=>{if(this.destroyed)return;this.#t.get(r.pageIndex)._startRenderPage(r.transparency,r.cacheKey)}),e.on("commonobj",([r,i,s])=>{if(this.destroyed||this.commonObjs.has(r))return null;switch(i){case"Font":let{disableFontFace:o,fontExtraProperties:a,pdfBug:c}=this._params;if("error"in s){let f=s.error;xe(`Error during font loading: ${f}`),this.commonObjs.resolve(r,f);break}let l=c&&globalThis.FontInspector?.enabled?(f,p)=>globalThis.FontInspector.fontAdded(f,p):null,u=new oT(s,{disableFontFace:o,fontExtraProperties:a,inspectFont:l});this.fontLoader.bind(u).catch(()=>e.sendWithPromise("FontFallback",{id:r})).finally(()=>{!a&&u.data&&(u.data=null),this.commonObjs.resolve(r,u)});break;case"CopyLocalImage":let{imageRef:d}=s;jt(d,"The imageRef must be defined.");for(let f of this.#t.values())for(let[,p]of f.objs)if(p?.ref===d)return p.dataLen?(this.commonObjs.resolve(r,structuredClone(p)),p.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(r,s);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([r,i,s,o])=>{if(this.destroyed)return;let a=this.#t.get(i);if(!a.objs.has(r)){if(a._intentStates.size===0){o?.bitmap?.close();return}switch(s){case"Image":a.objs.resolve(r,o),o?.dataLen>RQ&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(r,o);break;default:throw new Error(`Got unknown object type ${s}`)}}}),e.on("DocProgress",r=>{this.destroyed||t.onProgress?.({loaded:r.loaded,total:r.total})}),e.on("FetchBuiltInCMap",r=>g(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(r)})),e.on("FetchStandardFontData",r=>g(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(r)}))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&xe("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,r=this.#n.get(t);if(r)return r;let i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&this.#r.set(s.refStr,e);let o=new kT(t,s,this,this._params.pdfBug);return this.#t.set(t,o),o});return this.#n.set(t,i),i}getPageIndex(e){return NF(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#i("GetFieldObjects")}hasJSActions(){return this.#i("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#i("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#i("GetOptionalContentConfig").then(t=>new wT(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=this.#e.get(e);if(t)return t;let r=this.messageHandler.sendWithPromise(e,null).then(i=>({info:i[0],metadata:i[1]?new _T(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,r),r}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(e=!1){return g(this,null,function*(){if(!this.destroyed){yield this.messageHandler.sendWithPromise("Cleanup",null);for(let t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),Fd.cleanup()}})}cachedPageNumber(e){if(!NF(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#r.get(t)??null}},Td=Symbol("INITIAL_DATA"),Cg=class{#e=Object.create(null);#t(e){return this.#e[e]||=P(_({},Promise.withResolvers()),{data:Td})}get(e,t=null){if(t){let i=this.#t(e);return i.promise.then(()=>t(i.data)),null}let r=this.#e[e];if(!r||r.data===Td)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return r.data}has(e){let t=this.#e[e];return!!t&&t.data!==Td}delete(e){let t=this.#e[e];return!t||t.data===Td?!1:(delete this.#e[e],!0)}resolve(e,t=null){let r=this.#t(e);r.data=t,r.resolve()}clear(){for(let e in this.#e){let{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(let e in this.#e){let{data:t}=this.#e[e];t!==Td&&(yield[e,t])}}},VT=class{#e=null;constructor(e){this.#e=e,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;let{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}},jT=class n{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:r,commonObjs:i,annotationCanvasMap:s,operatorList:o,pageIndex:a,canvasFactory:c,filterFactory:l,useRequestAnimationFrame:u=!1,pdfBug:d=!1,pageColors:f=null}){this.callback=e,this.params=t,this.objs=r,this.commonObjs=i,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=c,this.filterFactory=l,this._pdfBug=d,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new VT(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(n.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");n.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:r,viewport:i,transform:s,background:o}=this.params;this.gfx=new hl(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:i,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),n.#t.delete(this._canvas),this.callback(e||new Md(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){return g(this,null,function*(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),n.#t.delete(this._canvas),this.callback())))})}},EX="4.10.38",IX="f9bea397f";function OF(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Cd(n){return Math.max(0,Math.min(255,255*n))}var Sg=class{static CMYK_G([e,t,r,i]){return["G",1-Math.min(1,.3*e+.59*r+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Cd(e),[e,e,e]}static G_HTML([e]){let t=OF(e);return`#${t}${t}${t}`}static RGB_G([e,t,r]){return["G",.3*e+.59*t+.11*r]}static RGB_rgb(e){return e.map(Cd)}static RGB_HTML(e){return`#${e.map(OF).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,r,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,r+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,r,i]){return[Cd(1-Math.min(1,e+i)),Cd(1-Math.min(1,r+i)),Cd(1-Math.min(1,t+i))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,r]){let i=1-e,s=1-t,o=1-r,a=Math.min(i,s,o);return["CMYK",i,s,o,a]}},$T=class{create(e,t,r=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),r||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){ft("Abstract method `_createSVG` called.")}},jd=class extends $T{_createSVG(e){return document.createElementNS(ms,e)}},Dg=class{static setupStorage(e,t,r,i,s){let o=i.getValue(t,{value:null});switch(r.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),s==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})});break;case"input":if(r.attributes.type==="radio"||r.attributes.type==="checkbox"){if(o.value===r.attributes.xfaOn?e.setAttribute("checked",!0):o.value===r.attributes.xfaOff&&e.removeAttribute("checked"),s==="print")break;e.addEventListener("change",a=>{i.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),s==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(let a of r.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{let c=a.target.options,l=c.selectedIndex===-1?"":c[c.selectedIndex].value;i.setValue(t,{value:l})});break}}static setAttributes({html:e,element:t,storage:r=null,intent:i,linkService:s}){let{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(let[c,l]of Object.entries(o))if(l!=null)switch(c){case"class":l.length&&e.setAttribute(c,l.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",l);break;case"style":Object.assign(e.style,l);break;case"textContent":e.textContent=l;break;default:(!a||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,l)}a&&s.addLinkAttributes(e,o.href,o.newWindow),r&&o.dataId&&this.setupStorage(e,o.dataId,t,r)}static render(e){let t=e.annotationStorage,r=e.linkService,i=e.xfaHtml,s=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:s,linkService:r});let a=s!=="richText",c=e.div;if(c.append(o),e.viewport){let d=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=d}a&&c.setAttribute("class","xfaLayer xfaFont");let l=[];if(i.children.length===0){if(i.value){let d=document.createTextNode(i.value);o.append(d),a&&Vd.shouldBuildText(i.name)&&l.push(d)}return{textDivs:l}}let u=[[i,-1,o]];for(;u.length>0;){let[d,f,p]=u.at(-1);if(f+1===d.children.length){u.pop();continue}let y=d.children[++u.at(-1)[1]];if(y===null)continue;let{name:w}=y;if(w==="#text"){let E=document.createTextNode(y.value);l.push(E),p.append(E);continue}let b=y?.attributes?.xmlns?document.createElementNS(y.attributes.xmlns,w):document.createElement(w);if(p.append(b),y.attributes&&this.setAttributes({html:b,element:y,storage:t,intent:s,linkService:r}),y.children?.length>0)u.push([y,-1,b]);else if(y.value){let E=document.createTextNode(y.value);a&&Vd.shouldBuildText(w)&&l.push(E),b.append(E)}}for(let d of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:l}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},qd=1e3,AX=9,Ia=new WeakSet;function fo(n){return{width:n[2]-n[0],height:n[3]-n[1]}}var UT=class{static create(e){switch(e.data.annotationType){case Gt.LINK:return new xg(e);case Gt.TEXT:return new BT(e);case Gt.WIDGET:switch(e.data.fieldType){case"Tx":return new HT(e);case"Btn":return e.data.radioButton?new Rg(e):e.data.checkBox?new zT(e):new GT(e);case"Ch":return new WT(e);case"Sig":return new qT(e)}return new gs(e);case Gt.POPUP:return new $d(e);case Gt.FREETEXT:return new Pg(e);case Gt.LINE:return new YT(e);case Gt.SQUARE:return new QT(e);case Gt.CIRCLE:return new XT(e);case Gt.POLYLINE:return new Mg(e);case Gt.CARET:return new JT(e);case Gt.INK:return new Ud(e);case Gt.POLYGON:return new ZT(e);case Gt.HIGHLIGHT:return new Ng(e);case Gt.UNDERLINE:return new eC(e);case Gt.SQUIGGLY:return new tC(e);case Gt.STRIKEOUT:return new nC(e);case Gt.STAMP:return new Og(e);case Gt.FILEATTACHMENT:return new rC(e);default:return new Mt(e)}}},Mt=class n{#e=null;#t=!1;#n=null;constructor(e,{isRenderable:t=!1,ignoreBorder:r=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(r)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:r}){return!!(e?.str||t?.str||r?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return n._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;this.#e||={rect:this.data.rect.slice(0)};let{rect:t}=e;t&&this.#r(t),this.#n?.popup.updateEdited(e)}resetEdited(){this.#e&&(this.#r(this.#e.rect),this.#n?.popup.resetEdited(),this.#e=null)}#r(e){let{container:{style:t},data:{rect:r,rotation:i},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:o,pageX:a,pageY:c}}}}=this;r?.splice(0,4,...e);let{width:l,height:u}=fo(e);t.left=`${100*(e[0]-a)/s}%`,t.top=`${100*(o-e[3]+c)/o}%`,i===0?(t.width=`${100*l/s}%`,t.height=`${100*u/o}%`):this.setRotation(i)}_createContainer(e){let{data:t,parent:{page:r,viewport:i}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),this instanceof gs||(s.tabIndex=qd);let{style:o}=s;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof $d){let{rotation:w}=t;return!t.hasOwnCanvas&&w!==0&&this.setRotation(w,s),s}let{width:a,height:c}=fo(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;let w=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(w>0||b>0){let D=`calc(${w}px * var(--scale-factor)) / calc(${b}px * var(--scale-factor))`;o.borderRadius=D}else if(this instanceof Rg){let D=`calc(${a}px * var(--scale-factor)) / calc(${c}px * var(--scale-factor))`;o.borderRadius=D}switch(t.borderStyle.style){case Id.SOLID:o.borderStyle="solid";break;case Id.DASHED:o.borderStyle="dashed";break;case Id.BEVELED:xe("Unimplemented border style: beveled");break;case Id.INSET:xe("Unimplemented border style: inset");break;case Id.UNDERLINE:o.borderBottomStyle="solid";break;default:break}let E=t.borderColor||null;E?(this.#t=!0,o.borderColor=se.makeHexColor(E[0]|0,E[1]|0,E[2]|0)):o.borderWidth=0}let l=se.normalizeRect([t.rect[0],r.view[3]-t.rect[1]+r.view[1],t.rect[2],r.view[3]-t.rect[3]+r.view[1]]),{pageWidth:u,pageHeight:d,pageX:f,pageY:p}=i.rawDims;o.left=`${100*(l[0]-f)/u}%`,o.top=`${100*(l[1]-p)/d}%`;let{rotation:y}=t;return t.hasOwnCanvas||y===0?(o.width=`${100*a/u}%`,o.height=`${100*c/d}%`):this.setRotation(y,s),s}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:r,pageHeight:i}=this.parent.viewport.rawDims,{width:s,height:o}=fo(this.data.rect),a,c;e%180===0?(a=100*s/r,c=100*o/i):(a=100*o/r,c=100*s/i),t.style.width=`${a}%`,t.style.height=`${c}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,r,i)=>{let s=i.detail[t],o=s[0],a=s.slice(1);i.target.style[r]=Sg[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[r]:Sg[`${o}_rgb`](a)})};return Le(this,"_commonActions",{display:t=>{let{display:r}=t.detail,i=r%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:r===1||r===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:r}=t.detail;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:r,noView:r})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let r=t.detail.rotation;this.setRotation(r),this.annotationStorage.setValue(this.data.id,{rotation:r})}})}_dispatchEventFromSandbox(e,t){let r=this._commonActions;for(let i of Object.keys(t.detail))(e[i]||r[i])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let r=this._commonActions;for(let[i,s]of Object.entries(t)){let o=r[i];if(o){let a={detail:{[i]:s},target:e};o(a),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,r,i,s]=this.data.rect.map(w=>Math.fround(w));if(e.length===8){let[w,b,E,D]=e.subarray(2,6);if(i===w&&s===b&&t===E&&r===D)return}let{style:o}=this.container,a;if(this.#t){let{borderColor:w,borderWidth:b}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${w}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}let c=i-t,l=s-r,{svgFactory:u}=this,d=u.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);let f=u.createElement("defs");d.append(f);let p=u.createElement("clipPath"),y=`clippath_${this.data.id}`;p.setAttribute("id",y),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let w=2,b=e.length;w<b;w+=8){let E=e[w],D=e[w+1],x=e[w+2],N=e[w+3],L=u.createElement("rect"),F=(x-t)/c,T=(s-D)/l,A=(E-x)/c,C=(D-N)/l;L.setAttribute("x",F),L.setAttribute("y",T),L.setAttribute("width",A),L.setAttribute("height",C),p.append(L),a?.push(`<rect vector-effect="non-scaling-stroke" x="${F}" y="${T}" width="${A}" height="${C}"/>`)}this.#t&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(d),this.container.style.clipPath=`url(#${y})`}_createPopup(){let{data:e}=this,t=this.#n=new $d({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(t.render())}render(){ft("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let r=[];if(this._fieldObjects){let i=this._fieldObjects[e];if(i)for(let{page:s,id:o,exportValues:a}of i){if(s===-1||o===t)continue;let c=typeof a=="string"?a:null,l=document.querySelector(`[data-element-id="${o}"]`);if(l&&!Ia.has(l)){xe(`_getElementsByName - element not allowed: ${o}`);continue}r.push({id:o,exportValue:c,domElement:l})}return r}for(let i of document.getElementsByName(e)){let{exportValue:s}=i,o=i.getAttribute("data-element-id");o!==t&&Ia.has(i)&&r.push({id:o,exportValue:s,domElement:i})}return r}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}},xg=class extends Mt{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:t}=this,r=document.createElement("a");r.setAttribute("data-element-id",e.id);let i=!1;return e.url?(t.addLinkAttributes(r,e.url,e.newWindow),i=!0):e.action?(this._bindNamedAction(r,e.action),i=!0):e.attachment?(this.#t(r,e.attachment,e.attachmentDest),i=!0):e.setOCGState?(this.#n(r,e.setOCGState),i=!0):e.dest?(this._bindLink(r,e.dest),i=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,e),i=!0),e.resetForm?(this._bindResetFormAction(r,e.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(r,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(r),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#e()}#t(e,t,r=null){e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,r),!1),this.#e()}#n(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");let r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let i of Object.keys(t.actions)){let s=r.get(i);s&&(e[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:i}}),!1))}e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){let r=e.onclick;if(r||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){xe('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(e.onclick=()=>!1);return}e.onclick=()=>{r?.();let{fields:i,refs:s,include:o}=t,a=[];if(i.length!==0||s.length!==0){let u=new Set(s);for(let d of i){let f=this._fieldObjects[d]||[];for(let{id:p}of f)u.add(p)}for(let d of Object.values(this._fieldObjects))for(let f of d)u.has(f.id)===o&&a.push(f)}else for(let u of Object.values(this._fieldObjects))a.push(...u);let c=this.annotationStorage,l=[];for(let u of a){let{id:d}=u;switch(l.push(d),u.type){case"text":{let p=u.defaultValue||"";c.setValue(d,{value:p});break}case"checkbox":case"radiobutton":{let p=u.defaultValue===u.exportValues;c.setValue(d,{value:p});break}case"combobox":case"listbox":{let p=u.defaultValue||"";c.setValue(d,{value:p});break}default:continue}let f=document.querySelector(`[data-element-id="${d}"]`);if(f){if(!Ia.has(f)){xe(`_bindResetFormAction - element not allowed: ${d}`);continue}}else continue;f.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}}),!1}}},BT=class extends Mt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},gs=class extends Mt{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return ln.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,r,i,s){r.includes("mouse")?e.addEventListener(r,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(r,o=>{if(r==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(r==="focus"){if(t.focused)return;t.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(o)}})})}_setEventListeners(e,t,r,i){for(let[s,o]of r)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,s,o,i),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":se.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:r}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||AX,s=e.style,o,a=2,c=l=>Math.round(10*l)/10;if(this.data.multiLine){let l=Math.abs(this.data.rect[3]-this.data.rect[1]-a),u=Math.round(l/(cg*i))||1,d=l/u;o=Math.min(i,c(d/cg))}else{let l=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(i,c(l/cg))}s.fontSize=`calc(${o}px * var(--scale-factor))`,s.color=se.makeHexColor(r[0],r[1],r[2]),this.data.textAlignment!==null&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},HT=class extends gs{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,r,i){let s=this.annotationStorage;for(let o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=r),s.setValue(o.id,{[i]:r})}render(){let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let r=null;if(this.renderForms){let i=e.getValue(t,{value:this.data.fieldValue}),s=i.value||"",o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&s.length>o&&(s=s.slice(0,o));let a=i.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));let c={userValue:s,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(r=document.createElement("textarea"),r.textContent=a??s,this.data.doNotScroll&&(r.style.overflowY="hidden")):(r=document.createElement("input"),r.type="text",r.setAttribute("value",a??s),this.data.doNotScroll&&(r.style.overflowX="hidden")),this.data.hasOwnCanvas&&(r.hidden=!0),Ia.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,r.name=this.data.fieldName,r.tabIndex=qd,this._setRequired(r,this.data.required),o&&(r.maxLength=o),r.addEventListener("input",u=>{e.setValue(t,{value:u.target.value}),this.setPropertyOnSiblings(r,"value",u.target.value,"value"),c.formattedValue=null}),r.addEventListener("resetform",u=>{let d=this.data.defaultFieldValue??"";r.value=c.userValue=d,c.formattedValue=null});let l=u=>{let{formattedValue:d}=c;d!=null&&(u.target.value=d),u.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){r.addEventListener("focus",d=>{if(c.focused)return;let{target:f}=d;c.userValue&&(f.value=c.userValue),c.lastCommittedValue=f.value,c.commitKey=1,this.data.actions?.Focus||(c.focused=!0)}),r.addEventListener("updatefromsandbox",d=>{this.showElementAndHideCanvas(d.target);let f={value(p){c.userValue=p.detail.value??"",e.setValue(t,{value:c.userValue.toString()}),p.target.value=c.userValue},formattedValue(p){let{formattedValue:y}=p.detail;c.formattedValue=y,y!=null&&p.target!==document.activeElement&&(p.target.value=y),e.setValue(t,{formattedValue:y})},selRange(p){p.target.setSelectionRange(...p.detail.selRange)},charLimit:p=>{let{charLimit:y}=p.detail,{target:w}=p;if(y===0){w.removeAttribute("maxLength");return}w.setAttribute("maxLength",y);let b=c.userValue;!b||b.length<=y||(b=b.slice(0,y),w.value=c.userValue=b,e.setValue(t,{value:b}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,willCommit:!0,commitKey:1,selStart:w.selectionStart,selEnd:w.selectionEnd}}))}};this._dispatchEventFromSandbox(f,d)}),r.addEventListener("keydown",d=>{c.commitKey=1;let f=-1;if(d.key==="Escape"?f=0:d.key==="Enter"&&!this.data.multiLine?f=2:d.key==="Tab"&&(c.commitKey=3),f===-1)return;let{value:p}=d.target;c.lastCommittedValue!==p&&(c.lastCommittedValue=p,c.userValue=p,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,willCommit:!0,commitKey:f,selStart:d.target.selectionStart,selEnd:d.target.selectionEnd}}))});let u=l;l=null,r.addEventListener("blur",d=>{if(!c.focused||!d.relatedTarget)return;this.data.actions?.Blur||(c.focused=!1);let{value:f}=d.target;c.userValue=f,c.lastCommittedValue!==f&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:f,willCommit:!0,commitKey:c.commitKey,selStart:d.target.selectionStart,selEnd:d.target.selectionEnd}}),u(d)}),this.data.actions?.Keystroke&&r.addEventListener("beforeinput",d=>{c.lastCommittedValue=null;let{data:f,target:p}=d,{value:y,selectionStart:w,selectionEnd:b}=p,E=w,D=b;switch(d.inputType){case"deleteWordBackward":{let x=y.substring(0,w).match(/\w*[^\w]*$/);x&&(E-=x[0].length);break}case"deleteWordForward":{let x=y.substring(w).match(/^[^\w]*\w*/);x&&(D+=x[0].length);break}case"deleteContentBackward":w===b&&(E-=1);break;case"deleteContentForward":w===b&&(D+=1);break}d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,change:f||"",willCommit:!1,selStart:E,selEnd:D}})}),this._setEventListeners(r,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],d=>d.target.value)}if(l&&r.addEventListener("blur",l),this.data.comb){let d=(this.data.rect[2]-this.data.rect[0])/o;r.classList.add("comb"),r.style.letterSpacing=`calc(${d}px * var(--scale-factor) - 1ch)`}}else r=document.createElement("div"),r.textContent=this.data.fieldValue,r.style.verticalAlign="middle",r.style.display="table-cell",this.data.hasOwnCanvas&&(r.hidden=!0);return this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},qT=class extends gs{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},zT=class extends gs{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,r=t.id,i=e.getValue(r,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(r,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let s=document.createElement("input");return Ia.add(s),s.setAttribute("data-element-id",r),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=qd,s.addEventListener("change",o=>{let{name:a,checked:c}=o.target;for(let l of this._getElementsByName(a,r)){let u=c&&l.exportValue===t.exportValue;l.domElement&&(l.domElement.checked=u),e.setValue(l.id,{value:u})}e.setValue(r,{value:c})}),s.addEventListener("resetform",o=>{let a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",o=>{let a={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(r,{value:c.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},Rg=class extends gs{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,r=t.id,i=e.getValue(r,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(r,{value:i})),i)for(let o of this._getElementsByName(t.fieldName,r))e.setValue(o.id,{value:!1});let s=document.createElement("input");if(Ia.add(s),s.setAttribute("data-element-id",r),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.tabIndex=qd,s.addEventListener("change",o=>{let{name:a,checked:c}=o.target;for(let l of this._getElementsByName(a,r))e.setValue(l.id,{value:!1});e.setValue(r,{value:c})}),s.addEventListener("resetform",o=>{let a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){let o=t.buttonValue;s.addEventListener("updatefromsandbox",a=>{let c={value:l=>{let u=o===l.detail.value;for(let d of this._getElementsByName(l.target.name)){let f=u&&d.id===r;d.domElement&&(d.domElement.checked=f),e.setValue(d.id,{value:f})}}};this._dispatchEventFromSandbox(c,a)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},GT=class extends xg{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",r=>{this._dispatchEventFromSandbox({},r)})),e}},WT=class extends gs{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,r=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Ia.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=qd;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",u=>{let d=this.data.defaultFieldValue;for(let f of i.options)f.selected=f.value===d});for(let u of this.data.options){let d=document.createElement("option");d.textContent=u.displayValue,d.value=u.exportValue,r.value.includes(u.exportValue)&&(d.setAttribute("selected",!0),s=!1),i.append(d)}let o=null;if(s){let u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),i.prepend(u),o=()=>{u.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}let a=u=>{let d=u?"value":"textContent",{options:f,multiple:p}=i;return p?Array.prototype.filter.call(f,y=>y.selected).map(y=>y[d]):f.selectedIndex===-1?null:f[f.selectedIndex][d]},c=a(!1),l=u=>{let d=u.target.options;return Array.prototype.map.call(d,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",u=>{let d={value(f){o?.();let p=f.detail.value,y=new Set(Array.isArray(p)?p:[p]);for(let w of i.options)w.selected=y.has(w.value);e.setValue(t,{value:a(!0)}),c=a(!1)},multipleSelection(f){i.multiple=!0},remove(f){let p=i.options,y=f.detail.remove;p[y].selected=!1,i.remove(y),p.length>0&&Array.prototype.findIndex.call(p,b=>b.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:a(!0),items:l(f)}),c=a(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),c=a(!1)},insert(f){let{index:p,displayValue:y,exportValue:w}=f.detail.insert,b=i.children[p],E=document.createElement("option");E.textContent=y,E.value=w,b?b.before(E):i.append(E),e.setValue(t,{value:a(!0),items:l(f)}),c=a(!1)},items(f){let{items:p}=f.detail;for(;i.length!==0;)i.remove(0);for(let y of p){let{displayValue:w,exportValue:b}=y,E=document.createElement("option");E.textContent=w,E.value=b,i.append(E)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:a(!0),items:l(f)}),c=a(!1)},indices(f){let p=new Set(f.detail.indices);for(let y of f.target.options)y.selected=p.has(y.index);e.setValue(t,{value:a(!0)}),c=a(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(d,u)}),i.addEventListener("input",u=>{let d=a(!0),f=a(!1);e.setValue(t,{value:d}),u.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:f,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):i.addEventListener("input",function(u){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},$d=class extends Mt{constructor(e){let{data:t,elements:r}=e;super(e,{isRenderable:Mt._hasPopupData(t)}),this.elements=r,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new KT({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let r of this.elements)r.popup=e,r.container.ariaHasPopup="dialog",t.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(r=>`${mC}${r}`).join(",")),this.container}},KT=class{#e=this.#S.bind(this);#t=this.#C.bind(this);#n=this.#D.bind(this);#r=this.#E.bind(this);#s=null;#i=null;#c=null;#a=null;#u=null;#l=null;#h=null;#d=!1;#f=null;#o=null;#p=null;#g=null;#m=null;#y=null;#w=!1;constructor({container:e,color:t,elements:r,titleObj:i,modificationDate:s,contentsObj:o,richText:a,parent:c,rect:l,parentRect:u,open:d}){this.#i=e,this.#m=i,this.#c=o,this.#g=a,this.#l=c,this.#s=t,this.#p=l,this.#h=u,this.#u=r,this.#a=hg.toDateObject(s),this.trigger=r.flatMap(f=>f.getElementsToTriggerPopup());for(let f of this.trigger)f.addEventListener("click",this.#r),f.addEventListener("mouseenter",this.#n),f.addEventListener("mouseleave",this.#t),f.classList.add("popupTriggerArea");for(let f of r)f.container?.addEventListener("keydown",this.#e);this.#i.hidden=!0,d&&this.#E()}render(){if(this.#f)return;let e=this.#f=document.createElement("div");if(e.className="popup",this.#s){let s=e.style.outlineColor=se.makeHexColor(...this.#s);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`:e.style.backgroundColor=se.makeHexColor(...this.#s.map(a=>Math.floor(.7*(255-a)+a)))}let t=document.createElement("span");t.className="header";let r=document.createElement("h1");if(t.append(r),{dir:r.dir,str:r.textContent}=this.#m,e.append(t),this.#a){let s=document.createElement("span");s.classList.add("popupDate"),s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#a.valueOf()})),t.append(s)}let i=this.#_;if(i)Dg.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let s=this._formatContents(this.#c);e.append(s)}this.#i.append(e)}get#_(){let e=this.#g,t=this.#c;return e?.str&&(!t?.str||t.str===e.str)&&this.#g.html||null}get#b(){return this.#_?.attributes?.style?.fontSize||0}get#I(){return this.#_?.attributes?.style?.color||null}#T(e){let t=[],r={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:this.#I,fontSize:this.#b?`calc(${this.#b}px * var(--scale-factor))`:""}};for(let s of e.split(`
`))t.push({name:"span",value:s,attributes:i});return r}_formatContents({str:e,dir:t}){let r=document.createElement("p");r.classList.add("popupContent"),r.dir=t;let i=e.split(/(?:\r\n?|\n)/);for(let s=0,o=i.length;s<o;++s){let a=i[s];r.append(document.createTextNode(a)),s<o-1&&r.append(document.createElement("br"))}return r}#S(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#d)&&this.#E()}updateEdited({rect:e,popupContent:t}){this.#y||={contentsObj:this.#c,richText:this.#g},e&&(this.#o=null),t&&(this.#g=this.#T(t),this.#c=null),this.#f?.remove(),this.#f=null}resetEdited(){this.#y&&({contentsObj:this.#c,richText:this.#g}=this.#y,this.#y=null,this.#f?.remove(),this.#f=null,this.#o=null)}#x(){if(this.#o!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:r,pageX:i,pageY:s}}}=this.#l,o=!!this.#h,a=o?this.#h:this.#p;for(let y of this.#u)if(!a||se.intersect(y.data.rect,a)!==null){a=y.data.rect,o=!0;break}let c=se.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),u=o?a[2]-a[0]+5:0,d=c[0]+u,f=c[1];this.#o=[100*(d-i)/t,100*(f-s)/r];let{style:p}=this.#i;p.left=`${this.#o[0]}%`,p.top=`${this.#o[1]}%`}#E(){this.#d=!this.#d,this.#d?(this.#D(),this.#i.addEventListener("click",this.#r),this.#i.addEventListener("keydown",this.#e)):(this.#C(),this.#i.removeEventListener("click",this.#r),this.#i.removeEventListener("keydown",this.#e))}#D(){this.#f||this.render(),this.isVisible?this.#d&&this.#i.classList.add("focused"):(this.#x(),this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#C(){this.#i.classList.remove("focused"),!(this.#d||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#w=this.isVisible,this.#w&&(this.#i.hidden=!0)}maybeShow(){this.#w&&(this.#f||this.#D(),this.#w=!1,this.#i.hidden=!1)}get isVisible(){return this.#i.hidden===!1}},Pg=class extends Mt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=De.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let r=document.createElement("span");r.textContent=t,e.append(r)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},YT=class extends Mt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let e=this.data,{width:t,height:r}=fo(e.rect),i=this.svgFactory.create(t,r,!0),s=this.#e=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),s.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),s.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),s.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}},QT=class extends Mt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let e=this.data,{width:t,height:r}=fo(e.rect),i=this.svgFactory.create(t,r,!0),s=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",s/2),o.setAttribute("y",s/2),o.setAttribute("width",t-s),o.setAttribute("height",r-s),o.setAttribute("stroke-width",s||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}},XT=class extends Mt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let e=this.data,{width:t,height:r}=fo(e.rect),i=this.svgFactory.create(t,r,!0),s=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",t/2),o.setAttribute("cy",r/2),o.setAttribute("rx",t/2-s/2),o.setAttribute("ry",r/2-s/2),o.setAttribute("stroke-width",s||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}},Mg=class extends Mt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,vertices:t,borderStyle:r,popupRef:i}}=this;if(!t)return this.container;let{width:s,height:o}=fo(e),a=this.svgFactory.create(s,o,!0),c=[];for(let u=0,d=t.length;u<d;u+=2){let f=t[u]-e[0],p=e[3]-t[u+1];c.push(`${f},${p}`)}c=c.join(" ");let l=this.#e=this.svgFactory.createElement(this.svgElementName);return l.setAttribute("points",c),l.setAttribute("stroke-width",r.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}},ZT=class extends Mg{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},JT=class extends Mt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},Ud=class extends Mt{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?De.HIGHLIGHT:De.INK}#n(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,rotation:t,inkLists:r,borderStyle:i,popupRef:s}}=this,{transform:o,width:a,height:c}=this.#n(t,e),l=this.svgFactory.create(a,c,!0),u=this.#e=this.svgFactory.createElement("svg:g");l.append(u),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",o);for(let d=0,f=r.length;d<f;d++){let p=this.svgFactory.createElement(this.svgElementName);this.#t.push(p),p.setAttribute("points",r[d].join(",")),u.append(p)}return!s&&this.hasPopupData&&this._createPopup(),this.container.append(l),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);let{thickness:t,points:r,rect:i}=e,s=this.#e;if(t>=0&&s.setAttribute("stroke-width",t||1),r)for(let o=0,a=this.#t.length;o<a;o++)this.#t[o].setAttribute("points",r[o].join(","));if(i){let{transform:o,width:a,height:c}=this.#n(this.data.rotation,i);s.parentElement.setAttribute("viewBox",`0 0 ${a} ${c}`),s.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Ng=class extends Mt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=De.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},eC=class extends Mt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},tC=class extends Mt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},nC=class extends Mt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},Og=class extends Mt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=De.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},rC=class extends Mt{#e=null;constructor(e){super(e,{isRenderable:!0});let{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",_({source:this},t))}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:e,data:t}=this,r;t.hasAppearance||t.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),r.addEventListener("dblclick",this.#t.bind(this)),this.#e=r;let{isMac:i}=ln.platform;return e.addEventListener("keydown",s=>{s.key==="Enter"&&(i?s.metaKey:s.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?this._createPopup():r.classList.add("popupTriggerArea"),e.append(r),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}},iC=class{#e=null;#t=null;#n=new Map;#r=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:r,annotationEditorUIManager:i,page:s,viewport:o,structTreeLayer:a}){this.div=e,this.#e=t,this.#t=r,this.#r=a||null,this.page=s,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return this.#n.size>0}#s(e,t){return g(this,null,function*(){let r=e.firstChild||e,i=r.id=`${mC}${t}`,s=yield this.#r?.getAriaAttributes(i);if(s)for(let[o,a]of s)r.setAttribute(o,a);this.div.append(e),this.#e?.moveElementInDOM(this.div,e,r,!1)})}render(e){return g(this,null,function*(){let{annotations:t}=e,r=this.div;ba(r,this.viewport);let i=new Map,s={data:null,layer:r,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new jd,annotationStorage:e.annotationStorage||new kd,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let o of t){if(o.noHTML)continue;let a=o.annotationType===Gt.POPUP;if(a){let u=i.get(o.id);if(!u)continue;s.elements=u}else{let{width:u,height:d}=fo(o.rect);if(u<=0||d<=0)continue}s.data=o;let c=UT.create(s);if(!c.isRenderable)continue;if(!a&&o.popupRef){let u=i.get(o.popupRef);u?u.push(c):i.set(o.popupRef,[c])}let l=c.render();o.hidden&&(l.style.visibility="hidden"),yield this.#s(l,o.id),c._isEditable&&(this.#n.set(c.data.id,c),this._annotationEditorUIManager?.renderAnnotationElement(c))}this.#i()})}update({viewport:e}){let t=this.div;this.viewport=e,ba(t,{rotation:e.rotation}),this.#i(),t.hidden=!1}#i(){if(!this.#t)return;let e=this.div;for(let[t,r]of this.#t){let i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;r.className="annotationContent";let{firstChild:s}=i;s?s.nodeName==="CANVAS"?s.replaceWith(r):s.classList.contains("annotationContent")?s.after(r):s.before(r):i.append(r)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(e){return this.#n.get(e)}},ag=/\r\n?|\n/g,sC=class n extends It{#e;#t="";#n=`${this.id}-editor`;#r=null;#s;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let e=n.prototype,t=s=>s.isEmpty(),r=Od.TRANSLATE_SMALL,i=Od.TRANSLATE_BIG;return Le(this,"_keyboardManager",new Ea([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}]]))}static _type="freetext";static _editorType=De.FREETEXT;constructor(e){super(P(_({},e),{name:"freeTextEditor"})),this.#e=e.color||n._defaultColor||It._defaultLineColor,this.#s=e.fontSize||n._defaultFontSize}static initialize(e,t){It.initialize(e,t);let r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case We.FREETEXT_SIZE:n._defaultFontSize=t;break;case We.FREETEXT_COLOR:n._defaultColor=t;break}}updateParams(e,t){switch(e){case We.FREETEXT_SIZE:this.#i(t);break;case We.FREETEXT_COLOR:this.#c(t);break}}static get defaultPropertiesToUpdate(){return[[We.FREETEXT_SIZE,n._defaultFontSize],[We.FREETEXT_COLOR,n._defaultColor||It._defaultLineColor]]}get propertiesToUpdate(){return[[We.FREETEXT_SIZE,this.#s],[We.FREETEXT_COLOR,this.#e]]}#i(e){let t=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--scale-factor))`,this.translate(0,-(i-this.#s)*this.parentScale),this.#s=i,this.#u()},r=this.#s;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#c(e){let t=i=>{this.#e=this.editorDiv.style.color=i},r=this.#e;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){let e=this.parentScale;return[-n._internalPadding*e,-(n._internalPadding+this.#s)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(De.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#r=new AbortController;let e=this._uiManager.combinedSignal(this.#r);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#n),this._isDraggable=!0,this.#r?.abort(),this.#r=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#a(){let e=[];this.editorDiv.normalize();let t=null;for(let r of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&r.nodeName==="BR"||(e.push(n.#l(r)),t=r);return e.join(`
`)}#u(){let[e,t]=this.parentDimensions,r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{let{currentLayer:i,div:s}=this,o=s.style.display,a=s.classList.contains("hidden");s.classList.remove("hidden"),s.style.display="hidden",i.div.append(this.div),r=s.getBoundingClientRect(),s.remove(),s.style.display=o,s.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=r.width/e,this.height=r.height/t):(this.width=r.height/e,this.height=r.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=this.#t,t=this.#t=this.#a().trimEnd();if(e===t)return;let r=i=>{if(this.#t=i,!i){this.remove();return}this.#h(),this._uiManager.rebuild(this),this.#u()};this.addCommands({cmd:()=>{r(t)},undo:()=>{r(e)},mustExec:!1}),this.#u()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){n._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#n),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:r}=this.editorDiv;if(r.fontSize=`calc(${this.#s}px * var(--scale-factor))`,r.color=this.#e,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),fg(this,this.div,["dblclick","keydown"]),this.width){let[i,s]=this.parentDimensions;if(this.annotationElementId){let{position:o}=this._initialData,[a,c]=this.getInitialTranslation();[a,c]=this.pageTranslationToScreen(a,c);let[l,u]=this.pageDimensions,[d,f]=this.pageTranslation,p,y;switch(this.rotation){case 0:p=e+(o[0]-d)/l,y=t+this.height-(o[1]-f)/u;break;case 90:p=e+(o[0]-d)/l,y=t-(o[1]-f)/u,[a,c]=[c,-a];break;case 180:p=e-this.width+(o[0]-d)/l,y=t-(o[1]-f)/u,[a,c]=[-a,-c];break;case 270:p=e+(o[0]-d-this.height*u)/l,y=t+(o[1]-f-this.width*l)/u,[a,c]=[-c,a];break}this.setAt(p*i,y*s,a,c)}else this.setAt(e*i,t*s,this.width*i,this.height*s);this.#h(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#l(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(ag,"")}editorDivPaste(e){let t=e.clipboardData||window.clipboardData,{types:r}=t;if(r.length===1&&r[0]==="text/plain")return;e.preventDefault();let i=n.#f(t.getData("text")||"").replaceAll(ag,`
`);if(!i)return;let s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();let o=s.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),s.collapseToStart();return}let{startContainer:a,startOffset:c}=o,l=[],u=[];if(a.nodeType===Node.TEXT_NODE){let p=a.parentElement;if(u.push(a.nodeValue.slice(c).replaceAll(ag,"")),p!==this.editorDiv){let y=l;for(let w of this.editorDiv.childNodes){if(w===p){y=u;continue}y.push(n.#l(w))}}l.push(a.nodeValue.slice(0,c).replaceAll(ag,""))}else if(a===this.editorDiv){let p=l,y=0;for(let w of this.editorDiv.childNodes)y++===c&&(p=u),p.push(n.#l(w))}this.#t=`${l.join(`
`)}${i}${u.join(`
`)}`,this.#h();let d=new Range,f=l.reduce((p,y)=>p+y.length,0);for(let{firstChild:p}of this.editorDiv.childNodes)if(p.nodeType===Node.TEXT_NODE){let y=p.nodeValue.length;if(f<=y){d.setStart(p,f),d.setEnd(p,f);break}f-=y}s.removeAllRanges(),s.addRange(d)}#h(){if(this.editorDiv.replaceChildren(),!!this.#t)for(let e of this.#t.split(`
`)){let t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#d(){return this.#t.replaceAll("\xA0"," ")}static#f(e){return e.replaceAll(" ","\xA0")}get contentDiv(){return this.editorDiv}static deserialize(e,t,r){return g(this,null,function*(){let i=null;if(e instanceof Pg){let{data:{defaultAppearanceData:{fontSize:o,fontColor:a},rect:c,rotation:l,id:u,popupRef:d},textContent:f,textPosition:p,parent:{page:{pageNumber:y}}}=e;if(!f||f.length===0)return null;i=e={annotationType:De.FREETEXT,color:Array.from(a),fontSize:o,value:f.join(`
`),position:p,pageIndex:y-1,rect:c.slice(0),rotation:l,id:u,deleted:!1,popupRef:d}}let s=yield Kt(n,this,"deserialize").call(this,e,t,r);return s.#s=e.fontSize,s.#e=se.makeHexColor(...e.color),s.#t=n.#f(e.value),s.annotationElementId=e.id||null,s._initialData=i,s})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let t=n._internalPadding*this.parentScale,r=this.getRect(t,t),i=It._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#e),s={annotationType:De.FREETEXT,color:i,fontSize:this.#s,value:this.#d(),pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?s:this.annotationElementId&&!this.#o(s)?null:(s.id=this.annotationElementId,s)}#o(e){let{value:t,fontSize:r,color:i,pageIndex:s}=this._initialData;return this._hasBeenMoved||e.value!==t||e.fontSize!==r||e.color.some((o,a)=>o!==i[a])||e.pageIndex!==s}renderAnnotationElement(e){let t=super.renderAnnotationElement(e);if(this.deleted)return t;let{style:r}=t;r.fontSize=`calc(${this.#s}px * var(--scale-factor))`,r.color=this.#e,t.replaceChildren();for(let s of this.#t.split(`
`)){let o=document.createElement("div");o.append(s?document.createTextNode(s):document.createElement("br")),t.append(o)}let i=n._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(i,i),popupContent:this.#t}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}},X=(()=>{class n{static PRECISION=1e-4;toSVGPath(){ft("Abstract method `toSVGPath` must be implemented.")}get box(){ft("Abstract getter `box` must be implemented.")}serialize(t,r){ft("Abstract method `serialize` must be implemented.")}static _rescale(t,r,i,s,o,a){a||=new Float32Array(t.length);for(let c=0,l=t.length;c<l;c+=2)a[c]=r+t[c]*s,a[c+1]=i+t[c+1]*o;return a}static _rescaleAndSwap(t,r,i,s,o,a){a||=new Float32Array(t.length);for(let c=0,l=t.length;c<l;c+=2)a[c]=r+t[c+1]*s,a[c+1]=i+t[c]*o;return a}static _translate(t,r,i,s){s||=new Float32Array(t.length);for(let o=0,a=t.length;o<a;o+=2)s[o]=r+t[o],s[o+1]=i+t[o+1];return s}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,r,i,s,o){switch(o){case 90:return[1-r/i,t/s];case 180:return[1-t/i,1-r/s];case 270:return[r/i,1-t/s];default:return[t/i,r/s]}}static _normalizePagePoint(t,r,i){switch(i){case 90:return[1-r,t];case 180:return[1-t,1-r];case 270:return[r,1-t];default:return[t,r]}}static createBezierPoints(t,r,i,s,o,a){return[(t+5*i)/6,(r+5*s)/6,(5*i+o)/6,(5*s+a)/6,(i+o)/2,(s+a)/2]}}return n})(),kg=class n{#e;#t=[];#n;#r;#s=[];#i=new Float32Array(18);#c;#a;#u;#l;#h;#d;#f=[];static#o=8;static#p=2;static#g=n.#o+n.#p;constructor({x:e,y:t},r,i,s,o,a=0){this.#e=r,this.#d=s*i,this.#r=o,this.#i.set([NaN,NaN,NaN,NaN,e,t],6),this.#n=a,this.#l=n.#o*i,this.#u=n.#g*i,this.#h=i,this.#f.push(e,t)}isEmpty(){return isNaN(this.#i[8])}#m(){let e=this.#i.subarray(4,6),t=this.#i.subarray(16,18),[r,i,s,o]=this.#e;return[(this.#c+(e[0]-t[0])/2-r)/s,(this.#a+(e[1]-t[1])/2-i)/o,(this.#c+(t[0]-e[0])/2-r)/s,(this.#a+(t[1]-e[1])/2-i)/o]}add({x:e,y:t}){this.#c=e,this.#a=t;let[r,i,s,o]=this.#e,[a,c,l,u]=this.#i.subarray(8,12),d=e-l,f=t-u,p=Math.hypot(d,f);if(p<this.#u)return!1;let y=p-this.#l,w=y/p,b=w*d,E=w*f,D=a,x=c;a=l,c=u,l+=b,u+=E,this.#f?.push(e,t);let N=-E/y,L=b/y,F=N*this.#d,T=L*this.#d;return this.#i.set(this.#i.subarray(2,8),0),this.#i.set([l+F,u+T],4),this.#i.set(this.#i.subarray(14,18),12),this.#i.set([l-F,u-T],16),isNaN(this.#i[6])?(this.#s.length===0&&(this.#i.set([a+F,c+T],2),this.#s.push(NaN,NaN,NaN,NaN,(a+F-r)/s,(c+T-i)/o),this.#i.set([a-F,c-T],14),this.#t.push(NaN,NaN,NaN,NaN,(a-F-r)/s,(c-T-i)/o)),this.#i.set([D,x,a,c,l,u],6),!this.isEmpty()):(this.#i.set([D,x,a,c,l,u],6),Math.abs(Math.atan2(x-c,D-a)-Math.atan2(E,b))<Math.PI/2?([a,c,l,u]=this.#i.subarray(2,6),this.#s.push(NaN,NaN,NaN,NaN,((a+l)/2-r)/s,((c+u)/2-i)/o),[a,c,D,x]=this.#i.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((D+a)/2-r)/s,((x+c)/2-i)/o),!0):([D,x,a,c,l,u]=this.#i.subarray(0,6),this.#s.push(((D+5*a)/6-r)/s,((x+5*c)/6-i)/o,((5*a+l)/6-r)/s,((5*c+u)/6-i)/o,((a+l)/2-r)/s,((c+u)/2-i)/o),[l,u,a,c,D,x]=this.#i.subarray(12,18),this.#t.push(((D+5*a)/6-r)/s,((x+5*c)/6-i)/o,((5*a+l)/6-r)/s,((5*c+u)/6-i)/o,((a+l)/2-r)/s,((c+u)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";let e=this.#s,t=this.#t;if(isNaN(this.#i[6])&&!this.isEmpty())return this.#y();let r=[];r.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?r.push(`L${e[i+4]} ${e[i+5]}`):r.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);this.#_(r);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?r.push(`L${t[i+4]} ${t[i+5]}`):r.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return this.#w(r),r.join(" ")}#y(){let[e,t,r,i]=this.#e,[s,o,a,c]=this.#m();return`M${(this.#i[2]-e)/r} ${(this.#i[3]-t)/i} L${(this.#i[4]-e)/r} ${(this.#i[5]-t)/i} L${s} ${o} L${a} ${c} L${(this.#i[16]-e)/r} ${(this.#i[17]-t)/i} L${(this.#i[14]-e)/r} ${(this.#i[15]-t)/i} Z`}#w(e){let t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#_(e){let[t,r,i,s]=this.#e,o=this.#i.subarray(4,6),a=this.#i.subarray(16,18),[c,l,u,d]=this.#m();e.push(`L${(o[0]-t)/i} ${(o[1]-r)/s} L${c} ${l} L${u} ${d} L${(a[0]-t)/i} ${(a[1]-r)/s}`)}newFreeDrawOutline(e,t,r,i,s,o){return new Lg(e,t,r,i,s,o)}getOutlines(){let e=this.#s,t=this.#t,r=this.#i,[i,s,o,a]=this.#e,c=new Float32Array((this.#f?.length??0)+2);for(let d=0,f=c.length-2;d<f;d+=2)c[d]=(this.#f[d]-i)/o,c[d+1]=(this.#f[d+1]-s)/a;if(c[c.length-2]=(this.#c-i)/o,c[c.length-1]=(this.#a-s)/a,isNaN(r[6])&&!this.isEmpty())return this.#b(c);let l=new Float32Array(this.#s.length+24+this.#t.length),u=e.length;for(let d=0;d<u;d+=2){if(isNaN(e[d])){l[d]=l[d+1]=NaN;continue}l[d]=e[d],l[d+1]=e[d+1]}u=this.#T(l,u);for(let d=t.length-6;d>=6;d-=6)for(let f=0;f<6;f+=2){if(isNaN(t[d+f])){l[u]=l[u+1]=NaN,u+=2;continue}l[u]=t[d+f],l[u+1]=t[d+f+1],u+=2}return this.#I(l,u),this.newFreeDrawOutline(l,c,this.#e,this.#h,this.#n,this.#r)}#b(e){let t=this.#i,[r,i,s,o]=this.#e,[a,c,l,u]=this.#m(),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-r)/s,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-r)/s,(t[5]-i)/o,NaN,NaN,NaN,NaN,a,c,NaN,NaN,NaN,NaN,l,u,NaN,NaN,NaN,NaN,(t[16]-r)/s,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-r)/s,(t[15]-i)/o],0),this.newFreeDrawOutline(d,e,this.#e,this.#h,this.#n,this.#r)}#I(e,t){let r=this.#t;return e.set([NaN,NaN,NaN,NaN,r[4],r[5]],t),t+=6}#T(e,t){let r=this.#i.subarray(4,6),i=this.#i.subarray(16,18),[s,o,a,c]=this.#e,[l,u,d,f]=this.#m();return e.set([NaN,NaN,NaN,NaN,(r[0]-s)/a,(r[1]-o)/c,NaN,NaN,NaN,NaN,l,u,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(i[0]-s)/a,(i[1]-o)/c],t),t+=24}},Lg=class extends X{#e;#t=new Float32Array(4);#n;#r;#s;#i;#c;constructor(e,t,r,i,s,o){super(),this.#c=e,this.#s=t,this.#e=r,this.#i=i,this.#n=s,this.#r=o,this.lastPoint=[NaN,NaN],this.#a(o);let[a,c,l,u]=this.#t;for(let d=0,f=e.length;d<f;d+=2)e[d]=(e[d]-a)/l,e[d+1]=(e[d+1]-c)/u;for(let d=0,f=t.length;d<f;d+=2)t[d]=(t[d]-a)/l,t[d+1]=(t[d+1]-c)/u}toSVGPath(){let e=[`M${this.#c[4]} ${this.#c[5]}`];for(let t=6,r=this.#c.length;t<r;t+=6){if(isNaN(this.#c[t])){e.push(`L${this.#c[t+4]} ${this.#c[t+5]}`);continue}e.push(`C${this.#c[t]} ${this.#c[t+1]} ${this.#c[t+2]} ${this.#c[t+3]} ${this.#c[t+4]} ${this.#c[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,r,i],s){let o=r-e,a=i-t,c,l;switch(s){case 0:c=X._rescale(this.#c,e,i,o,-a),l=X._rescale(this.#s,e,i,o,-a);break;case 90:c=X._rescaleAndSwap(this.#c,e,t,o,a),l=X._rescaleAndSwap(this.#s,e,t,o,a);break;case 180:c=X._rescale(this.#c,r,t,-o,a),l=X._rescale(this.#s,r,t,-o,a);break;case 270:c=X._rescaleAndSwap(this.#c,r,i,-o,-a),l=X._rescaleAndSwap(this.#s,r,i,-o,-a);break}return{outline:Array.from(c),points:[Array.from(l)]}}#a(e){let t=this.#c,r=t[4],i=t[5],s=r,o=i,a=r,c=i,l=r,u=i,d=e?Math.max:Math.min;for(let p=6,y=t.length;p<y;p+=6){if(isNaN(t[p]))s=Math.min(s,t[p+4]),o=Math.min(o,t[p+5]),a=Math.max(a,t[p+4]),c=Math.max(c,t[p+5]),u<t[p+5]?(l=t[p+4],u=t[p+5]):u===t[p+5]&&(l=d(l,t[p+4]));else{let w=se.bezierBoundingBox(r,i,...t.slice(p,p+6));s=Math.min(s,w[0]),o=Math.min(o,w[1]),a=Math.max(a,w[2]),c=Math.max(c,w[3]),u<w[3]?(l=w[2],u=w[3]):u===w[3]&&(l=d(l,w[2]))}r=t[p+4],i=t[p+5]}let f=this.#t;f[0]=s-this.#n,f[1]=o-this.#n,f[2]=a-s+2*this.#n,f[3]=c-o+2*this.#n,this.lastPoint=[l,u]}get box(){return this.#t}newOutliner(e,t,r,i,s,o=0){return new kg(e,t,r,i,s,o)}getNewOutline(e,t){let[r,i,s,o]=this.#t,[a,c,l,u]=this.#e,d=s*l,f=o*u,p=r*l+a,y=i*u+c,w=this.newOutliner({x:this.#s[0]*d+p,y:this.#s[1]*f+y},this.#e,this.#i,e,this.#r,t??this.#n);for(let b=2;b<this.#s.length;b+=2)w.add({x:this.#s[b]*d+p,y:this.#s[b+1]*f+y});return w.getOutlines()}},Bd=class{#e;#t;#n=[];#r=[];constructor(e,t=0,r=0,i=!0){let s=1/0,o=-1/0,a=1/0,c=-1/0,u=10**-4;for(let{x:E,y:D,width:x,height:N}of e){let L=Math.floor((E-t)/u)*u,F=Math.ceil((E+x+t)/u)*u,T=Math.floor((D-t)/u)*u,A=Math.ceil((D+N+t)/u)*u,C=[L,T,A,!0],R=[F,T,A,!1];this.#n.push(C,R),s=Math.min(s,L),o=Math.max(o,F),a=Math.min(a,T),c=Math.max(c,A)}let d=o-s+2*r,f=c-a+2*r,p=s-r,y=a-r,w=this.#n.at(i?-1:-2),b=[w[0],w[2]];for(let E of this.#n){let[D,x,N]=E;E[0]=(D-p)/d,E[1]=(x-y)/f,E[2]=(N-y)/f}this.#e=new Float32Array([p,y,d,f]),this.#t=b}getOutlines(){this.#n.sort((t,r)=>t[0]-r[0]||t[1]-r[1]||t[2]-r[2]);let e=[];for(let t of this.#n)t[3]?(e.push(...this.#u(t)),this.#c(t)):(this.#a(t),e.push(...this.#u(t)));return this.#s(e)}#s(e){let t=[],r=new Set;for(let o of e){let[a,c,l]=o;t.push([a,c,o],[a,l,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){let c=t[o][2],l=t[o+1][2];c.push(l),l.push(c),r.add(c),r.add(l)}let i=[],s;for(;r.size>0;){let o=r.values().next().value,[a,c,l,u,d]=o;r.delete(o);let f=a,p=c;for(s=[a,l],i.push(s);;){let y;if(r.has(u))y=u;else if(r.has(d))y=d;else break;r.delete(y),[a,c,l,u,d]=y,f!==a&&(s.push(f,p,a,p===c?c:l),f=a),p=p===c?l:c}s.push(f,p)}return new oC(i,this.#e,this.#t)}#i(e){let t=this.#r,r=0,i=t.length-1;for(;r<=i;){let s=r+i>>1,o=t[s][0];if(o===e)return s;o<e?r=s+1:i=s-1}return i+1}#c([,e,t]){let r=this.#i(e);this.#r.splice(r,0,[e,t])}#a([,e,t]){let r=this.#i(e);for(let i=r;i<this.#r.length;i++){let[s,o]=this.#r[i];if(s!==e)break;if(s===e&&o===t){this.#r.splice(i,1);return}}for(let i=r-1;i>=0;i--){let[s,o]=this.#r[i];if(s!==e)break;if(s===e&&o===t){this.#r.splice(i,1);return}}}#u(e){let[t,r,i]=e,s=[[t,r,i]],o=this.#i(i);for(let a=0;a<o;a++){let[c,l]=this.#r[a];for(let u=0,d=s.length;u<d;u++){let[,f,p]=s[u];if(!(l<=f||p<=c)){if(f>=c){if(p>l)s[u][1]=l;else{if(d===1)return[];s.splice(u,1),u--,d--}continue}s[u][2]=c,p>l&&s.push([t,l,p])}}}return s}},oC=class extends X{#e;#t;constructor(e,t,r){super(),this.#t=e,this.#e=t,this.lastPoint=r}toSVGPath(){let e=[];for(let t of this.#t){let[r,i]=t;e.push(`M${r} ${i}`);for(let s=2;s<t.length;s+=2){let o=t[s],a=t[s+1];o===r?(e.push(`V${a}`),i=a):a===i&&(e.push(`H${o}`),r=o)}e.push("Z")}return e.join(" ")}serialize([e,t,r,i],s){let o=[],a=r-e,c=i-t;for(let l of this.#t){let u=new Array(l.length);for(let d=0;d<l.length;d+=2)u[d]=e+l[d]*a,u[d+1]=i-l[d+1]*c;o.push(u)}return o}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}},Hd=class extends kg{newFreeDrawOutline(e,t,r,i,s,o){return new aC(e,t,r,i,s,o)}},aC=class extends Lg{newOutliner(e,t,r,i,s,o=0){return new Hd(e,t,r,i,s,o)}},Fg=class n{#e=null;#t=null;#n;#r=null;#s=!1;#i=!1;#c=null;#a;#u=null;#l=null;#h;static#d=null;static get _keyboardManager(){return Le(this,"_keyboardManager",new Ea([[["Escape","mac+Escape"],n.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],n.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],n.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],n.prototype._moveToPrevious],[["Home","mac+Home"],n.prototype._moveToBeginning],[["End","mac+End"],n.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#i=!1,this.#h=We.HIGHLIGHT_COLOR,this.#c=e):(this.#i=!0,this.#h=We.HIGHLIGHT_DEFAULT_COLOR),this.#l=e?._uiManager||t,this.#a=this.#l._eventBus,this.#n=e?.color||this.#l?.highlightColors.values().next().value||"#FFFF98",n.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=this.#l._signal;e.addEventListener("click",this.#g.bind(this),{signal:t}),e.addEventListener("keydown",this.#p.bind(this),{signal:t});let r=this.#t=document.createElement("span");return r.className="swatch",r.setAttribute("aria-hidden",!0),r.style.backgroundColor=this.#n,e.append(r),e}renderMainDropdown(){let e=this.#r=this.#f();return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}#f(){let e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",ei,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[r,i]of this.#l.highlightColors){let s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",i),s.title=r,s.setAttribute("data-l10n-id",n.#d[r]);let o=document.createElement("span");s.append(o),o.className="swatch",o.style.backgroundColor=i,s.setAttribute("aria-selected",i===this.#n),s.addEventListener("click",this.#o.bind(this,i),{signal:t}),e.append(s)}return e.addEventListener("keydown",this.#p.bind(this),{signal:t}),e}#o(e,t){t.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:this.#h,value:e})}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#g(e);return}let t=e.target.getAttribute("data-color");t&&this.#o(t,e)}_moveToNext(e){if(!this.#y){this.#g(e);return}if(e.target===this.#e){this.#r.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#r?.firstChild||e.target===this.#e){this.#y&&this._hideDropdownFromKeyboard();return}this.#y||this.#g(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#y){this.#g(e);return}this.#r.firstChild?.focus()}_moveToEnd(e){if(!this.#y){this.#g(e);return}this.#r.lastChild?.focus()}#p(e){n._keyboardManager.exec(this,e)}#g(e){if(this.#y){this.hideDropdown();return}if(this.#s=e.detail===0,this.#u||(this.#u=new AbortController,window.addEventListener("pointerdown",this.#m.bind(this),{signal:this.#l.combinedSignal(this.#u)})),this.#r){this.#r.classList.remove("hidden");return}let t=this.#r=this.#f();this.#e.append(t)}#m(e){this.#r?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#r?.classList.add("hidden"),this.#u?.abort(),this.#u=null}get#y(){return this.#r&&!this.#r.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#i){if(!this.#y){this.#c?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#s})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#r)return;let t=this.#l.highlightColors.values();for(let r of this.#r.children)r.setAttribute("aria-selected",t.next().value===e)}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#r?.remove(),this.#r=null}},Vg=class n extends It{#e=null;#t=0;#n;#r=null;#s=null;#i=null;#c=null;#a=0;#u=null;#l=null;#h=null;#d=!1;#f=null;#o;#p=null;#g="";#m;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=De.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let e=n.prototype;return Le(this,"_keyboardManager",new Ea([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super(P(_({},e),{name:"highlightEditor"})),this.color=e.color||n._defaultColor,this.#m=e.thickness||n._defaultThickness,this.#o=e.opacity||n._defaultOpacity,this.#n=e.boxes||null,this.#y=e.methodOfCreation||"",this.#g=e.text||"",this._isDraggable=!1,e.highlightId>-1?(this.#d=!0,this.#_(e),this.#x()):this.#n&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#c=e.focusNode,this.#a=e.focusOffset,this.#w(),this.#x(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#m,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#w(){let e=new Bd(this.#n,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;let t=new Bd(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#i=t.getOutlines();let{lastPoint:r}=this.#i;this.#f=[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height]}#_({highlightOutlines:e,highlightId:t,clipPathId:r}){this.#l=e;let i=1.5;if(this.#i=e.getNewOutline(this.#m/2+i,.0025),t>=0)this.#h=t,this.#r=r,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},!0);else if(this.parent){let u=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#h,{bbox:n.#E(this.#l.box,(u-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:n.#E(this.#i.box,u),path:{d:this.#i.toSVGPath()}})}let[s,o,a,c]=e.box;switch(this.rotation){case 0:this.x=s,this.y=o,this.width=a,this.height=c;break;case 90:{let[u,d]=this.parentDimensions;this.x=o,this.y=1-s,this.width=a*d/u,this.height=c*u/d;break}case 180:this.x=1-s,this.y=1-o,this.width=a,this.height=c;break;case 270:{let[u,d]=this.parentDimensions;this.x=1-o,this.y=s,this.width=a*d/u,this.height=c*u/d;break}}let{lastPoint:l}=this.#i;this.#f=[(l[0]-s)/a,(l[1]-o)/c]}static initialize(e,t){It.initialize(e,t),n._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case We.HIGHLIGHT_DEFAULT_COLOR:n._defaultColor=t;break;case We.HIGHLIGHT_THICKNESS:n._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#f}updateParams(e,t){switch(e){case We.HIGHLIGHT_COLOR:this.#b(t);break;case We.HIGHLIGHT_THICKNESS:this.#I(t);break}}static get defaultPropertiesToUpdate(){return[[We.HIGHLIGHT_DEFAULT_COLOR,n._defaultColor],[We.HIGHLIGHT_THICKNESS,n._defaultThickness]]}get propertiesToUpdate(){return[[We.HIGHLIGHT_COLOR,this.color||n._defaultColor],[We.HIGHLIGHT_THICKNESS,this.#m||n._defaultThickness],[We.HIGHLIGHT_FREE,this.#d]]}#b(e){let t=(s,o)=>{this.color=s,this.#o=o,this.parent?.drawLayer.updateProperties(this.#h,{root:{fill:s,"fill-opacity":o}}),this.#s?.updateColor(s)},r=this.color,i=this.#o;this.addCommands({cmd:t.bind(this,e,n._defaultOpacity),undo:t.bind(this,r,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}#I(e){let t=this.#m,r=i=>{this.#m=i,this.#T(i)};this.addCommands({cmd:r.bind(this,e),undo:r.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:We.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}addEditToolbar(){return g(this,null,function*(){let e=yield Kt(n.prototype,this,"addEditToolbar").call(this);return e?(this._uiManager.highlightColors&&(this.#s=new Fg({editor:this}),e.addColorPicker(this.#s)),e):null})}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#P())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#P())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#S(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#x(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#S():e&&(this.#x(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#T(e){if(!this.#d)return;this.#_({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition();let[t,r]=this.parentDimensions;this.setDims(this.width*t,this.height*r)}#S(){this.#h===null||!this.parent||(this.parent.drawLayer.remove(this.#h),this.#h=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#x(e=this.parent){this.#h===null&&({id:this.#h,clipPathId:this.#r}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#o},rootClass:{highlight:!0,free:this.#d},path:{d:this.#l.toSVGPath()}},!1,!0),this.#p=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},this.#d),this.#u&&(this.#u.style.clipPath=this.#r))}static#E([e,t,r,i],s){switch(s){case 90:return[1-t-i,e,i,r];case 180:return[1-e-r,1-t-i,r,i];case 270:return[t,1-e-r,i,r]}return[e,t,r,i]}rotate(e){let{drawLayer:t}=this.parent,r;this.#d?(e=(e-this.rotation+360)%360,r=n.#E(this.#l.box,e)):r=n.#E([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#h,{bbox:r,root:{"data-main-rotation":e}}),t.updateProperties(this.#p,{bbox:n.#E(this.#i.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;let e=super.render();this.#g&&(e.setAttribute("aria-label",this.#g),e.setAttribute("role","mark")),this.#d?e.classList.add("free"):this.div.addEventListener("keydown",this.#D.bind(this),{signal:this._uiManager._signal});let t=this.#u=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#r;let[r,i]=this.parentDimensions;return this.setDims(this.width*r,this.height*i),fg(this,this.#u,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#D(e){n._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#C(!0);break;case 1:case 3:this.#C(!1);break}}#C(e){if(!this.#e)return;let t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#c,this.#a)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#d||this.#C(!1))}get _mustFixPosition(){return!this.#d}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#h,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!e}}))}#P(){return this.#d?this.rotation:0}#O(){if(this.#d)return null;let[e,t]=this.pageDimensions,[r,i]=this.pageTranslation,s=this.#n,o=new Float32Array(s.length*8),a=0;for(let{x:c,y:l,width:u,height:d}of s){let f=c*e+r,p=(1-l)*t+i;o[a]=o[a+4]=f,o[a+1]=o[a+3]=p,o[a+2]=o[a+6]=f+u*e,o[a+5]=o[a+7]=p-d*t,a+=8}return o}#L(e){return this.#l.serialize(e,this.#P())}static startHighlighting(e,t,{target:r,x:i,y:s}){let{x:o,y:a,width:c,height:l}=r.getBoundingClientRect(),u=new AbortController,d=e.combinedSignal(u),f=p=>{u.abort(),this.#v(e,p)};window.addEventListener("blur",f,{signal:d}),window.addEventListener("pointerup",f,{signal:d}),window.addEventListener("pointerdown",hr,{capture:!0,passive:!1,signal:d}),window.addEventListener("contextmenu",ei,{signal:d}),r.addEventListener("pointermove",this.#A.bind(this,e),{signal:d}),this._freeHighlight=new Hd({x:i,y:s},[o,a,c,l],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#A(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#v(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(e,t,r){return g(this,null,function*(){let i=null;if(e instanceof Ng){let{data:{quadPoints:y,rect:w,rotation:b,id:E,color:D,opacity:x,popupRef:N},parent:{page:{pageNumber:L}}}=e;i=e={annotationType:De.HIGHLIGHT,color:Array.from(D),opacity:x,quadPoints:y,boxes:null,pageIndex:L-1,rect:w.slice(0),rotation:b,id:E,deleted:!1,popupRef:N}}else if(e instanceof Ud){let{data:{inkLists:y,rect:w,rotation:b,id:E,color:D,borderStyle:{rawWidth:x},popupRef:N},parent:{page:{pageNumber:L}}}=e;i=e={annotationType:De.HIGHLIGHT,color:Array.from(D),thickness:x,inkLists:y,boxes:null,pageIndex:L-1,rect:w.slice(0),rotation:b,id:E,deleted:!1,popupRef:N}}let{color:s,quadPoints:o,inkLists:a,opacity:c}=e,l=yield Kt(n,this,"deserialize").call(this,e,t,r);l.color=se.makeHexColor(...s),l.#o=c||1,a&&(l.#m=e.thickness),l.annotationElementId=e.id||null,l._initialData=i;let[u,d]=l.pageDimensions,[f,p]=l.pageTranslation;if(o){let y=l.#n=[];for(let w=0;w<o.length;w+=8)y.push({x:(o[w]-f)/u,y:1-(o[w+1]-p)/d,width:(o[w+2]-o[w])/u,height:(o[w+1]-o[w+5])/d});l.#w(),l.#x(),l.rotate(l.rotation)}else if(a){l.#d=!0;let y=a[0],w={x:y[0]-f,y:d-(y[1]-p)},b=new Hd(w,[0,0,u,d],1,l.#m/2,!0,.001);for(let x=0,N=y.length;x<N;x+=2)w.x=y[x]-f,w.y=d-(y[x+1]-p),b.add(w);let{id:E,clipPathId:D}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:l.color,"fill-opacity":l._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:b.toSVGPath()}},!0,!0);l.#_({highlightOutlines:b.getOutlines(),highlightId:E,clipPathId:D}),l.#x()}return l})}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();let t=this.getRect(0,0),r=It._colorManager.convert(this.color),i={annotationType:De.HIGHLIGHT,color:r,opacity:this.#o,thickness:this.#m,quadPoints:this.#O(),outlines:this.#L(t),pageIndex:this.pageIndex,rect:t,rotation:this.#P(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#N(i)?null:(i.id=this.annotationElementId,i)}#N(e){let{color:t}=this._initialData;return e.color.some((r,i)=>r!==t[i])}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}},cC=class{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,r]of Object.entries(e))this.updateProperty(t,r)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){let e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){ft("Not implemented")}},TX=(()=>{class n extends It{#e=null;#t;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#r=null;static#s=null;static#i=NaN;static#c=null;static#a=null;static#u=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#t=t.mustBeCommitted||!1,t.drawOutlines&&(this.#l(t),this.#f())}#l({drawOutlines:t,drawId:r,drawingOptions:i}){this.#e=t,this._drawingOptions||=i,r>=0?(this._drawId=r,this.parent.drawLayer.finalizeDraw(r,t.defaultProperties)):this._drawId=this.#h(t,this.parent),this.#g(t.box)}#h(t,r){let{id:i}=r.drawLayer.draw(n._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i}static _mergeSVGProperties(t,r){let i=new Set(Object.keys(t));for(let[s,o]of Object.entries(r))i.has(s)?Object.assign(t[s],o):t[s]=o;return t}static getDefaultDrawingOptions(t){ft("Not implemented")}static get typesMap(){ft("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,r){let i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,r),this._currentParent&&(n.#n.updateProperty(i,r),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,r){let i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,r)}static get defaultPropertiesToUpdate(){let t=[],r=this._defaultDrawingOptions;for(let[i,s]of this.typesMap)t.push([i,r[s]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:r}=this;for(let[i,s]of this.constructor.typesMap)t.push([i,r[s]]);return t}_updateProperty(t,r,i){let s=this._drawingOptions,o=s[r],a=c=>{s.updateProperty(r,c);let l=this.#e.updateProperty(r,c);l&&this.#g(l),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties())};this.addCommands({cmd:a.bind(this,i),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,n._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#p()),{bbox:this.#m()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,n._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#p()),{bbox:this.#m()}))}_onTranslating(t,r){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#m(t,r)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,n._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#m()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#d(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#g(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let r=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#d()):t&&(this._uiManager.addShouldRescale(this),this.#f(t),r=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),r&&this.select()}#d(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#h(this.#e,t)}}#o([t,r,i,s]){let{parentDimensions:[o,a],rotation:c}=this;switch(c){case 90:return[r,1-t,i*(a/o),s*(o/a)];case 180:return[1-t,1-r,i,s];case 270:return[1-r,t,i*(a/o),s*(o/a)];default:return[t,r,i,s]}}#p(){let{x:t,y:r,width:i,height:s,parentDimensions:[o,a],rotation:c}=this;switch(c){case 90:return[1-r,t,i*(o/a),s*(a/o)];case 180:return[1-t,1-r,i,s];case 270:return[r,1-t,i*(o/a),s*(a/o)];default:return[t,r,i,s]}}#g(t){if([this.x,this.y,this.width,this.height]=this.#o(t),this.div){this.fixAndSetPosition();let[r,i]=this.parentDimensions;this.setDims(this.width*r,this.height*i)}this._onResized()}#m(){let{x:t,y:r,width:i,height:s,rotation:o,parentRotation:a,parentDimensions:[c,l]}=this;switch((o*4+a)/90){case 1:return[1-r-s,t,s,i];case 2:return[1-t-i,1-r-s,i,s];case 3:return[r,1-t-i,s,i];case 4:return[t,r-i*(c/l),s*(l/c),i*(c/l)];case 5:return[1-r,t,i*(c/l),s*(l/c)];case 6:return[1-t-s*(l/c),1-r,s*(l/c),i*(c/l)];case 7:return[r-i*(c/l),1-t-s*(l/c),i*(c/l),s*(l/c)];case 8:return[t-i,r-s,i,s];case 9:return[1-r,t-i,s,i];case 10:return[1-t,1-r,i,s];case 11:return[r-s,1-t,s,i];case 12:return[t-s*(l/c),r,s*(l/c),i*(c/l)];case 13:return[1-r-i*(c/l),t-s*(l/c),i*(c/l),s*(l/c)];case 14:return[1-t,1-r-i*(c/l),s*(l/c),i*(c/l)];case 15:return[r,1-t,i*(c/l),s*(l/c)];default:return[t,r,i,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,n._mergeSVGProperties({bbox:this.#m()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#g(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let r=document.createElement("div");t.append(r),r.setAttribute("aria-hidden","true"),r.className="internal";let[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,r,i,s,o){ft("Not implemented")}static startDrawing(t,r,i,s){let{target:o,offsetX:a,offsetY:c,pointerId:l,pointerType:u}=s;if(n.#c&&n.#c!==u)return;let{viewport:{rotation:d}}=t,{width:f,height:p}=o.getBoundingClientRect(),y=n.#r=new AbortController,w=t.combinedSignal(y);if(n.#i||=l,n.#c??=u,window.addEventListener("pointerup",b=>{n.#i===b.pointerId?this._endDraw(b):n.#a?.delete(b.pointerId)},{signal:w}),window.addEventListener("pointercancel",b=>{n.#i===b.pointerId?this._currentParent.endDrawingSession():n.#a?.delete(b.pointerId)},{signal:w}),window.addEventListener("pointerdown",b=>{n.#c===b.pointerType&&((n.#a||=new Set).add(b.pointerId),n.#n.isCancellable()&&(n.#n.removeLastElement(),n.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:w}),window.addEventListener("contextmenu",ei,{signal:w}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:w}),o.addEventListener("touchmove",b=>{b.timeStamp===n.#u&&hr(b)},{signal:w}),t.toggleDrawing(),r._editorUndoBar?.hide(),n.#n){t.drawLayer.updateProperties(this._currentDrawId,n.#n.startNew(a,c,f,p,d));return}r.updateUIForDefaultProperties(this),n.#n=this.createDrawerInstance(a,c,f,p,d),n.#s=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(n.#s.toSVGProperties(),n.#n.defaultSVGProperties),!0,!1)}static _drawMove(t){if(n.#u=-1,!n.#n)return;let{offsetX:r,offsetY:i,pointerId:s}=t;if(n.#i===s){if(n.#a?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,n.#n.add(r,i)),n.#u=t.timeStamp,hr(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,n.#n=null,n.#s=null,n.#c=null,n.#u=NaN),n.#r&&(n.#r.abort(),n.#r=null,n.#i=NaN,n.#a=null)}static _endDraw(t){let r=this._currentParent;if(r){if(r.toggleDrawing(!0),this._cleanup(!1),t&&r.drawLayer.updateProperties(this._currentDrawId,n.#n.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){let i=n.#n,s=this._currentDrawId,o=i.getLastElement();r.addCommands({cmd:()=>{r.drawLayer.updateProperties(s,i.setLastElement(o))},undo:()=>{r.drawLayer.updateProperties(s,i.removeLastElement())},mustExec:!1,type:We.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){let r=this._currentParent;if(!r)return null;if(r.toggleDrawing(!0),r.cleanUndoStack(We.DRAW_STEP),!n.#n.isEmpty()){let{pageDimensions:[i,s],scale:o}=r,a=r.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:n.#n.getOutlines(i*o,s*o,o,this._INNER_MARGIN),drawingOptions:n.#s,mustBeCommitted:!t});return this._cleanup(!0),a}return r.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,r,i,s,o,a){ft("Not implemented")}static deserialize(t,r,i){return g(this,null,function*(){let{rawDims:{pageWidth:s,pageHeight:o,pageX:a,pageY:c}}=r.viewport,l=this.deserializeDraw(a,c,s,o,this._INNER_MARGIN,t),u=yield Kt(n,this,"deserialize").call(this,t,r,i);return u.createDrawingOptions(t),u.#l({drawOutlines:l}),u.#f(),u.onScaleChanging(),u.rotate(),u})}serializeDraw(t){let[r,i]=this.pageTranslation,[s,o]=this.pageDimensions;return this.#e.serialize([r,i,s,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}return n})(),lC=class{#e=new Float64Array(6);#t;#n;#r;#s;#i;#c="";#a=0;#u=new jg;#l;#h;constructor(e,t,r,i,s,o){this.#l=r,this.#h=i,this.#r=s,this.#s=o,[e,t]=this.#d(e,t);let a=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#i=[e,t],this.#n=[{line:a,points:this.#i}],this.#e.set(a,0)}updateProperty(e,t){e==="stroke-width"&&(this.#s=t)}#d(e,t){return X._normalizePoint(e,t,this.#l,this.#h,this.#r)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#i.length<=10}add(e,t){[e,t]=this.#d(e,t);let[r,i,s,o]=this.#e.subarray(2,6),a=e-s,c=t-o;return Math.hypot(this.#l*a,this.#h*c)<=2?null:(this.#i.push(e,t),isNaN(r)?(this.#e.set([s,o,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([r,i,s,o,e,t],0),this.#t.push(...X.createBezierPoints(r,i,s,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let r=this.add(e,t);return r||(this.#i.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,r,i,s){this.#l=r,this.#h=i,this.#r=s,[e,t]=this.#d(e,t);let o=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#i=[e,t];let a=this.#n.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#n.push({line:o,points:this.#i}),this.#e.set(o,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(e){return this.#n?(this.#n.push(e),this.#t=e.line,this.#i=e.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#u.setLastElement(e)}removeLastElement(){if(!this.#n)return this.#u.removeLastElement();this.#n.pop(),this.#c="";for(let e=0,t=this.#n.length;e<t;e++){let{line:r,points:i}=this.#n[e];this.#t=r,this.#i=i,this.#a=0,this.toSVGPath()}return{path:{d:this.#c}}}toSVGPath(){let e=X.svgRound(this.#t[4]),t=X.svgRound(this.#t[5]);if(this.#i.length===2)return this.#c=`${this.#c} M ${e} ${t} Z`,this.#c;if(this.#i.length<=6){let i=this.#c.lastIndexOf("M");this.#c=`${this.#c.slice(0,i)} M ${e} ${t}`,this.#a=6}if(this.#i.length===4){let i=X.svgRound(this.#t[10]),s=X.svgRound(this.#t[11]);return this.#c=`${this.#c} L ${i} ${s}`,this.#a=12,this.#c}let r=[];this.#a===0&&(r.push(`M ${e} ${t}`),this.#a=6);for(let i=this.#a,s=this.#t.length;i<s;i+=6){let[o,a,c,l,u,d]=this.#t.slice(i,i+6).map(X.svgRound);r.push(`C${o} ${a} ${c} ${l} ${u} ${d}`)}return this.#c+=r.join(" "),this.#a=this.#t.length,this.#c}getOutlines(e,t,r,i){let s=this.#n.at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),this.#u.build(this.#n,e,t,r,this.#r,this.#s,i),this.#e=null,this.#t=null,this.#n=null,this.#c=null,this.#u}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}},jg=class n extends X{#e;#t=0;#n;#r;#s;#i;#c;#a;#u;build(e,t,r,i,s,o,a){this.#s=t,this.#i=r,this.#c=i,this.#a=s,this.#u=o,this.#n=a??0,this.#r=e,this.#d()}setLastElement(e){return this.#r.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#r.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let e=[];for(let{line:t}of this.#r){if(e.push(`M${X.svgRound(t[4])} ${X.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12){e.push(`L${X.svgRound(t[10])} ${X.svgRound(t[11])}`);continue}for(let r=6,i=t.length;r<i;r+=6){let[s,o,a,c,l,u]=t.subarray(r,r+6).map(X.svgRound);e.push(`C${s} ${o} ${a} ${c} ${l} ${u}`)}}return e.join("")}serialize([e,t,r,i],s){let o=[],a=[],[c,l,u,d]=this.#h(),f,p,y,w,b,E,D,x,N;switch(this.#a){case 0:N=X._rescale,f=e,p=t+i,y=r,w=-i,b=e+c*r,E=t+(1-l-d)*i,D=e+(c+u)*r,x=t+(1-l)*i;break;case 90:N=X._rescaleAndSwap,f=e,p=t,y=r,w=i,b=e+l*r,E=t+c*i,D=e+(l+d)*r,x=t+(c+u)*i;break;case 180:N=X._rescale,f=e+r,p=t,y=-r,w=i,b=e+(1-c-u)*r,E=t+l*i,D=e+(1-c)*r,x=t+(l+d)*i;break;case 270:N=X._rescaleAndSwap,f=e+r,p=t+i,y=-r,w=-i,b=e+(1-l-d)*r,E=t+(1-c-u)*i,D=e+(1-l)*r,x=t+(1-c)*i;break}for(let{line:L,points:F}of this.#r)o.push(N(L,f,p,y,w,s?new Array(L.length):null)),a.push(N(F,f,p,y,w,s?new Array(F.length):null));return{lines:o,points:a,rect:[b,E,D,x]}}static deserialize(e,t,r,i,s,{paths:{lines:o,points:a},rotation:c,thickness:l}){let u=[],d,f,p,y,w;switch(c){case 0:w=X._rescale,d=-e/r,f=t/i+1,p=1/r,y=-1/i;break;case 90:w=X._rescaleAndSwap,d=-t/i,f=-e/r,p=1/i,y=1/r;break;case 180:w=X._rescale,d=e/r+1,f=-t/i,p=-1/r,y=1/i;break;case 270:w=X._rescaleAndSwap,d=t/i+1,f=e/r+1,p=-1/i,y=-1/r;break}if(!o){o=[];for(let E of a){let D=E.length;if(D===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1]]));continue}if(D===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1],NaN,NaN,NaN,NaN,E[2],E[3]]));continue}let x=new Float32Array(3*(D-2));o.push(x);let[N,L,F,T]=E.subarray(0,4);x.set([NaN,NaN,NaN,NaN,N,L],0);for(let A=4;A<D;A+=2){let C=E[A],R=E[A+1];x.set(X.createBezierPoints(N,L,F,T,C,R),(A-2)*3),[N,L,F,T]=[F,T,C,R]}}}for(let E=0,D=o.length;E<D;E++)u.push({line:w(o[E].map(x=>x??NaN),d,f,p,y),points:w(a[E].map(x=>x??NaN),d,f,p,y)});let b=new n;return b.build(u,r,i,1,c,l,s),b}#l(e=this.#u){let t=this.#n+e/2*this.#c;return this.#a%180===0?[t/this.#s,t/this.#i]:[t/this.#i,t/this.#s]}#h(){let[e,t,r,i]=this.#e,[s,o]=this.#l(0);return[e+s,t+o,r-2*s,i-2*o]}#d(){let e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:i}of this.#r){if(i.length<=12){for(let a=4,c=i.length;a<c;a+=6){let[l,u]=i.subarray(a,a+2);e[0]=Math.min(e[0],l),e[1]=Math.min(e[1],u),e[2]=Math.max(e[2],l),e[3]=Math.max(e[3],u)}continue}let s=i[4],o=i[5];for(let a=6,c=i.length;a<c;a+=6){let[l,u,d,f,p,y]=i.subarray(a,a+6);se.bezierBoundingBox(s,o,l,u,d,f,p,y,e),s=p,o=y}}let[t,r]=this.#l();e[0]=Math.min(1,Math.max(0,e[0]-t)),e[1]=Math.min(1,Math.max(0,e[1]-r)),e[2]=Math.min(1,Math.max(0,e[2]+t)),e[3]=Math.min(1,Math.max(0,e[3]+r)),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){let[t,r]=this.#l();this.#u=e;let[i,s]=this.#l(),[o,a]=[i-t,s-r],c=this.#e;return c[0]-=o,c[1]-=a,c[2]+=2*o,c[3]+=2*a,c}updateParentDimensions([e,t],r){let[i,s]=this.#l();this.#s=e,this.#i=t,this.#c=r;let[o,a]=this.#l(),c=o-i,l=a-s,u=this.#e;return u[0]-=c,u[1]-=l,u[2]+=2*c,u[3]+=2*l,u}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(X.svgRound).join(" ")}get defaultProperties(){let[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${X.svgRound(e)} ${X.svgRound(t)}`}}}get rotationTransform(){let[,,e,t]=this.#e,r=0,i=0,s=0,o=0,a=0,c=0;switch(this.#t){case 90:i=t/e,s=-e/t,a=e;break;case 180:r=-1,o=-1,a=e,c=t;break;case 270:i=-t/e,s=e/t,c=t;break;default:return""}return`matrix(${r} ${i} ${s} ${o} ${X.svgRound(a)} ${X.svgRound(c)})`}getPathResizingSVGProperties([e,t,r,i]){let[s,o]=this.#l(),[a,c,l,u]=this.#e;if(Math.abs(l-s)<=X.PRECISION||Math.abs(u-o)<=X.PRECISION){let w=e+r/2-(a+l/2),b=t+i/2-(c+u/2);return{path:{"transform-origin":`${X.svgRound(e)} ${X.svgRound(t)}`,transform:`${this.rotationTransform} translate(${w} ${b})`}}}let d=(r-2*s)/(l-2*s),f=(i-2*o)/(u-2*o),p=l/r,y=u/i;return{path:{"transform-origin":`${X.svgRound(a)} ${X.svgRound(c)}`,transform:`${this.rotationTransform} scale(${p} ${y}) translate(${X.svgRound(s)} ${X.svgRound(o)}) scale(${d} ${f}) translate(${X.svgRound(-s)} ${X.svgRound(-o)})`}}}getPathResizedSVGProperties([e,t,r,i]){let[s,o]=this.#l(),a=this.#e,[c,l,u,d]=a;if(a[0]=e,a[1]=t,a[2]=r,a[3]=i,Math.abs(u-s)<=X.PRECISION||Math.abs(d-o)<=X.PRECISION){let b=e+r/2-(c+u/2),E=t+i/2-(l+d/2);for(let{line:D,points:x}of this.#r)X._translate(D,b,E,D),X._translate(x,b,E,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${X.svgRound(e)} ${X.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let f=(r-2*s)/(u-2*s),p=(i-2*o)/(d-2*o),y=-f*(c+s)+e+s,w=-p*(l+o)+t+o;if(f!==1||p!==1||y!==0||w!==0)for(let{line:b,points:E}of this.#r)X._rescale(b,y,w,f,p,b),X._rescale(E,y,w,f,p,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${X.svgRound(e)} ${X.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],r){let[i,s]=r,o=this.#e,a=e-o[0],c=t-o[1];if(this.#s===i&&this.#i===s)for(let{line:l,points:u}of this.#r)X._translate(l,a,c,l),X._translate(u,a,c,u);else{let l=this.#s/i,u=this.#i/s;this.#s=i,this.#i=s;for(let{line:d,points:f}of this.#r)X._rescale(d,a,c,l,u,d),X._rescale(f,a,c,l,u,f);o[2]*=l,o[3]*=u}return o[0]=e,o[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${X.svgRound(e)} ${X.svgRound(t)}`}}}get defaultSVGProperties(){let e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${X.svgRound(e[0])} ${X.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}},uC=class n extends cC{#e;constructor(e){super(),this.#e=e,super.updateProperties({fill:"none",stroke:It._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this.#e.realScale),super.updateSVGProperty(e,t)}clone(){let e=new n(this.#e);return e.updateAll(this),e}},dC=class n extends TX{static _type="ink";static _editorType=De.INK;static _defaultDrawingOptions=null;constructor(e){super(P(_({},e),{name:"inkEditor"})),this._willKeepAspectRatio=!0}static initialize(e,t){It.initialize(e,t),this._defaultDrawingOptions=new uC(t.viewParameters)}static getDefaultDrawingOptions(e){let t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return Le(this,"typesMap",new Map([[We.INK_THICKNESS,"stroke-width"],[We.INK_COLOR,"stroke"],[We.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,r,i,s){return new lC(e,t,r,i,s,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,r,i,s,o){return jg.deserialize(e,t,r,i,s,o)}static deserialize(e,t,r){return g(this,null,function*(){let i=null;if(e instanceof Ud){let{data:{inkLists:o,rect:a,rotation:c,id:l,color:u,opacity:d,borderStyle:{rawWidth:f},popupRef:p},parent:{page:{pageNumber:y}}}=e;i=e={annotationType:De.INK,color:Array.from(u),thickness:f,opacity:d,paths:{points:o},boxes:null,pageIndex:y-1,rect:a.slice(0),rotation:c,id:l,deleted:!1,popupRef:p}}let s=yield Kt(n,this,"deserialize").call(this,e,t,r);return s.annotationElementId=e.id||null,s._initialData=i,s})}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:e,_drawingOptions:t,parent:r}=this;t.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){let e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:r}){this._drawingOptions=n.getDefaultDrawingOptions({stroke:se.makeHexColor(...e),"stroke-width":t,"stroke-opacity":r})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:t,points:r,rect:i}=this.serializeDraw(e),{_drawingOptions:{stroke:s,"stroke-opacity":o,"stroke-width":a}}=this,c={annotationType:De.INK,color:It._colorManager.convert(s),opacity:o,thickness:a,paths:{lines:t,points:r},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?c:this.annotationElementId&&!this.#e(c)?null:(c.id=this.annotationElementId,c)}#e(e){let{color:t,thickness:r,opacity:i,pageIndex:s}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((o,a)=>o!==t[a])||e.thickness!==r||e.opacity!==i||e.pageIndex!==s}renderAnnotationElement(e){let{points:t,rect:r}=this.serializeDraw(!1);return e.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:t}),null}},hC=class n extends It{#e=null;#t=null;#n=null;#r=null;#s=null;#i="";#c=null;#a=null;#u=!1;#l=!1;static _type="stamp";static _editorType=De.STAMP;constructor(e){super(P(_({},e),{name:"stampEditor"})),this.#r=e.bitmapUrl,this.#s=e.bitmapFile}static initialize(e,t){It.initialize(e,t)}static get supportedTypes(){return Le(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(t=>`image/${t}`))}static get supportedTypesStr(){return Le(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,t){t.pasteEditor(De.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){let t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#h(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#u=e.isSvg),e.file&&(this.#i=e.file.name),this.#o()}#d(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#c){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}mlGuessAltText(e=null,t=!0){return g(this,null,function*(){if(this.hasAltTextData())return null;let{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!(yield r.isEnabledFor("altText")))throw new Error("ML isn't enabled for alt text.");let{data:i,width:s,height:o}=e||this.copyCanvas(null,null,!0).imageData,a=yield r.guess({name:"altText",request:{data:i,width:s,height:o,channels:i.length/(s*o)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");let c=a.output;return yield this.setGuessedAltText(c),t&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c})}#f(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(r=>this.#h(r,!0)).finally(()=>this.#d());return}if(this.#r){let r=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(r).then(i=>this.#h(i)).finally(()=>this.#d());return}if(this.#s){let r=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(r).then(i=>this.#h(i)).finally(()=>this.#d());return}let e=document.createElement("input");e.type="file",e.accept=n.supportedTypesStr;let t=this._uiManager._signal;this.#n=new Promise(r=>{e.addEventListener("change",()=>g(this,null,function*(){if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let i=yield this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(i)}r()}),{signal:t}),e.addEventListener("cancel",()=>{this.remove(),r()},{signal:t})}).finally(()=>this.#d()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#c?.remove(),this.#c=null,this.#a&&(clearTimeout(this.#a),this.#a=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#f();return}super.rebuild(),this.div!==null&&(this.#t&&this.#c===null&&this.#f(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#n||this.#e||this.#r||this.#s||this.#t)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;if(this.width&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#e?this.#o():this.#f(),this.width&&!this.annotationElementId){let[r,i]=this.parentDimensions;this.setAt(e*r,t*i,this.width*r,this.height*i)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#a!==null&&clearTimeout(this.#a);let e=200;this.#a=setTimeout(()=>{this.#a=null,this.#g()},e)}#o(){let{div:e}=this,{width:t,height:r}=this.#e,[i,s]=this.pageDimensions,o=.75;if(this.width)t=this.width*i,r=this.height*s;else if(t>o*i||r>o*s){let u=Math.min(o*i/t,o*s/r);t*=u,r*=u}let[a,c]=this.parentDimensions;this.setDims(t*a/i,r*c/s),this._uiManager.enableWaiting(!1);let l=this.#c=document.createElement("canvas");l.setAttribute("role","img"),this.addContainer(l),this.width=t/i,this.height=r/s,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#g(),this.#l||(this.parent.addUndoableEditor(this),this.#l=!0),this._reportTelemetry({action:"inserted_image"}),this.#i&&l.setAttribute("aria-label",this.#i)}copyCanvas(e,t,r=!1){e||(e=224);let{width:i,height:s}=this.#e,o=new Nd,a=this.#e,c=i,l=s,u=null;if(t){if(i>t||s>t){let F=Math.min(t/i,t/s);c=Math.floor(i*F),l=Math.floor(s*F)}u=document.createElement("canvas");let f=u.width=Math.ceil(c*o.sx),p=u.height=Math.ceil(l*o.sy);this.#u||(a=this.#p(f,p));let y=u.getContext("2d");y.filter=this._uiManager.hcmFilter;let w="white",b="#cfcfd8";this._uiManager.hcmFilter!=="none"?b="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(w="#8f8f9d",b="#42414d");let E=15,D=E*o.sx,x=E*o.sy,N=new OffscreenCanvas(D*2,x*2),L=N.getContext("2d");L.fillStyle=w,L.fillRect(0,0,D*2,x*2),L.fillStyle=b,L.fillRect(0,0,D,x),L.fillRect(D,x,D,x),y.fillStyle=y.createPattern(N,"repeat"),y.fillRect(0,0,f,p),y.drawImage(a,0,0,a.width,a.height,0,0,f,p)}let d=null;if(r){let f,p;if(o.symmetric&&a.width<e&&a.height<e)f=a.width,p=a.height;else if(a=this.#e,i>e||s>e){let b=Math.min(e/i,e/s);f=Math.floor(i*b),p=Math.floor(s*b),this.#u||(a=this.#p(f,p))}let w=new OffscreenCanvas(f,p).getContext("2d",{willReadFrequently:!0});w.drawImage(a,0,0,a.width,a.height,0,0,f,p),d={width:f,height:p,data:w.getImageData(0,0,f,p).data}}return{canvas:u,width:c,height:l,imageData:d}}#p(e,t){let{width:r,height:i}=this.#e,s=r,o=i,a=this.#e;for(;s>2*e||o>2*t;){let c=s,l=o;s>2*e&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));let u=new OffscreenCanvas(s,o);u.getContext("2d").drawImage(a,0,0,c,l,0,0,s,o),a=u.transferToImageBitmap()}return a}#g(){let[e,t]=this.parentDimensions,{width:r,height:i}=this,s=new Nd,o=Math.ceil(r*e*s.sx),a=Math.ceil(i*t*s.sy),c=this.#c;if(!c||c.width===o&&c.height===a)return;c.width=o,c.height=a;let l=this.#u?this.#e:this.#p(o,a),u=c.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(l,0,0,l.width,l.height,0,0,o,a)}getImageForAltText(){return this.#c}#m(e){if(e){if(this.#u){let i=this._uiManager.imageManager.getSvgUrl(this.#t);if(i)return i}let t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#u){let[t,r]=this.pageDimensions,i=Math.round(this.width*t*po.PDF_TO_CSS_UNITS),s=Math.round(this.height*r*po.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(i,s);return o.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,i,s),o.transferToImageBitmap()}return structuredClone(this.#e)}static deserialize(e,t,r){return g(this,null,function*(){let i=null;if(e instanceof Og){let{data:{rect:y,rotation:w,id:b,structParent:E,popupRef:D},container:x,parent:{page:{pageNumber:N}}}=e,L=x.querySelector("canvas"),F=r.imageManager.getFromCanvas(x.id,L);L.remove();let T=(yield t._structTree.getAriaAttributes(`${mC}${b}`))?.get("aria-label")||"";i=e={annotationType:De.STAMP,bitmapId:F.id,bitmap:F.bitmap,pageIndex:N-1,rect:y.slice(0),rotation:w,id:b,deleted:!1,accessibilityData:{decorative:!1,altText:T},isSvg:!1,structParent:E,popupRef:D}}let s=yield Kt(n,this,"deserialize").call(this,e,t,r),{rect:o,bitmap:a,bitmapUrl:c,bitmapId:l,isSvg:u,accessibilityData:d}=e;l&&r.imageManager.isValidId(l)?(s.#t=l,a&&(s.#e=a)):s.#r=c,s.#u=u;let[f,p]=s.pageDimensions;return s.width=(o[2]-o[0])/f,s.height=(o[3]-o[1])/p,s.annotationElementId=e.id||null,d&&(s.altTextData=d),s._initialData=i,s.#l=!!i,s})}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let r={annotationType:De.STAMP,bitmapId:this.#t,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#u,structTreeParentId:this._structTreeParentId};if(e)return r.bitmapUrl=this.#m(!0),r.accessibilityData=this.serializeAltText(!0),r;let{decorative:i,altText:s}=this.serializeAltText(!1);if(!i&&s&&(r.accessibilityData={type:"Figure",alt:s}),this.annotationElementId){let a=this.#y(r);if(a.isSame)return null;a.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1}if(r.id=this.annotationElementId,t===null)return r;t.stamps||=new Map;let o=this.#u?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:o,serialized:r}),r.bitmap=this.#m(!1);else if(this.#u){let a=t.stamps.get(this.#t);o>a.area&&(a.area=o,a.serialized.bitmap.close(),a.serialized.bitmap=this.#m(!1))}return r}#y(e){let{pageIndex:t,accessibilityData:{altText:r}}=this._initialData,i=e.pageIndex===t,s=(e.accessibilityData?.alt||"")===r;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&s,isSameAltText:s}}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}},CX=(()=>{class n{#e;#t=!1;#n=null;#r=null;#s=null;#i=new Map;#c=!1;#a=!1;#u=!1;#l=null;#h=null;#d=null;#f=null;#o;static _initialized=!1;static#p=new Map([sC,dC,hC,Vg].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:r,div:i,structTreeLayer:s,accessibilityManager:o,annotationLayer:a,drawLayer:c,textLayer:l,viewport:u,l10n:d}){let f=[...n.#p.values()];if(!n._initialized){n._initialized=!0;for(let p of f)p.initialize(d,t)}t.registerEditorTypes(f),this.#o=t,this.pageIndex=r,this.div=i,this.#e=o,this.#n=a,this.viewport=u,this.#d=l,this.drawLayer=c,this._structTree=s,this.#o.addLayer(this)}get isEmpty(){return this.#i.size===0}get isInvisible(){return this.isEmpty&&this.#o.getMode()===De.NONE}updateToolbar(t){this.#o.updateToolbar(t)}updateMode(t=this.#o.getMode()){switch(this.#_(),t){case De.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case De.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case De.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:r}=this.div;for(let i of n.#p.values())r.toggle(`${i._type}Editing`,t===i._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#d?.div}setEditingState(t){this.#o.setEditingState(t)}addCommands(t){this.#o.addCommands(t)}cleanUndoStack(t){this.#o.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#n?.div.classList.toggle("disabled",!t)}enable(){return g(this,null,function*(){this.#u=!0,this.div.tabIndex=0,this.togglePointerEvents(!0);let t=new Set;for(let i of this.#i.values())i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#o.removeChangedExistingAnnotation(i),t.add(i.annotationElementId));if(!this.#n){this.#u=!1;return}let r=this.#n.getEditableAnnotations();for(let i of r){if(i.hide(),this.#o.isDeletedAnnotationElement(i.data.id)||t.has(i.data.id))continue;let s=yield this.deserialize(i);s&&(this.addOrRebuild(s),s.enableEditing())}this.#u=!1})}disable(){this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);let t=new Map,r=new Map;for(let s of this.#i.values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){t.set(s.annotationElementId,s);continue}else r.set(s.annotationElementId,s);this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()}if(this.#n){let s=this.#n.getEditableAnnotations();for(let o of s){let{id:a}=o.data;if(this.#o.isDeletedAnnotationElement(a))continue;let c=r.get(a);if(c){c.resetAnnotationElement(o),c.show(!1),o.show();continue}c=t.get(a),c&&(this.#o.addChangedExistingAnnotation(c),c.renderAnnotationElement(o)&&c.show(!1)),o.show()}}this.#_(),this.isEmpty&&(this.div.hidden=!0);let{classList:i}=this.div;for(let s of n.#p.values())i.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#a=!1}getEditableAnnotation(t){return this.#n?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#o.getActive()!==t&&this.#o.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;let t=this.#o.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#g.bind(this),{signal:t}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#g(t){this.#o.unselectAll();let{target:r}=t;if(r===this.#d.div||(r.getAttribute("role")==="img"||r.classList.contains("endOfContent"))&&this.#d.div.contains(r)){let{isMac:i}=ln.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#o.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),Vg.startHighlighting(this,this.#o.direction==="ltr",{target:this.#d.div,x:t.x,y:t.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#o._signal}),t.preventDefault()}}enableClick(){if(this.#r)return;this.#r=new AbortController;let t=this.#o.combinedSignal(this.#r);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});let r=this.pointerup.bind(this);this.div.addEventListener("pointerup",r,{signal:t}),this.div.addEventListener("pointercancel",r,{signal:t})}disableClick(){this.#r?.abort(),this.#r=null}attach(t){this.#i.set(t.id,t);let{annotationElementId:r}=t;r&&this.#o.isDeletedAnnotationElement(r)&&this.#o.removeDeletedAnnotationElement(t)}detach(t){this.#i.delete(t.id),this.#e?.removePointerInTextLayer(t.contentDiv),!this.#a&&t.annotationElementId&&this.#o.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#o.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#o.addDeletedAnnotationElement(t.annotationElementId),It.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#o.addEditor(t),this.attach(t),!t.isAttachedToDOM){let r=t.render();this.div.append(r),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#u),this.#o.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;let{activeElement:r}=document;t.div.contains(r)&&!this.#s&&(t._focusEventsAllowed=!1,this.#s=setTimeout(()=>{this.#s=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#o._signal}),r.focus())},0)),t._structTreeParentId=this.#e?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){let r=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:r,undo:i,mustExec:!1})}getNextId(){return this.#o.getId()}get#m(){return n.#p.get(this.#o.getMode())}combinedSignal(t){return this.#o.combinedSignal(t)}#y(t){let r=this.#m;return r?new r.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#m?.canCreateNewEmptyEditor()}pasteEditor(t,r){this.#o.updateToolbar(t),this.#o.updateMode(t);let{offsetX:i,offsetY:s}=this.#w(),o=this.getNextId(),a=this.#y(_({parent:this,id:o,x:i,y:s,uiManager:this.#o,isCentered:!0},r));a&&this.add(a)}deserialize(t){return g(this,null,function*(){return(yield n.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#o))||null})}createAndAddNewEditor(t,r,i={}){let s=this.getNextId(),o=this.#y(_({parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:this.#o,isCentered:r},i));return o&&this.add(o),o}#w(){let{x:t,y:r,width:i,height:s}=this.div.getBoundingClientRect(),o=Math.max(0,t),a=Math.max(0,r),c=Math.min(window.innerWidth,t+i),l=Math.min(window.innerHeight,r+s),u=(o+c)/2-t,d=(a+l)/2-r,[f,p]=this.viewport.rotation%180===0?[u,d]:[d,u];return{offsetX:f,offsetY:p}}addNewEditor(){this.createAndAddNewEditor(this.#w(),!0)}setSelected(t){this.#o.setSelected(t)}toggleSelected(t){this.#o.toggleSelected(t)}unselect(t){this.#o.unselect(t)}pointerup(t){let{isMac:r}=ln.platform;if(!(t.button!==0||t.ctrlKey&&r)&&t.target===this.div&&this.#c&&(this.#c=!1,!(this.#m?.isDrawer&&this.#m.supportMultipleDrawings))){if(!this.#t){this.#t=!0;return}if(this.#o.getMode()===De.STAMP){this.#o.unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(this.#o.getMode()===De.HIGHLIGHT&&this.enableTextSelection(),this.#c){this.#c=!1;return}let{isMac:r}=ln.platform;if(t.button!==0||t.ctrlKey&&r||t.target!==this.div)return;if(this.#c=!0,this.#m?.isDrawer){this.startDrawingSession(t);return}let i=this.#o.getActive();this.#t=!i||i.isEmpty()}startDrawingSession(t){if(this.div.focus(),this.#l){this.#m.startDrawing(this,this.#o,!1,t);return}this.#o.setCurrentDrawingSession(this),this.#l=new AbortController;let r=this.#o.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(this.#h=null,this.commitOrRemove())},{signal:r}),this.#m.startDrawing(this,this.#o,!1,t)}pause(t){if(t){let{activeElement:r}=document;this.div.contains(r)&&(this.#h=r);return}this.#h&&setTimeout(()=>{this.#h?.focus(),this.#h=null},0)}endDrawingSession(t=!1){return this.#l?(this.#o.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#h=null,this.#m.endDrawing(t)):null}findNewParent(t,r,i){let s=this.#o.findParent(r,i);return s===null||s===this?!1:(s.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#m.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#o.getActive()?.parent===this&&(this.#o.commitOrRemove(),this.#o.setActiveEditor(null)),this.#s&&(clearTimeout(this.#s),this.#s=null);for(let t of this.#i.values())this.#e?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#i.clear(),this.#o.removeLayer(this)}#_(){for(let t of this.#i.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,ba(this.div,t);for(let r of this.#o.getEditors(this.pageIndex))this.add(r),r.rebuild();this.updateMode()}update({viewport:t}){this.#o.commitOrRemove(),this.#_();let r=this.viewport.rotation,i=t.rotation;if(this.viewport=t,ba(this.div,{rotation:i}),r!==i)for(let s of this.#i.values())s.rotate(i)}get pageDimensions(){let{pageWidth:t,pageHeight:r}=this.viewport.rawDims;return[t,r]}get scale(){return this.#o.viewParameters.realScale}}return n})(),fC=class n{#e=null;#t=0;#n=new Map;#r=new Map;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#n.size>0)for(let t of this.#n.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return Le(this,"_svgFactory",new jd)}static#s(e,[t,r,i,s]){let{style:o}=e;o.top=`${100*r}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*s}%`}#i(){let e=n._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#c(e,t){let r=n._svgFactory.createElement("clipPath");e.append(r);let i=`clip_${t}`;r.setAttribute("id",i),r.setAttribute("clipPathUnits","objectBoundingBox");let s=n._svgFactory.createElement("use");return r.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),i}#a(e,t){for(let[r,i]of Object.entries(t))i===null?e.removeAttribute(r):e.setAttribute(r,i)}draw(e,t=!1,r=!1){let i=this.#t++,s=this.#i(),o=n._svgFactory.createElement("defs");s.append(o);let a=n._svgFactory.createElement("path");o.append(a);let c=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",c),a.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#r.set(i,a);let l=r?this.#c(o,c):null,u=n._svgFactory.createElement("use");return s.append(u),u.setAttribute("href",`#${c}`),this.updateProperties(s,e),this.#n.set(i,s),{id:i,clipPathId:`url(#${l})`}}drawOutline(e,t){let r=this.#t++,i=this.#i(),s=n._svgFactory.createElement("defs");i.append(s);let o=n._svgFactory.createElement("path");s.append(o);let a=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let c;if(t){let d=n._svgFactory.createElement("mask");s.append(d),c=`mask_p${this.pageIndex}_${r}`,d.setAttribute("id",c),d.setAttribute("maskUnits","objectBoundingBox");let f=n._svgFactory.createElement("rect");d.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");let p=n._svgFactory.createElement("use");d.append(p),p.setAttribute("href",`#${a}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}let l=n._svgFactory.createElement("use");i.append(l),l.setAttribute("href",`#${a}`),c&&l.setAttribute("mask",`url(#${c})`);let u=l.cloneNode();return i.append(u),l.classList.add("mainOutline"),u.classList.add("secondaryOutline"),this.updateProperties(i,e),this.#n.set(r,i),r}finalizeDraw(e,t){this.#r.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;let{root:r,bbox:i,rootClass:s,path:o}=t,a=typeof e=="number"?this.#n.get(e):e;if(a){if(r&&this.#a(a,r),i&&n.#s(a,i),s){let{classList:c}=a;for(let[l,u]of Object.entries(s))c.toggle(l,u)}if(o){let l=a.firstChild.firstChild;this.#a(l,o)}}}updateParent(e,t){if(t===this)return;let r=this.#n.get(e);r&&(t.#e.append(r),this.#n.delete(e),t.#n.set(e,r))}remove(e){this.#r.delete(e),this.#e!==null&&(this.#n.get(e).remove(),this.#n.delete(e))}destroy(){this.#e=null;for(let e of this.#n.values())e.remove();this.#n.clear(),this.#r.clear()}};globalThis.pdfjsTestingUtils={HighlightOutliner:Bd};var Ige=ye.AbortException,Age=ye.AnnotationEditorLayer,Tge=ye.AnnotationEditorParamsType,Cge=ye.AnnotationEditorType,Sge=ye.AnnotationEditorUIManager,Dge=ye.AnnotationLayer,xge=ye.AnnotationMode,Rge=ye.ColorPicker,Pge=ye.DOMSVGFactory,Mge=ye.DrawLayer,Nge=ye.FeatureTest,qF=ye.GlobalWorkerOptions,Oge=ye.ImageKind,kge=ye.InvalidPDFException,Lge=ye.MissingPDFException,Fge=ye.OPS,Vge=ye.OutputScale,jge=ye.PDFDataRangeTransport,$ge=ye.PDFDateString,Uge=ye.PDFWorker,Bge=ye.PasswordResponses,Hge=ye.PermissionFlag,qge=ye.PixelsPerInch,zge=ye.RenderingCancelledException,Gge=ye.TextLayer,Wge=ye.TouchManager,Kge=ye.UnexpectedResponseException,Yge=ye.Util,Qge=ye.VerbosityLevel,Xge=ye.XfaLayer,Zge=ye.build,Jge=ye.createValidAbsoluteUrl,eye=ye.fetchData,zF=ye.getDocument,tye=ye.getFilenameFromUrl,nye=ye.getPdfFilenameFromUrl,rye=ye.getXfaPageViewport,iye=ye.isDataScheme,sye=ye.isPdfFile,oye=ye.noContextMenu,aye=ye.normalizeUnicode,cye=ye.setLayerDimensions,lye=ye.shadow,uye=ye.stopEvent,dye=ye.version;var Kg=class{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent!==void 0?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}};var _o={};lx(_o,{BRAND:()=>JX,DIRTY:()=>Aa,EMPTY_PATH:()=>PX,INVALID:()=>ue,NEVER:()=>FZ,OK:()=>Tn,ParseStatus:()=>un,Schema:()=>Re,ZodAny:()=>Xg,ZodArray:()=>Wd,ZodBigInt:()=>bC,ZodBoolean:()=>EC,ZodBranded:()=>Kd,ZodCatch:()=>MC,ZodDate:()=>IC,ZodDefault:()=>PC,ZodDiscriminatedUnion:()=>Zg,ZodEffects:()=>wl,ZodEnum:()=>ny,ZodError:()=>Fi,ZodFirstPartyTypeKind:()=>B,ZodFunction:()=>ey,ZodIntersection:()=>SC,ZodIssueCode:()=>U,ZodLazy:()=>DC,ZodLiteral:()=>xC,ZodMap:()=>tV,ZodNaN:()=>iV,ZodNativeEnum:()=>RC,ZodNever:()=>Ta,ZodNull:()=>TC,ZodNullable:()=>bl,ZodNumber:()=>wC,ZodObject:()=>_l,ZodOptional:()=>yo,ZodParsedType:()=>G,ZodPipeline:()=>Yd,ZodPromise:()=>ry,ZodReadonly:()=>NC,ZodRecord:()=>Jg,ZodSchema:()=>Re,ZodSet:()=>nV,ZodString:()=>ty,ZodSymbol:()=>JF,ZodTransformer:()=>wl,ZodTuple:()=>vl,ZodType:()=>Re,ZodUndefined:()=>AC,ZodUnion:()=>CC,ZodUnknown:()=>Gd,ZodVoid:()=>eV,addIssueToContext:()=>z,any:()=>cZ,array:()=>hZ,bigint:()=>rZ,boolean:()=>cV,coerce:()=>LZ,custom:()=>sV,date:()=>iZ,datetimeRegex:()=>ZF,defaultErrorMap:()=>ys,discriminatedUnion:()=>gZ,effect:()=>DZ,enum:()=>TZ,function:()=>EZ,getErrorMap:()=>ml,getParsedType:()=>Li,instanceof:()=>tZ,intersection:()=>yZ,isAborted:()=>Yg,isAsync:()=>gl,isDirty:()=>Qg,isValid:()=>go,late:()=>eZ,lazy:()=>IZ,literal:()=>AZ,makeIssue:()=>zd,map:()=>wZ,nan:()=>nZ,nativeEnum:()=>CZ,never:()=>uZ,null:()=>aZ,nullable:()=>RZ,number:()=>aV,object:()=>fZ,objectUtil:()=>GF,oboolean:()=>kZ,onumber:()=>OZ,optional:()=>xZ,ostring:()=>NZ,pipeline:()=>MZ,preprocess:()=>PZ,promise:()=>SZ,quotelessJson:()=>DX,record:()=>vZ,set:()=>bZ,setErrorMap:()=>RX,strictObject:()=>pZ,string:()=>oV,symbol:()=>sZ,transformer:()=>DZ,tuple:()=>_Z,undefined:()=>oZ,union:()=>mZ,unknown:()=>lZ,util:()=>$e,void:()=>dZ});var $e;(function(n){n.assertEqual=i=>{};function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{let s={};for(let o of i)s[o]=o;return s},n.getValidEnumValues=i=>{let s=n.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(let a of s)o[a]=i[a];return n.objectValues(o)},n.objectValues=i=>n.objectKeys(i).map(function(s){return i[s]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let o in i)Object.prototype.hasOwnProperty.call(i,o)&&s.push(o);return s},n.find=(i,s)=>{for(let o of i)if(s(o))return o},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}n.joinValues=r,n.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})($e||($e={}));var GF=function(n){return n.mergeShapes=(e,t)=>_(_({},e),t),n}(GF||{}),G=$e.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Li=n=>{switch(typeof n){case"undefined":return G.undefined;case"string":return G.string;case"number":return Number.isNaN(n)?G.nan:G.number;case"boolean":return G.boolean;case"function":return G.function;case"bigint":return G.bigint;case"symbol":return G.symbol;case"object":return Array.isArray(n)?G.array:n===null?G.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?G.promise:typeof Map<"u"&&n instanceof Map?G.map:typeof Set<"u"&&n instanceof Set?G.set:typeof Date<"u"&&n instanceof Date?G.date:G.object;default:return G.unknown}};var U=$e.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),DX=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),Fi=(()=>{class n extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){let r=t||function(o){return o.message},i={_errors:[]},s=o=>{for(let a of o.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)i._errors.push(r(a));else{let c=i,l=0;for(;l<a.path.length;){let u=a.path[l];l===a.path.length-1?(c[u]=c[u]||{_errors:[]},c[u]._errors.push(r(a))):c[u]=c[u]||{_errors:[]},c=c[u],l++}}};return s(this),i}static assert(t){if(!(t instanceof n))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,$e.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){let r={},i=[];for(let s of this.issues)if(s.path.length>0){let o=s.path[0];r[o]=r[o]||[],r[o].push(t(s))}else i.push(t(s));return{formErrors:i,fieldErrors:r}}get formErrors(){return this.flatten()}}return n.create=e=>new n(e),n})();var xX=(n,e)=>{let t;switch(n.code){case U.invalid_type:n.received===G.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case U.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,$e.jsonStringifyReplacer)}`;break;case U.unrecognized_keys:t=`Unrecognized key(s) in object: ${$e.joinValues(n.keys,", ")}`;break;case U.invalid_union:t="Invalid input";break;case U.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${$e.joinValues(n.options)}`;break;case U.invalid_enum_value:t=`Invalid enum value. Expected ${$e.joinValues(n.options)}, received '${n.received}'`;break;case U.invalid_arguments:t="Invalid function arguments";break;case U.invalid_return_type:t="Invalid function return type";break;case U.invalid_date:t="Invalid date";break;case U.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:$e.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case U.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case U.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case U.custom:t="Invalid input";break;case U.invalid_intersection_types:t="Intersection results could not be merged";break;case U.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case U.not_finite:t="Number must be finite";break;default:t=e.defaultError,$e.assertNever(n)}return{message:t}},ys=xX;var WF=ys;function RX(n){WF=n}function ml(){return WF}var zd=n=>{let{data:e,path:t,errorMaps:r,issueData:i}=n,s=[...t,...i.path||[]],o=P(_({},i),{path:s});if(i.message!==void 0)return P(_({},i),{path:s,message:i.message});let a="",c=r.filter(l=>!!l).slice().reverse();for(let l of c)a=l(o,{data:e,defaultError:a}).message;return P(_({},i),{path:s,message:a})},PX=[];function z(n,e){let t=ml(),r=zd({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===ys?void 0:ys].filter(i=>!!i)});n.common.issues.push(r)}var un=class n{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let i of t){if(i.status==="aborted")return ue;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static mergeObjectAsync(e,t){return g(this,null,function*(){let r=[];for(let i of t){let s=yield i.key,o=yield i.value;r.push({key:s,value:o})}return n.mergeObjectSync(e,r)})}static mergeObjectSync(e,t){let r={};for(let i of t){let{key:s,value:o}=i;if(s.status==="aborted"||o.status==="aborted")return ue;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(r[s.value]=o.value)}return{status:e.value,value:r}}},ue=Object.freeze({status:"aborted"}),Aa=n=>({status:"dirty",value:n}),Tn=n=>({status:"valid",value:n}),Yg=n=>n.status==="aborted",Qg=n=>n.status==="dirty",go=n=>n.status==="valid",gl=n=>typeof Promise<"u"&&n instanceof Promise;var re=function(n){return n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message,n}(re||{});var Ir=class{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},KF=(n,e)=>{if(go(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Fi(n.common.issues);return this._error=t,this._error}}};function Ce(n){if(!n)return{};let{errorMap:e,invalid_type_error:t,required_error:r,description:i}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(o,a)=>{let{message:c}=n;return o.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??r??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:c??t??a.defaultError}},description:i}}var Re=class{get description(){return this._def.description}_getType(e){return Li(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Li(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new un,ctx:{common:e.parent.common,data:e.data,parsedType:Li(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(gl(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Li(e)},i=this._parseSync({data:e,path:r.path,parent:r});return KF(r,i)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Li(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return go(r)?{value:r.value}:{issues:t.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(r=>go(r)?{value:r.value}:{issues:t.common.issues})}parseAsync(e,t){return g(this,null,function*(){let r=yield this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error})}safeParseAsync(e,t){return g(this,null,function*(){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Li(e)},i=this._parse({data:e,path:r.path,parent:r}),s=yield gl(i)?i:Promise.resolve(i);return KF(r,s)})}refine(e,t){let r=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{let o=e(i),a=()=>s.addIssue(_({code:U.custom},r(i)));return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof t=="function"?t(r,i):t),!1))}_refinement(e){return new wl({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return yo.create(this,this._def)}nullable(){return bl.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Wd.create(this)}promise(){return ry.create(this,this._def)}or(e){return CC.create([this,e],this._def)}and(e){return SC.create(this,e,this._def)}transform(e){return new wl(P(_({},Ce(this._def)),{schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){let t=typeof e=="function"?e:()=>e;return new PC(P(_({},Ce(this._def)),{innerType:this,defaultValue:t,typeName:B.ZodDefault}))}brand(){return new Kd(_({typeName:B.ZodBranded,type:this},Ce(this._def)))}catch(e){let t=typeof e=="function"?e:()=>e;return new MC(P(_({},Ce(this._def)),{innerType:this,catchValue:t,typeName:B.ZodCatch}))}describe(e){let t=this.constructor;return new t(P(_({},this._def),{description:e}))}pipe(e){return Yd.create(this,e)}readonly(){return NC.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},MX=/^c[^\s-]{8,}$/i,NX=/^[0-9a-z]+$/,OX=/^[0-9A-HJKMNP-TV-Z]{26}$/i,kX=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,LX=/^[a-z0-9_-]{21}$/i,FX=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,VX=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,jX=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,$X="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",_C,UX=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,BX=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,HX=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,qX=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,zX=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,GX=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,QF="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",WX=new RegExp(`^${QF}$`);function XF(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);let t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function KX(n){return new RegExp(`^${XF(n)}$`)}function ZF(n){let e=`${QF}T${XF(n)}`,t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function YX(n,e){return!!((e==="v4"||!e)&&UX.test(n)||(e==="v6"||!e)&&HX.test(n))}function QX(n,e){if(!FX.test(n))return!1;try{let[t]=n.split(".");if(!t)return!1;let r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(r));return!(typeof i!="object"||i===null||"typ"in i&&i?.typ!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function XX(n,e){return!!((e==="v4"||!e)&&BX.test(n)||(e==="v6"||!e)&&qX.test(n))}var ty=(()=>{class n extends Re{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==G.string){let o=this._getOrReturnCtx(t);return z(o,{code:U.invalid_type,expected:G.string,received:o.parsedType}),ue}let i=new un,s;for(let o of this._def.checks)if(o.kind==="min")t.data.length<o.value&&(s=this._getOrReturnCtx(t,s),z(s,{code:U.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),i.dirty());else if(o.kind==="max")t.data.length>o.value&&(s=this._getOrReturnCtx(t,s),z(s,{code:U.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),i.dirty());else if(o.kind==="length"){let a=t.data.length>o.value,c=t.data.length<o.value;(a||c)&&(s=this._getOrReturnCtx(t,s),a?z(s,{code:U.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):c&&z(s,{code:U.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),i.dirty())}else if(o.kind==="email")jX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"email",code:U.invalid_string,message:o.message}),i.dirty());else if(o.kind==="emoji")_C||(_C=new RegExp($X,"u")),_C.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"emoji",code:U.invalid_string,message:o.message}),i.dirty());else if(o.kind==="uuid")kX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"uuid",code:U.invalid_string,message:o.message}),i.dirty());else if(o.kind==="nanoid")LX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"nanoid",code:U.invalid_string,message:o.message}),i.dirty());else if(o.kind==="cuid")MX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"cuid",code:U.invalid_string,message:o.message}),i.dirty());else if(o.kind==="cuid2")NX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"cuid2",code:U.invalid_string,message:o.message}),i.dirty());else if(o.kind==="ulid")OX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"ulid",code:U.invalid_string,message:o.message}),i.dirty());else if(o.kind==="url")try{new URL(t.data)}catch{s=this._getOrReturnCtx(t,s),z(s,{validation:"url",code:U.invalid_string,message:o.message}),i.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"regex",code:U.invalid_string,message:o.message}),i.dirty())):o.kind==="trim"?t.data=t.data.trim():o.kind==="includes"?t.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(t,s),z(s,{code:U.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),i.dirty()):o.kind==="toLowerCase"?t.data=t.data.toLowerCase():o.kind==="toUpperCase"?t.data=t.data.toUpperCase():o.kind==="startsWith"?t.data.startsWith(o.value)||(s=this._getOrReturnCtx(t,s),z(s,{code:U.invalid_string,validation:{startsWith:o.value},message:o.message}),i.dirty()):o.kind==="endsWith"?t.data.endsWith(o.value)||(s=this._getOrReturnCtx(t,s),z(s,{code:U.invalid_string,validation:{endsWith:o.value},message:o.message}),i.dirty()):o.kind==="datetime"?ZF(o).test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{code:U.invalid_string,validation:"datetime",message:o.message}),i.dirty()):o.kind==="date"?WX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{code:U.invalid_string,validation:"date",message:o.message}),i.dirty()):o.kind==="time"?KX(o).test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{code:U.invalid_string,validation:"time",message:o.message}),i.dirty()):o.kind==="duration"?VX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"duration",code:U.invalid_string,message:o.message}),i.dirty()):o.kind==="ip"?YX(t.data,o.version)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"ip",code:U.invalid_string,message:o.message}),i.dirty()):o.kind==="jwt"?QX(t.data,o.alg)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"jwt",code:U.invalid_string,message:o.message}),i.dirty()):o.kind==="cidr"?XX(t.data,o.version)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"cidr",code:U.invalid_string,message:o.message}),i.dirty()):o.kind==="base64"?zX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"base64",code:U.invalid_string,message:o.message}),i.dirty()):o.kind==="base64url"?GX.test(t.data)||(s=this._getOrReturnCtx(t,s),z(s,{validation:"base64url",code:U.invalid_string,message:o.message}),i.dirty()):$e.assertNever(o);return{status:i.value,value:t.data}}_regex(t,r,i){return this.refinement(s=>t.test(s),_({validation:r,code:U.invalid_string},re.errToObj(i)))}_addCheck(t){return new n(P(_({},this._def),{checks:[...this._def.checks,t]}))}email(t){return this._addCheck(_({kind:"email"},re.errToObj(t)))}url(t){return this._addCheck(_({kind:"url"},re.errToObj(t)))}emoji(t){return this._addCheck(_({kind:"emoji"},re.errToObj(t)))}uuid(t){return this._addCheck(_({kind:"uuid"},re.errToObj(t)))}nanoid(t){return this._addCheck(_({kind:"nanoid"},re.errToObj(t)))}cuid(t){return this._addCheck(_({kind:"cuid"},re.errToObj(t)))}cuid2(t){return this._addCheck(_({kind:"cuid2"},re.errToObj(t)))}ulid(t){return this._addCheck(_({kind:"ulid"},re.errToObj(t)))}base64(t){return this._addCheck(_({kind:"base64"},re.errToObj(t)))}base64url(t){return this._addCheck(_({kind:"base64url"},re.errToObj(t)))}jwt(t){return this._addCheck(_({kind:"jwt"},re.errToObj(t)))}ip(t){return this._addCheck(_({kind:"ip"},re.errToObj(t)))}cidr(t){return this._addCheck(_({kind:"cidr"},re.errToObj(t)))}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck(_({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:t?.offset??!1,local:t?.local??!1},re.errToObj(t?.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(_({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision},re.errToObj(t?.message)))}duration(t){return this._addCheck(_({kind:"duration"},re.errToObj(t)))}regex(t,r){return this._addCheck(_({kind:"regex",regex:t},re.errToObj(r)))}includes(t,r){return this._addCheck(_({kind:"includes",value:t,position:r?.position},re.errToObj(r?.message)))}startsWith(t,r){return this._addCheck(_({kind:"startsWith",value:t},re.errToObj(r)))}endsWith(t,r){return this._addCheck(_({kind:"endsWith",value:t},re.errToObj(r)))}min(t,r){return this._addCheck(_({kind:"min",value:t},re.errToObj(r)))}max(t,r){return this._addCheck(_({kind:"max",value:t},re.errToObj(r)))}length(t,r){return this._addCheck(_({kind:"length",value:t},re.errToObj(r)))}nonempty(t){return this.min(1,re.errToObj(t))}trim(){return new n(P(_({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new n(P(_({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new n(P(_({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}return n.create=e=>new n(_({checks:[],typeName:B.ZodString,coerce:e?.coerce??!1},Ce(e))),n})();function ZX(n,e){let t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=t>r?t:r,s=Number.parseInt(n.toFixed(i).replace(".","")),o=Number.parseInt(e.toFixed(i).replace(".",""));return s%o/10**i}var wC=(()=>{class n extends Re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==G.number){let o=this._getOrReturnCtx(t);return z(o,{code:U.invalid_type,expected:G.number,received:o.parsedType}),ue}let i,s=new un;for(let o of this._def.checks)o.kind==="int"?$e.isInteger(t.data)||(i=this._getOrReturnCtx(t,i),z(i,{code:U.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?t.data<o.value:t.data<=o.value)&&(i=this._getOrReturnCtx(t,i),z(i,{code:U.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?t.data>o.value:t.data>=o.value)&&(i=this._getOrReturnCtx(t,i),z(i,{code:U.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?ZX(t.data,o.value)!==0&&(i=this._getOrReturnCtx(t,i),z(i,{code:U.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(t.data)||(i=this._getOrReturnCtx(t,i),z(i,{code:U.not_finite,message:o.message}),s.dirty()):$e.assertNever(o);return{status:s.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,re.toString(r))}gt(t,r){return this.setLimit("min",t,!1,re.toString(r))}lte(t,r){return this.setLimit("max",t,!0,re.toString(r))}lt(t,r){return this.setLimit("max",t,!1,re.toString(r))}setLimit(t,r,i,s){return new n(P(_({},this._def),{checks:[...this._def.checks,{kind:t,value:r,inclusive:i,message:re.toString(s)}]}))}_addCheck(t){return new n(P(_({},this._def),{checks:[...this._def.checks,t]}))}int(t){return this._addCheck({kind:"int",message:re.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:re.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:re.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:re.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:re.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:re.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:re.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:re.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:re.toString(t)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&$e.isInteger(t.value))}get isFinite(){let t=null,r=null;for(let i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(r===null||i.value>r)&&(r=i.value):i.kind==="max"&&(t===null||i.value<t)&&(t=i.value)}return Number.isFinite(r)&&Number.isFinite(t)}}return n.create=e=>new n(_({checks:[],typeName:B.ZodNumber,coerce:e?.coerce||!1},Ce(e))),n})(),bC=(()=>{class n extends Re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==G.bigint)return this._getInvalidInput(t);let i,s=new un;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?t.data<o.value:t.data<=o.value)&&(i=this._getOrReturnCtx(t,i),z(i,{code:U.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?t.data>o.value:t.data>=o.value)&&(i=this._getOrReturnCtx(t,i),z(i,{code:U.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?t.data%o.value!==BigInt(0)&&(i=this._getOrReturnCtx(t,i),z(i,{code:U.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):$e.assertNever(o);return{status:s.value,value:t.data}}_getInvalidInput(t){let r=this._getOrReturnCtx(t);return z(r,{code:U.invalid_type,expected:G.bigint,received:r.parsedType}),ue}gte(t,r){return this.setLimit("min",t,!0,re.toString(r))}gt(t,r){return this.setLimit("min",t,!1,re.toString(r))}lte(t,r){return this.setLimit("max",t,!0,re.toString(r))}lt(t,r){return this.setLimit("max",t,!1,re.toString(r))}setLimit(t,r,i,s){return new n(P(_({},this._def),{checks:[...this._def.checks,{kind:t,value:r,inclusive:i,message:re.toString(s)}]}))}_addCheck(t){return new n(P(_({},this._def),{checks:[...this._def.checks,t]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:re.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:re.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:re.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:re.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:re.toString(r)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}return n.create=e=>new n(_({checks:[],typeName:B.ZodBigInt,coerce:e?.coerce??!1},Ce(e))),n})(),EC=(()=>{class n extends Re{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==G.boolean){let i=this._getOrReturnCtx(t);return z(i,{code:U.invalid_type,expected:G.boolean,received:i.parsedType}),ue}return Tn(t.data)}}return n.create=e=>new n(_({typeName:B.ZodBoolean,coerce:e?.coerce||!1},Ce(e))),n})(),IC=(()=>{class n extends Re{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==G.date){let o=this._getOrReturnCtx(t);return z(o,{code:U.invalid_type,expected:G.date,received:o.parsedType}),ue}if(Number.isNaN(t.data.getTime())){let o=this._getOrReturnCtx(t);return z(o,{code:U.invalid_date}),ue}let i=new un,s;for(let o of this._def.checks)o.kind==="min"?t.data.getTime()<o.value&&(s=this._getOrReturnCtx(t,s),z(s,{code:U.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),i.dirty()):o.kind==="max"?t.data.getTime()>o.value&&(s=this._getOrReturnCtx(t,s),z(s,{code:U.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),i.dirty()):$e.assertNever(o);return{status:i.value,value:new Date(t.data.getTime())}}_addCheck(t){return new n(P(_({},this._def),{checks:[...this._def.checks,t]}))}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:re.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:re.toString(r)})}get minDate(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}return n.create=e=>new n(_({checks:[],coerce:e?.coerce||!1,typeName:B.ZodDate},Ce(e))),n})(),JF=(()=>{class n extends Re{_parse(t){if(this._getType(t)!==G.symbol){let i=this._getOrReturnCtx(t);return z(i,{code:U.invalid_type,expected:G.symbol,received:i.parsedType}),ue}return Tn(t.data)}}return n.create=e=>new n(_({typeName:B.ZodSymbol},Ce(e))),n})(),AC=(()=>{class n extends Re{_parse(t){if(this._getType(t)!==G.undefined){let i=this._getOrReturnCtx(t);return z(i,{code:U.invalid_type,expected:G.undefined,received:i.parsedType}),ue}return Tn(t.data)}}return n.create=e=>new n(_({typeName:B.ZodUndefined},Ce(e))),n})(),TC=(()=>{class n extends Re{_parse(t){if(this._getType(t)!==G.null){let i=this._getOrReturnCtx(t);return z(i,{code:U.invalid_type,expected:G.null,received:i.parsedType}),ue}return Tn(t.data)}}return n.create=e=>new n(_({typeName:B.ZodNull},Ce(e))),n})(),Xg=(()=>{class n extends Re{constructor(){super(...arguments),this._any=!0}_parse(t){return Tn(t.data)}}return n.create=e=>new n(_({typeName:B.ZodAny},Ce(e))),n})(),Gd=(()=>{class n extends Re{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Tn(t.data)}}return n.create=e=>new n(_({typeName:B.ZodUnknown},Ce(e))),n})(),Ta=(()=>{class n extends Re{_parse(t){let r=this._getOrReturnCtx(t);return z(r,{code:U.invalid_type,expected:G.never,received:r.parsedType}),ue}}return n.create=e=>new n(_({typeName:B.ZodNever},Ce(e))),n})(),eV=(()=>{class n extends Re{_parse(t){if(this._getType(t)!==G.undefined){let i=this._getOrReturnCtx(t);return z(i,{code:U.invalid_type,expected:G.void,received:i.parsedType}),ue}return Tn(t.data)}}return n.create=e=>new n(_({typeName:B.ZodVoid},Ce(e))),n})(),Wd=(()=>{class n extends Re{_parse(t){let{ctx:r,status:i}=this._processInputParams(t),s=this._def;if(r.parsedType!==G.array)return z(r,{code:U.invalid_type,expected:G.array,received:r.parsedType}),ue;if(s.exactLength!==null){let a=r.data.length>s.exactLength.value,c=r.data.length<s.exactLength.value;(a||c)&&(z(r,{code:a?U.too_big:U.too_small,minimum:c?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),i.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(z(r,{code:U.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),i.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(z(r,{code:U.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),i.dirty()),r.common.async)return Promise.all([...r.data].map((a,c)=>s.type._parseAsync(new Ir(r,a,r.path,c)))).then(a=>un.mergeArray(i,a));let o=[...r.data].map((a,c)=>s.type._parseSync(new Ir(r,a,r.path,c)));return un.mergeArray(i,o)}get element(){return this._def.type}min(t,r){return new n(P(_({},this._def),{minLength:{value:t,message:re.toString(r)}}))}max(t,r){return new n(P(_({},this._def),{maxLength:{value:t,message:re.toString(r)}}))}length(t,r){return new n(P(_({},this._def),{exactLength:{value:t,message:re.toString(r)}}))}nonempty(t){return this.min(1,t)}}return n.create=(e,t)=>new n(_({type:e,minLength:null,maxLength:null,exactLength:null,typeName:B.ZodArray},Ce(t))),n})();function yl(n){if(n instanceof _l){let e={};for(let t in n.shape){let r=n.shape[t];e[t]=yo.create(yl(r))}return new _l(P(_({},n._def),{shape:()=>e}))}else return n instanceof Wd?new Wd(P(_({},n._def),{type:yl(n.element)})):n instanceof yo?yo.create(yl(n.unwrap())):n instanceof bl?bl.create(yl(n.unwrap())):n instanceof vl?vl.create(n.items.map(e=>yl(e))):n}var _l=(()=>{class n extends Re{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),r=$e.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==G.object){let u=this._getOrReturnCtx(t);return z(u,{code:U.invalid_type,expected:G.object,received:u.parsedType}),ue}let{status:i,ctx:s}=this._processInputParams(t),{shape:o,keys:a}=this._getCached(),c=[];if(!(this._def.catchall instanceof Ta&&this._def.unknownKeys==="strip"))for(let u in s.data)a.includes(u)||c.push(u);let l=[];for(let u of a){let d=o[u],f=s.data[u];l.push({key:{status:"valid",value:u},value:d._parse(new Ir(s,f,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Ta){let u=this._def.unknownKeys;if(u==="passthrough")for(let d of c)l.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(u==="strict")c.length>0&&(z(s,{code:U.unrecognized_keys,keys:c}),i.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let d of c){let f=s.data[d];l.push({key:{status:"valid",value:d},value:u._parse(new Ir(s,f,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(()=>g(this,null,function*(){let u=[];for(let d of l){let f=yield d.key,p=yield d.value;u.push({key:f,value:p,alwaysSet:d.alwaysSet})}return u})).then(u=>un.mergeObjectSync(i,u)):un.mergeObjectSync(i,l)}get shape(){return this._def.shape()}strict(t){return re.errToObj,new n(_(P(_({},this._def),{unknownKeys:"strict"}),t!==void 0?{errorMap:(r,i)=>{let s=this._def.errorMap?.(r,i).message??i.defaultError;return r.code==="unrecognized_keys"?{message:re.errToObj(t).message??s}:{message:s}}}:{}))}strip(){return new n(P(_({},this._def),{unknownKeys:"strip"}))}passthrough(){return new n(P(_({},this._def),{unknownKeys:"passthrough"}))}extend(t){return new n(P(_({},this._def),{shape:()=>_(_({},this._def.shape()),t)}))}merge(t){return new n({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>_(_({},this._def.shape()),t._def.shape()),typeName:B.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new n(P(_({},this._def),{catchall:t}))}pick(t){let r={};for(let i of $e.objectKeys(t))t[i]&&this.shape[i]&&(r[i]=this.shape[i]);return new n(P(_({},this._def),{shape:()=>r}))}omit(t){let r={};for(let i of $e.objectKeys(this.shape))t[i]||(r[i]=this.shape[i]);return new n(P(_({},this._def),{shape:()=>r}))}deepPartial(){return yl(this)}partial(t){let r={};for(let i of $e.objectKeys(this.shape)){let s=this.shape[i];t&&!t[i]?r[i]=s:r[i]=s.optional()}return new n(P(_({},this._def),{shape:()=>r}))}required(t){let r={};for(let i of $e.objectKeys(this.shape))if(t&&!t[i])r[i]=this.shape[i];else{let o=this.shape[i];for(;o instanceof yo;)o=o._def.innerType;r[i]=o}return new n(P(_({},this._def),{shape:()=>r}))}keyof(){return rV($e.objectKeys(this.shape))}}return n.create=(e,t)=>new n(_({shape:()=>e,unknownKeys:"strip",catchall:Ta.create(),typeName:B.ZodObject},Ce(t))),n.strictCreate=(e,t)=>new n(_({shape:()=>e,unknownKeys:"strict",catchall:Ta.create(),typeName:B.ZodObject},Ce(t))),n.lazycreate=(e,t)=>new n(_({shape:e,unknownKeys:"strip",catchall:Ta.create(),typeName:B.ZodObject},Ce(t))),n})(),CC=(()=>{class n extends Re{_parse(t){let{ctx:r}=this._processInputParams(t),i=this._def.options;function s(o){for(let c of o)if(c.result.status==="valid")return c.result;for(let c of o)if(c.result.status==="dirty")return r.common.issues.push(...c.ctx.common.issues),c.result;let a=o.map(c=>new Fi(c.ctx.common.issues));return z(r,{code:U.invalid_union,unionErrors:a}),ue}if(r.common.async)return Promise.all(i.map(o=>g(this,null,function*(){let a=P(_({},r),{common:P(_({},r.common),{issues:[]}),parent:null});return{result:yield o._parseAsync({data:r.data,path:r.path,parent:a}),ctx:a}}))).then(s);{let o,a=[];for(let l of i){let u=P(_({},r),{common:P(_({},r.common),{issues:[]}),parent:null}),d=l._parseSync({data:r.data,path:r.path,parent:u});if(d.status==="valid")return d;d.status==="dirty"&&!o&&(o={result:d,ctx:u}),u.common.issues.length&&a.push(u.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;let c=a.map(l=>new Fi(l));return z(r,{code:U.invalid_union,unionErrors:c}),ue}}get options(){return this._def.options}}return n.create=(e,t)=>new n(_({options:e,typeName:B.ZodUnion},Ce(t))),n})(),_s=n=>n instanceof DC?_s(n.schema):n instanceof wl?_s(n.innerType()):n instanceof xC?[n.value]:n instanceof ny?n.options:n instanceof RC?$e.objectValues(n.enum):n instanceof PC?_s(n._def.innerType):n instanceof AC?[void 0]:n instanceof TC?[null]:n instanceof yo?[void 0,..._s(n.unwrap())]:n instanceof bl?[null,..._s(n.unwrap())]:n instanceof Kd||n instanceof NC?_s(n.unwrap()):n instanceof MC?_s(n._def.innerType):[],Zg=class n extends Re{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==G.object)return z(t,{code:U.invalid_type,expected:G.object,received:t.parsedType}),ue;let r=this.discriminator,i=t.data[r],s=this.optionsMap.get(i);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(z(t,{code:U.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ue)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let i=new Map;for(let s of t){let o=_s(s.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(i.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,s)}}return new n(_({typeName:B.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i},Ce(r)))}};function vC(n,e){let t=Li(n),r=Li(e);if(n===e)return{valid:!0,data:n};if(t===G.object&&r===G.object){let i=$e.objectKeys(e),s=$e.objectKeys(n).filter(a=>i.indexOf(a)!==-1),o=_(_({},n),e);for(let a of s){let c=vC(n[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===G.array&&r===G.array){if(n.length!==e.length)return{valid:!1};let i=[];for(let s=0;s<n.length;s++){let o=n[s],a=e[s],c=vC(o,a);if(!c.valid)return{valid:!1};i.push(c.data)}return{valid:!0,data:i}}else return t===G.date&&r===G.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}var SC=(()=>{class n extends Re{_parse(t){let{status:r,ctx:i}=this._processInputParams(t),s=(o,a)=>{if(Yg(o)||Yg(a))return ue;let c=vC(o.value,a.value);return c.valid?((Qg(o)||Qg(a))&&r.dirty(),{status:r.value,value:c.data}):(z(i,{code:U.invalid_intersection_types}),ue)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([o,a])=>s(o,a)):s(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}return n.create=(e,t,r)=>new n(_({left:e,right:t,typeName:B.ZodIntersection},Ce(r))),n})(),vl=(()=>{class n extends Re{_parse(t){let{status:r,ctx:i}=this._processInputParams(t);if(i.parsedType!==G.array)return z(i,{code:U.invalid_type,expected:G.array,received:i.parsedType}),ue;if(i.data.length<this._def.items.length)return z(i,{code:U.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ue;!this._def.rest&&i.data.length>this._def.items.length&&(z(i,{code:U.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let o=[...i.data].map((a,c)=>{let l=this._def.items[c]||this._def.rest;return l?l._parse(new Ir(i,a,i.path,c)):null}).filter(a=>!!a);return i.common.async?Promise.all(o).then(a=>un.mergeArray(r,a)):un.mergeArray(r,o)}get items(){return this._def.items}rest(t){return new n(P(_({},this._def),{rest:t}))}}return n.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new n(_({items:e,typeName:B.ZodTuple,rest:null},Ce(t)))},n})(),Jg=class n extends Re{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==G.object)return z(r,{code:U.invalid_type,expected:G.object,received:r.parsedType}),ue;let i=[],s=this._def.keyType,o=this._def.valueType;for(let a in r.data)i.push({key:s._parse(new Ir(r,a,r.path,a)),value:o._parse(new Ir(r,r.data[a],r.path,a)),alwaysSet:a in r.data});return r.common.async?un.mergeObjectAsync(t,i):un.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Re?new n(_({keyType:e,valueType:t,typeName:B.ZodRecord},Ce(r))):new n(_({keyType:ty.create(),valueType:e,typeName:B.ZodRecord},Ce(t)))}},tV=(()=>{class n extends Re{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:i}=this._processInputParams(t);if(i.parsedType!==G.map)return z(i,{code:U.invalid_type,expected:G.map,received:i.parsedType}),ue;let s=this._def.keyType,o=this._def.valueType,a=[...i.data.entries()].map(([c,l],u)=>({key:s._parse(new Ir(i,c,i.path,[u,"key"])),value:o._parse(new Ir(i,l,i.path,[u,"value"]))}));if(i.common.async){let c=new Map;return Promise.resolve().then(()=>g(this,null,function*(){for(let l of a){let u=yield l.key,d=yield l.value;if(u.status==="aborted"||d.status==="aborted")return ue;(u.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(u.value,d.value)}return{status:r.value,value:c}}))}else{let c=new Map;for(let l of a){let u=l.key,d=l.value;if(u.status==="aborted"||d.status==="aborted")return ue;(u.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(u.value,d.value)}return{status:r.value,value:c}}}}return n.create=(e,t,r)=>new n(_({valueType:t,keyType:e,typeName:B.ZodMap},Ce(r))),n})(),nV=(()=>{class n extends Re{_parse(t){let{status:r,ctx:i}=this._processInputParams(t);if(i.parsedType!==G.set)return z(i,{code:U.invalid_type,expected:G.set,received:i.parsedType}),ue;let s=this._def;s.minSize!==null&&i.data.size<s.minSize.value&&(z(i,{code:U.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&i.data.size>s.maxSize.value&&(z(i,{code:U.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());let o=this._def.valueType;function a(l){let u=new Set;for(let d of l){if(d.status==="aborted")return ue;d.status==="dirty"&&r.dirty(),u.add(d.value)}return{status:r.value,value:u}}let c=[...i.data.values()].map((l,u)=>o._parse(new Ir(i,l,i.path,u)));return i.common.async?Promise.all(c).then(l=>a(l)):a(c)}min(t,r){return new n(P(_({},this._def),{minSize:{value:t,message:re.toString(r)}}))}max(t,r){return new n(P(_({},this._def),{maxSize:{value:t,message:re.toString(r)}}))}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}return n.create=(e,t)=>new n(_({valueType:e,minSize:null,maxSize:null,typeName:B.ZodSet},Ce(t))),n})(),ey=class n extends Re{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==G.function)return z(t,{code:U.invalid_type,expected:G.function,received:t.parsedType}),ue;function r(a,c){return zd({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ml(),ys].filter(l=>!!l),issueData:{code:U.invalid_arguments,argumentsError:c}})}function i(a,c){return zd({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ml(),ys].filter(l=>!!l),issueData:{code:U.invalid_return_type,returnTypeError:c}})}let s={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof ry){let a=this;return Tn(function(...c){return g(this,null,function*(){let l=new Fi([]),u=yield a._def.args.parseAsync(c,s).catch(p=>{throw l.addIssue(r(c,p)),l}),d=yield Reflect.apply(o,this,u);return yield a._def.returns._def.type.parseAsync(d,s).catch(p=>{throw l.addIssue(i(d,p)),l})})})}else{let a=this;return Tn(function(...c){let l=a._def.args.safeParse(c,s);if(!l.success)throw new Fi([r(c,l.error)]);let u=Reflect.apply(o,this,l.data),d=a._def.returns.safeParse(u,s);if(!d.success)throw new Fi([i(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new n(P(_({},this._def),{args:vl.create(e).rest(Gd.create())}))}returns(e){return new n(P(_({},this._def),{returns:e}))}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new n(_({args:e||vl.create([]).rest(Gd.create()),returns:t||Gd.create(),typeName:B.ZodFunction},Ce(r)))}},DC=(()=>{class n extends Re{get schema(){return this._def.getter()}_parse(t){let{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}return n.create=(e,t)=>new n(_({getter:e,typeName:B.ZodLazy},Ce(t))),n})(),xC=(()=>{class n extends Re{_parse(t){if(t.data!==this._def.value){let r=this._getOrReturnCtx(t);return z(r,{received:r.data,code:U.invalid_literal,expected:this._def.value}),ue}return{status:"valid",value:t.data}}get value(){return this._def.value}}return n.create=(e,t)=>new n(_({value:e,typeName:B.ZodLiteral},Ce(t))),n})();function rV(n,e){return new ny(_({values:n,typeName:B.ZodEnum},Ce(e)))}var ny=(()=>{class n extends Re{_parse(t){if(typeof t.data!="string"){let r=this._getOrReturnCtx(t),i=this._def.values;return z(r,{expected:$e.joinValues(i),received:r.parsedType,code:U.invalid_type}),ue}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){let r=this._getOrReturnCtx(t),i=this._def.values;return z(r,{received:r.data,code:U.invalid_enum_value,options:i}),ue}return Tn(t.data)}get options(){return this._def.values}get enum(){let t={};for(let r of this._def.values)t[r]=r;return t}get Values(){let t={};for(let r of this._def.values)t[r]=r;return t}get Enum(){let t={};for(let r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return n.create(t,_(_({},this._def),r))}exclude(t,r=this._def){return n.create(this.options.filter(i=>!t.includes(i)),_(_({},this._def),r))}}return n.create=rV,n})(),RC=(()=>{class n extends Re{_parse(t){let r=$e.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(t);if(i.parsedType!==G.string&&i.parsedType!==G.number){let s=$e.objectValues(r);return z(i,{expected:$e.joinValues(s),received:i.parsedType,code:U.invalid_type}),ue}if(this._cache||(this._cache=new Set($e.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let s=$e.objectValues(r);return z(i,{received:i.data,code:U.invalid_enum_value,options:s}),ue}return Tn(t.data)}get enum(){return this._def.values}}return n.create=(e,t)=>new n(_({values:e,typeName:B.ZodNativeEnum},Ce(t))),n})(),ry=(()=>{class n extends Re{unwrap(){return this._def.type}_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==G.promise&&r.common.async===!1)return z(r,{code:U.invalid_type,expected:G.promise,received:r.parsedType}),ue;let i=r.parsedType===G.promise?r.data:Promise.resolve(r.data);return Tn(i.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}}return n.create=(e,t)=>new n(_({type:e,typeName:B.ZodPromise},Ce(t))),n})(),wl=(()=>{class n extends Re{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===B.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:r,ctx:i}=this._processInputParams(t),s=this._def.effect||null,o={addIssue:a=>{z(i,a),a.fatal?r.abort():r.dirty()},get path(){return i.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="preprocess"){let a=s.transform(i.data,o);if(i.common.async)return Promise.resolve(a).then(c=>g(this,null,function*(){if(r.value==="aborted")return ue;let l=yield this._def.schema._parseAsync({data:c,path:i.path,parent:i});return l.status==="aborted"?ue:l.status==="dirty"?Aa(l.value):r.value==="dirty"?Aa(l.value):l}));{if(r.value==="aborted")return ue;let c=this._def.schema._parseSync({data:a,path:i.path,parent:i});return c.status==="aborted"?ue:c.status==="dirty"?Aa(c.value):r.value==="dirty"?Aa(c.value):c}}if(s.type==="refinement"){let a=c=>{let l=s.refinement(c,o);if(i.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(i.common.async===!1){let c=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return c.status==="aborted"?ue:(c.status==="dirty"&&r.dirty(),a(c.value),{status:r.value,value:c.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(c=>c.status==="aborted"?ue:(c.status==="dirty"&&r.dirty(),a(c.value).then(()=>({status:r.value,value:c.value}))))}if(s.type==="transform")if(i.common.async===!1){let a=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!go(a))return ue;let c=s.transform(a.value,o);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:c}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(a=>go(a)?Promise.resolve(s.transform(a.value,o)).then(c=>({status:r.value,value:c})):ue);$e.assertNever(s)}}return n.create=(e,t,r)=>new n(_({schema:e,typeName:B.ZodEffects,effect:t},Ce(r))),n.createWithPreprocess=(e,t,r)=>new n(_({schema:t,effect:{type:"preprocess",transform:e},typeName:B.ZodEffects},Ce(r))),n})();var yo=(()=>{class n extends Re{_parse(t){return this._getType(t)===G.undefined?Tn(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return n.create=(e,t)=>new n(_({innerType:e,typeName:B.ZodOptional},Ce(t))),n})(),bl=(()=>{class n extends Re{_parse(t){return this._getType(t)===G.null?Tn(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return n.create=(e,t)=>new n(_({innerType:e,typeName:B.ZodNullable},Ce(t))),n})(),PC=(()=>{class n extends Re{_parse(t){let{ctx:r}=this._processInputParams(t),i=r.data;return r.parsedType===G.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}return n.create=(e,t)=>new n(_({innerType:e,typeName:B.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default},Ce(t))),n})(),MC=(()=>{class n extends Re{_parse(t){let{ctx:r}=this._processInputParams(t),i=P(_({},r),{common:P(_({},r.common),{issues:[]})}),s=this._def.innerType._parse({data:i.data,path:i.path,parent:_({},i)});return gl(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Fi(i.common.issues)},input:i.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Fi(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}return n.create=(e,t)=>new n(_({innerType:e,typeName:B.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch},Ce(t))),n})(),iV=(()=>{class n extends Re{_parse(t){if(this._getType(t)!==G.nan){let i=this._getOrReturnCtx(t);return z(i,{code:U.invalid_type,expected:G.nan,received:i.parsedType}),ue}return{status:"valid",value:t.data}}}return n.create=e=>new n(_({typeName:B.ZodNaN},Ce(e))),n})(),JX=Symbol("zod_brand"),Kd=class extends Re{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},Yd=class n extends Re{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return g(this,null,function*(){let s=yield this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?ue:s.status==="dirty"?(t.dirty(),Aa(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})});{let i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?ue:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,t){return new n({in:e,out:t,typeName:B.ZodPipeline})}},NC=(()=>{class n extends Re{_parse(t){let r=this._def.innerType._parse(t),i=s=>(go(s)&&(s.value=Object.freeze(s.value)),s);return gl(r)?r.then(s=>i(s)):i(r)}unwrap(){return this._def.innerType}}return n.create=(e,t)=>new n(_({innerType:e,typeName:B.ZodReadonly},Ce(t))),n})();function YF(n,e){let t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function sV(n,e={},t){return n?Xg.create().superRefine((r,i)=>{let s=n(r);if(s instanceof Promise)return s.then(o=>{if(!o){let a=YF(e,r),c=a.fatal??t??!0;i.addIssue(P(_({code:"custom"},a),{fatal:c}))}});if(!s){let o=YF(e,r),a=o.fatal??t??!0;i.addIssue(P(_({code:"custom"},o),{fatal:a}))}}):Xg.create()}var eZ={object:_l.lazycreate},B=function(n){return n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly",n}(B||{});var tZ=(n,e={message:`Input not instance of ${n.name}`})=>sV(t=>t instanceof n,e),oV=ty.create,aV=wC.create,nZ=iV.create,rZ=bC.create,cV=EC.create,iZ=IC.create,sZ=JF.create,oZ=AC.create,aZ=TC.create,cZ=Xg.create,lZ=Gd.create,uZ=Ta.create,dZ=eV.create,hZ=Wd.create,fZ=_l.create,pZ=_l.strictCreate,mZ=CC.create,gZ=Zg.create,yZ=SC.create,_Z=vl.create,vZ=Jg.create,wZ=tV.create,bZ=nV.create,EZ=ey.create,IZ=DC.create,AZ=xC.create,TZ=ny.create,CZ=RC.create,SZ=ry.create,DZ=wl.create,xZ=yo.create,RZ=bl.create,PZ=wl.createWithPreprocess,MZ=Yd.create,NZ=()=>oV().optional(),OZ=()=>aV().optional(),kZ=()=>cV().optional(),LZ={string:n=>ty.create(P(_({},n),{coerce:!0})),number:n=>wC.create(P(_({},n),{coerce:!0})),boolean:n=>EC.create(P(_({},n),{coerce:!0})),bigint:n=>bC.create(P(_({},n),{coerce:!0})),date:n=>IC.create(P(_({},n),{coerce:!0}))};var FZ=ue;var YS=Or(oy(),1);var gV=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function HZ(n){return typeof n=="string"&&gV.test(n)}var Sa=HZ;var dn=[];for(ay=0;ay<256;++ay)dn.push((ay+256).toString(16).slice(1));var ay;function yV(n,e=0){return(dn[n[e+0]]+dn[n[e+1]]+dn[n[e+2]]+dn[n[e+3]]+"-"+dn[n[e+4]]+dn[n[e+5]]+"-"+dn[n[e+6]]+dn[n[e+7]]+"-"+dn[n[e+8]]+dn[n[e+9]]+"-"+dn[n[e+10]]+dn[n[e+11]]+dn[n[e+12]]+dn[n[e+13]]+dn[n[e+14]]+dn[n[e+15]]).toLowerCase()}var cy,qZ=new Uint8Array(16);function OC(){if(!cy&&(cy=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!cy))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return cy(qZ)}var zZ=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),kC={randomUUID:zZ};function GZ(n,e,t){if(kC.randomUUID&&!e&&!n)return kC.randomUUID();n=n||{};var r=n.random||(n.rng||OC)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return yV(r)}var $t=GZ;var SV=Or(oy(),1),my=Or(py(),1);var tJ=(...n)=>fetch(...n),nJ=Symbol.for("ls:fetch_implementation");var ae=()=>globalThis[nJ]??tJ;var rJ=[400,401,403,404,405,406,407,408],iJ=[409],Xd=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in my.default?this.queue=new my.default.default({concurrency:this.maxConcurrency}):this.queue=new my.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>(0,SV.default)(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{onFailedAttempt(s){return g(this,null,function*(){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||s?.code==="ECONNABORTED")throw s;let o=s?.response,a=o?.status;if(a){if(rJ.includes(+a))throw s;if(iJ.includes(+a))return;r&&(yield r(o))}})},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>ae()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function BC(n){return typeof n?._getType=="function"}function HC(n){let e={type:n._getType(),data:{content:n.content}};return n?.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs=_({},n.additional_kwargs)),e}function Ue(n,e){if(!Sa(n)){let t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}var DV={};function gy(n){DV[n]||(console.warn(n),DV[n]=!0)}var cS=Or(y2(),1);function _2(n,e){let t=(0,cS.parse)(n),r=(0,cS.parse)(e);if(!t||!r)throw new Error("Invalid version format.");return t.compare(r)>=0}function vs(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);let[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){let[i,s]=e.split("/",2);if(!i||!s)throw new Error(`Invalid identifier format: ${n}`);return[i,s,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}var lS=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}};function Fe(n,e,t){return g(this,null,function*(){let r;if(n.ok){t&&(r=yield n.text());return}r=yield n.text();let i=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new lS(i):new Error(i)})}var v2="[...]",ene={result:"[Circular]"},xy=[],Al=[];function tne(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function xa(n,e,t,r){try{return JSON.stringify(n,e,t)}catch(o){if(!o.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=tne()),dS(n,"",0,[],void 0,0,r);var i;try{Al.length===0?i=JSON.stringify(n,e,t):i=JSON.stringify(n,nne(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;xy.length!==0;){var s=xy.pop();s.length===4?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return i}}function uS(n,e,t,r){var i=Object.getOwnPropertyDescriptor(r,t);i.get!==void 0?i.configurable?(Object.defineProperty(r,t,{value:n}),xy.push([r,t,e,i])):Al.push([e,t,n]):(r[t]=n,xy.push([r,t,e]))}function dS(n,e,t,r,i,s,o){s+=1;var a;if(typeof n=="object"&&n!==null){for(a=0;a<r.length;a++)if(r[a]===n){uS(ene,n,e,i);return}if(typeof o.depthLimit<"u"&&s>o.depthLimit){uS(v2,n,e,i);return}if(typeof o.edgesLimit<"u"&&t+1>o.edgesLimit){uS(v2,n,e,i);return}if(r.push(n),Array.isArray(n))for(a=0;a<n.length;a++)dS(n[a],a,a,r,n,s,o);else{var c=Object.keys(n);for(a=0;a<c.length;a++){var l=c[a];dS(n[l],l,a,r,n,s,o)}}r.pop()}}function nne(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Al.length>0)for(var r=0;r<Al.length;r++){var i=Al[r];if(i[1]===e&&i[0]===t){t=i[2],Al.splice(r,1);break}}return n.call(this,e,t)}}function w2(n){let e=Py(),t=b2(),r=n.extra??{},i=r.metadata;return n.extra=P(_({},r),{runtime:_(_({},e),r?.runtime),metadata:_(_(_({},t),t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{}),i)}),n}var rne=()=>{let n=ws("TRACING_SAMPLING_RATE");if(n===void 0)return;let e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},ine=n=>{let t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};function sne(n){return g(this,null,function*(){let e=[];try{for(var t=Me(n),r,i,s;r=!(i=yield t.next()).done;r=!1){let o=i.value;e.push(o)}}catch{s=[i]}finally{try{r&&(i=t.return)&&(yield i.call(t))}finally{if(s)throw s[0]}}return e})}function hS(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var one=n=>g(void 0,null,function*(){if(n?.status===429){let e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return yield new Promise(t=>setTimeout(t,e)),!0}return!1}),fS=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,r=new Promise(s=>{t=s}),i=xa(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i,r}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let t=[],r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){let i=this.items.shift();i&&(t.push(i),r+=i.size,this.sizeBytes-=i.size)}if(t.length===0&&this.items.length>0){let i=this.items.shift();t.push(i),r+=i.size,this.sizeBytes-=i.size}return[t.map(i=>({action:i.action,item:i.payload})),()=>t.forEach(i=>i.itemPromiseResolve())]}},ane=20971520,cne=1e3,Ra=class n{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new fS}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=n.getDefaultClientConfig();this.tracingSampleRate=rne(),this.apiUrl=hS(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=hS(e.apiKey??t.apiKey),this.webUrl=hS(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new Xd(e.callerOptions??{}),this.batchIngestCaller=new Xd(P(_({},e.callerOptions??{}),{onFailedResponseHook:one})),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){let e=ws("API_KEY"),t=ws("ENDPOINT")??"https://api.smith.langchain.com",r=ws("HIDE_INPUTS")==="true",i=ws("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:ine(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${Ry}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t=_({},e);return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}_getResponse(e,t){return g(this,null,function*(){let r=t?.toString()??"",i=`${this.apiUrl}${e}?${r}`,s=yield this.caller.call(ae(),i,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(s,`Failed to fetch ${e}`),s})}_get(e,t){return g(this,null,function*(){return(yield this._getResponse(e,t)).json()})}_getPaginated(i){return we(this,arguments,function*(e,t=new URLSearchParams,r){let s=Number(t.get("offset"))||0,o=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(o));let a=`${this.apiUrl}${e}?${t}`,c=yield new $(this.caller.call(ae(),a,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)));yield new $(Fe(c,`Failed to fetch ${e}`));let l=r?r(yield new $(c.json())):yield new $(c.json());if(l.length===0||(yield l,l.length<o))break;s+=l.length}})}_getCursorPaginatedList(e,t=null,r="POST",i="runs"){return we(this,null,function*(){let s=t?_({},t):{};for(;;){let o=yield new $(this.caller.call(ae(),`${this.apiUrl}${e}`,P(_({method:r,headers:P(_({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:JSON.stringify(s)}))),a=yield new $(o.json());if(!a||!a[i])break;yield a[i];let c=a.cursors;if(!c||!c.next)break;s.cursor=c.next}})}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let r=[];for(let i of e)this.filteredPostUuids.has(i.id)?this.filteredPostUuids.delete(i.id):r.push(i);return r}else{let r=[];for(let i of e)i.id!==i.trace_id&&!this.filteredPostUuids.has(i.trace_id)||Math.random()<this.tracingSampleRate?r.push(i):this.filteredPostUuids.add(i.id);return r}}_getBatchSizeLimitBytes(){return g(this,null,function*(){let e=yield this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??ane})}drainAutoBatchQueue(){return g(this,null,function*(){for(;this.autoBatchQueue.items.length>=0;){let[e,t]=this.autoBatchQueue.pop(yield this._getBatchSizeLimitBytes());if(!e.length){t();return}try{let r={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)};(yield this._ensureServerInfo())?.batch_ingest_config?.use_multipart_endpoint?yield this.multipartIngestRuns(r):yield this.batchIngestRuns(r)}finally{t()}}})}processRunOperation(e,t){return g(this,null,function*(){let r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=w2(e.item));let i=this.autoBatchQueue.push(e),s=yield this._getBatchSizeLimitBytes();return(t||this.autoBatchQueue.sizeBytes>s)&&(yield this.drainAutoBatchQueue().catch(console.error)),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),i})}_getServerInfo(){return g(this,null,function*(){let e=yield ae()(`${this.apiUrl}/info`,_({method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(cne)},this.fetchOptions));return yield Fe(e,"get server info"),e.json()})}_ensureServerInfo(){return g(this,null,function*(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=g(this,null,function*(){if(this._serverInfo===void 0)try{this._serverInfo=yield this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to single calls and default limits.")}return this._serverInfo??{}})),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))})}_getSettings(){return g(this,null,function*(){return this.settings||(this.settings=this._get("/settings")),yield this.settings})}createRun(e){return g(this,null,function*(){if(!this._filterForSampling([e]).length)return;let t=P(_({},this.headers),{"Content-Type":"application/json"}),r=e.project_name;delete e.project_name;let i=this.prepareRunCreateOrUpdateInputs(P(_({session_name:r},e),{start_time:e.start_time??Date.now()}));if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){this.processRunOperation({action:"create",item:i}).catch(console.error);return}let s=w2(i),o=yield this.caller.call(ae(),`${this.apiUrl}/runs`,_({method:"POST",headers:t,body:xa(s),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(o,"create run",!0)})}batchIngestRuns(r){return g(this,arguments,function*({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let i=e?.map(l=>this.prepareRunCreateOrUpdateInputs(l))??[],s=t?.map(l=>this.prepareRunCreateOrUpdateInputs(l))??[];if(i.length>0&&s.length>0){let l=i.reduce((d,f)=>(f.id&&(d[f.id]=f),d),{}),u=[];for(let d of s)d.id!==void 0&&l[d.id]?l[d.id]=_(_({},l[d.id]),d):u.push(d);i=Object.values(l),s=u}let o={post:this._filterForSampling(i),patch:this._filterForSampling(s,!0)};if(!o.post.length&&!o.patch.length)return;if((yield this._ensureServerInfo()).version===void 0){this.autoBatchTracing=!1;for(let l of o.post)yield this.createRun(l);for(let l of o.patch)l.id!==void 0&&(yield this.updateRun(l.id,l));return}let c={post:[],patch:[]};for(let l of["post","patch"]){let u=l,d=o[u].reverse(),f=d.pop();for(;f!==void 0;)c[u].push(f),f=d.pop()}(c.post.length>0||c.patch.length>0)&&(yield this._postBatchIngestRuns(xa(c)))})}_postBatchIngestRuns(e){return g(this,null,function*(){let t=P(_({},this.headers),{"Content-Type":"application/json",Accept:"application/json"}),r=yield this.batchIngestCaller.call(ae(),`${this.apiUrl}/runs/batch`,_({method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(r,"batch create run",!0)})}multipartIngestRuns(r){return g(this,arguments,function*({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let i={},s=[];for(let f of e??[]){let p=this.prepareRunCreateOrUpdateInputs(f);p.id!==void 0&&p.attachments!==void 0&&(i[p.id]=p.attachments),delete p.attachments,s.push(p)}let o=[];for(let f of t??[])o.push(this.prepareRunCreateOrUpdateInputs(f));if(s.find(f=>f.trace_id===void 0||f.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(o.find(f=>f.trace_id===void 0||f.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&o.length>0){let f=s.reduce((y,w)=>(w.id&&(y[w.id]=w),y),{}),p=[];for(let y of o)y.id!==void 0&&f[y.id]?f[y.id]=_(_({},f[y.id]),y):p.push(y);s=Object.values(f),o=p}if(s.length===0&&o.length===0)return;let l=[],u=[];for(let[f,p]of[["post",s],["patch",o]])for(let y of p){let d=y,{inputs:w,outputs:b,events:E}=d,D=nn(d,["inputs","outputs","events"]),x={inputs:w,outputs:b,events:E},N=xa(D);u.push({name:`${f}.${D.id}`,payload:new Blob([N],{type:`application/json; length=${N.length}`})});for(let[L,F]of Object.entries(x)){if(F===void 0)continue;let T=xa(F);u.push({name:`${f}.${D.id}.${L}`,payload:new Blob([T],{type:`application/json; length=${T.length}`})})}if(D.id!==void 0){let L=i[D.id];if(L){delete i[D.id];for(let[F,[T,A]]of Object.entries(L))u.push({name:`attachment.${D.id}.${F}`,payload:new Blob([A],{type:`${T}; length=${A.length}`})})}}l.push(`trace=${D.trace_id},id=${D.id}`)}yield this._sendMultipartRequest(u,l.join("; "))})}_sendMultipartRequest(e,t){return g(this,null,function*(){try{let r=new FormData;for(let i of e)r.append(i.name,i.payload);yield this.batchIngestCaller.call(ae(),`${this.apiUrl}/runs/multipart`,_({method:"POST",headers:_({},this.headers),body:r,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))}catch(r){let i="Failed to multipart ingest runs";r instanceof Error?i+=`: ${r.stack||r.message}`:i+=`: ${String(r)}`,console.warn(`${i.trim()}

Context: ${t}`)}})}updateRun(e,t){return g(this,null,function*(){Ue(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r=P(_({},t),{id:e});if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization){yield this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}let i=P(_({},this.headers),{"Content-Type":"application/json"}),s=yield this.caller.call(ae(),`${this.apiUrl}/runs/${e}`,_({method:"PATCH",headers:i,body:xa(t),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(s,"update run",!0)})}readRun(r){return g(this,arguments,function*(e,{loadChildRuns:t}={loadChildRuns:!1}){Ue(e);let i=yield this._get(`/runs/${e}`);return t&&i.child_run_ids&&(i=yield this._loadChildRuns(i)),i})}getRunUrl(i){return g(this,arguments,function*({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r?.projectName?s=(yield this.readProject({projectName:r?.projectName})).id:r?.projectId?s=r?.projectId:s=(yield this.readProject({projectName:ws("PROJECT")||"default"})).id;let o=yield this._getTenantId();return`${this.getHostUrl()}/o/${o}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=yield this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")})}_loadChildRuns(e){return g(this,null,function*(){let t=yield sne(this.listRuns({id:e.child_run_ids})),r={},i={};t.sort((s,o)=>(s?.dotted_order??"").localeCompare(o?.dotted_order??""));for(let s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.parent_run_id in r||(r[s.parent_run_id]=[]),r[s.parent_run_id].push(s),i[s.id]=s}e.child_runs=r[e.id]||[];for(let s in r)s!==e.id&&(i[s].child_runs=r[s]);return e})}listRuns(e){return we(this,null,function*(){let{projectId:t,projectName:r,parentRunId:i,traceId:s,referenceExampleId:o,startTime:a,executionOrder:c,isRoot:l,runType:u,error:d,id:f,query:p,filter:y,traceFilter:w,treeFilter:b,limit:E,select:D}=e,x=[];if(t&&(x=Array.isArray(t)?t:[t]),r){let M=Array.isArray(r)?r:[r],O=yield new $(Promise.all(M.map(S=>this.readProject({projectName:S}).then(Pe=>Pe.id))));x.push(...O)}let N=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],L={session:x.length?x:null,run_type:u,reference_example:o,query:p,filter:y,trace_filter:w,tree_filter:b,execution_order:c,parent_run:i,start_time:a?a.toISOString():null,error:d,id:f,limit:E,trace:s,select:D||N,is_root:l},F=0;try{for(var T=Me(this._getCursorPaginatedList("/runs/query",L)),A,C,R;A=!(C=yield new $(T.next())).done;A=!1){let M=C.value;if(E){if(F>=E)break;if(M.length+F>E){let O=M.slice(0,E-F);yield*rn(O);break}F+=M.length,yield*rn(M)}else yield*rn(M)}}catch{R=[C]}finally{try{A&&(C=T.return)&&(yield new $(C.call(T)))}finally{if(R)throw R[0]}}})}getRunStats(E){return g(this,arguments,function*({id:e,trace:t,parentRun:r,runType:i,projectNames:s,projectIds:o,referenceExampleIds:a,startTime:c,endTime:l,error:u,query:d,filter:f,traceFilter:p,treeFilter:y,isRoot:w,dataSourceType:b}){let D=o||[];s&&(D=[...o||[],...yield Promise.all(s.map(T=>this.readProject({projectName:T}).then(A=>A.id)))]);let N=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:D,reference_example:a,start_time:c,end_time:l,error:u,query:d,filter:f,trace_filter:p,tree_filter:y,is_root:w,data_source_type:b}).filter(([T,A])=>A!==void 0));return yield(yield this.caller.call(ae(),`${this.apiUrl}/runs/stats`,_({method:"POST",headers:this.headers,body:JSON.stringify(N),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}shareRun(r){return g(this,arguments,function*(e,{shareId:t}={}){let i={run_id:e,share_token:t||$t()};Ue(e);let o=yield(yield this.caller.call(ae(),`${this.apiUrl}/runs/${e}/share`,_({method:"PUT",headers:this.headers,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();if(o===null||!("share_token"in o))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${o.share_token}/r`})}unshareRun(e){return g(this,null,function*(){Ue(e);let t=yield this.caller.call(ae(),`${this.apiUrl}/runs/${e}/share`,_({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(t,"unshare run",!0)})}readRunSharedLink(e){return g(this,null,function*(){Ue(e);let r=yield(yield this.caller.call(ae(),`${this.apiUrl}/runs/${e}/share`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`})}listSharedRuns(r){return g(this,arguments,function*(e,{runIds:t}={}){let i=new URLSearchParams({share_token:e});if(t!==void 0)for(let a of t)i.append("id",a);return Ue(e),yield(yield this.caller.call(ae(),`${this.apiUrl}/public/${e}/runs${i}`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}readDatasetSharedSchema(e,t){return g(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id),Ue(e);let i=yield(yield this.caller.call(ae(),`${this.apiUrl}/datasets/${e}/share`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i})}shareDataset(e,t){return g(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id);let r={dataset_id:e};Ue(e);let s=yield(yield this.caller.call(ae(),`${this.apiUrl}/datasets/${e}/share`,_({method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s})}unshareDataset(e){return g(this,null,function*(){Ue(e);let t=yield this.caller.call(ae(),`${this.apiUrl}/datasets/${e}/share`,_({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(t,"unshare dataset",!0)})}readSharedDataset(e){return g(this,null,function*(){return Ue(e),yield(yield this.caller.call(ae(),`${this.apiUrl}/public/${e}/datasets`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}listSharedExamples(e,t){return g(this,null,function*(){let r={};t?.exampleIds&&(r.id=t.exampleIds);let i=new URLSearchParams;Object.entries(r).forEach(([a,c])=>{Array.isArray(c)?c.forEach(l=>i.append(a,l)):i.append(a,c)});let s=yield this.caller.call(ae(),`${this.apiUrl}/public/${e}/examples?${i.toString()}`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)),o=yield s.json();if(!s.ok)throw"detail"in o?new Error(`Failed to list shared examples.
Status: ${s.status}
Message: ${o.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${s.status} ${s.statusText}`);return o.map(a=>P(_({},a),{_hostUrl:this.getHostUrl()}))})}createProject(a){return g(this,arguments,function*({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:s=null,referenceDatasetId:o=null}){let c=i?"?upsert=true":"",l=`${this.apiUrl}/sessions${c}`,u=s||{};r&&(u.metadata=r);let d={name:e,extra:u,description:t};o!==null&&(d.reference_dataset_id=o);let f=yield this.caller.call(ae(),l,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(f,"create project"),yield f.json()})}updateProject(a,c){return g(this,arguments,function*(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:s=null,endTime:o=null}){let l=`${this.apiUrl}/sessions/${e}`,u=s;i&&(u=P(_({},u||{}),{metadata:i}));let d={name:t,extra:u,description:r,end_time:o?new Date(o).toISOString():null},f=yield this.caller.call(ae(),l,_({method:"PATCH",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(f,"update project"),yield f.json()})}hasProject(r){return g(this,arguments,function*({projectId:e,projectName:t}){let i="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ue(e),i+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let o=yield this.caller.call(ae(),`${this.apiUrl}${i}?${s}`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));try{let a=yield o.json();return o.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}})}readProject(i){return g(this,arguments,function*({projectId:e,projectName:t,includeStats:r}){let s="/sessions",o=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ue(e),s+=`/${e}`;else if(t!==void 0)o.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&o.append("include_stats",r.toString());let a=yield this._get(s,o),c;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);c=a[0]}else c=a;return c})}getProjectUrl(r){return g(this,arguments,function*({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let i=yield this.readProject({projectId:e,projectName:t}),s=yield this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${i.id}`})}getDatasetUrl(r){return g(this,arguments,function*({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let i=yield this.readDataset({datasetId:e,datasetName:t}),s=yield this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${i.id}`})}_getTenantId(){return g(this,null,function*(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});try{for(var t=Me(this._getPaginated("/sessions",e)),r,i,s;r=!(i=yield t.next()).done;r=!1){let o=i.value;return this._tenantId=o[0].tenant_id,o[0].tenant_id}}catch{s=[i]}finally{try{r&&(i=t.return)&&(yield i.call(t))}finally{if(s)throw s[0]}}throw new Error("No projects found to resolve tenant.")})}listProjects(){return we(this,arguments,function*({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:s,referenceFree:o,metadata:a}={}){let c=new URLSearchParams;if(e!==void 0)for(let p of e)c.append("id",p);if(t!==void 0&&c.append("name",t),r!==void 0&&c.append("name_contains",r),i!==void 0)c.append("reference_dataset",i);else if(s!==void 0){let p=yield new $(this.readDataset({datasetName:s}));c.append("reference_dataset",p.id)}o!==void 0&&c.append("reference_free",o.toString()),a!==void 0&&c.append("metadata",JSON.stringify(a));try{for(var l=Me(this._getPaginated("/sessions",c)),u,d,f;u=!(d=yield new $(l.next())).done;u=!1){let p=d.value;yield*rn(p)}}catch{f=[d]}finally{try{u&&(d=l.return)&&(yield new $(d.call(l)))}finally{if(f)throw f[0]}}})}deleteProject(r){return g(this,arguments,function*({projectId:e,projectName:t}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?i=(yield this.readProject({projectName:t})).id:i=e,Ue(i);let s=yield this.caller.call(ae(),`${this.apiUrl}/sessions/${i}`,_({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(s,`delete session ${i} (${t})`,!0)})}uploadCsv(c){return g(this,arguments,function*({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:s,dataType:o,name:a}){let l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(p=>{u.append("input_keys",p)}),i.forEach(p=>{u.append("output_keys",p)}),s&&u.append("description",s),o&&u.append("data_type",o),a&&u.append("name",a);let d=yield this.caller.call(ae(),l,_({method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(d,"upload CSV"),yield d.json()})}createDataset(a){return g(this,arguments,function*(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:s,metadata:o}={}){let c={name:e,description:t,extra:o?{metadata:o}:void 0};r&&(c.data_type=r),i&&(c.inputs_schema_definition=i),s&&(c.outputs_schema_definition=s);let l=yield this.caller.call(ae(),`${this.apiUrl}/datasets`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(l,"create dataset"),yield l.json()})}readDataset(r){return g(this,arguments,function*({datasetId:e,datasetName:t}){let i="/datasets",s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Ue(e),i+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let o=yield this._get(i,s),a;if(Array.isArray(o)){if(o.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=o[0]}else a=o;return a})}hasDataset(r){return g(this,arguments,function*({datasetId:e,datasetName:t}){try{return yield this.readDataset({datasetId:e,datasetName:t}),!0}catch(i){if(i instanceof Error&&i.message.toLocaleLowerCase().includes("not found"))return!1;throw i}})}diffDatasetVersions(s){return g(this,arguments,function*({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let o=e;if(o===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(yield this.readDataset({datasetName:t})).id);let a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return yield this._get(`/datasets/${o}/versions/diff`,a)})}readDatasetOpenaiFinetuning(r){return g(this,arguments,function*({datasetId:e,datasetName:t}){let i="/datasets";if(e===void 0)if(t!==void 0)e=(yield this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(yield(yield this._getResponse(`${i}/${e}/openai_ft`)).text()).trim().split(`
`).map(c=>JSON.parse(c))})}listDatasets(){return we(this,arguments,function*({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:s,metadata:o}={}){let a="/datasets",c=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(let p of r)c.append("id",p);i!==void 0&&c.append("name",i),s!==void 0&&c.append("name_contains",s),o!==void 0&&c.append("metadata",JSON.stringify(o));try{for(var l=Me(this._getPaginated(a,c)),u,d,f;u=!(d=yield new $(l.next())).done;u=!1){let p=d.value;yield*rn(p)}}catch{f=[d]}finally{try{u&&(d=l.return)&&(yield new $(d.call(l)))}finally{if(f)throw f[0]}}})}updateDataset(e){return g(this,null,function*(){let a=e,{datasetId:t,datasetName:r}=a,i=nn(a,["datasetId","datasetName"]);if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");let s=t??(yield this.readDataset({datasetName:r})).id;Ue(s);let o=yield this.caller.call(ae(),`${this.apiUrl}/datasets/${s}`,_({method:"PATCH",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(o,"update dataset"),yield o.json()})}deleteDataset(r){return g(this,arguments,function*({datasetId:e,datasetName:t}){let i="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(yield this.readDataset({datasetName:t})).id),s!==void 0)Ue(s),i+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");let o=yield this.caller.call(ae(),this.apiUrl+i,_({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(o,`delete ${i}`),yield o.json()})}indexDataset(i){return g(this,arguments,function*({datasetId:e,datasetName:t,tag:r}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(yield this.readDataset({datasetName:t})).id),Ue(s);let o={tag:r},a=yield this.caller.call(ae(),`${this.apiUrl}/datasets/${s}/index`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(a,"index dataset"),yield a.json()})}similarExamples(s,o,a){return g(this,arguments,function*(e,t,r,{filter:i}={}){let c={limit:r,inputs:e};i!==void 0&&(c.filter=i),Ue(t);let l=yield this.caller.call(ae(),`${this.apiUrl}/datasets/${t}/search`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(l,"fetch similar examples"),(yield l.json()).examples})}createExample(u,d,f){return g(this,arguments,function*(e,t,{datasetId:r,datasetName:i,createdAt:s,exampleId:o,metadata:a,split:c,sourceRunId:l}){let p=r;if(p===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(p!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");p===void 0&&(p=(yield this.readDataset({datasetName:i})).id);let w={dataset_id:p,inputs:e,outputs:t,created_at:(s||new Date)?.toISOString(),id:o,metadata:a,split:c,source_run_id:l},b=yield this.caller.call(ae(),`${this.apiUrl}/examples`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(b,"create example"),yield b.json()})}createExamples(e){return g(this,null,function*(){let{inputs:t,outputs:r,metadata:i,sourceRunIds:s,exampleIds:o,datasetId:a,datasetName:c}=e,l=a;if(l===void 0&&c===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&c!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(yield this.readDataset({datasetName:c})).id);let u=t.map((p,y)=>({dataset_id:l,inputs:p,outputs:r?r[y]:void 0,metadata:i?i[y]:void 0,split:e.splits?e.splits[y]:void 0,id:o?o[y]:void 0,source_run_id:s?s[y]:void 0})),d=yield this.caller.call(ae(),`${this.apiUrl}/examples/bulk`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(d,"create examples"),yield d.json()})}createLLMExample(e,t,r){return g(this,null,function*(){return this.createExample({input:e},{output:t},r)})}createChatExample(e,t,r){return g(this,null,function*(){let i=e.map(o=>BC(o)?HC(o):o),s=BC(t)?HC(t):t;return this.createExample({input:i},{output:s},r)})}readExample(e){return g(this,null,function*(){Ue(e);let t=`/examples/${e}`;return yield this._get(t)})}listExamples(){return we(this,arguments,function*({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:s,inlineS3Urls:o,metadata:a,limit:c,offset:l,filter:u}={}){let d;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(t!==void 0)d=(yield new $(this.readDataset({datasetName:t}))).id;else throw new Error("Must provide a datasetName or datasetId");let f=new URLSearchParams({dataset:d}),p=i?typeof i=="string"?i:i?.toISOString():void 0;p&&f.append("as_of",p);let y=o??!0;if(f.append("inline_s3_urls",y.toString()),r!==void 0)for(let N of r)f.append("id",N);if(s!==void 0)for(let N of s)f.append("splits",N);if(a!==void 0){let N=JSON.stringify(a);f.append("metadata",N)}c!==void 0&&f.append("limit",c.toString()),l!==void 0&&f.append("offset",l.toString()),u!==void 0&&f.append("filter",u);let w=0;try{for(var b=Me(this._getPaginated("/examples",f)),E,D,x;E=!(D=yield new $(b.next())).done;E=!1){let N=D.value;for(let L of N)yield L,w++;if(c!==void 0&&w>=c)break}}catch{x=[D]}finally{try{E&&(D=b.return)&&(yield new $(D.call(b)))}finally{if(x)throw x[0]}}})}deleteExample(e){return g(this,null,function*(){Ue(e);let t=`/examples/${e}`,r=yield this.caller.call(ae(),this.apiUrl+t,_({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(r,`delete ${t}`),yield r.json()})}updateExample(e,t){return g(this,null,function*(){Ue(e);let r=yield this.caller.call(ae(),`${this.apiUrl}/examples/${e}`,_({method:"PATCH",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(r,"update example"),yield r.json()})}updateExamples(e){return g(this,null,function*(){let t=yield this.caller.call(ae(),`${this.apiUrl}/examples/bulk`,_({method:"PATCH",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(t,"update examples"),yield t.json()})}listDatasetSplits(i){return g(this,arguments,function*({datasetId:e,datasetName:t,asOf:r}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(yield this.readDataset({datasetName:t})).id:s=e,Ue(s);let o=new URLSearchParams,a=r?typeof r=="string"?r:r?.toISOString():void 0;return a&&o.append("as_of",a),yield this._get(`/datasets/${s}/splits`,o)})}updateDatasetSplits(o){return g(this,arguments,function*({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:s=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(yield this.readDataset({datasetName:t})).id:a=e,Ue(a);let c={split_name:r,examples:i.map(u=>(Ue(u),u)),remove:s},l=yield this.caller.call(ae(),`${this.apiUrl}/datasets/${a}/splits`,_({method:"PUT",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(l,"update dataset splits",!0)})}evaluateRun(o,a){return g(this,arguments,function*(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:s}={loadChildRuns:!1}){gy("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let c;if(typeof e=="string")c=yield this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)c=e;else throw new Error(`Invalid run type: ${typeof e}`);c.reference_example_id!==null&&c.reference_example_id!==void 0&&(s=yield this.readExample(c.reference_example_id));let l=yield t.evaluateRun(c,s),[u,d]=yield this._logEvaluationFeedback(l,c,r);return d[0]})}createFeedback(y,w,b){return g(this,arguments,function*(e,t,{score:r,value:i,correction:s,comment:o,sourceInfo:a,feedbackSourceType:c="api",sourceRunId:l,feedbackId:u,feedbackConfig:d,projectId:f,comparativeExperimentId:p}){if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");let E={type:c??"api",metadata:a??{}};l!==void 0&&E?.metadata!==void 0&&!E.metadata.__run&&(E.metadata.__run={run_id:l}),E?.metadata!==void 0&&E.metadata.__run?.run_id!==void 0&&Ue(E.metadata.__run.run_id);let D={id:u??$t(),run_id:e,key:t,score:r,value:i,correction:s,comment:o,feedback_source:E,comparative_experiment_id:p,feedbackConfig:d,session_id:f},x=`${this.apiUrl}/feedback`,N=yield this.caller.call(ae(),x,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(D),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(N,"create feedback",!0),D})}updateFeedback(o,a){return g(this,arguments,function*(e,{score:t,value:r,correction:i,comment:s}){let c={};t!=null&&(c.score=t),r!=null&&(c.value=r),i!=null&&(c.correction=i),s!=null&&(c.comment=s),Ue(e);let l=yield this.caller.call(ae(),`${this.apiUrl}/feedback/${e}`,_({method:"PATCH",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(l,"update feedback",!0)})}readFeedback(e){return g(this,null,function*(){Ue(e);let t=`/feedback/${e}`;return yield this._get(t)})}deleteFeedback(e){return g(this,null,function*(){Ue(e);let t=`/feedback/${e}`,r=yield this.caller.call(ae(),this.apiUrl+t,_({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(r,`delete ${t}`),yield r.json()})}listFeedback(){return we(this,arguments,function*({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let i=new URLSearchParams;if(e&&i.append("run",e.join(",")),t)for(let l of t)i.append("key",l);if(r)for(let l of r)i.append("source",l);try{for(var s=Me(this._getPaginated("/feedback",i)),o,a,c;o=!(a=yield new $(s.next())).done;o=!1){let l=a.value;yield*rn(l)}}catch{c=[a]}finally{try{o&&(a=s.return)&&(yield new $(a.call(s)))}finally{if(c)throw c[0]}}})}createPresignedFeedbackToken(s,o){return g(this,arguments,function*(e,t,{expiration:r,feedbackConfig:i}={}){let a={run_id:e,feedback_key:t,feedback_config:i};return r?typeof r=="string"?a.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(a.expires_in=r):a.expires_in={hours:3},yield(yield this.caller.call(ae(),`${this.apiUrl}/feedback/tokens`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}createComparativeExperiment(c){return g(this,arguments,function*({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:s,metadata:o,id:a}){if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(yield this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");let l={id:a,name:e,experiment_ids:t,reference_dataset_id:r,description:s,created_at:(i??new Date)?.toISOString(),extra:{}};return o&&(l.extra.metadata=o),yield(yield this.caller.call(ae(),`${this.apiUrl}/datasets/comparative`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}listPresignedFeedbackTokens(e){return we(this,null,function*(){Ue(e);let t=new URLSearchParams({run_id:e});try{for(var r=Me(this._getPaginated("/feedback/tokens",t)),i,s,o;i=!(s=yield new $(r.next())).done;i=!1){let a=s.value;yield*rn(a)}}catch{o=[s]}finally{try{i&&(s=r.return)&&(yield new $(s.call(r)))}finally{if(o)throw o[0]}}})}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}_logEvaluationFeedback(e,t,r){return g(this,null,function*(){let i=this._selectEvalResults(e),s=[];for(let o of i){let a=r||{};o.evaluatorInfo&&(a=_(_({},o.evaluatorInfo),a));let c=null;o.targetRunId?c=o.targetRunId:t&&(c=t.id),s.push(yield this.createFeedback(c,o.key,{score:o.score,value:o.value,comment:o.comment,correction:o.correction,sourceInfo:a,sourceRunId:o.sourceRunId,feedbackConfig:o.feedbackConfig,feedbackSourceType:"model"}))}return[i,s]})}logEvaluationFeedback(e,t,r){return g(this,null,function*(){let[i]=yield this._logEvaluationFeedback(e,t,r);return i})}listAnnotationQueues(){return we(this,arguments,function*(e={}){let{queueIds:t,name:r,nameContains:i,limit:s}=e,o=new URLSearchParams;t&&t.forEach((f,p)=>{Ue(f,`queueIds[${p}]`),o.append("ids",f)}),r&&o.append("name",r),i&&o.append("name_contains",i),o.append("limit",(s!==void 0?Math.min(s,100):100).toString());let a=0;try{for(var c=Me(this._getPaginated("/annotation-queues",o)),l,u,d;l=!(u=yield new $(c.next())).done;l=!1){let f=u.value;if(yield*rn(f),a++,s!==void 0&&a>=s)break}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new $(u.call(c)))}finally{if(d)throw d[0]}}})}createAnnotationQueue(e){return g(this,null,function*(){let{name:t,description:r,queueId:i}=e,s={name:t,description:r,id:i||$t()},o=yield this.caller.call(ae(),`${this.apiUrl}/annotation-queues`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(([c,l])=>l!==void 0))),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(o,"create annotation queue"),yield o.json()})}readAnnotationQueue(e){return g(this,null,function*(){let t=yield this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value})}updateAnnotationQueue(e,t){return g(this,null,function*(){let{name:r,description:i}=t,s=yield this.caller.call(ae(),`${this.apiUrl}/annotation-queues/${Ue(e,"queueId")}`,_({method:"PATCH",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify({name:r,description:i}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(s,"update annotation queue")})}deleteAnnotationQueue(e){return g(this,null,function*(){let t=yield this.caller.call(ae(),`${this.apiUrl}/annotation-queues/${Ue(e,"queueId")}`,_({method:"DELETE",headers:P(_({},this.headers),{Accept:"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(t,"delete annotation queue")})}addRunsToAnnotationQueue(e,t){return g(this,null,function*(){let r=yield this.caller.call(ae(),`${this.apiUrl}/annotation-queues/${Ue(e,"queueId")}/runs`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(t.map((i,s)=>Ue(i,`runIds[${s}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(r,"add runs to annotation queue")})}getRunFromAnnotationQueue(e,t){return g(this,null,function*(){let r=`/annotation-queues/${Ue(e,"queueId")}/run`,i=yield this.caller.call(ae(),`${this.apiUrl}${r}/${t}`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(i,"get run from annotation queue"),yield i.json()})}_currentTenantIsOwner(e){return g(this,null,function*(){let t=yield this._getSettings();return e=="-"||t.tenant_handle===e})}_ownerConflictError(e,t){return g(this,null,function*(){let r=yield this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)})}_getLatestCommitHash(e){return g(this,null,function*(){let t=yield this.caller.call(ae(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)),r=yield t.json();if(!t.ok){let i=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),s=new Error(`Error ${t.status}: ${t.statusText}
${i}`);throw s.statusCode=t.status,s}if(r.commits.length!==0)return r.commits[0].commit_hash})}_likeOrUnlikePrompt(e,t){return g(this,null,function*(){let[r,i,s]=vs(e),o=yield this.caller.call(ae(),`${this.apiUrl}/likes/${r}/${i}`,_({method:"POST",body:JSON.stringify({like:t}),headers:P(_({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(o,`${t?"like":"unlike"} prompt`),yield o.json()})}_getPromptUrl(e){return g(this,null,function*(){let[t,r,i]=vs(e);if(yield this._currentTenantIsOwner(t)){let s=yield this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${s.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${s.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`})}promptExists(e){return g(this,null,function*(){return!!(yield this.getPrompt(e))})}likePrompt(e){return g(this,null,function*(){return this._likeOrUnlikePrompt(e,!0)})}unlikePrompt(e){return g(this,null,function*(){return this._likeOrUnlikePrompt(e,!1)})}listCommits(e){return we(this,null,function*(){try{for(var t=Me(this._getPaginated(`/commits/${e}/`,new URLSearchParams,a=>a.commits)),r,i,s;r=!(i=yield new $(t.next())).done;r=!1){let o=i.value;yield*rn(o)}}catch{s=[i]}finally{try{r&&(i=t.return)&&(yield new $(i.call(t)))}finally{if(s)throw s[0]}}})}listPrompts(e){return we(this,null,function*(){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);try{for(var r=Me(this._getPaginated("/repos",t,c=>c.repos)),i,s,o;i=!(s=yield new $(r.next())).done;i=!1){let a=s.value;yield*rn(a)}}catch{o=[s]}finally{try{i&&(s=r.return)&&(yield new $(s.call(r)))}finally{if(o)throw o[0]}}})}getPrompt(e){return g(this,null,function*(){let[t,r,i]=vs(e),s=yield this.caller.call(ae(),`${this.apiUrl}/repos/${t}/${r}`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));if(s.status===404)return null;yield Fe(s,"get prompt");let o=yield s.json();return o.repo?o.repo:null})}createPrompt(e,t){return g(this,null,function*(){let r=yield this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,s,o]=vs(e);if(!(yield this._currentTenantIsOwner(i)))throw yield this._ownerConflictError("create a prompt",i);let a=P(_(_(_({repo_handle:s},t?.description&&{description:t.description}),t?.readme&&{readme:t.readme}),t?.tags&&{tags:t.tags}),{is_public:!!t?.isPublic}),c=yield this.caller.call(ae(),`${this.apiUrl}/repos/`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(c,"create prompt");let{repo:l}=yield c.json();return l})}createCommit(e,t,r){return g(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[i,s,o]=vs(e),a=r?.parentCommitHash==="latest"||!r?.parentCommitHash?yield this._getLatestCommitHash(`${i}/${s}`):r?.parentCommitHash,c={manifest:JSON.parse(JSON.stringify(t)),parent_commit:a},l=yield this.caller.call(ae(),`${this.apiUrl}/commits/${i}/${s}`,_({method:"POST",headers:P(_({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(l,"create commit");let u=yield l.json();return this._getPromptUrl(`${i}/${s}${u.commit_hash?`:${u.commit_hash}`:""}`)})}updatePrompt(e,t){return g(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[r,i]=vs(e);if(!(yield this._currentTenantIsOwner(r)))throw yield this._ownerConflictError("update a prompt",r);let s={};if(t?.description!==void 0&&(s.description=t.description),t?.readme!==void 0&&(s.readme=t.readme),t?.tags!==void 0&&(s.tags=t.tags),t?.isPublic!==void 0&&(s.is_public=t.isPublic),t?.isArchived!==void 0&&(s.is_archived=t.isArchived),Object.keys(s).length===0)throw new Error("No valid update options provided");let o=yield this.caller.call(ae(),`${this.apiUrl}/repos/${r}/${i}`,_({method:"PATCH",body:JSON.stringify(s),headers:P(_({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield Fe(o,"update prompt"),o.json()})}deletePrompt(e){return g(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[t,r,i]=vs(e);if(!(yield this._currentTenantIsOwner(t)))throw yield this._ownerConflictError("delete a prompt",t);return yield(yield this.caller.call(ae(),`${this.apiUrl}/repos/${t}/${r}`,_({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}pullPromptCommit(e,t){return g(this,null,function*(){let[r,i,s]=vs(e),o=yield this._getServerInfo(),a=_2(o.version,"0.5.23"),c=s;if(!a&&s==="latest"){let d=yield this._getLatestCommitHash(`${r}/${i}`);if(d)c=d;else throw new Error("No commits found")}let l=yield this.caller.call(ae(),`${this.apiUrl}/commits/${r}/${i}/${c}${t?.includeModel?"?include_model=true":""}`,_({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield Fe(l,"pull prompt commit");let u=yield l.json();return{owner:r,repo:i,commit_hash:u.commit_hash,manifest:u.manifest,examples:u.examples}})}_pullPrompt(e,t){return g(this,null,function*(){let r=yield this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(r.manifest)})}pushPrompt(e,t){return g(this,null,function*(){return(yield this.promptExists(e))?t&&Object.keys(t).some(i=>i!=="object")&&(yield this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic})):yield this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?yield this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):yield this._getPromptUrl(e)})}clonePublicDataset(r){return g(this,arguments,function*(e,t={}){let{sourceApiUrl:i=this.apiUrl,datasetName:s}=t,[o,a]=this.parseTokenOrUrl(e,i),c=new n({apiUrl:o,apiKey:"placeholder"}),l=yield c.readSharedDataset(a),u=s||l.name;try{if(yield this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}let d=yield c.listSharedExamples(a),f=yield this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{yield this.createExamples({inputs:d.map(p=>p.inputs),outputs:d.flatMap(p=>p.outputs?[p.outputs]:[]),datasetId:f.id})}catch(p){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),p}})}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return Ue(e),[t,e]}catch{}try{let o=new URL(e).pathname.split("/").filter(a=>a!=="");if(o.length>=r){let a=o[o.length-r];return[t,a]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}awaitPendingTraceBatches(){return Promise.all(this.autoBatchQueue.items.map(({itemPromise:e})=>e))}};var Ry="0.1.68";var bs,lne=()=>typeof window<"u"&&typeof window.document<"u",une=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",dne=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),E2=()=>typeof Deno<"u",hne=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!E2(),fne=()=>bs||(lne()?bs="browser":hne()?bs="node":une()?bs="webworker":dne()?bs="jsdom":E2()?bs="deno":bs="other",bs),pS;function Py(){if(pS===void 0){let n=fne(),e=mne();pS=_({library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:Ry},e)}return pS}function b2(){let n=pne()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[r,i]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof i=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[r]=i);return e}function pne(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function wo(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}function ws(n){return wo(`LANGSMITH_${n}`)||wo(`LANGCHAIN_${n}`)}var mS;function mne(){if(mS!==void 0)return mS;let n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of n){let r=wo(t);r!==void 0&&(e[t]=r)}return mS=e,e}var I2=n=>n!==void 0?n:!!["TRACING_V2","TRACING"].find(t=>ws(t)==="true");var My=Symbol.for("lc:context_variables");function gne(n){return n.replace(/[-:.]/g,"")}function yne(n,e,t=1){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return gne(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}var Ny=class n{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){let t=e.split(","),r={},i=[];for(let s of t){let[o,a]=s.split("="),c=decodeURIComponent(a);o==="langsmith-metadata"?r=JSON.parse(c):o==="langsmith-tags"&&(i=c.split(","))}return new n(r,i)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}},vo=class n{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),gS(e)){Object.assign(this,_({},e));return}let t=n.getDefaultConfig(),a=e,{metadata:r}=a,i=nn(a,["metadata"]),s=i.client??n.getSharedClient(),o=_(_({},r),i?.extra?.metadata);if(i.extra=P(_({},i.extra),{metadata:o}),Object.assign(this,P(_(_({},t),i),{client:s})),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let c=yne(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+c:this.dotted_order=c}}static getDefaultConfig(){return{id:$t(),run_type:"chain",project_name:wo("LANGCHAIN_PROJECT")??wo("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:wo("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:wo("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return n.sharedClient||(n.sharedClient=new Ra),n.sharedClient}createChild(e){let t=this.child_execution_order+1,r=new n(P(_({},e),{parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t}));My in this&&(r[My]=this[My]);let i=Symbol.for("lc:child_config"),s=e.extra?.[i]??this.extra[i];if(vne(s)){let c=_({},s),l=_ne(c.callbacks)?c.callbacks.copy?.():void 0;l&&(Object.assign(l,{_parentRunId:r.id}),l.handlers?.find(T2)?.updateFromRunTree?.(r),c.callbacks=l),r.extra[i]=c}let o=new Set,a=this;for(;a!=null&&!o.has(a.id);)o.add(a.id),a.child_execution_order=Math.max(a.child_execution_order,t),a=a.parent_run;return this.child_runs.push(r),r}end(s,o){return g(this,arguments,function*(e,t,r=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?P(_({},this.extra),{metadata:_(_({},this.extra.metadata),i)}):{metadata:i})})}_convertToCreate(e,t,r=!0){let i=e.extra??{};if(i.runtime||(i.runtime={}),t)for(let[c,l]of Object.entries(t))i.runtime[c]||(i.runtime[c]=l);let s,o;return r?(o=e.parent_run?.id,s=[]):(s=e.child_runs.map(c=>this._convertToCreate(c,t,r)),o=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:s,parent_run_id:o,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}postRun(e=!0){return g(this,null,function*(){try{let t=Py(),r=yield this._convertToCreate(this,t,!0);if(yield this.client.createRun(r),!e){gy("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let i of this.child_runs)yield i.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}})}patchRun(){return g(this,null,function*(){try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};yield this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}})}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){let r=e?.callbacks,i,s,o,a=I2();if(r){let l=r?.getParentRunId?.()??"",u=r?.handlers?.find(d=>d?.name=="langchain_tracer");i=u?.getRun?.(l),s=u?.projectName,o=u?.client,a=a||!!u}return i?new n({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:o,tracingEnabled:a,project_name:s,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:_(_({},i?.extra?.metadata),e?.metadata)}}).createChild(t):new n(P(_({},t),{client:o,tracingEnabled:a,project_name:s}))}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=r["langsmith-trace"];if(!i||typeof i!="string")return;let s=i.trim(),o=s.split(".").map(l=>{let[u,d]=l.split("Z");return{strTime:u,time:Date.parse(u+"Z"),uuid:d}}),a=o[0].uuid,c=P(_({},t),{name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:o.at(-1)?.uuid,trace_id:a,dotted_order:s});if(r.baggage&&typeof r.baggage=="string"){let l=Ny.fromHeader(r.baggage);c.metadata=l.metadata,c.tags=l.tags}return new n(c)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new Ny(this.extra?.metadata,this.tags).toHeader()};if(e)for(let[r,i]of Object.entries(t))e.set(r,i);return t}};Object.defineProperty(vo,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function gS(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function T2(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function A2(n){return Array.isArray(n)&&n.some(e=>T2(e))}function _ne(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function vne(n){return n!==void 0&&typeof n.callbacks=="object"&&(A2(n.callbacks?.handlers)||A2(n.callbacks))}var _S=class{getStore(){}run(e,t){return t()}},yS=Symbol.for("ls:tracing_async_local_storage"),wne=new _S,vS=class{getInstance(){return globalThis[yS]??wne}initializeGlobalInstance(e){globalThis[yS]===void 0&&(globalThis[yS]=e)}},bne=new vS,C2=()=>{let n=bne.getInstance().getStore();if(!gS(n))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return n};var zve=Symbol.for("langsmith:traceable:root");function Oy(n){return typeof n=="function"&&"langsmith:traceable"in n}var wS={};lx(wS,{JsonPatchError:()=>Dt,_areEquals:()=>oh,applyOperation:()=>Ma,applyPatch:()=>Na,applyReducer:()=>Tne,deepClone:()=>Ine,getValueByPointer:()=>Vy,validate:()=>R2,validator:()=>jy});var Ene=Object.prototype.hasOwnProperty;function D2(n,e){return Ene.call(n,e)}function x2(n){if(Array.isArray(n)){let t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)D2(n,t)&&e.push(t);return e}function Sr(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function Ly(n){let e=0,t=n.length,r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Fy(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function sh(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function ky(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(ky(n[t]))return!0}else if(typeof n=="object"){let t=x2(n),r=t.length;for(var e=0;e<r;e++)if(ky(n[t[e]]))return!0}}return!1}function S2(n,e){let t=[n];for(let r in e){let i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(`${r}: ${i}`)}return t.join(`
`)}var Pa=class extends Error{constructor(e,t,r,i,s){super(S2(e,{name:t,index:r,operation:i,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=S2(e,{name:t,index:r,operation:i,tree:s})}};var Dt=Pa,Ine=Sr,Tl={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=Vy(t,this.path);r&&(r=Sr(r));let i=Ma(t,{op:"remove",path:this.from}).removed;return Ma(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){let r=Vy(t,this.from);return Ma(t,{op:"add",path:this.path,value:Sr(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:oh(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},Ane={add:function(n,e,t){return Ly(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Tl.move,copy:Tl.copy,test:Tl.test,_get:Tl._get};function Vy(n,e){if(e=="")return n;var t={op:"_get",path:e};return Ma(n,t),t.value}function Ma(n,e,t=!1,r=!0,i=!0,s=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):jy(e,0)),e.path===""){let o={newDocument:n};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=n,o;if(e.op==="move"||e.op==="copy")return o.newDocument=Vy(n,e.from),e.op==="move"&&(o.removed=n),o;if(e.op==="test"){if(o.test=oh(n,e.value),o.test===!1)throw new Dt("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o.newDocument=n,o}else{if(e.op==="remove")return o.removed=n,o.newDocument=null,o;if(e.op==="_get")return e.value=n,o;if(t)throw new Dt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,n);return o}}else{r||(n=Sr(n));let a=(e.path||"").split("/"),c=n,l=1,u=a.length,d,f,p;for(typeof t=="function"?p=t:p=jy;;){if(f=a[l],f&&f.indexOf("~")!=-1&&(f=sh(f)),i&&(f=="__proto__"||f=="prototype"&&l>0&&a[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(c[f]===void 0?d=a.slice(0,l).join("/"):l==u-1&&(d=e.path),d!==void 0&&p(e,0,n,d)),l++,Array.isArray(c)){if(f==="-")f=c.length;else{if(t&&!Ly(f))throw new Dt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,n);Ly(f)&&(f=~~f)}if(l>=u){if(t&&e.op==="add"&&f>c.length)throw new Dt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,n);let y=Ane[e.op].call(e,c,f,n);if(y.test===!1)throw new Dt("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return y}}else if(l>=u){let y=Tl[e.op].call(e,c,f,n);if(y.test===!1)throw new Dt("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return y}if(c=c[f],t&&l<u&&(!c||typeof c!="object"))throw new Dt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,n)}}}function Na(n,e,t,r=!0,i=!0){if(t&&!Array.isArray(e))throw new Dt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=Sr(n));let s=new Array(e.length);for(let o=0,a=e.length;o<a;o++)s[o]=Ma(n,e[o],t,!0,i,o),n=s[o].newDocument;return s.newDocument=n,s}function Tne(n,e,t){let r=Ma(n,e);if(r.test===!1)throw new Dt("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return r.newDocument}function jy(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new Dt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Tl[n.op]){if(typeof n.path!="string")throw new Dt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new Dt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new Dt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new Dt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&ky(n.value))throw new Dt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Dt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new Dt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var o={op:"_get",path:n.from,value:void 0},a=R2([o],t);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Dt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new Dt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function R2(n,e,t){try{if(!Array.isArray(n))throw new Dt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Na(Sr(e),Sr(n),t||!0);else{t=t||jy;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof Dt)return i;throw i}}function oh(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,s,o;if(t&&r){if(s=n.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!oh(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var a=Object.keys(n);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!oh(n[o],e[o]))return!1;return!0}return n!==n&&e!==e}var twe=P(_({},wS),{JsonPatchError:Pa,deepClone:Sr,escapePathComponent:Fy,unescapePathComponent:sh});var $2=Or(M2(),1),Mne=Or(j2(),1);function U2(n,e){return e?.[n]||(0,$2.default)(n)}function B2(n,e,t){let r={};for(let i in n)Object.hasOwn(n,i)&&(r[e(i,t)]=n[i]);return r}function H2(n){return Array.isArray(n)?[...n]:_({},n)}function Nne(n,e){let t=H2(n);for(let[r,i]of Object.entries(e)){let[s,...o]=r.split(".").reverse(),a=t;for(let c of o.reverse()){if(a[c]===void 0)break;a[c]=H2(a[c]),a=a[c]}a[s]!==void 0&&(a[s]={lc:1,type:"secret",id:[i]})}return t}function ES(n){let e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}var Es=class n{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ES(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof n||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((i,s)=>(i[s]=s in this?this[s]:this.lc_kwargs[s],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(r,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(i=>{let s=this,o=r,[a,...c]=i.split(".").reverse();for(let l of c.reverse()){if(!(l in s)||s[l]===void 0)return;(!(l in o)||o[l]===void 0)&&(typeof s[l]=="object"&&s[l]!=null?o[l]={}:Array.isArray(s[l])&&(o[l]=[])),s=s[l],o=o[l]}a in s&&s[a]!==void 0&&(o[a]=o[a]||s[a])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:B2(Object.keys(t).length?Nne(r,t):r,U2,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};var One=()=>typeof window<"u"&&typeof window.document<"u",kne=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Lne=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),q2=()=>typeof Deno<"u",Fne=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!q2(),Vne=()=>{let n;return One()?n="browser":Fne()?n="node":kne()?n="webworker":Lne()?n="jsdom":q2()?n="deno":n="other",n},IS;function z2(){return g(this,null,function*(){return IS===void 0&&(IS={library:"langchain-js",runtime:Vne()}),IS})}function ti(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}var AS=class{},Oa=class n extends AS{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ES(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:ti("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Es.prototype.toJSON.call(this)}toJSONNotImplemented(){return Es.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends n{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:$t()}),Object.assign(this,e)}}return new t}};function TS(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function jne(n){return n.replace(/[-:.]/g,"")}function $ne(n,e,t){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return jne(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Cl(n){return typeof n._addRunToRunMap=="function"}var Dr=class extends Oa{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let t=$ne(e.start_time,e.id,e.execution_order),r=_({},e);if(r.parent_run_id!==void 0){let i=this.runMap.get(r.parent_run_id);i&&(this._addChildRun(i,r),i.child_execution_order=Math.max(i.child_execution_order,r.child_execution_order),r.trace_id=i.trace_id,i.dotted_order!==void 0&&(r.dotted_order=[i.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}_endTrace(e){return g(this,null,function*(){let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):yield this.persistRun(e),this.runMap.delete(e.id),yield this.onRunUpdate?.(e)})}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,i,s,o,a,c){let l=this._getExecutionOrder(i),u=Date.now(),d=a?P(_({},s),{metadata:a}):s,f={id:r,name:c??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:o||[]};return this._addRunToRunMap(f)}handleLLMStart(e,t,r,i,s,o,a,c){return g(this,null,function*(){let l=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,i,s,o,a,c);return yield this.onRunCreate?.(l),yield this.onLLMStart?.(l),l})}_createRunForChatModelStart(e,t,r,i,s,o,a,c){let l=this._getExecutionOrder(i),u=Date.now(),d=a?P(_({},s),{metadata:a}):s,f={id:r,name:c??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:o||[]};return this._addRunToRunMap(f)}handleChatModelStart(e,t,r,i,s,o,a,c){return g(this,null,function*(){let l=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,i,s,o,a,c);return yield this.onRunCreate?.(l),yield this.onLLMStart?.(l),l})}handleLLMEnd(e,t){return g(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),yield this.onLLMEnd?.(r),yield this._endTrace(r),r})}handleLLMError(e,t){return g(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),yield this.onLLMError?.(r),yield this._endTrace(r),r})}_createRunForChainStart(e,t,r,i,s,o,a,c){let l=this._getExecutionOrder(i),u=Date.now(),d={id:r,name:c??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:a??"chain",child_runs:[],extra:o?{metadata:o}:{},tags:s||[]};return this._addRunToRunMap(d)}handleChainStart(e,t,r,i,s,o,a,c){return g(this,null,function*(){let l=this.runMap.get(r)??this._createRunForChainStart(e,t,r,i,s,o,a,c);return yield this.onRunCreate?.(l),yield this.onChainStart?.(l),l})}handleChainEnd(e,t,r,i,s){return g(this,null,function*(){let o=this.runMap.get(t);if(!o)throw new Error("No chain run to end.");return o.end_time=Date.now(),o.outputs=TS(e,"output"),o.events.push({name:"end",time:new Date(o.end_time).toISOString()}),s?.inputs!==void 0&&(o.inputs=TS(s.inputs,"input")),yield this.onChainEnd?.(o),yield this._endTrace(o),o})}handleChainError(e,t,r,i,s){return g(this,null,function*(){let o=this.runMap.get(t);if(!o)throw new Error("No chain run to end.");return o.end_time=Date.now(),o.error=this.stringifyError(e),o.events.push({name:"error",time:new Date(o.end_time).toISOString()}),s?.inputs!==void 0&&(o.inputs=TS(s.inputs,"input")),yield this.onChainError?.(o),yield this._endTrace(o),o})}_createRunForToolStart(e,t,r,i,s,o,a){let c=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:a??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:c,child_execution_order:c,run_type:"tool",child_runs:[],extra:o?{metadata:o}:{},tags:s||[]};return this._addRunToRunMap(u)}handleToolStart(e,t,r,i,s,o,a){return g(this,null,function*(){let c=this.runMap.get(r)??this._createRunForToolStart(e,t,r,i,s,o,a);return yield this.onRunCreate?.(c),yield this.onToolStart?.(c),c})}handleToolEnd(e,t){return g(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),yield this.onToolEnd?.(r),yield this._endTrace(r),r})}handleToolError(e,t){return g(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),yield this.onToolError?.(r),yield this._endTrace(r),r})}handleAgentAction(e,t){return g(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="chain")return;let i=r;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentAction?.(r)})}handleAgentEnd(e,t){return g(this,null,function*(){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentEnd?.(r))})}_createRunForRetrieverStart(e,t,r,i,s,o,a){let c=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:a??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:c,child_execution_order:c,run_type:"retriever",child_runs:[],extra:o?{metadata:o}:{},tags:s||[]};return this._addRunToRunMap(u)}handleRetrieverStart(e,t,r,i,s,o,a){return g(this,null,function*(){let c=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,i,s,o,a);return yield this.onRunCreate?.(c),yield this.onRetrieverStart?.(c),c})}handleRetrieverEnd(e,t){return g(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),yield this.onRetrieverEnd?.(r),yield this._endTrace(r),r})}handleRetrieverError(e,t){return g(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),yield this.onRetrieverError?.(r),yield this._endTrace(r),r})}handleText(e,t){return g(this,null,function*(){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),yield this.onText?.(r))})}handleLLMNewToken(e,t,r,i,s,o){return g(this,null,function*(){let a=this.runMap.get(r);if(!a||a?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return a.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:o?.chunk}}),yield this.onLLMNewToken?.(a,e,{chunk:o?.chunk}),a})}};var CS=Or(Y2(),1);function jn(n,e){return`${n.open}${e}${n.close}`}function xr(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function Q2(n){return typeof n=="string"?n.trim():n==null?n:xr(n,n.toString())}function bo(n){if(!n.end_time)return"";let e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:Jn}=CS.default,ah=class extends Dr{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let i=this.runMap.get(r.parent_run_id);if(i)t.push(i),r=i;else break}return t}getBreadcrumbs(e){let r=[...this.getParents(e).reverse(),e].map((i,s,o)=>{let a=`${i.execution_order}:${i.run_type}:${i.name}`;return s===o.length-1?jn(CS.default.bold,a):a}).join(" > ");return jn(Jn.grey,r)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.green,"[chain/start]")} [${t}] Entering Chain run with input: ${xr(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.cyan,"[chain/end]")} [${t}] [${bo(e)}] Exiting Chain run with output: ${xr(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.red,"[chain/error]")} [${t}] [${bo(e)}] Chain run errored with error: ${xr(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${jn(Jn.green,"[llm/start]")} [${t}] Entering LLM run with input: ${xr(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.cyan,"[llm/end]")} [${t}] [${bo(e)}] Exiting LLM run with output: ${xr(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.red,"[llm/error]")} [${t}] [${bo(e)}] LLM run errored with error: ${xr(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Q2(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.cyan,"[tool/end]")} [${t}] [${bo(e)}] Exiting Tool run with output: "${Q2(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.red,"[tool/error]")} [${t}] [${bo(e)}] Tool run errored with error: ${xr(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${xr(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.cyan,"[retriever/end]")} [${t}] [${bo(e)}] Exiting Retriever run with output: ${xr(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${jn(Jn.red,"[retriever/error]")} [${t}] [${bo(e)}] Retriever run errored with error: ${xr(e.error,"[error]")}`)}onAgentAction(e){let t=e,r=this.getBreadcrumbs(e);console.log(`${jn(Jn.blue,"[agent/action]")} [${r}] Agent selected action: ${xr(t.actions[t.actions.length-1],"[action]")}`)}};function SS(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}var $y=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}};function X2(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="",t=[],r=!1,i=!1;for(let s of n){if(r)s==='"'&&!i?r=!1:s===`
`&&!i?s="\\n":s==="\\"?i=!i:i=!1;else if(s==='"')r=!0,i=!1;else if(s==="{")t.push("}");else if(s==="[")t.push("]");else if(s==="}"||s==="]")if(t&&t[t.length-1]===s)t.pop();else return null;e+=s}r&&(e+='"');for(let s=t.length-1;s>=0;s-=1)e+=t[s];try{return JSON.parse(e)}catch{return null}}function ka(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?Uy(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function Bne(n,e){function t(r,i){if(typeof r!="object"||r===null||r===void 0)return r;if(i>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(o=>t(o,i+1));let s={};for(let o of Object.keys(r))s[o]=t(r[o],i+1);return s}return JSON.stringify(t(n,0),null,2)}var Is=class extends Es{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=Bne(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};function ji(n,e){let t=_({},n);for(let[r,i]of Object.entries(e))if(t[r]==null)t[r]=i;else{if(i==null)continue;if(typeof t[r]!=typeof i||Array.isArray(t[r])!==Array.isArray(i))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=i}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=ji(t[r],i);else if(Array.isArray(t[r]))t[r]=Uy(t[r],i);else{if(t[r]===i)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function Uy(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{let t=[...n];for(let r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){let i=t.findIndex(s=>s.index===r.index);i!==-1?t[i]=ji(t[i],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}var As=class extends Is{};var La=class n extends As{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t=P(_({},e),{tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]});else{let r=[],i=[];for(let s of e.tool_call_chunks){let o={};try{if(o=X2(s.args||"{}"),o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");r.push({name:s.name??"",args:o,id:s.id,type:"tool_call"})}catch{i.push({name:s.name,args:s.args,id:s.id,error:"Malformed args.",type:"invalid_tool_call"})}}t=P(_({},e),{tool_calls:r,invalid_tool_calls:i})}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return P(_({},super.lc_aliases),{tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"})}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return P(_({},super._printableFields),{tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata})}concat(e){let t={content:ka(this.content,e.content),additional_kwargs:ji(this.additional_kwargs,e.additional_kwargs),response_metadata:ji(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let r=Uy(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s={input_tokens:r.input_tokens+i.input_tokens,output_tokens:r.output_tokens+i.output_tokens,total_tokens:r.total_tokens+i.total_tokens};t.usage_metadata=s}return new n(t)}};function Z2(n,e="Human",t="AI"){let r=[];for(let i of n){let s;if(i._getType()==="human")s=e;else if(i._getType()==="ai")s=t;else if(i._getType()==="system")s="System";else if(i._getType()==="function")s="Function";else if(i._getType()==="tool")s="Tool";else if(i._getType()==="generic")s=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);let o=i.name?`${i.name}, `:"",a=typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2);r.push(`${s}: ${o}${a}`)}return r.join(`
`)}var Sl=class n extends Dr{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:i}=e;this.projectName=r??ti("LANGCHAIN_PROJECT")??ti("LANGCHAIN_SESSION"),this.exampleId=t,this.client=i??new Ra({});let s=n.getTraceableRunTree();s&&this.updateFromRunTree(s)}_convertToCreate(e,t=void 0){return g(this,null,function*(){return P(_({},e),{extra:P(_({},e.extra),{runtime:yield z2()}),child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t})})}persistRun(e){return g(this,null,function*(){})}onRunCreate(e){return g(this,null,function*(){let t=yield this._convertToCreate(e,this.exampleId);yield this.client.createRun(t)})}onRunUpdate(e){return g(this,null,function*(){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};yield this.client.updateRun(e.id,t)})}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e,r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();let i=[t];for(;i.length>0;){let s=i.shift();!s||r.has(s.id)||(r.add(s.id),this.runMap.set(s.id,s),s.child_runs&&i.push(...s.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){let t={},r=[];for(let[i,s]of this.runMap){let o=new vo(P(_({},s),{child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0}));t[i]=o,r.push([i,s.dotted_order])}r.sort((i,s)=>!i[1]||!s[1]?0:i[1].localeCompare(s[1]));for(let[i]of r){let s=this.runMap.get(i),o=t[i];if(!(!s||!o)&&s.parent_run_id){let a=t[s.parent_run_id];a&&(a.child_runs.push(o),o.parent_run=a)}}return t[e]}static getTraceableRunTree(){try{return C2()}catch{return}}};var By=Or(py(),1);var DS;function Hne(){let n="default"in By.default?By.default.default:By.default;return new n({autoStart:!0,concurrency:1})}function Ut(n,e){return g(this,null,function*(){e===!0?yield n():(typeof DS>"u"&&(DS=Hne()),DS.add(n))})}var xS=n=>n!==void 0?n:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>ti(t)==="true");xS()&&ti("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join(`
`);var RS=class{setHandler(e){return this.setHandlers([e])}},Dl=class{constructor(e,t,r,i,s,o,a,c){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:c})}get parentRunId(){return this._parentRunId}handleText(e){return g(this,null,function*(){yield Promise.all(this.handlers.map(t=>Ut(()=>g(this,null,function*(){try{yield t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleCustomEvent(e,t,r,i,s){return g(this,null,function*(){yield Promise.all(this.handlers.map(o=>Ut(()=>g(this,null,function*(){try{yield o.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(a){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${a}`),o.raiseError)throw a}}),o.awaitHandlers)))})}},PS=class extends Dl{getChild(e){let t=new $i(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleRetrieverEnd(e){return g(this,null,function*(){yield Promise.all(this.handlers.map(t=>Ut(()=>g(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleRetrieverError(e){return g(this,null,function*(){yield Promise.all(this.handlers.map(t=>Ut(()=>g(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}}),t.awaitHandlers)))})}},Hy=class extends Dl{handleLLMNewToken(e,t,r,i,s,o){return g(this,null,function*(){yield Promise.all(this.handlers.map(a=>Ut(()=>g(this,null,function*(){if(!a.ignoreLLM)try{yield a.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,o)}catch(c){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMNewToken: ${c}`),a.raiseError)throw c}}),a.awaitHandlers)))})}handleLLMError(e){return g(this,null,function*(){yield Promise.all(this.handlers.map(t=>Ut(()=>g(this,null,function*(){if(!t.ignoreLLM)try{yield t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleLLMEnd(e){return g(this,null,function*(){yield Promise.all(this.handlers.map(t=>Ut(()=>g(this,null,function*(){if(!t.ignoreLLM)try{yield t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}},MS=class extends Dl{getChild(e){let t=new $i(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleChainError(e,t,r,i,s){return g(this,null,function*(){yield Promise.all(this.handlers.map(o=>Ut(()=>g(this,null,function*(){if(!o.ignoreChain)try{yield o.handleChainError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(a){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleChainError: ${a}`),o.raiseError)throw a}}),o.awaitHandlers)))})}handleChainEnd(e,t,r,i,s){return g(this,null,function*(){yield Promise.all(this.handlers.map(o=>Ut(()=>g(this,null,function*(){if(!o.ignoreChain)try{yield o.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(a){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleChainEnd: ${a}`),o.raiseError)throw a}}),o.awaitHandlers)))})}handleAgentAction(e){return g(this,null,function*(){yield Promise.all(this.handlers.map(t=>Ut(()=>g(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleAgentEnd(e){return g(this,null,function*(){yield Promise.all(this.handlers.map(t=>Ut(()=>g(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}},NS=class extends Dl{getChild(e){let t=new $i(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleToolError(e){return g(this,null,function*(){yield Promise.all(this.handlers.map(t=>Ut(()=>g(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleToolEnd(e){return g(this,null,function*(){yield Promise.all(this.handlers.map(t=>Ut(()=>g(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}},$i=class n extends RS{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}handleLLMStart(e,t,r=void 0,i=void 0,s=void 0,o=void 0,a=void 0,c=void 0){return g(this,null,function*(){return Promise.all(t.map((l,u)=>g(this,null,function*(){let d=u===0&&r?r:$t();return yield Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Cl(f)&&f._createRunForLLMStart(e,[l],d,this._parentRunId,s,this.tags,this.metadata,c),Ut(()=>g(this,null,function*(){try{yield f.handleLLMStart?.(e,[l],d,this._parentRunId,s,this.tags,this.metadata,c)}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}}),f.awaitHandlers)})),new Hy(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChatModelStart(e,t,r=void 0,i=void 0,s=void 0,o=void 0,a=void 0,c=void 0){return g(this,null,function*(){return Promise.all(t.map((l,u)=>g(this,null,function*(){let d=u===0&&r?r:$t();return yield Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Cl(f)&&f._createRunForChatModelStart(e,[l],d,this._parentRunId,s,this.tags,this.metadata,c),Ut(()=>g(this,null,function*(){try{if(f.handleChatModelStart)yield f.handleChatModelStart?.(e,[l],d,this._parentRunId,s,this.tags,this.metadata,c);else if(f.handleLLMStart){let p=Z2(l);yield f.handleLLMStart?.(e,[p],d,this._parentRunId,s,this.tags,this.metadata,c)}}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}}),f.awaitHandlers)})),new Hy(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChainStart(c,l){return g(this,arguments,function*(e,t,r=$t(),i=void 0,s=void 0,o=void 0,a=void 0){return yield Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return Cl(u)&&u._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,i,a),Ut(()=>g(this,null,function*(){try{yield u.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,i,a)}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${d}`),u.raiseError)throw d}}),u.awaitHandlers)})),new MS(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleToolStart(c,l){return g(this,arguments,function*(e,t,r=$t(),i=void 0,s=void 0,o=void 0,a=void 0){return yield Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Cl(u)&&u._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,a),Ut(()=>g(this,null,function*(){try{yield u.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a)}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${d}`),u.raiseError)throw d}}),u.awaitHandlers)})),new NS(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleRetrieverStart(c,l){return g(this,arguments,function*(e,t,r=$t(),i=void 0,s=void 0,o=void 0,a=void 0){return yield Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Cl(u)&&u._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,a),Ut(()=>g(this,null,function*(){try{yield u.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a)}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${d}`),u.raiseError)throw d}}),u.awaitHandlers)})),new PS(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleCustomEvent(e,t,r,i,s){return g(this,null,function*(){yield Promise.all(this.handlers.map(o=>Ut(()=>g(this,null,function*(){if(!o.ignoreCustomEvent)try{yield o.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(a){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${a}`),o.raiseError)throw a}}),o.awaitHandlers)))})}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata=_(_({},this.metadata),e),t&&(this.inheritableMetadata=_(_({},this.inheritableMetadata),e))}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new n(this._parentRunId);for(let i of this.handlers){let s=this.inheritableHandlers.includes(i);r.addHandler(i,s)}for(let i of this.tags){let s=this.inheritableTags.includes(i);r.addTags([i],s)}for(let i of Object.keys(this.metadata)){let s=Object.keys(this.inheritableMetadata).includes(i);r.addMetadata({[i]:this.metadata[i]},s)}for(let i of e)r.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===i.name)||r.addHandler(i,t);return r}static fromHandlers(e){class t extends Oa{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:$t()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static configure(e,t,r,i,s,o,a){return g(this,null,function*(){return this._configureSync(e,t,r,i,s,o,a)})}static _configureSync(e,t,r,i,s,o,a){let c;(e||t)&&(Array.isArray(e)||!e?(c=new n,c.setHandlers(e?.map(ch)??[],!0)):c=e,c=c.copy(Array.isArray(t)?t.map(ch):t?.handlers,!1));let l=ti("LANGCHAIN_VERBOSE")==="true"||a?.verbose,u=Sl.getTraceableRunTree()?.tracingEnabled||xS(),d=u||(ti("LANGCHAIN_TRACING")??!1);if(l||d){if(c||(c=new n),l&&!c.handlers.some(f=>f.name===ah.prototype.name)){let f=new ah;c.addHandler(f,!0)}if(d&&!c.handlers.some(f=>f.name==="langchain_tracer")&&u){let f=new Sl;c.addHandler(f,!0),c._parentRunId=Sl.getTraceableRunTree()?.id??c._parentRunId}}return(r||i)&&c&&(c.addTags(r??[]),c.addTags(i??[],!1)),(s||o)&&c&&(c.addMetadata(s??{}),c.addMetadata(o??{},!1)),c}};function ch(n){return"name"in n?n:Oa.fromMethods(n)}var kS=class{getStore(){}run(e,t){return t()}},qne=new kS,OS=Symbol.for("ls:tracing_async_local_storage"),J2=Symbol.for("lc:child_config"),LS=class{getInstance(){return globalThis[OS]??qne}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[J2]}runWithConfig(e,t,r){let i=$i._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),s=this.getInstance(),o=i?.getParentRunId(),a=i?.handlers?.find(l=>l?.name==="langchain_tracer"),c;return a&&o?c=a.convertToRunTree(o):r||(c=new vo({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra=P(_({},c.extra),{[J2]:e})),s.run(c,t)}initializeGlobalInstance(e){globalThis[OS]===void 0&&(globalThis[OS]=e)}},ni=new LS;function Ui(n,e){return g(this,null,function*(){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!e?.aborted)throw r}),new Promise((r,i)=>{t=()=>{i(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&i(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))})}var Dn=class n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}next(){return g(this,null,function*(){this.ensureReader();try{let e=yield this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}})}return(){return g(this,null,function*(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),yield e}return{done:!0,value:void 0}})}throw(e){return g(this,null,function*(){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),yield t}throw e})}[Symbol.asyncIterator](){return this}[Symbol.asyncDispose](){return g(this,null,function*(){yield this.return()})}static fromReadableStream(e){let t=e.getReader();return new n({start(r){return i();function i(){return t.read().then(({done:s,value:o})=>{if(s){r.close();return}return r.enqueue(o),i()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new n({pull(r){return g(this,null,function*(){let{value:i,done:s}=yield e.next();s&&r.close(),r.enqueue(i)})},cancel(r){return g(this,null,function*(){yield e.return(r)})}})}};function FS(n,e=2){let t=Array.from({length:e},()=>[]);return t.map(function(i){return we(this,null,function*(){for(;;)if(i.length===0){let s=yield new $(n.next());for(let o of t)o.push(s)}else{if(i[0].done)return;yield i.shift().value}})})}function Bi(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){let t=_({},n);for(let[r,i]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=Bi(t[r],i):t[r]=i;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}var Ts=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{ni.runWithConfig(e.config,()=>g(this,null,function*(){this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(i=>t(void 0),r)}),!0)})}next(...e){return g(this,null,function*(){return this.signal?.throwIfAborted(),this.firstResultUsed?ni.runWithConfig(this.config,this.signal?()=>g(this,null,function*(){return Ui(this.generator.next(...e),this.signal)}):()=>g(this,null,function*(){return this.generator.next(...e)}),!0):(this.firstResultUsed=!0,this.firstResult)})}return(e){return g(this,null,function*(){return this.generator.return(e)})}throw(e){return g(this,null,function*(){return this.generator.throw(e)})}[Symbol.asyncIterator](){return this}[Symbol.asyncDispose](){return g(this,null,function*(){yield this.return()})}};function e$(n,e,t,r,...i){return g(this,null,function*(){let s=new Ts({generator:e,startSetup:t,signal:r}),o=yield s.setup;return{output:n(s,o,...i),setup:o}})}var ri=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=Na({},t);return new lh({ops:t,state:r[r.length-1].newDocument})}},lh=class n extends ri{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=Na(this.state,e.ops);return new n({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=Na({},e.ops);return new n({ops:e.ops,state:t[t.length-1].newDocument})}},r$=n=>n.name==="log_stream_tracer";function t$(n,e){return g(this,null,function*(){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input})}function n$(n,e){return g(this,null,function*(){let{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t})}function zne(n){return n!==void 0&&n.message!==void 0}var uh=class extends Dr{constructor(e){super(_({_awaitHandler:!0},e)),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Dn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(e){return g(this,null,function*(){})}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(i=>!this.excludeTags?.includes(i))),r}tapOutputIterable(e,t){return we(this,null,function*(){try{for(var r=Me(t),i,s,o;i=!(s=yield new $(r.next())).done;i=!1){let a=s.value;if(e!==this.rootId){let c=this.keyMapByRunId[e];c&&(yield new $(this.writer.write(new ri({ops:[{op:"add",path:`/logs/${c}/streamed_output/-`,value:a}]}))))}yield a}}catch{o=[s]}finally{try{i&&(s=r.return)&&(yield new $(s.call(r)))}finally{if(o)throw o[0]}}})}onRunCreate(e){return g(this,null,function*(){if(this.rootId===void 0&&(this.rootId=e.id,yield this.writer.write(new ri({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=yield t$(e,this._schemaFormat)),yield this.writer.write(new ri({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))})}onRunUpdate(e){return g(this,null,function*(){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:yield t$(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:yield n$(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let i=new ri({ops:r});yield this.writer.write(i)}finally{if(e.id===this.rootId){let t=new ri({ops:[{op:"replace",path:"/final_output",value:yield n$(e,this._schemaFormat)}]});yield this.writer.write(t),this.autoClose&&(yield this.writer.close())}}})}onLLMNewToken(e,t,r){return g(this,null,function*(){let i=this.keyMapByRunId[e.id];if(i===void 0)return;let s=e.inputs.messages!==void 0,o;s?zne(r?.chunk)?o=r?.chunk:o=new La({id:`run-${e.id}`,content:t}):o=t;let a=new ri({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:o}]});yield this.writer.write(a)})}};var dh=class n{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new n({text:this.text+e.text,generationInfo:_(_({},this.generationInfo),e.generationInfo)})}};function qy({name:n,serialized:e}){return n!==void 0?n:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var i$=n=>n.name==="event_stream_tracer",zy=class extends Dr{constructor(e){super(_({_awaitHandler:!0},e)),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Dn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(e){return g(this,null,function*(){})}_includeRun(e){let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(i=>!this.excludeTags?.includes(i))),r}tapOutputIterable(e,t){return we(this,null,function*(){let r=yield new $(t.next());if(r.done)return;let i=this.runInfoMap.get(e);if(i===void 0){yield r.value;return}function s(w,b){return w==="llm"&&typeof b=="string"?new dh({text:b}):b}let o=this.tappedPromises.get(e);if(o===void 0){let w;o=new Promise(b=>{w=b}),this.tappedPromises.set(e,o);try{let b={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};yield new $(this.send(P(_({},b),{data:{chunk:s(i.runType,r.value)}}),i)),yield r.value;try{for(var a=Me(t),c,l,u;c=!(l=yield new $(a.next())).done;c=!1){let E=l.value;i.runType!=="tool"&&i.runType!=="retriever"&&(yield new $(this.send(P(_({},b),{data:{chunk:s(i.runType,E)}}),i))),yield E}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new $(l.call(a)))}finally{if(u)throw u[0]}}}finally{w()}}else{yield r.value;try{for(var d=Me(t),f,p,y;f=!(p=yield new $(d.next())).done;f=!1){let w=p.value;yield w}}catch{y=[p]}finally{try{f&&(p=d.return)&&(yield new $(p.call(d)))}finally{if(y)throw y[0]}}}})}send(e,t){return g(this,null,function*(){this._includeRun(t)&&(yield this.writer.write(e))})}sendEndEvent(e,t){return g(this,null,function*(){let r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):yield this.send(e,t)})}onLLMStart(e){return g(this,null,function*(){let t=qy(e),r=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,i);let s=`on_${r}_start`;yield this.send({event:s,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)})}onLLMNewToken(e,t,r){return g(this,null,function*(){let i=this.runInfoMap.get(e.id),s,o;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(i.runType==="chat_model")o="on_chat_model_stream",r?.chunk===void 0?s=new La({content:t,id:`run-${e.id}`}):s=r.chunk.message;else if(i.runType==="llm")o="on_llm_stream",r?.chunk===void 0?s=new dh({text:t}):s=r.chunk;else throw new Error(`Unexpected run type ${i.runType}`);yield this.send({event:o,data:{chunk:s},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}})}onLLMEnd(e){return g(this,null,function*(){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let i=e.outputs?.generations,s;if(t.runType==="chat_model"){for(let o of i??[]){if(s!==void 0)break;s=o[0]?.message}r="on_chat_model_end"}else if(t.runType==="llm")s={generations:i?.map(o=>o.map(a=>({text:a.text,generationInfo:a.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);yield this.sendEndEvent({event:r,data:{output:s,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}onChainStart(e){return g(this,null,function*(){let t=qy(e),r=e.run_type??"chain",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},i.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,i.inputs=e.inputs.input):(s.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),yield this.send({event:`on_${r}_start`,data:s,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)})}onChainEnd(e){return g(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},o={output:e.outputs?.output??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(o.input=i.input,t.inputs=i.input),yield this.sendEndEvent({event:r,data:o,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)})}onToolStart(e){return g(this,null,function*(){let t=qy(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),yield this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)})}onToolEnd(e){return g(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;yield this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}onRetrieverStart(e){return g(this,null,function*(){let t=qy(e),i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),yield this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)})}onRetrieverEnd(e){return g(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);yield this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}handleCustomEvent(e,t,r){return g(this,null,function*(){let i=this.runInfoMap.get(r);if(i===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);yield this.send({event:"on_custom_event",run_id:r,name:e,tags:i.tags,metadata:i.metadata,data:t},i)})}finish(){return g(this,null,function*(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})})}};var Gy=25;function Rr(n){return g(this,null,function*(){return $i._configureSync(n?.callbacks,void 0,n?.tags,void 0,n?.metadata)})}function VS(...n){let e={};for(let t of n.filter(r=>!!r))for(let r of Object.keys(t))if(r==="metadata")e[r]=_(_({},e[r]),t[r]);else if(r==="tags"){let i=e[r]??[];e[r]=[...new Set(i.concat(t[r]??[]))]}else if(r==="configurable")e[r]=_(_({},e[r]),t[r]);else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){let i=e.callbacks,s=t.callbacks;if(Array.isArray(s))if(!i)e.callbacks=s;else if(Array.isArray(i))e.callbacks=i.concat(s);else{let o=i.copy();for(let a of s)o.addHandler(ch(a),!0);e.callbacks=o}else if(s)if(!i)e.callbacks=s;else if(Array.isArray(i)){let o=s.copy();for(let a of i)o.addHandler(ch(a),!0);e.callbacks=o}else e.callbacks=new $i(s._parentRunId,{handlers:i.handlers.concat(s.handlers),inheritableHandlers:i.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(s.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(s.inheritableTags))),metadata:_(_({},i.metadata),s.metadata)})}else{let i=r;e[i]=t[i]??e[i]}return e}var Gne=new Set(["string","number","boolean"]);function ct(n){let e=ni.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let r=e,{runId:i,runName:s}=r,o=nn(r,["runId","runName"]);t=Object.entries(o).reduce((a,[c,l])=>(l!==void 0&&(a[c]=l),a),t)}if(n&&(t=Object.entries(n).reduce((i,[s,o])=>(o!==void 0&&(i[s]=o),i),t)),t?.configurable)for(let i of Object.keys(t.configurable))Gne.has(typeof t.configurable[i])&&!t.metadata?.[i]&&(t.metadata||(t.metadata={}),t.metadata[i]=t.configurable[i]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let i=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,i])):t.signal=i,delete t.timeout}return t}function hn(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:i,configurable:s,runId:o}={}){let a=ct(n);return e!==void 0&&(delete a.runName,a.callbacks=e),r!==void 0&&(a.recursionLimit=r),t!==void 0&&(a.maxConcurrency=t),i!==void 0&&(a.runName=i),s!==void 0&&(a.configurable=_(_({},a.configurable),s)),o!==void 0&&delete a.runId,a}var s$=Or(oy(),1),Wy=Or(py(),1),Wne=[400,401,402,403,404,405,406,407,409],Kne=n=>{if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||n?.code==="ECONNABORTED")throw n;let e=n?.response?.status??n?.status;if(e&&Wne.includes(+e))throw n;if(n?.error?.code==="insufficient_quota"){let t=new Error(n?.message);throw t.name="InsufficientQuotaError",t}},hh=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Kne;let t="default"in Wy.default?Wy.default.default:Wy.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,s$.default)(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var fh=class extends Dr{constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}onRunCreate(e){return g(this,null,function*(){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?yield this.argOnStart(e):this.argOnStart.length===2&&(yield this.argOnStart(e,this.config))))})}onRunUpdate(e){return g(this,null,function*(){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?yield this.argOnError(e):this.argOnError.length===2&&(yield this.argOnError(e,this.config))):this.argOnEnd&&(this.argOnEnd.length===1?yield this.argOnEnd(e):this.argOnEnd.length===2&&(yield this.argOnEnd(e,this.config))))})}};function ph(n){return n?n.lc_runnable:!1}var Ky=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,i=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||i.some(s=>this.includeTags?.includes(s))),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&i.every(s=>!this.excludeTags?.includes(s))),r}};var a$=Symbol("Let zodToJsonSchema decide on which parser to use");var o$={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},c$=n=>typeof n=="string"?P(_({},o$),{name:n}):_(_({},o$),n);var l$=n=>{let e=c$(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return P(_({},e),{flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))})};function jS(n,e,t,r){r?.errorMessages&&t&&(n.errorMessage=P(_({},n.errorMessage),{[e]:t}))}function Ke(n,e,t,r,i){n[e]=t,jS(n,e,r,i)}var Yy=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")};function bt(n){if(n.target!=="openAi")return{};let e=[...n.basePath,n.definitionPath,n.openAiAnyTypeName];return n.flags.hasReferencedOpenAiAnyType=!0,{$ref:n.$refStrategy==="relative"?Yy(e,n.currentPath):e.join("/")}}function u$(n,e){let t={type:"array"};return n.type?._def&&n.type?._def?.typeName!==B.ZodAny&&(t.items=fe(n.type._def,P(_({},e),{currentPath:[...e.currentPath,"items"]}))),n.minLength&&Ke(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Ke(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Ke(t,"minItems",n.exactLength.value,n.exactLength.message,e),Ke(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function d$(n,e){let t={type:"integer",format:"int64"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Ke(t,"minimum",r.value,r.message,e):Ke(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ke(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ke(t,"maximum",r.value,r.message,e):Ke(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ke(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ke(t,"multipleOf",r.value,r.message,e);break}return t}function h$(){return{type:"boolean"}}function Qy(n,e){return fe(n.type._def,e)}var f$=(n,e)=>fe(n.innerType._def,e);function $S(n,e,t){let r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,s)=>$S(n,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Yne(n,e)}}var Yne=(n,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let r of n.checks)switch(r.kind){case"min":Ke(t,"minimum",r.value,r.message,e);break;case"max":Ke(t,"maximum",r.value,r.message,e);break}return t};function p$(n,e){return P(_({},fe(n.innerType._def,e)),{default:n.defaultValue()})}function m$(n,e){return e.effectStrategy==="input"?fe(n.schema._def,e):bt(e)}function g$(n){return{type:"string",enum:Array.from(n.values)}}var Qne=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function y$(n,e){let t=[fe(n.left._def,P(_({},e),{currentPath:[...e.currentPath,"allOf","0"]})),fe(n.right._def,P(_({},e),{currentPath:[...e.currentPath,"allOf","1"]}))].filter(s=>!!s),r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,i=[];return t.forEach(s=>{if(Qne(s))i.push(...s.allOf),s.unevaluatedProperties===void 0&&(r=void 0);else{let a=s;if("additionalProperties"in s&&s.additionalProperties===!1){let o=s,{additionalProperties:c}=o;a=nn(o,["additionalProperties"])}else r=void 0;i.push(a)}}),i.length?_({allOf:i},r):void 0}function _$(n,e){let t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}var US,ii={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(US===void 0&&(US=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),US),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Xy(n,e){let t={type:"string"};if(n.checks)for(let r of n.checks)switch(r.kind){case"min":Ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":Ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":si(t,"email",r.message,e);break;case"format:idn-email":si(t,"idn-email",r.message,e);break;case"pattern:zod":$n(t,ii.email,r.message,e);break}break;case"url":si(t,"uri",r.message,e);break;case"uuid":si(t,"uuid",r.message,e);break;case"regex":$n(t,r.regex,r.message,e);break;case"cuid":$n(t,ii.cuid,r.message,e);break;case"cuid2":$n(t,ii.cuid2,r.message,e);break;case"startsWith":$n(t,RegExp(`^${BS(r.value,e)}`),r.message,e);break;case"endsWith":$n(t,RegExp(`${BS(r.value,e)}$`),r.message,e);break;case"datetime":si(t,"date-time",r.message,e);break;case"date":si(t,"date",r.message,e);break;case"time":si(t,"time",r.message,e);break;case"duration":si(t,"duration",r.message,e);break;case"length":Ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),Ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{$n(t,RegExp(BS(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&si(t,"ipv4",r.message,e),r.version!=="v4"&&si(t,"ipv6",r.message,e);break}case"base64url":$n(t,ii.base64url,r.message,e);break;case"jwt":$n(t,ii.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&$n(t,ii.ipv4Cidr,r.message,e),r.version!=="v4"&&$n(t,ii.ipv6Cidr,r.message,e);break}case"emoji":$n(t,ii.emoji(),r.message,e);break;case"ulid":{$n(t,ii.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{si(t,"binary",r.message,e);break}case"contentEncoding:base64":{Ke(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{$n(t,ii.base64,r.message,e);break}}break}case"nanoid":$n(t,ii.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function BS(n,e){return e.patternStrategy==="escape"?Zne(n):n}var Xne=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Zne(n){let e="";for(let t=0;t<n.length;t++)Xne.has(n[t])||(e+="\\"),e+=n[t];return e}function si(n,e,t,r){n.format||n.anyOf?.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push(_({format:n.format},n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}})),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push(_({format:e},t&&r.errorMessages&&{errorMessage:{format:t}}))):Ke(n,"format",e,t,r)}function $n(n,e,t,r){n.pattern||n.allOf?.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push(_({pattern:n.pattern},n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}})),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push(_({pattern:v$(e,r)},t&&r.errorMessages&&{errorMessage:{pattern:t}}))):Ke(n,"pattern",v$(e,r),t,r)}function v$(n,e){if(!e.applyRegexFlags||!n.flags)return n.source;let t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source,i="",s=!1,o=!1,a=!1;for(let c=0;c<r.length;c++){if(s){i+=r[c],s=!1;continue}if(t.i){if(o){if(r[c].match(/[a-z]/)){a?(i+=r[c],i+=`${r[c-2]}-${r[c]}`.toUpperCase(),a=!1):r[c+1]==="-"&&r[c+2]?.match(/[a-z]/)?(i+=r[c],a=!0):i+=`${r[c]}${r[c].toUpperCase()}`;continue}}else if(r[c].match(/[a-z]/)){i+=`[${r[c]}${r[c].toUpperCase()}]`;continue}}if(t.m){if(r[c]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(r[c]==="$"){i+=`($|(?=[\r
]))`;continue}}if(t.s&&r[c]==="."){i+=o?`${r[c]}\r
`:`[${r[c]}\r
]`;continue}i+=r[c],r[c]==="\\"?s=!0:o&&r[c]==="]"?o=!1:!o&&r[c]==="["&&(o=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return i}function Zy(n,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&n.keyType?._def.typeName===B.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((s,o)=>P(_({},s),{[o]:fe(n.valueType._def,P(_({},e),{currentPath:[...e.currentPath,"properties",o]}))??bt(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:fe(n.valueType._def,P(_({},e),{currentPath:[...e.currentPath,"additionalProperties"]}))??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(n.keyType?._def.typeName===B.ZodString&&n.keyType._def.checks?.length){let r=Xy(n.keyType._def,e),{type:s}=r,o=nn(r,["type"]);return P(_({},t),{propertyNames:o})}else{if(n.keyType?._def.typeName===B.ZodEnum)return P(_({},t),{propertyNames:{enum:n.keyType._def.values}});if(n.keyType?._def.typeName===B.ZodBranded&&n.keyType._def.type._def.typeName===B.ZodString&&n.keyType._def.type._def.checks?.length){let i=Qy(n.keyType._def,e),{type:s}=i,o=nn(i,["type"]);return P(_({},t),{propertyNames:o})}}return t}function w$(n,e){if(e.mapStrategy==="record")return Zy(n,e);let t=fe(n.keyType._def,P(_({},e),{currentPath:[...e.currentPath,"items","items","0"]}))||bt(e),r=fe(n.valueType._def,P(_({},e),{currentPath:[...e.currentPath,"items","items","1"]}))||bt(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function b$(n){let e=n.values,r=Object.keys(n.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),i=Array.from(new Set(r.map(s=>typeof s)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function E$(n){return n.target==="openAi"?void 0:{not:bt(P(_({},n),{currentPath:[...n.currentPath,"not"]}))}}function I$(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var mh={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function T$(n,e){if(e.target==="openApi3")return A$(n,e);let t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in mh&&(!r._def.checks||!r._def.checks.length))){let r=t.reduce((i,s)=>{let o=mh[s._def.typeName];return o&&!i.includes(o)?[...i,o]:i},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=t.reduce((i,s)=>{let o=typeof s._def.value;switch(o){case"string":case"number":case"boolean":return[...i,o];case"bigint":return[...i,"integer"];case"object":if(s._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===t.length){let i=r.filter((s,o,a)=>a.indexOf(s)===o);return{type:i.length>1?i:i[0],enum:t.reduce((s,o)=>s.includes(o._def.value)?s:[...s,o._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,i)=>[...r,...i._def.values.filter(s=>!r.includes(s))],[])};return A$(n,e)}var A$=(n,e)=>{let t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,i)=>fe(r._def,P(_({},e),{currentPath:[...e.currentPath,"anyOf",`${i}`]}))).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function C$(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:mh[n.innerType._def.typeName],nullable:!0}:{type:[mh[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let r=fe(n.innerType._def,P(_({},e),{currentPath:[...e.currentPath]}));return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&P(_({},r),{nullable:!0})}let t=fe(n.innerType._def,P(_({},e),{currentPath:[...e.currentPath,"anyOf","0"]}));return t&&{anyOf:[t,{type:"null"}]}}function S$(n,e){let t={type:"number"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"int":t.type="integer",jS(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Ke(t,"minimum",r.value,r.message,e):Ke(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ke(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ke(t,"maximum",r.value,r.message,e):Ke(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ke(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ke(t,"multipleOf",r.value,r.message,e);break}return t}function D$(n,e){let t=e.target==="openAi",r={type:"object",properties:{}},i=[],s=n.shape();for(let a in s){let c=s[a];if(c===void 0||c._def===void 0)continue;let l=ere(c);l&&t&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),l=!1);let u=fe(c._def,P(_({},e),{currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]}));u!==void 0&&(r.properties[a]=u,l||i.push(a))}i.length&&(r.required=i);let o=Jne(n,e);return o!==void 0&&(r.additionalProperties=o),r}function Jne(n,e){if(n.catchall._def.typeName!=="ZodNever")return fe(n.catchall._def,P(_({},e),{currentPath:[...e.currentPath,"additionalProperties"]}));switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function ere(n){try{return n.isOptional()}catch{return!0}}var x$=(n,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return fe(n.innerType._def,e);let t=fe(n.innerType._def,P(_({},e),{currentPath:[...e.currentPath,"anyOf","1"]}));return t?{anyOf:[{not:bt(e)},t]}:bt(e)};var R$=(n,e)=>{if(e.pipeStrategy==="input")return fe(n.in._def,e);if(e.pipeStrategy==="output")return fe(n.out._def,e);let t=fe(n.in._def,P(_({},e),{currentPath:[...e.currentPath,"allOf","0"]})),r=fe(n.out._def,P(_({},e),{currentPath:[...e.currentPath,"allOf",t?"1":"0"]}));return{allOf:[t,r].filter(i=>i!==void 0)}};function P$(n,e){return fe(n.type._def,e)}function M$(n,e){let r={type:"array",uniqueItems:!0,items:fe(n.valueType._def,P(_({},e),{currentPath:[...e.currentPath,"items"]}))};return n.minSize&&Ke(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Ke(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function N$(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>fe(t._def,P(_({},e),{currentPath:[...e.currentPath,"items",`${r}`]}))).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:fe(n.rest._def,P(_({},e),{currentPath:[...e.currentPath,"additionalItems"]}))}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>fe(t._def,P(_({},e),{currentPath:[...e.currentPath,"items",`${r}`]}))).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function O$(n){return{not:bt(n)}}function k$(n){return bt(n)}var L$=(n,e)=>fe(n.innerType._def,e);var F$=(n,e,t)=>{switch(e){case B.ZodString:return Xy(n,t);case B.ZodNumber:return S$(n,t);case B.ZodObject:return D$(n,t);case B.ZodBigInt:return d$(n,t);case B.ZodBoolean:return h$();case B.ZodDate:return $S(n,t);case B.ZodUndefined:return O$(t);case B.ZodNull:return I$(t);case B.ZodArray:return u$(n,t);case B.ZodUnion:case B.ZodDiscriminatedUnion:return T$(n,t);case B.ZodIntersection:return y$(n,t);case B.ZodTuple:return N$(n,t);case B.ZodRecord:return Zy(n,t);case B.ZodLiteral:return _$(n,t);case B.ZodEnum:return g$(n);case B.ZodNativeEnum:return b$(n);case B.ZodNullable:return C$(n,t);case B.ZodOptional:return x$(n,t);case B.ZodMap:return w$(n,t);case B.ZodSet:return M$(n,t);case B.ZodLazy:return()=>n.getter()._def;case B.ZodPromise:return P$(n,t);case B.ZodNaN:case B.ZodNever:return E$(t);case B.ZodEffects:return m$(n,t);case B.ZodAny:return bt(t);case B.ZodUnknown:return k$(t);case B.ZodDefault:return p$(n,t);case B.ZodBranded:return Qy(n,t);case B.ZodReadonly:return L$(n,t);case B.ZodCatch:return f$(n,t);case B.ZodPipeline:return R$(n,t);case B.ZodFunction:case B.ZodVoid:case B.ZodSymbol:return;default:return(r=>{})(e)}};function fe(n,e,t=!1){let r=e.seen.get(n);if(e.override){let a=e.override?.(n,e,r,t);if(a!==a$)return a}if(r&&!t){let a=tre(r,e);if(a!==void 0)return a}let i={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,i);let s=F$(n,n.typeName,e),o=typeof s=="function"?fe(s(),e):s;if(o&&nre(n,e,o),e.postProcess){let a=e.postProcess(o,n,e);return i.jsonSchema=o,a}return i.jsonSchema=o,o}var tre=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:Yy(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),bt(e)):e.$refStrategy==="seen"?bt(e):void 0}},nre=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t);var HS=(n,e)=>{let t=l$(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[l,u])=>P(_({},c),{[l]:fe(u._def,P(_({},t),{currentPath:[...t.basePath,t.definitionPath,l]}),!0)??bt(t)}),{}):void 0,i=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=fe(n._def,i===void 0?t:P(_({},t),{currentPath:[...t.basePath,t.definitionPath,i]}),!1)??bt(t),o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(s.title=o),t.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[t.openAiAnyTypeName]||(r[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let a=i===void 0?r?P(_({},s),{[t.definitionPath]:r}):s:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,i].join("/"),[t.definitionPath]:P(_({},r),{[i]:s})};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function qS(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}function rre(n,e){let t=e[n.source]??n.source,r=e[n.target]??n.target;return[t,r]}function ire(n){let e="";for(let[t,r]of Object.entries(n))e+=`	classDef ${t}class fill:${r};
`;return e}function V$(n,e,t){let{firstNodeLabel:r,lastNodeLabel:i,nodeColors:s,withStyles:o=!0,curveStyle:a="linear",wrapLabelNWords:c=9}=t??{},l=o?`%%{init: {'flowchart': {'curve': '${a}'}}}%%
graph TD;
`:`graph TD;
`;if(o){let d="default",f={[d]:"{0}([{1}]):::otherclass"};r!==void 0&&(f[r]="{0}[{0}]:::startclass"),i!==void 0&&(f[i]="{0}[{0}]:::endclass");for(let p of Object.values(n)){let y=f[p]??f[d],w=qS(p),b=p.split(":"),E=b[b.length-1];l+=`	${y.replace(/\{0\}/g,w).replace(/\{1\}/g,E)};
`}}let u="";for(let d of e){let f=d.source.includes(":")?d.source.split(":")[0]:void 0,p=d.target.includes(":")?d.target.split(":")[0]:void 0;u!==""&&(u!==f||u!==p)&&(l+=`	end
`,u=""),u===""&&f!==void 0&&f===p&&(l=`	subgraph ${f}
`,u=f);let[y,w]=rre(d,n),b="";if(d.data!==void 0){let E=d.data,D=E.split(" ");D.length>c&&(E=D.reduce((x,N,L)=>(L%c===0&&x.push(""),x[x.length-1]+=` ${N}`,x),[]).join("<br>")),d.conditional?b=` -. ${E} .-> `:b=` -- ${E} --> `}else d.conditional?b=" -.-> ":b=" --> ";l+=`	${qS(y)}${b}${qS(w)};
`}return u!==""&&(l+=`end
`),o&&s!==void 0&&(l+=ire(s)),l}function j$(n,e){return g(this,null,function*(){let{backgroundColor:t="white"}=e??{},r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let i=`https://mermaid.ink/img/${r}?bgColor=${t}`,s=yield fetch(i);if(!s.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${s.status}`,`Status text: ${s.statusText}`].join(`
`));return yield s.blob()})}var $$=42;function zS(n){if(Sa(n.id))if(ph(n.data))try{let e=n.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>$$&&(e=`${e.substring(0,$$)}...`),e}catch{return n.data.getName()}else return n.data.name??"UnknownSchema";else return n.id}function sre(n){return ph(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:P(_({},HS(n.data.schema)),{title:n.data.name})}}var gh=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=Sa(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>_({id:e[t.id]},sre(t))),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let r=t||$t(),i={id:r,data:e};return this.nodes[r]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,i){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let s={source:e.id,target:t.id,data:r,conditional:i};return this.edges.push(s),s}firstNode(){let e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){let e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map(l=>l.id).every(Sa)&&(r="");let s=l=>r?`${r}:${l}`:l;Object.entries(e.nodes).forEach(([l,u])=>{this.nodes[s(l)]=P(_({},u),{id:s(l)})});let o=e.edges.map(l=>P(_({},l),{source:s(l.source),target:s(l.target)}));this.edges=[...this.edges,...o];let a=e.firstNode(),c=e.lastNode();return[a?{id:s(a.id),data:a.data}:void 0,c?{id:s(c.id),data:c.data}:void 0]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:i={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:s}=e??{},o={};for(let d of Object.values(this.nodes))o[d.id]=zS(d);let a=this.firstNode(),c=a?zS(a):void 0,l=this.lastNode(),u=l?zS(l):void 0;return V$(o,this.edges,{firstNodeLabel:c,lastNodeLabel:u,withStyles:t,curveStyle:r,nodeColors:i,wrapLabelNWords:s})}drawMermaidPng(e){return g(this,null,function*(){let t=this.drawMermaid(e);return j$(t,{backgroundColor:e?.backgroundColor})})}};function U$(n){let e=new TextEncoder,t=new ReadableStream({start(i){return g(this,null,function*(){try{for(var s=Me(n),o,a,c;o=!(a=yield s.next()).done;o=!1){let l=a.value;i.enqueue(e.encode(`event: data
data: ${JSON.stringify(l)}

`))}}catch{c=[a]}finally{try{o&&(a=s.return)&&(yield a.call(s))}finally{if(c)throw c[0]}}i.enqueue(e.encode(`event: end

`)),i.close()})}});return Dn.fromReadableStream(t)}function GS(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}var B$=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function Jy(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*WS(n,e){for(;;){let{value:t,done:r}=ni.runWithConfig(n,e.next.bind(e),!0);if(r)break;yield t}}function KS(n,e){return we(this,null,function*(){let t=e[Symbol.asyncIterator]();for(;;){let{value:r,done:i}=yield new $(ni.runWithConfig(n,t.next.bind(e),!0));if(i)break;yield r}})}function Jt(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}var en=class extends Es{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new Va({bound:this,kwargs:e,config:{}})}map(){return new QS({bound:this})}withRetry(e){return new XS(_({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt},e))}withConfig(e){return new Va({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new JS({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(ct);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:t},(i,s)=>ct(s===0?e:r))}return Array.from({length:t},()=>ct(e))}batch(e,t,r){return g(this,null,function*(){let i=this._getOptionsList(t??{},e.length),s=i[0]?.maxConcurrency??r?.maxConcurrency,o=new hh({maxConcurrency:s,onFailedAttempt:c=>{throw c}}),a=e.map((c,l)=>o.call(()=>g(this,null,function*(){try{return yield this.invoke(c,i[l])}catch(u){if(r?.returnExceptions)return u;throw u}})));return Promise.all(a)})}_streamIterator(e,t){return we(this,null,function*(){yield this.invoke(e,t)})}stream(e,t){return g(this,null,function*(){let r=ct(t),i=new Ts({generator:this._streamIterator(e,r),config:r});return yield i.setup,Dn.fromAsyncGenerator(i)})}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=ct(e):t=ct({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r=_({},e);return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}_callWithConfig(e,t,r){return g(this,null,function*(){let i=ct(r),o=yield(yield Rr(i))?.handleChainStart(this.toJSON(),Jt(t,"input"),i.runId,i?.runType,void 0,void 0,i?.runName??this.getName());delete i.runId;let a;try{let c=e.call(this,t,i,o);a=yield Ui(c,r?.signal)}catch(c){throw yield o?.handleChainError(c),c}return yield o?.handleChainEnd(Jt(a,"output")),a})}_batchWithConfig(e,t,r,i){return g(this,null,function*(){let s=this._getOptionsList(r??{},t.length),o=yield Promise.all(s.map(Rr)),a=yield Promise.all(o.map((l,u)=>g(this,null,function*(){let d=yield l?.handleChainStart(this.toJSON(),Jt(t[u],"input"),s[u].runId,s[u].runType,void 0,void 0,s[u].runName??this.getName());return delete s[u].runId,d}))),c;try{let l=e.call(this,t,s,a,i);c=yield Ui(l,s?.[0]?.signal)}catch(l){throw yield Promise.all(a.map(u=>u?.handleChainError(l))),l}return yield Promise.all(a.map(l=>l?.handleChainEnd(Jt(c,"output")))),c})}_transformStreamWithConfig(e,t,r){return we(this,null,function*(){let i,s=!0,o,a=!0,c=ct(r),l=yield new $(Rr(c));function u(){return we(this,null,function*(){try{for(var b=Me(e),E,D,x;E=!(D=yield new $(b.next())).done;E=!1){let N=D.value;if(s)if(i===void 0)i=N;else try{i=Bi(i,N)}catch{i=void 0,s=!1}yield N}}catch{x=[D]}finally{try{E&&(D=b.return)&&(yield new $(D.call(b)))}finally{if(x)throw x[0]}}})}let d;try{let b=yield new $(e$(t.bind(this),u(),()=>g(this,null,function*(){return l?.handleChainStart(this.toJSON(),{input:""},c.runId,c.runType,void 0,void 0,c.runName??this.getName())}),r?.signal,c));delete c.runId,d=b.setup;let E=d?.handlers.find(i$),D=b.output;E!==void 0&&d!==void 0&&(D=E.tapOutputIterable(d.runId,D));let x=d?.handlers.find(r$);x!==void 0&&d!==void 0&&(D=x.tapOutputIterable(d.runId,D));try{for(var f=Me(D),p,y,w;p=!(y=yield new $(f.next())).done;p=!1){let N=y.value;if(yield N,a)if(o===void 0)o=N;else try{o=Bi(o,N)}catch{o=void 0,a=!1}}}catch{w=[y]}finally{try{p&&(y=f.return)&&(yield new $(y.call(f)))}finally{if(w)throw w[0]}}}catch(b){throw yield new $(d?.handleChainError(b,void 0,void 0,void 0,{inputs:Jt(i,"input")})),b}yield new $(d?.handleChainEnd(o??{},void 0,void 0,void 0,{inputs:Jt(i,"input")}))})}getGraph(e){let t=new gh,r=t.addNode({name:`${this.getName()}Input`,schema:_o.any()}),i=t.addNode(this),s=t.addNode({name:`${this.getName()}Output`,schema:_o.any()});return t.addEdge(r,i),t.addEdge(i,s),t}pipe(e){return new e_({first:this,last:Fa(e)})}pick(e){return this.pipe(new tD(e))}assign(e){return this.pipe(new eD(new yh({steps:e})))}transform(e,t){return we(this,null,function*(){let r;try{for(var i=Me(e),s,o,a;s=!(o=yield new $(i.next())).done;s=!1){let c=o.value;r===void 0?r=c:r=Bi(r,c)}}catch{a=[o]}finally{try{s&&(o=i.return)&&(yield new $(o.call(i)))}finally{if(a)throw a[0]}}yield*rn(this._streamIterator(r,ct(t)))})}streamLog(e,t,r){return we(this,null,function*(){let i=new uh(P(_({},r),{autoClose:!1,_schemaFormat:"original"})),s=ct(t);yield*rn(this._streamLog(e,i,s))})}_streamLog(e,t,r){return we(this,null,function*(){let{callbacks:i}=r;if(i===void 0)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{let f=i.copy();f.addHandler(t,!0),r.callbacks=f}let s=this.stream(e,r);function o(){return g(this,null,function*(){try{let b=yield s;try{for(var f=Me(b),p,y,w;p=!(y=yield f.next()).done;p=!1){let E=y.value;let D=new ri({ops:[{op:"add",path:"/streamed_output/-",value:E}]});yield t.writer.write(D)}}catch{w=[y]}finally{try{p&&(y=f.return)&&(yield y.call(f))}finally{if(w)throw w[0]}}}finally{yield t.writer.close()}})}let a=o();try{try{for(var c=Me(t),l,u,d;l=!(u=yield new $(c.next())).done;l=!1){let f=u.value;yield f}}catch{d=[u]}finally{try{l&&(u=c.return)&&(yield new $(u.call(c)))}finally{if(d)throw d[0]}}}finally{yield new $(a)}})}streamEvents(e,t,r){let i;if(t.version==="v1")i=this._streamEventsV1(e,t,r);else if(t.version==="v2")i=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?U$(i):Dn.fromAsyncGenerator(i)}_streamEventsV2(e,t,r){return we(this,null,function*(){let i=new zy(P(_({},r),{autoClose:!1})),s=ct(t),o=s.runId??$t();s.runId=o;let a=s.callbacks;if(a===void 0)s.callbacks=[i];else if(Array.isArray(a))s.callbacks=a.concat(i);else{let E=a.copy();E.addHandler(i,!0),s.callbacks=E}let c=this;function l(){return g(this,null,function*(){try{let L=yield c.stream(e,s),F=i.tapOutputIterable(o,L);try{for(var E=Me(F),D,x,N;D=!(x=yield E.next()).done;D=!1){let T=x.value;;}}catch{N=[x]}finally{try{D&&(x=E.return)&&(yield x.call(E))}finally{if(N)throw N[0]}}}finally{yield i.finish()}})}let u=l(),d=!1,f;try{try{for(var p=Me(i),y,w,b;y=!(w=yield new $(p.next())).done;y=!1){let E=w.value;if(!d){E.data.input=e,d=!0,f=E.run_id,yield E;continue}E.run_id===f&&E.event.endsWith("_end")&&E.data?.input&&delete E.data.input,yield E}}catch{b=[w]}finally{try{y&&(w=p.return)&&(yield new $(w.call(p)))}finally{if(b)throw b[0]}}}finally{yield new $(u)}})}_streamEventsV1(e,t,r){return we(this,null,function*(){let i,s=!1,o=ct(t),a=o.tags??[],c=o.metadata??{},l=o.runName??this.getName(),u=new uh(P(_({},r),{autoClose:!1,_schemaFormat:"streaming_events"})),d=new Ky(_({},r)),f=this._streamLog(e,u,o);try{for(var y=Me(f),w,b,E;w=!(b=yield new $(y.next())).done;w=!1){let D=b.value;if(i?i=i.concat(D):i=lh.fromRunLogPatch(D),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;let F=_({},i.state),T={run_id:F.id,event:`on_${F.type}_start`,name:l,tags:a,metadata:c,data:{input:e}};d.includeEvent(T,F.type)&&(yield T)}let x=D.ops.filter(F=>F.path.startsWith("/logs/")).map(F=>F.path.split("/")[2]),N=[...new Set(x)];for(let F of N){let T,A={},C=i.state.logs[F];if(C.end_time===void 0?C.streamed_output.length>0?T="stream":T="start":T="end",T==="start")C.inputs!==void 0&&(A.input=C.inputs);else if(T==="end")C.inputs!==void 0&&(A.input=C.inputs),A.output=C.final_output;else if(T==="stream"){let R=C.streamed_output.length;if(R!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${R} instead. Encountered in: "${C.name}"`);A={chunk:C.streamed_output[0]},C.streamed_output=[]}yield{event:`on_${C.type}_${T}`,name:C.name,run_id:C.id,tags:C.tags,metadata:C.metadata,data:A}}let{state:L}=i;if(L.streamed_output.length>0){let F=L.streamed_output.length;if(F!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${F} instead. Encountered in: "${L.name}"`);let T={chunk:L.streamed_output[0]};L.streamed_output=[];let A={event:`on_${L.type}_stream`,run_id:L.id,tags:a,metadata:c,name:l,data:T};d.includeEvent(A,L.type)&&(yield A)}}}catch{E=[b]}finally{try{w&&(b=y.return)&&(yield new $(b.call(y)))}finally{if(E)throw E[0]}}let p=i?.state;if(p!==void 0){let D={event:`on_${p.type}_end`,name:l,run_id:p.id,tags:a,metadata:c,data:{output:p.final_output}};d.includeEvent(D,p.type)&&(yield D)}})}static isRunnable(e){return ph(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new Va({bound:this,config:{},configFactories:[i=>({callbacks:[new fh({config:i,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return are(this,e)}},Va=class n extends en{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}_mergeConfig(...e){return g(this,null,function*(){let t=VS(this.config,...e);return VS(t,...this.configFactories?yield Promise.all(this.configFactories.map(r=>g(this,null,function*(){return yield r(t)}))):[])})}bind(e){return new this.constructor({bound:this.bound,kwargs:_(_({},this.kwargs),e),config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:_(_({},this.config),e)})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}invoke(e,t){return g(this,null,function*(){return this.bound.invoke(e,yield this._mergeConfig(ct(t),this.kwargs))})}batch(e,t,r){return g(this,null,function*(){let i=Array.isArray(t)?yield Promise.all(t.map(s=>g(this,null,function*(){return this._mergeConfig(ct(s),this.kwargs)}))):yield this._mergeConfig(ct(t),this.kwargs);return this.bound.batch(e,i,r)})}_streamIterator(e,t){return we(this,null,function*(){yield*rn(this.bound._streamIterator(e,yield new $(this._mergeConfig(ct(t),this.kwargs))))})}stream(e,t){return g(this,null,function*(){return this.bound.stream(e,yield this._mergeConfig(ct(t),this.kwargs))})}transform(e,t){return we(this,null,function*(){yield*rn(this.bound.transform(e,yield new $(this._mergeConfig(ct(t),this.kwargs))))})}streamEvents(e,t,r){let i=this,s=function(){return we(this,null,function*(){yield*rn(i.bound.streamEvents(e,P(_({},yield new $(i._mergeConfig(ct(t),i.kwargs))),{version:t.version}),r))})};return Dn.fromAsyncGenerator(s())}static isRunnableBinding(e){return e.bound&&en.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new fh({config:i,onStart:e,onEnd:t,onError:r})]})]})}},QS=class n extends en{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new n({bound:this.bound.bind(e)})}invoke(e,t){return g(this,null,function*(){return this._callWithConfig(this._invoke,e,t)})}_invoke(e,t,r){return g(this,null,function*(){return this.bound.batch(e,hn(t,{callbacks:r?.getChild()}))})}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}},XS=class n extends Va{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let i=e>1?`retry:attempt:${e}`:void 0;return hn(t,{callbacks:r?.getChild(i)})}_invoke(e,t,r){return g(this,null,function*(){return(0,YS.default)(i=>Kt(n.prototype,this,"invoke").call(this,e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})})}invoke(e,t){return g(this,null,function*(){return this._callWithConfig(this._invoke,e,t)})}_batch(e,t,r,i){return g(this,null,function*(){let s={};try{yield(0,YS.default)(o=>g(this,null,function*(){let a=e.map((f,p)=>p).filter(f=>s[f.toString()]===void 0||s[f.toString()]instanceof Error),c=a.map(f=>e[f]),l=a.map(f=>this._patchConfigForRetry(o,t?.[f],r?.[f])),u=yield Kt(n.prototype,this,"batch").call(this,c,l,P(_({},i),{returnExceptions:!0})),d;for(let f=0;f<u.length;f+=1){let p=u[f],y=a[f];p instanceof Error&&d===void 0&&(d=p,d.input=c[f]),s[y.toString()]=p}if(d)throw d;return u}),{onFailedAttempt:o=>this.onFailedAttempt(o,o.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(o){if(i?.returnExceptions!==!0)throw o}return Object.keys(s).sort((o,a)=>parseInt(o,10)-parseInt(a,10)).map(o=>s[parseInt(o,10)])})}batch(e,t,r){return g(this,null,function*(){return this._batchWithConfig(this._batch.bind(this),e,t,r)})}},e_=class n extends en{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}invoke(e,t){return g(this,null,function*(){let r=ct(t),s=yield(yield Rr(r))?.handleChainStart(this.toJSON(),Jt(e,"input"),r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let o=e,a;try{let c=[this.first,...this.middle];for(let l=0;l<c.length;l+=1){let d=c[l].invoke(o,hn(r,{callbacks:s?.getChild(`seq:step:${l+1}`)}));o=yield Ui(d,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");a=yield this.last.invoke(o,hn(r,{callbacks:s?.getChild(`seq:step:${this.steps.length}`)}))}catch(c){throw yield s?.handleChainError(c),c}return yield s?.handleChainEnd(Jt(a,"output")),a})}batch(e,t,r){return g(this,null,function*(){let i=this._getOptionsList(t??{},e.length),s=yield Promise.all(i.map(Rr)),o=yield Promise.all(s.map((c,l)=>g(this,null,function*(){let u=yield c?.handleChainStart(this.toJSON(),Jt(e[l],"input"),i[l].runId,void 0,void 0,void 0,i[l].runName);return delete i[l].runId,u}))),a=e;try{for(let c=0;c<this.steps.length;c+=1){let u=this.steps[c].batch(a,o.map((d,f)=>{let p=d?.getChild(`seq:step:${c+1}`);return hn(i[f],{callbacks:p})}),r);a=yield Ui(u,i[0]?.signal)}}catch(c){throw yield Promise.all(o.map(l=>l?.handleChainError(c))),c}return yield Promise.all(o.map(c=>c?.handleChainEnd(Jt(a,"output")))),a})}_streamIterator(e,t){return we(this,null,function*(){let r=yield new $(Rr(t)),d=t??{},{runId:i}=d,s=nn(d,["runId"]),o=yield new $(r?.handleChainStart(this.toJSON(),Jt(e,"input"),i,void 0,void 0,void 0,s?.runName)),a=[this.first,...this.middle,this.last],c=!0,l;function u(){return we(this,null,function*(){yield e})}try{let b=a[0].transform(u(),hn(s,{callbacks:o?.getChild("seq:step:1")}));for(let E=1;E<a.length;E+=1){let D=a[E];b=yield new $(D.transform(b,hn(s,{callbacks:o?.getChild(`seq:step:${E+1}`)})))}try{for(var f=Me(b),p,y,w;p=!(y=yield new $(f.next())).done;p=!1){let E=y.value;if(t?.signal?.throwIfAborted(),yield E,c)if(l===void 0)l=E;else try{l=Bi(l,E)}catch{l=void 0,c=!1}}}catch{w=[y]}finally{try{p&&(y=f.return)&&(yield new $(y.call(f)))}finally{if(w)throw w[0]}}}catch(b){throw yield new $(o?.handleChainError(b)),b}yield new $(o?.handleChainEnd(Jt(l,"output")))})}getGraph(e){let t=new gh,r=null;return this.steps.forEach((i,s)=>{let o=i.getGraph(e);s!==0&&o.trimFirstNode(),s!==this.steps.length-1&&o.trimLastNode(),t.extend(o);let a=o.firstNode();if(!a)throw new Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,a),r=o.lastNode()}),t}pipe(e){return n.isRunnableSequence(e)?new n({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new n({first:this.first,middle:[...this.middle,this.last],last:Fa(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&en.isRunnable(e)}static from([e,...t],r){return new n({first:Fa(e),middle:t.slice(0,-1).map(Fa),last:Fa(t[t.length-1]),name:r})}},yh=class n extends en{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,r]of Object.entries(e.steps))this.steps[t]=Fa(r)}static from(e){return new n({steps:e})}invoke(e,t){return g(this,null,function*(){let r=ct(t),s=yield(yield Rr(r))?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let o={};try{let a=Object.entries(this.steps).map(u=>g(this,[u],function*([c,l]){o[c]=yield l.invoke(e,hn(r,{callbacks:s?.getChild(`map:key:${c}`)}))}));yield Ui(Promise.all(a),t?.signal)}catch(a){throw yield s?.handleChainError(a),a}return yield s?.handleChainEnd(o),o})}_transform(e,t,r){return we(this,null,function*(){let i=_({},this.steps),s=FS(e,Object.keys(i).length),o=new Map(Object.entries(i).map(([a,c],l)=>{let u=c.transform(s[l],hn(r,{callbacks:t?.getChild(`map:key:${a}`)}));return[a,u.next().then(d=>({key:a,gen:u,result:d}))]}));for(;o.size;){let a=Promise.race(o.values()),{key:c,result:l,gen:u}=yield new $(Ui(a,r?.signal));o.delete(c),l.done||(yield{[c]:l.value},o.set(c,u.next().then(d=>({key:c,gen:u,result:d}))))}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return g(this,null,function*(){function r(){return we(this,null,function*(){yield e})}let i=ct(t),s=new Ts({generator:this.transform(r(),i),config:i});return yield s.setup,Dn.fromAsyncGenerator(s)})}},ZS=class n extends en{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Oy(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}invoke(e,t){return g(this,null,function*(){let[r]=this._getOptionsList(t??{},1),i=yield Rr(r),s=this.func(hn(r,{callbacks:i}),e);return Ui(s,r?.signal)})}_streamIterator(e,t){return we(this,null,function*(){let[r]=this._getOptionsList(t??{},1),i=yield new $(this.invoke(e,t));if(Jy(i)){try{for(var s=Me(i),o,a,c;o=!(a=yield new $(s.next())).done;o=!1){let l=a.value;r?.signal?.throwIfAborted(),yield l}}catch{c=[a]}finally{try{o&&(a=s.return)&&(yield new $(a.call(s)))}finally{if(c)throw c[0]}}return}if(B$(i)){for(;;){r?.signal?.throwIfAborted();let l=i.next();if(l.done)break;yield l.value}return}yield i})}static from(e){return new n({func:e})}};function ore(n){if(Oy(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var t_=class n extends en{static lc_name(){return"RunnableLambda"}constructor(e){if(Oy(e.func))return ZS.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),ore(e.func),this.func=e.func}static from(e){return new n({func:e})}_invoke(e,t,r){return g(this,null,function*(){return new Promise((i,s)=>{let o=hn(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??Gy)-1});ni.runWithConfig(o,()=>g(this,null,function*(){try{let d=yield this.func(e,P(_({},o),{config:o}));if(d&&en.isRunnable(d)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");d=yield d.invoke(e,P(_({},o),{recursionLimit:(o.recursionLimit??Gy)-1}))}else if(Jy(d)){let f;try{for(var a=Me(KS(o,d)),c,l,u;c=!(l=yield a.next()).done;c=!1){let p=l.value;if(t?.signal?.throwIfAborted(),f===void 0)f=p;else try{f=Bi(f,p)}catch{f=p}}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield l.call(a))}finally{if(u)throw u[0]}}d=f}else if(GS(d)){let f;for(let p of WS(o,d))if(t?.signal?.throwIfAborted(),f===void 0)f=p;else try{f=Bi(f,p)}catch{f=p}d=f}i(d)}catch(d){s(d)}}))})})}invoke(e,t){return g(this,null,function*(){return this._callWithConfig(this._invoke,e,t)})}_transform(e,t,r){return we(this,null,function*(){let i;try{for(var a=Me(e),c,l,u;c=!(l=yield new $(a.next())).done;c=!1){let x=l.value;if(i===void 0)i=x;else try{i=Bi(i,x)}catch{i=x}}}catch{u=[l]}finally{try{c&&(l=a.return)&&(yield new $(l.call(a)))}finally{if(u)throw u[0]}}let s=hn(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??Gy)-1}),o=yield new $(new Promise((x,N)=>{ni.runWithConfig(s,()=>g(this,null,function*(){try{let L=yield this.func(i,P(_({},s),{config:s}));x(L)}catch(L){N(L)}}))}));if(o&&en.isRunnable(o)){if(r?.recursionLimit===0)throw new Error("Recursion limit reached.");let x=yield new $(o.stream(i,s));try{for(var d=Me(x),f,p,y;f=!(p=yield new $(d.next())).done;f=!1){let N=p.value;yield N}}catch{y=[p]}finally{try{f&&(p=d.return)&&(yield new $(p.call(d)))}finally{if(y)throw y[0]}}}else if(Jy(o))try{for(var w=Me(KS(s,o)),b,E,D;b=!(E=yield new $(w.next())).done;b=!1){let x=E.value;r?.signal?.throwIfAborted(),yield x}}catch{D=[E]}finally{try{b&&(E=w.return)&&(yield new $(E.call(w)))}finally{if(D)throw D[0]}}else if(GS(o))for(let x of WS(s,o))r?.signal?.throwIfAborted(),yield x;else yield o})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return g(this,null,function*(){function r(){return we(this,null,function*(){yield e})}let i=ct(t),s=new Ts({generator:this.transform(r(),i),config:i});return yield s.setup,Dn.fromAsyncGenerator(s)})}};var JS=class extends en{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}invoke(e,t){return g(this,null,function*(){let r=ct(t),i=yield Rr(t),l=r,{runId:s}=l,o=nn(l,["runId"]),a=yield i?.handleChainStart(this.toJSON(),Jt(e,"input"),s,void 0,void 0,void 0,o?.runName),c;for(let u of this.runnables()){r?.signal?.throwIfAborted();try{let d=yield u.invoke(e,hn(o,{callbacks:a?.getChild()}));return yield a?.handleChainEnd(Jt(d,"output")),d}catch(d){c===void 0&&(c=d)}}throw c===void 0?new Error("No error stored at end of fallback."):(yield a?.handleChainError(c),c)})}_streamIterator(e,t){return we(this,null,function*(){let r=ct(t),i=yield new $(Rr(t)),d=r,{runId:s}=d,o=nn(d,["runId"]),a=yield new $(i?.handleChainStart(this.toJSON(),Jt(e,"input"),s,void 0,void 0,void 0,o?.runName)),c,l;for(let b of this.runnables()){r?.signal?.throwIfAborted();let E=hn(o,{callbacks:a?.getChild()});try{l=yield new $(b.stream(e,E));break}catch(D){c===void 0&&(c=D)}}if(l===void 0){let b=c??new Error("No error stored at end of fallback.");throw yield new $(a?.handleChainError(b)),b}let u;try{try{for(var f=Me(l),p,y,w;p=!(y=yield new $(f.next())).done;p=!1){let b=y.value;yield b;try{u=u===void 0?u:Bi(u,b)}catch{u=void 0}}}catch{w=[y]}finally{try{p&&(y=f.return)&&(yield new $(y.call(f)))}finally{if(w)throw w[0]}}}catch(b){throw yield new $(a?.handleChainError(b)),b}yield new $(a?.handleChainEnd(Jt(u,"output")))})}batch(e,t,r){return g(this,null,function*(){if(r?.returnExceptions)throw new Error("Not implemented.");let i=this._getOptionsList(t??{},e.length),s=yield Promise.all(i.map(c=>Rr(c))),o=yield Promise.all(s.map((c,l)=>g(this,null,function*(){let u=yield c?.handleChainStart(this.toJSON(),Jt(e[l],"input"),i[l].runId,void 0,void 0,void 0,i[l].runName);return delete i[l].runId,u}))),a;for(let c of this.runnables()){i[0].signal?.throwIfAborted();try{let l=yield c.batch(e,o.map((u,d)=>hn(i[d],{callbacks:u?.getChild()})),r);return yield Promise.all(o.map((u,d)=>u?.handleChainEnd(Jt(l[d],"output")))),l}catch(l){a===void 0&&(a=l)}}throw a?(yield Promise.all(o.map(c=>c?.handleChainError(a))),a):new Error("No error stored at end of fallbacks.")})}};function Fa(n){if(typeof n=="function")return new t_({func:n});if(en.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){let e={};for(let[t,r]of Object.entries(n))e[t]=Fa(r);return new yh({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var eD=class extends en{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof yh&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}invoke(e,t){return g(this,null,function*(){let r=yield this.mapper.invoke(e,t);return _(_({},e),r)})}_transform(e,t,r){return we(this,null,function*(){let i=this.mapper.getStepsKeys(),[s,o]=FS(e),a=this.mapper.transform(o,hn(r,{callbacks:t?.getChild()})),c=a.next();try{for(var l=Me(s),u,d,f;u=!(d=yield new $(l.next())).done;u=!1){let E=d.value;if(typeof E!="object"||Array.isArray(E))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof E}`);let D=Object.fromEntries(Object.entries(E).filter(([x])=>!i.includes(x)));Object.keys(D).length>0&&(yield D)}}catch{f=[d]}finally{try{u&&(d=l.return)&&(yield new $(d.call(l)))}finally{if(f)throw f[0]}}yield(yield new $(c)).value;try{for(var p=Me(a),y,w,b;y=!(w=yield new $(p.next())).done;y=!1){let E=w.value;yield E}}catch{b=[w]}finally{try{y&&(w=p.return)&&(yield new $(w.call(p)))}finally{if(b)throw b[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return g(this,null,function*(){function r(){return we(this,null,function*(){yield e})}let i=ct(t),s=new Ts({generator:this.transform(r(),i),config:i});return yield s.setup,Dn.fromAsyncGenerator(s)})}},tD=class extends en{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}_pick(e){return g(this,null,function*(){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}})}invoke(e,t){return g(this,null,function*(){return this._callWithConfig(this._pick.bind(this),e,t)})}_transform(e){return we(this,null,function*(){try{for(var t=Me(e),r,i,s;r=!(i=yield new $(t.next())).done;r=!1){let o=i.value;let a=yield new $(this._pick(o));a!==void 0&&(yield a)}}catch{s=[i]}finally{try{r&&(i=t.return)&&(yield new $(i.call(t)))}finally{if(s)throw s[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return g(this,null,function*(){function r(){return we(this,null,function*(){yield e})}let i=ct(t),s=new Ts({generator:this.transform(r(),i),config:i});return yield s.setup,Dn.fromAsyncGenerator(s)})}},n_=class extends Va{constructor(e){let t=e_.from([t_.from(r=>g(this,null,function*(){let i;if(SS(r))try{i=yield this.schema.parseAsync(r.args)}catch{throw new $y("Received tool input did not match expected schema",JSON.stringify(r.args))}else i=r;return i})).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function are(n,e){let t=e.name??n.getName(),r=e.description??e.schema?.description;return e.schema.constructor===_o.ZodString?new n_({name:t,description:r,schema:_o.object({input:_o.string()}).transform(i=>i.input),bound:n}):new n_({name:t,description:r,schema:e.schema,bound:n})}var r_=class extends en{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,t){return this.transformDocuments(e)}};var G$=Or(z$(),1);var mre=Object.defineProperty,gre=(n,e,t)=>e in n?mre(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,yre=(n,e,t)=>(gre(n,typeof e!="symbol"?e+"":e,t),t);function _re(n,e){let t=Array.from({length:n.length},(r,i)=>({start:i,end:i+1}));for(;t.length>1;){let r=null;for(let i=0;i<t.length-1;i++){let s=n.slice(t[i].start,t[i+1].end),o=e.get(s.join(","));o!=null&&(r==null||o<r[0])&&(r=[o,i])}if(r!=null){let i=r[1];t[i]={start:t[i].start,end:t[i+1].end},t.splice(i+1,1)}else break}return t}function vre(n,e){return n.length===1?[e.get(n.join(","))]:_re(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function wre(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var rD=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(n,e){this.patStr=n.pat_str;let t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,i)=>{let[s,o,...a]=i.split(" "),c=Number.parseInt(o,10);return a.forEach((l,u)=>r[l]=c+u),r},{});for(let[r,i]of Object.entries(t)){let s=G$.default.toByteArray(r);this.rankMap.set(s.join(","),i),this.textMap.set(i,s)}this.specialTokens=_(_({},n.special_tokens),e),this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[i,s])=>(r[s]=this.textEncoder.encode(i),r),{})}encode(n,e=[],t="all"){let r=new RegExp(this.patStr,"ug"),i=rD.specialTokenRegex(Object.keys(this.specialTokens)),s=[],o=new Set(e==="all"?Object.keys(this.specialTokens):e),a=new Set(t==="all"?Object.keys(this.specialTokens).filter(l=>!o.has(l)):t);if(a.size>0){let l=rD.specialTokenRegex([...a]),u=n.match(l);if(u!=null)throw new Error(`The text contains a special token that is not allowed: ${u[0]}`)}let c=0;for(;;){let l=null,u=c;for(;i.lastIndex=u,l=i.exec(n),!(l==null||o.has(l[0]));)u=l.index+1;let d=l?.index??n.length;for(let p of n.substring(c,d).matchAll(r)){let y=this.textEncoder.encode(p[0]),w=this.rankMap.get(y.join(","));if(w!=null){s.push(w);continue}s.push(...vre(y,this.rankMap))}if(l==null)break;let f=this.specialTokens[l[0]];s.push(f),c=l.index+l[0].length}return s}decode(n){let e=[],t=0;for(let s=0;s<n.length;++s){let o=n[s],a=this.textMap.get(o)??this.inverseSpecialTokens[o];a!=null&&(e.push(a),t+=a.length)}let r=new Uint8Array(t),i=0;for(let s of e)r.set(s,i),i+=s.length;return this.textDecoder.decode(r)}},iD=rD;yre(iD,"specialTokenRegex",n=>new RegExp(n.map(e=>wre(e)).join("|"),"g"));var sD=class extends r_{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=e?.chunkSize??this.chunkSize,this.chunkOverlap=e?.chunkOverlap??this.chunkOverlap,this.keepSeparator=e?.keepSeparator??this.keepSeparator,this.lengthFunction=e?.lengthFunction??(t=>t.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}transformDocuments(r){return g(this,arguments,function*(e,t={}){return this.splitDocuments(e,t)})}splitOnSeparator(e,t){let r;if(t)if(this.keepSeparator){let i=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${i})`))}else r=e.split(t);else r=e.split("");return r.filter(i=>i!=="")}createDocuments(i){return g(this,arguments,function*(e,t=[],r={}){let s=t.length>0?t:[...Array(e.length)].map(()=>({})),{chunkHeader:o="",chunkOverlapHeader:a="(cont'd) ",appendChunkOverlapHeader:c=!1}=r,l=new Array;for(let u=0;u<e.length;u+=1){let d=e[u],f=1,p=null,y=-1;for(let w of yield this.splitText(d)){let b=o,E=d.indexOf(w,y+1);if(p===null){let L=this.numberOfNewLines(d,0,E);f+=L}else{let L=y+(yield this.lengthFunction(p));if(L<E){let F=this.numberOfNewLines(d,L,E);f+=F}else if(L>E){let F=this.numberOfNewLines(d,E,L);f-=F}c&&(b+=a)}let D=this.numberOfNewLines(w),x=s[u].loc&&typeof s[u].loc=="object"?_({},s[u].loc):{};x.lines={from:f,to:f+D};let N=P(_({},s[u]),{loc:x});b+=w,l.push(new Kg({pageContent:b,metadata:N})),f+=D,p=w,y=E}}return l})}numberOfNewLines(e,t,r){return(e.slice(t,r).match(/\n/g)||[]).length}splitDocuments(r){return g(this,arguments,function*(e,t={}){let i=e.filter(a=>a.pageContent!==void 0),s=i.map(a=>a.pageContent),o=i.map(a=>a.metadata);return this.createDocuments(s,o,t)})}joinDocs(e,t){let r=e.join(t).trim();return r===""?null:r}mergeSplits(e,t){return g(this,null,function*(){let r=[],i=[],s=0;for(let a of e){let c=yield this.lengthFunction(a);if(s+c+i.length*t.length>this.chunkSize&&(s>this.chunkSize&&console.warn(`Created a chunk of size ${s}, +
which is longer than the specified ${this.chunkSize}`),i.length>0)){let l=this.joinDocs(i,t);for(l!==null&&r.push(l);s>this.chunkOverlap||s+c+i.length*t.length>this.chunkSize&&s>0;)s-=yield this.lengthFunction(i[0]),i.shift()}i.push(a),s+=c}let o=this.joinDocs(i,t);return o!==null&&r.push(o),r})}};var s_=class n extends sD{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=e?.separators??this.separators,this.keepSeparator=e?.keepSeparator??!0}_splitText(e,t){return g(this,null,function*(){let r=[],i=t[t.length-1],s;for(let l=0;l<t.length;l+=1){let u=t[l];if(u===""){i=u;break}if(e.includes(u)){i=u,s=t.slice(l+1);break}}let o=this.splitOnSeparator(e,i),a=[],c=this.keepSeparator?"":i;for(let l of o)if((yield this.lengthFunction(l))<this.chunkSize)a.push(l);else{if(a.length){let u=yield this.mergeSplits(a,c);r.push(...u),a=[]}if(!s)r.push(l);else{let u=yield this._splitText(l,s);r.push(...u)}}if(a.length){let l=yield this.mergeSplits(a,c);r.push(...l)}return r})}splitText(e){return g(this,null,function*(){return this._splitText(e,this.separators)})}static fromLanguage(e,t){return new n(P(_({},t),{separators:n.getSeparatorsForLanguage(e)}))}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}};qF.workerSrc="/assets/pdf.worker.min.js";var W$=(()=>{class n{constructor(){}pdfToTextByPage(t){return g(this,null,function*(){let r=yield t.arrayBuffer(),i=yield zF({data:r}).promise,s=[];for(let o=1;o<=i.numPages;o++){let l=(yield(yield i.getPage(o)).getTextContent()).items.map(u=>u.str).join(" ").replace(/\s+/g," ").trim();s.push(l)}return s})}chunkPages(t){return g(this,null,function*(){let r=new s_({chunkSize:400,chunkOverlap:50,separators:[`

`,`
`," ",""]}),i=[],s=0;for(let o=0;o<t.length;o++){let a=t[o];if(a.trim().length===0)continue;let c=yield r.splitText(a);for(let l of c)i.push({text:l.trim(),page:o+1,chunkIndex:s++})}return i})}processPdfFile(t){return g(this,null,function*(){try{console.log(`Processing PDF: ${t.name}`);let r=yield this.pdfToTextByPage(t);console.log(`Extracted text from ${r.length} pages`);let i=yield this.chunkPages(r);return console.log(`Created ${i.length} chunks`),i}catch(r){throw console.error("Error processing PDF:",r),r}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var K$=(()=>{class n{constructor(t,r,i,s){this.firestore=t,this.storage=r,this.functions=i,this.auth=s,this.embedChunks=Qm(this.functions,"embedChunks")}uploadPdf(t){return g(this,null,function*(){if(!this.auth.currentUser)throw new Error("User not authenticated");let r=this.auth.currentUser.uid,s=`${Date.now()}_${t.name}`,o=`documents/${r}/${s}`,a=FL(this.storage,o);yield VL(a,t);let c=yield kL(a),l={uid:r,filename:t.name,bucketPath:o,pageCount:0,status:"processing",createdAt:new Date,uploadUrl:c};return(yield lo(Xr(this.firestore,"documents"),l)).id})}saveChunksWithEmbeddings(t,r){return g(this,null,function*(){if(!this.auth.currentUser)throw new Error("User not authenticated");let i=this.auth.currentUser.uid,s=64,o=Xr(this.firestore,`documents/${t}/chunks`);for(let a=0;a<r.length;a+=s){let c=r.slice(a,a+s),l=c.map(u=>u.text);try{console.log(`Getting embeddings for batch ${Math.floor(a/s)+1}/${Math.ceil(r.length/s)}`);let{data:u}=yield this.embedChunks({texts:l}),d=c.map((f,p)=>g(this,null,function*(){let y=P(_({},f),{docId:t,uid:i,embedding:u.vectors[p]||[]});return lo(o,y)}));yield Promise.all(d)}catch(u){throw console.error("Error getting embeddings for batch:",u),u}}})}updateDocumentStatus(t,r,i){return g(this,null,function*(){let s=rL(this.firestore,`documents/${t}`),o={status:r};i!==void 0&&(o.pageCount=i),yield sL(s,o)})}getUserDocuments(){return g(this,null,function*(){if(!this.auth.currentUser)return[];let t=this.auth.currentUser.uid,r=md(Xr(this.firestore,"documents"),qm("uid","==",t),pd("createdAt","desc"));return(yield fd(r)).docs.map(s=>{let o=s.data();return P(_({id:s.id},o),{createdAt:o.createdAt?.toDate?o.createdAt.toDate():new Date(o.createdAt)})})})}static{this.\u0275fac=function(r){return new(r||n)(pe(fs),pe(ya),pe(ps),pe(Kr))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Y$=(()=>{class n{constructor(t,r,i){this.firestore=t,this.functions=r,this.auth=i,this.chatRag=Qm(this.functions,"chatRag")}createSession(t){return g(this,null,function*(){if(!this.auth.currentUser)throw new Error("User not authenticated");let i={uid:this.auth.currentUser.uid,title:t||`Chat ${new Date().toLocaleString()}`,createdAt:new Date};return(yield lo(Xr(this.firestore,"sessions"),i)).id})}getUserSessions(){return g(this,null,function*(){if(!this.auth.currentUser)return[];let t=this.auth.currentUser.uid,r=md(Xr(this.firestore,"sessions"),qm("uid","==",t),pd("createdAt","desc"));return(yield fd(r)).docs.map(s=>P(_({id:s.id},s.data()),{createdAt:s.data().createdAt.toDate()}))})}getSessionMessages(t){return g(this,null,function*(){let r=md(Xr(this.firestore,`sessions/${t}/messages`),pd("createdAt","asc"));return(yield fd(r)).docs.map(s=>P(_({id:s.id},s.data()),{createdAt:s.data().createdAt.toDate()}))})}sendMessage(t,r,i){return g(this,null,function*(){if(!this.auth.currentUser)throw new Error("User not authenticated");let s=this.auth.currentUser.uid,o={role:"user",content:r,createdAt:new Date},a=yield lo(Xr(this.firestore,`sessions/${t}/messages`),o);try{let{data:c}=yield this.chatRag({sessionId:t,message:r,k:8,restrictDocId:i}),l={role:"assistant",content:c.answer,sources:c.sources,createdAt:new Date},u=yield lo(Xr(this.firestore,`sessions/${t}/messages`),l);return _({id:u.id},l)}catch(c){console.error("Error getting RAG response:",c);let l={role:"assistant",content:"Sorry, I encountered an error processing your question. Please try again.",createdAt:new Date},u=yield lo(Xr(this.firestore,`sessions/${t}/messages`),l);return _({id:u.id},l)}})}static{this.\u0275fac=function(r){return new(r||n)(pe(fs),pe(ps),pe(Kr))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var o_=(()=>{class n{constructor(t){this.auth=t,this.userSubject=new Bt(null),this.user$=this.userSubject.asObservable(),sk(this.auth,r=>{this.userSubject.next(r)})}signInAnonymously(){return g(this,null,function*(){try{yield ok(this.auth)}catch(t){throw console.error("Error signing in:",t),t}})}signOut(){return g(this,null,function*(){try{yield ak(this.auth)}catch(t){throw console.error("Error signing out:",t),t}})}getCurrentUser(){return this.auth.currentUser}isAuthenticated(){return!!this.auth.currentUser}static{this.\u0275fac=function(r){return new(r||n)(pe(Kr))}}static{this.\u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Tre(n,e){if(n&1){let t=ir();Z(0,"div",12)(1,"div",13),_e(2,"\u{1F4E4}"),W(),Z(3,"h3"),_e(4,"Upload PDF Document"),W(),Z(5,"p"),_e(6,"Drag and drop a PDF file here, or click to select"),W(),Z(7,"input",14,0),Tt("change",function(i){Yt(t);let s=nt(2);return Qt(s.onFileSelect(i))}),W(),Z(9,"button",15),Tt("click",function(){Yt(t);let i=lu(8);return Qt(i.click())}),_e(10," Choose File "),W()()}}function Cre(n,e){if(n&1&&(Z(0,"div",16),Hs(1,"div",17),Z(2,"p"),_e(3),W()()),n&2){let t=nt(2);oe(3),mi(t.uploadProgress)}}function Sre(n,e){n&1&&(Z(0,"span"),_e(1,"\u{1F4C4}"),W())}function Dre(n,e){n&1&&(Z(0,"span",30),_e(1,"\u23F3"),W())}function xre(n,e){n&1&&(Z(0,"span"),_e(1,"\u274C"),W())}function Rre(n,e){if(n&1&&(Z(0,"span",31),_e(1),W()),n&2){let t=nt().$implicit;oe(),yr("",t.pageCount," pages")}}function Pre(n,e){if(n&1){let t=ir();Z(0,"div",21),Tt("click",function(){let i=Yt(t).$implicit,s=nt(3);return Qt(s.selectDocument(i))}),Z(1,"div",22),_t(2,Sre,2,0,"span",23)(3,Dre,2,0,"span",24)(4,xre,2,0,"span",23),W(),Z(5,"div",25)(6,"h4"),_e(7),W(),Z(8,"div",26)(9,"span",27),_e(10),W(),_t(11,Rre,2,1,"span",28),Z(12,"span",29),_e(13),W()()()()}if(n&2){let t=e.$implicit,r=nt(3);pi("selected",(r.selectedDocument==null?null:r.selectedDocument.id)===t.id)("processing",t.status==="processing")("error",t.status==="error"),oe(2),je("ngIf",t.status==="completed"),oe(),je("ngIf",t.status==="processing"),oe(),je("ngIf",t.status==="error"),oe(3),mi(t.filename),oe(2),bM(t.status),oe(),mi(t.status),oe(),je("ngIf",t.pageCount>0),oe(2),mi(t.createdAt.toLocaleDateString())}}function Mre(n,e){if(n&1&&(Z(0,"div",18)(1,"h3"),_e(2,"Your Documents"),W(),Z(3,"div",19),_t(4,Pre,14,15,"div",20),W()()),n&2){let t=nt(2);oe(4),je("ngForOf",t.documents)}}function Nre(n,e){n&1&&(Z(0,"div",32)(1,"p"),_e(2,"No documents uploaded yet. Start by uploading your first PDF!"),W()())}function Ore(n,e){if(n&1){let t=ir();Z(0,"div",5)(1,"div",6)(2,"div",7),Tt("dragover",function(i){Yt(t);let s=nt();return Qt(s.onDragOver(i))})("dragleave",function(i){Yt(t);let s=nt();return Qt(s.onDragLeave(i))})("drop",function(i){Yt(t);let s=nt();return Qt(s.onDrop(i))}),_t(3,Tre,11,0,"div",8)(4,Cre,4,1,"div",9),W(),_t(5,Mre,5,1,"div",10)(6,Nre,3,0,"div",11),W()()}if(n&2){let t=nt();oe(2),pi("drag-over",t.dragOver)("uploading",t.uploading),oe(),je("ngIf",!t.uploading),oe(),je("ngIf",t.uploading),oe(),je("ngIf",t.documents.length>0),oe(),je("ngIf",t.documents.length===0&&!t.uploading)}}function kre(n,e){if(n&1){let t=ir();Z(0,"div",44),Tt("click",function(){let i=Yt(t).$implicit,s=nt(2);return Qt(s.selectSession(i))}),Z(1,"div",45),_e(2),W(),Z(3,"div",46),_e(4),W()()}if(n&2){let t=e.$implicit,r=nt(2);pi("active",(r.currentSession==null?null:r.currentSession.id)===t.id),oe(2),mi(t.title),oe(2),mi(t.createdAt.toLocaleDateString())}}function Lre(n,e){if(n&1&&(Z(0,"option",51),_e(1),W()),n&2){let t=e.$implicit;je("ngValue",t)("disabled",t.status!=="completed"),oe(),yr(" ",t.filename," ")}}function Fre(n,e){if(n&1){let t=ir();Z(0,"div",47)(1,"h4"),_e(2,"Filter by Document"),W(),Z(3,"select",48),ep("ngModelChange",function(i){Yt(t);let s=nt(2);return $w(s.selectedDocument,i)||(s.selectedDocument=i),Qt(i)}),Z(4,"option",49),_e(5,"All documents"),W(),_t(6,Lre,2,3,"option",50),W()()}if(n&2){let t=nt(2);oe(3),Jf("ngModel",t.selectedDocument),oe(),je("ngValue",null),oe(2),je("ngForOf",t.documents)}}function Vre(n,e){if(n&1&&(Z(0,"div",54)(1,"span",55),_e(2),W()()),n&2){let t=nt(3);oe(2),yr("\u{1F4C4} ",t.selectedDocument.filename,"")}}function jre(n,e){if(n&1&&(Z(0,"div",52)(1,"h2"),_e(2),W(),_t(3,Vre,3,1,"div",53),W()),n&2){let t=nt(2);oe(2),mi(t.currentSession.title),oe(),je("ngIf",t.selectedDocument)}}function $re(n,e){if(n&1&&(Z(0,"span",74),_e(1),W()),n&2){let t=e.$implicit;oe(),yr(" ",t.label," ")}}function Ure(n,e){if(n&1&&(Z(0,"div",71)(1,"h5"),_e(2,"Sources:"),W(),Z(3,"div",72),_t(4,$re,2,1,"span",73),W()()),n&2){let t=nt().$implicit;oe(4),je("ngForOf",t.sources)}}function Bre(n,e){if(n&1&&(Z(0,"div",66)(1,"div",67)(2,"div",68),_e(3),W(),_t(4,Ure,5,1,"div",69),W(),Z(5,"div",70),_e(6),W()()),n&2){let t=e.$implicit;pi("user-message",t.role==="user")("assistant-message",t.role==="assistant"),oe(3),mi(t.content),oe(),je("ngIf",t.sources&&t.sources.length>0),oe(2),yr(" ",t.createdAt.toLocaleTimeString()," ")}}function Hre(n,e){n&1&&(Z(0,"div",75)(1,"div",67)(2,"div",76),Hs(3,"span")(4,"span")(5,"span"),W()()())}function qre(n,e){n&1&&(Z(0,"span"),_e(1,"\u27A4"),W())}function zre(n,e){n&1&&(Z(0,"span",77),_e(1,"\u23F3"),W())}function Gre(n,e){n&1&&(Z(0,"div",78),_e(1," Upload some documents first to start chatting! "),W())}function Wre(n,e){if(n&1){let t=ir();Z(0,"div",56)(1,"div",57),_t(2,Bre,7,7,"div",58)(3,Hre,6,0,"div",59),W(),Z(4,"div",60)(5,"div",61)(6,"textarea",62),ep("ngModelChange",function(i){Yt(t);let s=nt(2);return $w(s.messageInput,i)||(s.messageInput=i),Qt(i)}),Tt("keydown",function(i){Yt(t);let s=nt(2);return Qt(s.onEnterKey(i))}),W(),Z(7,"button",63),Tt("click",function(){Yt(t);let i=nt(2);return Qt(i.sendMessage())}),_t(8,qre,2,0,"span",23)(9,zre,2,0,"span",64),W()(),_t(10,Gre,2,0,"div",65),W()()}if(n&2){let t=nt(2);oe(2),je("ngForOf",t.messages),oe(),je("ngIf",t.sending),oe(3),Jf("ngModel",t.messageInput),je("disabled",t.sending||t.documents.length===0),oe(),je("disabled",!t.messageInput.trim()||t.sending||t.documents.length===0),oe(),je("ngIf",!t.sending),oe(),je("ngIf",t.sending),oe(),je("ngIf",t.documents.length===0)}}function Kre(n,e){if(n&1){let t=ir();Z(0,"div",79)(1,"h3"),_e(2,"Welcome to RAG Chatbot! \u{1F916}"),W(),Z(3,"p"),_e(4,"Create a new chat session to start asking questions about your documents."),W(),Z(5,"button",15),Tt("click",function(){Yt(t);let i=nt(2);return Qt(i.createNewSession())}),_e(6," Start New Chat "),W()()}}function Yre(n,e){if(n&1){let t=ir();Z(0,"div",5)(1,"div",33)(2,"aside",34)(3,"div",35)(4,"h3"),_e(5,"Chat Sessions"),W(),Z(6,"button",36),Tt("click",function(){Yt(t);let i=nt();return Qt(i.createNewSession())}),_e(7," + New Chat "),W()(),Z(8,"div",37),_t(9,kre,5,4,"div",38),W(),_t(10,Fre,7,3,"div",39),W(),Z(11,"main",40),_t(12,jre,4,2,"div",41)(13,Wre,11,8,"div",42)(14,Kre,7,0,"div",43),W()()()}if(n&2){let t=nt();oe(9),je("ngForOf",t.sessions),oe(),je("ngIf",t.documents.length>0),oe(2),je("ngIf",t.currentSession),oe(),je("ngIf",t.currentSession),oe(),je("ngIf",!t.currentSession)}}var X$=(()=>{class n{constructor(t,r,i,s){this.pdfProcessor=t,this.documentService=r,this.chatService=i,this.authService=s,this.documents=[],this.selectedDocument=null,this.uploading=!1,this.uploadProgress="",this.sessions=[],this.currentSession=null,this.messages=[],this.messageInput="",this.sending=!1,this.activeTab="documents",this.dragOver=!1}ngOnInit(){this.loadUserData()}loadUserData(){return g(this,null,function*(){try{this.documents=yield this.documentService.getUserDocuments(),this.sessions=yield this.chatService.getUserSessions(),this.sessions.length>0&&!this.currentSession&&(yield this.selectSession(this.sessions[0]))}catch(t){console.error("Error loading user data:",t)}})}onDragOver(t){t.preventDefault(),this.dragOver=!0}onDragLeave(t){t.preventDefault(),this.dragOver=!1}onDrop(t){t.preventDefault(),this.dragOver=!1;let r=t.dataTransfer?.files;r&&r.length>0&&this.handleFile(r[0])}onFileSelect(t){let r=t.target;r.files&&r.files.length>0&&this.handleFile(r.files[0])}handleFile(t){return g(this,null,function*(){if(t.type!=="application/pdf"){alert("Please select a PDF file.");return}if(t.size>50*1024*1024){alert("File size must be less than 50MB.");return}this.uploading=!0,this.uploadProgress="Uploading file...";try{let r=yield this.documentService.uploadPdf(t);this.uploadProgress="Processing PDF...";let i=yield this.pdfProcessor.processPdfFile(t);this.uploadProgress=`Generating embeddings for ${i.length} chunks...`,yield this.documentService.saveChunksWithEmbeddings(r,i),this.uploadProgress="Finalizing...",yield this.documentService.updateDocumentStatus(r,"completed",i.length),this.uploadProgress="Complete!",yield this.loadUserData()}catch(r){console.error("Error processing file:",r),this.uploadProgress="Error processing file. Please try again."}finally{this.uploading=!1,setTimeout(()=>{this.uploadProgress=""},2e3)}})}selectDocument(t){this.selectedDocument=t}createNewSession(){return g(this,null,function*(){try{let t=yield this.chatService.createSession();yield this.loadUserData();let r=this.sessions.find(i=>i.id===t);r&&(yield this.selectSession(r)),this.activeTab="chat"}catch(t){console.error("Error creating session:",t)}})}selectSession(t){return g(this,null,function*(){this.currentSession=t;try{this.messages=yield this.chatService.getSessionMessages(t.id)}catch(r){console.error("Error loading messages:",r)}})}sendMessage(){return g(this,null,function*(){if(!this.messageInput.trim()||!this.currentSession||this.sending)return;let t=this.messageInput.trim();this.messageInput="",this.sending=!0;let r={role:"user",content:t,createdAt:new Date};this.messages.push(r);try{let i=yield this.chatService.sendMessage(this.currentSession.id,t,this.selectedDocument?.id);this.messages.push(i)}catch(i){console.error("Error sending message:",i),this.messages.push({role:"assistant",content:"Sorry, there was an error processing your message. Please try again.",createdAt:new Date})}finally{this.sending=!1}})}onEnterKey(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}setActiveTab(t){this.activeTab=t}static{this.\u0275fac=function(r){return new(r||n)(ke(W$),ke(K$),ke(Y$),ke(o_))}}static{this.\u0275cmp=_c({type:n,selectors:[["app-dashboard"]],standalone:!0,features:[Ic],decls:8,vars:7,consts:[["fileInput",""],[1,"dashboard"],[1,"tab-nav"],[1,"tab-btn",3,"click"],["class","tab-content",4,"ngIf"],[1,"tab-content"],[1,"documents-section"],[1,"upload-area",3,"dragover","dragleave","drop"],["class","upload-content",4,"ngIf"],["class","upload-progress",4,"ngIf"],["class","documents-list",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"upload-content"],[1,"upload-icon"],["type","file","accept","application/pdf",2,"display","none",3,"change"],[1,"btn","btn-primary",3,"click"],[1,"upload-progress"],[1,"spinner"],[1,"documents-list"],[1,"document-grid"],["class","document-card",3,"selected","processing","error","click",4,"ngFor","ngForOf"],[1,"document-card",3,"click"],[1,"doc-icon"],[4,"ngIf"],["class","processing-icon",4,"ngIf"],[1,"doc-info"],[1,"doc-meta"],[1,"doc-status"],["class","doc-pages",4,"ngIf"],[1,"doc-date"],[1,"processing-icon"],[1,"doc-pages"],[1,"empty-state"],[1,"chat-layout"],[1,"chat-sidebar"],[1,"sidebar-header"],[1,"btn","btn-small","btn-primary",3,"click"],[1,"sessions-list"],["class","session-item",3,"active","click",4,"ngFor","ngForOf"],["class","document-filter",4,"ngIf"],[1,"chat-main"],["class","chat-header",4,"ngIf"],["class","messages-container",4,"ngIf"],["class","empty-chat",4,"ngIf"],[1,"session-item",3,"click"],[1,"session-title"],[1,"session-date"],[1,"document-filter"],[1,"doc-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],[3,"ngValue","disabled"],[1,"chat-header"],["class","chat-info",4,"ngIf"],[1,"chat-info"],[1,"document-badge"],[1,"messages-container"],[1,"messages-list"],["class","message",3,"user-message","assistant-message",4,"ngFor","ngForOf"],["class","message assistant-message",4,"ngIf"],[1,"message-input-area"],[1,"input-wrapper"],["placeholder","Ask a question about your documents...","rows","2",1,"message-input",3,"ngModelChange","keydown","ngModel","disabled"],[1,"send-btn",3,"click","disabled"],["class","sending-icon",4,"ngIf"],["class","input-help",4,"ngIf"],[1,"message"],[1,"message-content"],[1,"message-text"],["class","message-sources",4,"ngIf"],[1,"message-time"],[1,"message-sources"],[1,"source-tags"],["class","source-tag",4,"ngFor","ngForOf"],[1,"source-tag"],[1,"message","assistant-message"],[1,"typing-indicator"],[1,"sending-icon"],[1,"input-help"],[1,"empty-chat"]],template:function(r,i){r&1&&(Z(0,"div",1)(1,"nav",2)(2,"button",3),Tt("click",function(){return i.setActiveTab("documents")}),_e(3),W(),Z(4,"button",3),Tt("click",function(){return i.setActiveTab("chat")}),_e(5," \u{1F4AC} Chat "),W()(),_t(6,Ore,7,8,"div",4)(7,Yre,15,5,"div",4),W()),r&2&&(oe(2),pi("active",i.activeTab==="documents"),oe(),yr(" \u{1F4C4} Documents (",i.documents.length,") "),oe(),pi("active",i.activeTab==="chat"),oe(2),je("ngIf",i.activeTab==="documents"),oe(),je("ngIf",i.activeTab==="chat"))},dependencies:[fu,qM,op,vF,gF,_F,tg,rg,hF,HA],styles:[".dashboard[_ngcontent-%COMP%]{height:100vh;display:flex;flex-direction:column}.tab-nav[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid #dee2e6;background:#fff;padding:0 2rem}.tab-btn[_ngcontent-%COMP%]{padding:1rem 1.5rem;border:none;background:none;cursor:pointer;font-weight:500;color:#6c757d;border-bottom:3px solid transparent;transition:all .2s}.tab-btn[_ngcontent-%COMP%]:hover{color:#495057;background:#f8f9fa}.tab-btn.active[_ngcontent-%COMP%]{color:#007bff;border-bottom-color:#007bff}.tab-content[_ngcontent-%COMP%]{flex:1;overflow:hidden}.documents-section[_ngcontent-%COMP%]{padding:2rem;height:100%;overflow-y:auto}.upload-area[_ngcontent-%COMP%]{border:2px dashed #dee2e6;border-radius:8px;padding:3rem 2rem;text-align:center;margin-bottom:2rem;transition:all .2s;background:#fff}.upload-area.drag-over[_ngcontent-%COMP%]{border-color:#007bff;background:#f0f8ff}.upload-area.uploading[_ngcontent-%COMP%]{border-color:#28a745;background:#f0fff4}.upload-content[_ngcontent-%COMP%]{max-width:400px;margin:0 auto}.upload-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.upload-area[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:.5rem;color:#495057}.upload-area[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;margin-bottom:1.5rem}.upload-progress[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #007bff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.documents-list[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#495057}.document-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem}.document-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #dee2e6;border-radius:8px;padding:1.5rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:1rem}.document-card[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #0000001a;transform:translateY(-1px)}.document-card.selected[_ngcontent-%COMP%]{border-color:#007bff;box-shadow:0 0 0 2px #007bff40}.document-card.processing[_ngcontent-%COMP%]{opacity:.7}.document-card.error[_ngcontent-%COMP%]{border-color:#dc3545}.doc-icon[_ngcontent-%COMP%]{font-size:2rem;flex-shrink:0}.processing-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite alternate}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:1}to{opacity:.4}}.doc-info[_ngcontent-%COMP%]{flex:1;min-width:0}.doc-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1rem;font-weight:600;color:#495057;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.doc-meta[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;font-size:.8rem;color:#6c757d}.doc-status[_ngcontent-%COMP%]{padding:.1rem .5rem;border-radius:12px;font-weight:500;text-transform:capitalize}.doc-status.completed[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.doc-status.processing[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.doc-status.error[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#6c757d}.chat-layout[_ngcontent-%COMP%]{display:flex;height:100%}.chat-sidebar[_ngcontent-%COMP%]{width:320px;background:#fff;border-right:1px solid #dee2e6;display:flex;flex-direction:column;overflow:hidden}.sidebar-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #dee2e6;display:flex;justify-content:space-between;align-items:center}.sidebar-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;color:#495057}.sessions-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:.5rem}.session-item[_ngcontent-%COMP%]{padding:1rem;border-radius:6px;cursor:pointer;margin-bottom:.25rem;transition:background .2s}.session-item[_ngcontent-%COMP%]:hover{background:#f8f9fa}.session-item.active[_ngcontent-%COMP%]{background:#e7f3ff;border:1px solid #007bff}.session-title[_ngcontent-%COMP%]{font-weight:500;color:#495057;margin-bottom:.25rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.session-date[_ngcontent-%COMP%]{font-size:.8rem;color:#6c757d}.document-filter[_ngcontent-%COMP%]{padding:1.5rem;border-top:1px solid #dee2e6}.document-filter[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.9rem;color:#495057}.doc-select[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ced4da;border-radius:4px;font-size:.9rem}.chat-main[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}.chat-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #dee2e6;background:#fff;display:flex;justify-content:space-between;align-items:center}.chat-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;color:#495057}.document-badge[_ngcontent-%COMP%]{background:#e7f3ff;color:#0056b3;padding:.25rem .75rem;border-radius:12px;font-size:.8rem;font-weight:500}.messages-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}.messages-list[_ngcontent-%COMP%]{flex:1;padding:1rem;overflow-y:auto;background:#f8f9fa}.message[_ngcontent-%COMP%]{margin-bottom:1.5rem;display:flex;flex-direction:column}.user-message[_ngcontent-%COMP%]{align-items:flex-end}.assistant-message[_ngcontent-%COMP%]{align-items:flex-start}.message-content[_ngcontent-%COMP%]{max-width:70%;padding:1rem;border-radius:12px;position:relative}.user-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:#007bff;color:#fff}.assistant-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:#fff;border:1px solid #dee2e6}.message-text[_ngcontent-%COMP%]{line-height:1.4;white-space:pre-wrap}.message-sources[_ngcontent-%COMP%]{margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,.2)}.assistant-message[_ngcontent-%COMP%]   .message-sources[_ngcontent-%COMP%]{border-top-color:#dee2e6}.message-sources[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.8rem;font-weight:600;opacity:.8}.source-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.25rem}.source-tag[_ngcontent-%COMP%]{background:#fff3;padding:.1rem .5rem;border-radius:8px;font-size:.7rem;font-weight:500}.assistant-message[_ngcontent-%COMP%]   .source-tag[_ngcontent-%COMP%]{background:#f8f9fa;color:#6c757d}.message-time[_ngcontent-%COMP%]{font-size:.7rem;color:#6c757d;margin-top:.5rem;opacity:.7}.typing-indicator[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;background:#007bff;animation:_ngcontent-%COMP%_typing 1.4s infinite}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}@keyframes _ngcontent-%COMP%_typing{0%,60%,to{opacity:.3}30%{opacity:1}}.message-input-area[_ngcontent-%COMP%]{padding:1rem;background:#fff;border-top:1px solid #dee2e6}.input-wrapper[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:flex-end}.message-input[_ngcontent-%COMP%]{flex:1;padding:.75rem;border:1px solid #ced4da;border-radius:8px;resize:vertical;min-height:42px;max-height:120px;font-family:inherit;font-size:.9rem}.message-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 2px #007bff40}.send-btn[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#007bff;color:#fff;border:none;border-radius:8px;cursor:pointer;transition:background .2s;min-width:50px;display:flex;align-items:center;justify-content:center}.send-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}.send-btn[_ngcontent-%COMP%]:disabled{background:#6c757d;cursor:not-allowed}.sending-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1s ease-in-out infinite alternate}.input-help[_ngcontent-%COMP%]{margin-top:.5rem;font-size:.8rem;color:#6c757d;text-align:center}.empty-chat[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:2rem;background:#f8f9fa}.empty-chat[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#495057}.empty-chat[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;margin-bottom:2rem;max-width:400px}@media (max-width: 768px){.chat-sidebar[_ngcontent-%COMP%]{position:absolute;z-index:100;height:100%;transform:translate(-100%);transition:transform .3s}.document-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.message-content[_ngcontent-%COMP%]{max-width:85%}}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:.25rem;font-size:.9rem;cursor:pointer;transition:all .2s;text-decoration:none;display:inline-block;font-weight:500}.btn-small[_ngcontent-%COMP%]{padding:.4rem .8rem;font-size:.8rem}.btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none}.btn-primary[_ngcontent-%COMP%]{background:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}"]})}}return n})();var Z$=[{path:"",component:X$},{path:"**",redirectTo:""}];var xl={production:!1,firebase:{apiKey:"AIzaSyCUJfZ1Ff0wBhQ-ZggZNJP_xcZ9N-Stn7A",authDomain:"aiplayground-6e5be.firebaseapp.com",projectId:"aiplayground-6e5be",storageBucket:"aiplayground-6e5be.firebasestorage.app",messagingSenderId:"236516094288",appId:"1:236516094288:web:6b8640736a959ce4eabc55",measurementId:"G-R8RH83Z0NY"},useEmulator:!0};var J$={providers:[FN(Z$),uO(()=>dO(xl.firebase)),nk(()=>{let n=ik();return xl.useEmulator&&rk(n,"http://localhost:9099"),n}),tL(()=>{let n=iL();return xl.useEmulator&&nL(n,"localhost",8080),n}),NL(()=>{let n=LL();return xl.useEmulator&&OL(n,"localhost",9199),n}),GL(()=>{let n=KL();if(xl.useEmulator)try{WL(n,"localhost",5001)}catch(e){console.warn("Functions emulator connection failed, might already be connected:",e)}return n})]};function Qre(n,e){if(n&1){let t=ir();Z(0,"div",6)(1,"span",7),_e(2,"Signed in"),W(),Z(3,"button",8),Tt("click",function(){Yt(t);let i=nt();return Qt(i.signOut())}),_e(4,"Sign Out"),W()()}}function Xre(n,e){n&1&&(Z(0,"span",11),_e(1,"Signing in..."),W())}function Zre(n,e){if(n&1){let t=ir();Z(0,"button",12),Tt("click",function(){Yt(t);let i=nt(2);return Qt(i.signInAnonymously())}),_e(1,"Sign In"),W()}}function Jre(n,e){if(n&1&&(Z(0,"div",6),_t(1,Xre,2,0,"span",9)(2,Zre,2,0,"button",10),W()),n&2){let t=nt();oe(),je("ngIf",t.loading),oe(),je("ngIf",!t.loading)}}function eie(n,e){n&1&&(Z(0,"main",13),Hs(1,"router-outlet"),W())}function tie(n,e){if(n&1){let t=ir();Z(0,"div",14)(1,"h2"),_e(2,"Please sign in to continue"),W(),Z(3,"p"),_e(4,"You need to be authenticated to use the chatbot."),W(),Z(5,"button",15),Tt("click",function(){Yt(t);let i=nt();return Qt(i.signInAnonymously())}),_e(6),W()()}if(n&2){let t=nt();oe(5),je("disabled",t.loading),oe(),yr(" ",t.loading?"Signing in...":"Sign In Anonymously"," ")}}var eU=(()=>{class n{constructor(t){this.authService=t,this.title="Firebase RAG Chatbot",this.loading=!1,this.user$=this.authService.user$}ngOnInit(){this.user$.subscribe(t=>{!t&&!this.loading&&this.signInAnonymously()})}signInAnonymously(){return g(this,null,function*(){this.loading=!0;try{yield this.authService.signInAnonymously()}catch(t){console.error("Failed to sign in:",t)}finally{this.loading=!1}})}signOut(){return g(this,null,function*(){try{yield this.authService.signOut()}catch(t){console.error("Failed to sign out:",t)}})}static{this.\u0275fac=function(r){return new(r||n)(ke(o_))}}static{this.\u0275cmp=_c({type:n,selectors:[["app-root"]],standalone:!0,features:[Ic],decls:12,vars:9,consts:[["signInButton",""],["authRequired",""],[1,"app-container"],[1,"app-header"],["class","auth-section",4,"ngIf","ngIfElse"],["class","main-content",4,"ngIf","ngIfElse"],[1,"auth-section"],[1,"user-info"],[1,"btn","btn-secondary",3,"click"],["class","loading",4,"ngIf"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"loading"],[1,"btn","btn-primary",3,"click"],[1,"main-content"],[1,"auth-required"],[1,"btn","btn-primary",3,"click","disabled"]],template:function(r,i){if(r&1&&(Z(0,"div",2)(1,"header",3)(2,"h1"),_e(3),W(),_t(4,Qre,5,0,"div",4),Uw(5,"async"),_t(6,Jre,3,2,"ng-template",null,0,Hw),W(),_t(8,eie,2,0,"main",5),Uw(9,"async"),_t(10,tie,7,2,"ng-template",null,1,Hw),W()),r&2){let s=lu(7),o=lu(11);oe(3),yr("\u{1F916} ",i.title,""),oe(),je("ngIf",Bw(5,5,i.user$))("ngIfElse",s),oe(4),je("ngIf",Bw(9,7,i.user$))("ngIfElse",o)}},dependencies:[fu,op,zM,Bb],styles:[".app-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column}.app-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 4px #0000001a}.app-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.8rem;font-weight:600}.auth-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.user-info[_ngcontent-%COMP%]{font-size:.9rem;opacity:.9}.main-content[_ngcontent-%COMP%]{flex:1;background:#f8f9fa}.auth-required[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;text-align:center;padding:2rem}.auth-required[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#495057;margin-bottom:.5rem}.auth-required[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;margin-bottom:2rem}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:.25rem;font-size:.9rem;cursor:pointer;transition:all .2s;text-decoration:none;display:inline-block}.btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none}.btn-primary[_ngcontent-%COMP%]{background:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}.btn-secondary[_ngcontent-%COMP%]{background:#fff3;color:#fff;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff4d}.loading[_ngcontent-%COMP%]{font-style:italic;opacity:.8}"]})}}return n})();tN(eU,J$).catch(n=>console.error(n));
