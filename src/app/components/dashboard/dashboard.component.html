<div class="dashboard">
  <!-- Navigation Tabs -->
  <nav class="tab-nav">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'documents'"
      (click)="setActiveTab('documents')">
      üìÑ Documents ({{ documents.length }})
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'chat'"
      (click)="setActiveTab('chat')">
      üí¨ Chat
    </button>
  </nav>

  <!-- Documents Tab -->
  <div class="tab-content" *ngIf="activeTab === 'documents'">
    <div class="documents-section">
      
      <!-- File Upload Area -->
      <div class="upload-area" 
           [class.drag-over]="dragOver"
           [class.uploading]="uploading"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)"
           (drop)="onDrop($event)">
        
        <div class="upload-content" *ngIf="!uploading">
          <div class="upload-icon">üì§</div>
          <h3>Upload PDF Document</h3>
          <p>Drag and drop a PDF file here, or click to select</p>
          <input 
            type="file" 
            accept="application/pdf" 
            (change)="onFileSelect($event)"
            #fileInput
            style="display: none">
          <button class="btn btn-primary" (click)="fileInput.click()">
            Choose File
          </button>
        </div>

        <div class="upload-progress" *ngIf="uploading">
          <div class="spinner"></div>
          <p>{{ uploadProgress }}</p>
        </div>
      </div>

      <!-- Documents List -->
      <div class="documents-list" *ngIf="documents.length > 0">
        <h3>Your Documents</h3>
        <div class="document-grid">
          <div 
            class="document-card" 
            *ngFor="let doc of documents"
            [class.selected]="selectedDocument?.id === doc.id"
            [class.processing]="doc.status === 'processing'"
            [class.error]="doc.status === 'error'"
            (click)="selectDocument(doc)">
            
            <div class="doc-icon">
              <span *ngIf="doc.status === 'completed'">üìÑ</span>
              <span *ngIf="doc.status === 'processing'" class="processing-icon">‚è≥</span>
              <span *ngIf="doc.status === 'error'">‚ùå</span>
            </div>
            
            <div class="doc-info">
              <h4>{{ doc.filename }}</h4>
              <div class="doc-meta">
                <span class="doc-status" [class]="doc.status">{{ doc.status }}</span>
                <span class="doc-pages" *ngIf="doc.pageCount > 0">{{ doc.pageCount }} pages</span>
                <span class="doc-date">{{ doc.createdAt.toLocaleDateString() }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="documents.length === 0 && !uploading">
        <p>No documents uploaded yet. Start by uploading your first PDF!</p>
      </div>
    </div>
  </div>

  <!-- Chat Tab -->
  <div class="tab-content" *ngIf="activeTab === 'chat'">
    <div class="chat-layout">
      
      <!-- Chat Sidebar -->
      <aside class="chat-sidebar">
        <div class="sidebar-header">
          <h3>Chat Sessions</h3>
          <button class="btn btn-small btn-primary" (click)="createNewSession()">
            + New Chat
          </button>
        </div>

        <div class="sessions-list">
          <div 
            class="session-item"
            *ngFor="let session of sessions"
            [class.active]="currentSession?.id === session.id"
            (click)="selectSession(session)">
            <div class="session-title">{{ session.title }}</div>
            <div class="session-date">{{ session.createdAt.toLocaleDateString() }}</div>
          </div>
        </div>

        <div class="document-filter" *ngIf="documents.length > 0">
          <h4>Filter by Document</h4>
          <select class="doc-select" [(ngModel)]="selectedDocument">
            <option [ngValue]="null">All documents</option>
            <option 
              *ngFor="let doc of documents" 
              [ngValue]="doc"
              [disabled]="doc.status !== 'completed'">
              {{ doc.filename }}
            </option>
          </select>
        </div>

      </aside>

      <!-- Chat Main -->
      <main class="chat-main">
        <div class="chat-header" *ngIf="currentSession">
          <h2>{{ currentSession.title }}</h2>
          <div class="chat-info" *ngIf="selectedDocument">
            <span class="document-badge">üìÑ {{ selectedDocument.filename }}</span>
          </div>
        </div>

        <div class="messages-container" *ngIf="currentSession">
          <div class="messages-list">
            <div 
              class="message"
              *ngFor="let message of messages"
              [class.user-message]="message.role === 'user'"
              [class.assistant-message]="message.role === 'assistant'">
              
              <div class="message-content">
                <div class="message-text">{{ message.content }}</div>
                <div class="message-sources" *ngIf="message.sources && message.sources.length > 0">
                  <h5>Sources:</h5>
                  <div class="source-tags">
                    <span 
                      class="source-tag" 
                      *ngFor="let source of message.sources">
                      {{ source.label }}
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="message-time">
                {{ message.createdAt.toLocaleTimeString() }}
              </div>
            </div>

            <div class="message assistant-message" *ngIf="sending">
              <div class="message-content">
                <div class="typing-indicator">
                  <span></span><span></span><span></span>
                </div>
              </div>
            </div>
          </div>

          <div class="message-input-area">
            <div class="input-wrapper">
              <textarea 
                class="message-input"
                [(ngModel)]="messageInput"
                (keydown)="onEnterKey($event)"
                placeholder="Ask a question about your documents..."
                rows="2"
                [disabled]="sending || documents.length === 0"></textarea>
              <button 
                class="send-btn"
                (click)="sendMessage()"
                [disabled]="!messageInput.trim() || sending || documents.length === 0">
                <span *ngIf="!sending">‚û§</span>
                <span *ngIf="sending" class="sending-icon">‚è≥</span>
              </button>
            </div>
            <div class="input-help" *ngIf="documents.length === 0">
              Upload some documents first to start chatting!
            </div>
          </div>
        </div>

        <div class="empty-chat" *ngIf="!currentSession">
          <h3>Welcome to RAG Chatbot! ü§ñ</h3>
          <p>Create a new chat session to start asking questions about your documents.</p>
          <button class="btn btn-primary" (click)="createNewSession()">
            Start New Chat
          </button>
        </div>
      </main>
    </div>
  </div>
</div>